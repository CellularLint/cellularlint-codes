4  General

4.1  Overview

The non-access stratum (NAS) described in the present document forms the highest stratum of the control plane between UE and MME at the radio interface (reference point "LTE-Uu"; see 3GPP  S  23.401  [10]).

Main functions of the protocols that are part of the NAS are:

-  the support of mobility of the user equipment (UE); and

-  the support of session management procedures to establish and maintain IP connectivity between the UE and a packet data network gateway (PDN GW).

NAS security is an additional function of the NAS providing services to the NAS protocols, e.g. integrity protection and ciphering of NAS signalling messages.

For the support of the above functions, the following procedures are supplied within this specification:

-  elementary procedures for EPS mobility management in clause  5; and

-  elementary procedures for EPS session management in clause  6.

Complete NAS transactions consist of specific sequences of elementary procedures. Examples of such specific sequences can be found in 3GPP  S  23.401  [10].

The NAS for EPS follows the protocol architecture model for layer  3 as described in 3GPP  S  24.007  [12]; however, due to the objective of EPS to provide the subscriber with a "ready-to-use" IP connectivity and an "always-on" experience, the protocol supports a linkage between mobility management and session management procedures during the attach procedure (see clause  4.2).

Signalling procedures for the control of NAS security are described as part of the EPS mobility management in clause  5. In addition to that, principles for the handing of EPS security contexts and for the activation of ciphering and integrity protection, when a NAS signalling connection is established, are provided in clause  4.4.

4.2  Linkage between the protocols for EPS mobility management and EPS session management

During the EPS attach procedure, the network can activate a default EPS bearer context (i.e. if the UE requests PDN connectivity in the attach request). Additionally, the network can activate one or several dedicated EPS bearer contexts in parallel for PDN connections of IP or Ethernet PDN type. To this purpose the EPS session management messages for the default EPS bearer context activation can be transmitted in an information element in the EPS mobility management messages. In this case, the UE and the network execute the attach procedure, the default EPS bearer context activation procedure, and the dedicated EPS bearer context activation procedure in parallel. The UE and network shall complete the combined default EPS bearer context activation procedure and the attach procedure before the dedicated EPS bearer context activation procedure is completed. If EMM-REGISTERED without PDN connection is not supported by the UE or the MME, then the success of the attach procedure is dependent on the success of the default EPS bearer context activation procedure. If the attach procedure fails, then the ESM procedures also fail.

A UE using EPS services with control plane CIoT EPS optimization can initiate transport of user data via the control plane. For this purpose a UE in EMM-IDLE mode can initiate the service request procedure and transmit the ESM DATA TRANSPORT message in an information element in the CONTROL PLANE SERVICE REQUEST message.

Except for the attach procedure and the service request procedure, during EMM procedures the MME shall suspend the transmission of ESM messages. During the service request procedure the MME may suspend the transmission of ESM messages.

Except for the attach procedure and the service request procedure for UE initiated transport of user data via the control plane, during EMM procedures the UE shall suspend the transmission of ESM messages.

4.2A  Handling of NAS signalling low priority indication

A UE configured for NAS signalling low priority (see 3GPP  S  24.368  [15A], 3GPP  S  31.102  [17]) indicates this by including the Device properties IE in the appropriate NAS message and setting the low priority indicator to "MS is configured for NAS signalling low priority", except for the following cases in which the UE shall set the low priority indicator to "MS is not configured for NAS signalling low priority":

-  the UE is performing an attach for emergency bearer services;

-  the UE has a PDN connection for emergency bearer services established and is performing EPS mobility management procedures, or is establishing a PDN connection for emergency bearer services;

-  the UE configured for dual priority is requested by the upper layers to establish a PDN connection with the low priority indicator set to "MS is not configured for NAS signalling low priority";

-  the UE configured for dual priority is performing EPS session management procedures related to the PDN connection established with low priority indicator set to "MS is not configured for NAS signalling low priority";

-  the UE configured for dual priority has a PDN connection established by setting the low priority indicator to "MS is not configured for NAS signalling low priority" and is performing EPS mobility management procedures;

-  the UE is performing a service request procedure for a CS fallback emergency call or 1xCS fallback emergency call;

-  the UE is a UE configured to use AC11        15 in selected PLMN; or

-  the UE is responding to paging.

The network may use the NAS signalling low priority indication for NAS level mobility management congestion control and APN based congestion control.

If the NAS signalling low priority indication is provided in a PDN CONNECTIVITY REQUEST message, the MME stores the NAS signalling low priority indication within the default EPS bearer context activated due to the PDN connectivity request procedure.

4.3  UE mode of operation

4.3.1  General

A UE attached for EPS services shall operate in one of the following operation modes:

-  PS mode 1 of operation: the UE registers only to EPS services, and UE   's usage setting is "voice centric";

-  PS mode 2 of operation: the UE registers only to EPS services, and UE   's usage setting is "data centric";

-  CS/PS mode 1 of operation: the UE registers to both EPS and non-EPS services, and UE   's usage setting is "voice centric"; and

-  CS/PS mode 2 of operation: the UE registers to both EPS and non-EPS services, and UE   's usage setting is "data centric".

A UE configured to use CS fallback, shall operate in CS/PS mode 1 or CS/PS mode 2. Such UE may also be configured to use IMS, in which case the voice domain preference for E-UTRAN as defined in 3GPP  S  24.167  [13B] shall be used for the selection of the domain for originating voice communication services.

NOTE  1:  The domain selected for originating voice communication services can be ignored by attempting a CS emergency call.

Upon request from upper layers to establish a CS emergency call:

-  if the UE needs to initiate a CS fallback emergency call but it is unable to perform CS fallback, the UE shall attempt to select GERAN or UTRAN radio access technology, and a UE with "IMS voice not available" should disable the E-UTRA capability (see clause  4.5) to allow a potential callback, and then progress the CS emergency call establishment;

-  if the UE needs to initiate a 1xCS fallback emergency call but it is unable to perform 1xCS fallback, the UE shall attempt to select cdma2000   xae 1x radio access technology to establish the call.

NOTE  2:  Unable to perform CS fallback or 1xCS fallback means that either the UE was not allowed to attempt CS fallback or 1xCS fallback, or CS fallback or 1xCS fallback attempt failed.

A UE configured to use SMS over SGs shall operate in CS/PS mode 1 or CS/PS mode 2.

The behaviour of the UE in CS/PS mode 1 of operation, upon failure to access the CS domain or upon reception of a "CS fallback not preferred" or "SMS only" indication, will depend on the availability of voice over IMS. In the present document, "IMS voice not available" refers to one of the following conditions:

a)  the UE is not configured to use IMS;

b)  the UE is not configured to use IMS voice, i.e. when the voice domain preference for E-UTRAN, as defined in 3GPP  S  24.167  [13B], indicates that voice communication services are allowed to be invoked only over the CS domain;

c)  the UE is configured to use IMS voice, but the network indicates in the ATTACH ACCEPT message or the TRACKING AREA UPDATE ACCEPT message that IMS voice over PS sessions are not supported; or

d)  the UE is configured to use IMS voice, the network indicates in the ATTACH ACCEPT message or the TRACKING AREA UPDATE ACCEPT message that IMS voice over PS sessions are supported, but the upper layers:

-  provide no indication that the UE is available for voice call in the IMS within a manufacturer determined period of time; or

-  indicate that the UE is not available for voice calls in the IMS.

NOTE  3:  If conditions  a, b and c evaluate to false, the upper layers need time to attempt IMS registration. In the event an indication from the upper layers that the UE is available for voice calls in the IMS takes longer than the manufacturer determined period of time (e.g. due to delay when attempting IMS registration or due to delay obtaining an EPS bearer context for SIP signalling), the NAS layer assumes the UE is not available for voice calls in the IMS.

Other conditions may exist but these are implementation specific.

In the present document, "IMS voice available" refers to the conditions a, b, c and d, and other implementation specific conditions for "IMS voice not available" evaluate to false.

4.3.2  Change of UE mode of operation

4.3.2.1  General

The UE mode of operation can change as a result of e.g.:

-  a change of UE   's usage setting for a CS voice capable UE;

-  a change of voice domain preference for E-UTRAN as defined in 3GPP  S  24.167  [13B] for a CS voice capable UE;

-  a change in the UE   's availability for voice calls in the IMS; or

-  a change in UE configuration regarding the use of SMS as defined in 3GPP  S  24.167  [13B].

Figure  4.3.2.1.1 and figure  4.3.2.1.2 illustrate the transitions between different UE mode of operations when UE   's usage settings, voice domain preference for E-UTRAN or configuration regarding SMS changes.



NOTE  1:  The UE may transit from CS/PS mode 1 to PS mode 1 or from CS/PS mode 2 to PS mode 2 if "CS domain not available" is received. After the transition to PS mode 1 or PS mode 2 due to "CS domain not available", the UE can transit back to CS/PS mode 1 or CS/PS mode 2, e.g. due to change of PLMN which is not in the list of the equivalent PLMNs.

NOTE  2:  Not all possible transitions are shown in this figure.



Figure 4.3.2.1.1: Change of UE mode of operation for a CS voice capable UE



NOTE:  Not all possible transitions are shown in this figure.



Figure 4.3.2.1.2: Change of UE mode of operation for a UE with no CS voice capability

4.3.2.2  Change of UE   's usage setting

Whenever the UE   's usage setting changes, the UE dependent on its mode of operation shall execute procedures according to table  4.3.2.2.1 and table  4.3.2.2.2:

a)  The UE is operating in PS mode 1 or PS mode 2

Table 4.3.2.2.1: Change of UE   's usage setting for a UE in PS mode 1 or PS mode 2

UE   's usage setting change

Procedure to execute

From data centric to voice centric and "IMS voice not available"

Disable the E-UTRA capability if voice domain selection results in a selection to a different RAT (see clause  4.5), or combined tracking area update with IMSI attach if voice domain selection results in attempt to stay in E-UTRAN.



From voice centric to data centric and E-UTRA is disabled

Re-enable the E-UTRA capability (see clause  4.5)



b)  The UE is operating in CS/PS mode 1 or CS/PS mode 2

Table 4.3.2.2.2: Change of UE   's usage setting for a UE in CS/PS mode 1 or CS/PS mode 2

UE   's usage setting change

Procedure to execute

From data centric to voice centric, "CS fallback is not available" and "IMS voice not available" (NOTE 1)

Disable the E-UTRA capability (see clause  4.5)



From data centric to voice centric, "IMS voice not available" and the UE received a "CS fallback not preferred" or "SMS only" indication during the last successful combined attach or combined tracking area updating procedure

Disable the E-UTRA capability (see clause  4.5)



From voice centric to data centric and E-UTRA is disabled

Re-enable the E-UTRA capability (see clause  4.5)

NOTE 1:  "CS fallback is not available" includes EMM causes #16, #17, and #18



4.3.2.3  Change of voice domain preference for E-UTRAN

Whenever the voice domain preference for E-UTRAN changes, the UE dependent on its mode of operation shall execute procedures according to table  4.3.2.3.1 and table  4.3.2.3.2:

a)  The UE is operating in PS mode 1 or PS mode 2

Table 4.3.2.3.1: Change of voice domain preference for E-UTRAN for a UE in PS mode 1 or PS mode 2

Voice domain preference for E-UTRAN change

Procedure to execute

From "IMS PS voice only" to "CS voice only" or "CS voice preferred, IMS PS Voice as secondary"

Transit from PS mode 1 to CS/PS mode 1 or from PS mode 2 to CS/PS mode 2. Combined tracking area update with IMSI attach

From "IMS PS voice preferred, CS Voice as secondary" to "CS voice only" or "CS voice preferred, IMS PS Voice as secondary"

Transit from PS mode 1 to CS/PS mode 1 or from PS mode 2 to CS/PS mode 2. Combined tracking area update with IMSI attach



b)  The UE is operating in CS/PS mode 1 or CS/PS mode 2

Table 4.3.2.3.2: Change of voice domain preference for E-UTRAN for a UE in CS/PS mode 1 or CS/PS mode 2

Voice domain preference for E-UTRAN change

Procedure to execute

From any configuration to "IMS PS voice only", UE is configured to prefer SMS over IP networks and the UE is available for voice calls in the IMS.

May:

-  transit from CS/PS mode 1 to PS mode 1 or from CS/PS mode 2 to PS mode 2; and

-  detach for non-EPS services

From any configuration to "CS voice only", UE is in CS/PS mode 1 of operation and "CS fallback is not available"(NOTE  1)

Disable the E-UTRA capability (see clause  4.5)

From any configuration to "CS voice only", UE is in CS/PS mode 1 of operation and the UE received a "CS fallback not preferred" or "SMS only" indication during the last successful combined attach or combined tracking area updating procedure.

Disable the E-UTRA capability (see clause  4.5)

From "CS voice only" to any configuration and E-UTRA capability was disabled due to change of voice domain preference for E-UTRAN.

Re-enable the E-UTRA capability (see clause  4.5).

If an RR or RRC connection exists, the UE shall delay re-enabling the E-UTRA capability until the RR or RRC connection is released.

NOTE  1:  "CS fallback is not available" includes EMM causes #16, #17, and #18



4.3.2.4  Change or determination of IMS registration status

Whenever the UE   's availability for voice calls in the IMS is determined or changes (e.g. whenever the IMS registration status is determined or changes), the UE dependent on its mode of operation shall execute procedures according to table  4.3.2.4.1, 4.3.2.4.2 or 4.3.2.4.3:

a)  The UE is operating in PS mode 1

Table 4.3.2.4.1: Change of IMS registration status for a UE in PS mode 1

Change of IMS registration status

Procedure to execute

UE is not available for voice calls in the IMS indication and voice domain preference for E-UTRAN is "IMS PS voice preferred, CS Voice as secondary"

Transit to CS/PS mode 1. Combined tracking area update with IMSI attach



UE is not available for voice calls in the IMS indication, SMS configuration is set to prefer to use SMS over IP networks, and voice domain preference for E-UTRAN is "IMS PS voice only"

Disable the E-UTRA capability (see clause  4.5)



UE is not available for voice calls in the IMS indication, SMS configuration is set to prefer to use SMS over IP networks, and UE is not CS voice capable

May disable the E-UTRA capability (see clause  4.5)





NOTE  1:  If the UE in PS mode 1 transits to CS/PS mode 1 according to table  4.3.2.4.1, then the UE can return to PS mode 1 when the upper layer indicates the status of being available for voice over PS.

b)  The UE is operating in PS mode 2

Table 4.3.2.4.2: Change of IMS registration status for a UE in PS mode 2

Change of IMS registration status

Procedure to execute

UE is not available for voice calls in the IMS indication and voice domain preference for E-UTRAN is "IMS PS voice preferred, CS Voice as secondary"

Transit to CS/PS mode 2. Combined tracking area update with IMSI attach



Unsuccessful IMS registration indication from upper layers, SMS configuration is set to prefer to use SMS over IP networks, and voice domain preference for E-UTRAN is "IMS PS voice only"

Transit to CS/PS mode 2. Combined tracking area update with "SMS only"



Unsuccessful IMS registration indication from upper layers, SMS configuration is set to prefer to use SMS over IP networks, and UE is not CS voice capable

Transit to CS/PS mode 2. Combined tracking area update with "SMS only"





NOTE  2:  If the UE in PS mode 2 transits to CS/PS mode 2 according to table  4.3.2.4.2, then the UE can return to PS mode 2 when the upper layer indicates the status of being available for voice over PS.

c)  The UE is operating in CS/PS mode 1

Table 4.3.2.4.3: Change of IMS registration status for a UE in CS/PS mode 1

Change of IMS registration status

Procedure to execute

UE is not available for voice calls in the IMS indication, and any of: 
- "CS fallback is not available" (NOTE 1); or 
- the UE received a "CS fallback not preferred" or "SMS only" indication during the last successful combined attach or combined tracking area updating procedure

Disable the E-UTRA capability (see clause 4.5)

UE is not available for voice calls in the IMS indication, 
UE is in state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM and timer T3402 is running

May disable the E-UTRA capability (see clause  4.5)



NOTE 1:  "CS fallback is not available" includes EMM causes #16, #17, and #18



4.3.2.5  Change of configuration regarding the use of SMS.

Whenever the UE   's configuration on use of SMS changes, the UE dependent on its mode of operation shall execute procedures according to table  4.3.2.5.1 and table  4.3.2.5.2:

a)  The UE is operating in PS mode 1 or PS mode 2

Table 4.3.2.5.1: Change of configuration regarding the use of SMS in PS mode 1 or PS mode 2

SMS configuration change

Procedure to execute

Change to "SMS service is not preferred to be invoked over IP networks" or the UE is unable to use SMS using IMS (see 3GPP  S  24.229  [13D]).

Transit from PS mode 1 to CS/PS mode 1 or from PS mode 2 to CS/PS mode 2. Combined tracking area update with IMSI attach, (with or without "SMS only")



b)  The UE is operating in CS/PS mode 1 or CS/PS mode 2

Table 4.3.2.5.2: Change of configuration regarding the use of SMS in CS/PS mode 1 or CS/PS mode 2

SMS configuration change

Procedure to execute

Change to "SMS service is preferred to be invoked over IP networks", the UE is able to use SMS using IMS (see 3GPP  S  24.229  [13D]), and UE has no CS voice capability

May:

-  transit from CS/PS mode 1 to PS mode 1 or from CS/PS mode 2 to PS mode 2; and

-  detach for non-EPS services

Change to "SMS service is preferred to be invoked over IP networks", UE is able to use SMS using IMS (see 3GPP  S  24.229  [13D]), and the voice domain preference for E-UTRAN is "IMS PS voice only" 

May:

-  transit from CS/PS mode 1 to PS mode 1 or from CS/PS mode 2 to PS mode 2; and

-  detach for non-EPS services



4.4  NAS security

4.4.1  General

This clause describes the principles for the handling of EPS security contexts in the UE and in the MME and the procedures used for the security protection of EPS NAS messages between UE and MME. Security protection involves integrity protection and ciphering of the EMM and ESM NAS messages.

The signalling procedures for the control of NAS security are part of the EMM protocol and are described in detail in clause  5.

NOTE:  The use of ciphering in a network is an operator option. In this clause, for the ease of description, it is assumed that ciphering is used, unless explicitly indicated otherwise. Operation of a network without ciphering is achieved by configuring the MME so that it always selects the "null ciphering algorithm", EEA0.

4.4.2  Handling of EPS security contexts

4.4.2.1  General

The security parameters for authentication, integrity protection and ciphering are tied together in an EPS security context and identified by a key set identifier for E-UTRAN (eKSI). The relationship between the security parameters is defined in 3GPP  S  33.401  [19].

Before security can be activated, the MME and the UE need to establish an EPS security context. Usually, the EPS security context is created as the result of an EPS authentication procedure between MME and UE. Alternatively:

-  during inter-system handover from A/Gb mode to S1 mode or from Iu mode to S1 mode, the MME and the UE derive a mapped EPS security context from a UMTS security context that has been established while the UE was in A/Gb mode or Iu mode; or

-  during CS to PS SRVCC handover from A/Gb mode to S1 mode or from Iu mode to S1 mode, the MME and the UE derive a mapped EPS security context from a CS UMTS security context that has been established while the UE was in A/Gb mode or Iu mode.

The EPS security context is taken into use by the UE and the MME, when the MME initiates a security mode control procedure or during the inter-system handover procedure from A/Gb mode to S1 mode or Iu mode to S1 mode. The EPS security context which has been taken into use by the network most recently is called current EPS security context. This current EPS security context can be of type native or mapped, i.e. originating from a native EPS security context or mapped EPS security context.

The key set identifier eKSI is assigned by the MME either during the EPS authentication procedure or, for the mapped EPS security context, during the inter-system handover procedure. The eKSI consists of a value and a type of security context parameter indicating whether an EPS security context is a native EPS security context or a mapped EPS security context. When the EPS security context is a native EPS security context, the eKSI has the value of KSIASME, and when the current EPS security context is of type mapped, the eKSI has the value of KSISGSN.

The EPS security context which is indicated by an eKSI can be taken into use to establish the secure exchange of NAS messages when a new NAS signalling connection is established without executing a new EPS authentication procedure (see clause  4.4.2.3) or when the MME initiates a security mode control procedure. For this purpose the initial NAS messages (i.e. ATTACH REQUEST, TRACKING AREA UPDATE REQUEST, DETACH REQUEST, SERVICE REQUEST, EXTENDED SERVICE REQUEST, and CONTROL PLANE SERVICE REQUEST) and the SECURITY MODE COMMAND message contain an eKSI in the NAS key set identifier IE or the value part of eKSI in the KSI and sequence number IE indicating the current EPS security context used to integrity protect the NAS message.

In the present document, when the UE is required to delete an eKSI, the UE shall set the eKSI to the value "no key is available" and consider also the associated keys KASME or K   'ASME, EPS NAS ciphering key and EPS NAS integrity key invalid (i.e. the EPS security context associated with the eKSI as no longer valid).

NOTE:  In some specifications the term ciphering key sequence number might be used instead of the term Key Set Identifier (KSI).

The UE and the MME need to be able to maintain two EPS security contexts simultaneously, i.e. a current EPS security context and a non-current EPS security context, since:

-  after an EPS re-authentication, the UE and the MME can have both a current EPS security context and a non-current EPS security context which has not yet been taken into use (i.e. a partial native EPS security context); and

-  after an inter-system handover from A/Gb mode to S1 mode or Iu mode to S1 mode, the UE and the MME can have both a mapped EPS security context, which is the current EPS security context, and a non-current native EPS security context that was created during a previous access in S1 mode or S101 mode.

The number of EPS security contexts that need to be maintained simultaneously by the UE and the MME is limited by the following requirements:

-  After a successful EPS (re-)authentication, which creates a new partial native EPS security context, the MME and the UE shall delete the non-current EPS security context, if any.

-  When a partial native EPS security context is taken into use through a security mode control procedure, the MME and the UE shall delete the previously current EPS security context.

-  When the MME and the UE create an EPS security context using null integrity and null ciphering algorithm during an attach procedure for emergency bearer services, or a tracking area updating procedure for a UE that has a PDN connection for emergency bearer services (see clause  5.4.3.2), the MME and the UE shall delete the previous current EPS security context.

-  When a new mapped EPS security context or EPS security context created using null integrity and null ciphering algorithm is taken into use during the inter-system handover from A/Gb mode to S1 mode or Iu mode to S1 mode, the MME and the UE shall not delete the previously current native EPS security context, if any. Instead, the previously current native EPS security context shall become a non-current native EPS security context, and the MME and the UE shall delete any partial native EPS security context.

  If no previously current native EPS security context exists, the MME and the UE shall not delete the partial native EPS security context, if any.

-  When the MME and the UE derive a new mapped EPS security context during inter-system handover from A/Gb mode to S1 mode or Iu mode to S1 mode, the MME and the UE shall delete any existing current mapped EPS security context.

-  When a non-current full native EPS security context is taken into use by a security mode control procedure, then the MME and the UE shall delete the previously current mapped EPS security context.

-  When the UE or the MME moves from EMM-REGISTERED to EMM-DEREGISTERED state, if the current EPS security context is a mapped EPS security context and a non-current full native EPS security context exists, then the non-current EPS security context shall become the current EPS security context. Furthermore, the UE and the MME shall delete any mapped EPS security context or partial native EPS security context.

The UE shall mark the EPS security context on the USIM or in the non-volatile memory as invalid when the UE initiates an attach procedure as described in clause  5.5.1 or when the UE leaves state EMM-DEREGISTERED for any other state except EMM-NULL.

The UE shall store the current native EPS security context as specified in annex  C and mark it as valid only when the UE enters state EMM-DEREGISTERED from any other state except EMM-NULL or when the UE aborts the attach procedure without having left EMM-DEREGISTERED.

4.4.2.2  Establishment of a mapped EPS security context during intersystem handover

In order for the UE to derive a mapped EPS security context for an inter-system change from A/Gb mode or Iu mode to S1 mode in EMM-CONNECTED mode, the MME shall generate a KSISGSN, create a nonceMME and generate the K   'ASME using the created nonceMME as indicated in 3GPP  S  33.401  [19]. The MME shall include the selected NAS algorithms, nonceMME and generated KSISGSN (associated with the K   'ASME) in the NAS security transparent container for handover to E-UTRAN. The MME shall derive the EPS NAS keys from K   'ASME.

When the UE receives the command to perform handover to E-UTRAN, the UE shall derive K   'ASME, as indicated in 3GPP  S  33.401  [19], using the nonceMME received in the NAS security transparent container. Furthermore, the UE shall associate the derived K   'ASME with the received KSISGSN and derive the EPS NAS keys from K   'ASME.

When the UE has a PDN connection for emergency bearer services and has no current UMTS security context, the MME shall set EIA0 and EEA0 as the selected NAS security algorithms in the NAS security transparent container for handover to E-UTRAN. The MME shall create a locally generated K   'ASME. The MME shall set the KSI value of the associated security context to "000" and the type of security context flag to "mapped security context" in the NAS security transparent container for handover to E-UTRAN.

When the UE receives the command to perform handover to E-UTRAN and has a PDN connection for emergency bearer services, if EIA0 and EEA0 as the selected NAS security algorithms are included in the NAS security transparent container for handover to E-UTRAN, the UE shall create a locally generated K   'ASME. The UE shall set the KSI value of the associated security context to the KSI value received.

If the inter-system change from A/Gb mode or Iu mode to S1 mode in EMM-CONNECTED mode is not completed successfully, the MME and the UE shall delete the new mapped EPS security context.

The establishment of a mapped EPS security context during inter-system change from N1 mode to S1 mode in EMM-CONNECTED mode is specified in 3GPP  S  24.501  [54] clause  4.4.2.4.

4.4.2.3  Establishment of secure exchange of NAS messages

Secure exchange of NAS messages via a NAS signalling connection is usually established by the MME during the attach procedure by initiating a security mode control procedure. After successful completion of the security mode control procedure, all NAS messages exchanged between the UE and the MME are sent integrity protected using the current EPS security algorithms, and except for the messages specified in clause  4.4.5, all NAS messages exchanged between the UE and the MME are sent ciphered using the current EPS security algorithms.

During inter-system handover from A/Gb mode to S1 mode or Iu mode to S1 mode, secure exchange of NAS messages is established between the MME and the UE by:

-  the transmission of NAS security related parameters encapsulated in the AS signalling from the MME to the UE triggering the inter-system handover (see 3GPP  S  33.401  [19]). The UE uses these parameters to generate the mapped EPS security context; and,

-  after the handover, the transmission of a TRACKING AREA UPDATE REQUEST message from the UE to the MME. The UE shall send this message integrity protected using the mapped EPS security context, but unciphered. From this time onward, all NAS messages exchanged between the UE and the MME are sent integrity protected using the mapped EPS security context, and except for the messages specified in clause  4.4.5, all NAS messages exchanged between the UE and the MME are sent ciphered using the mapped EPS security context.

During inter-system change from N1 mode to S1 mode in EMM-CONNECTED mode, secure exchange of NAS messages is established between the MME and the UE by:

-  the transmission of NAS security related parameters encapsulated in the AS signalling from the AMF to the UE triggering the inter-system handover (see 3GPP  S  33.501  [56]). The UE uses these parameters to generate the mapped EPS security context (see clause  8.6.1 of 3GPP  S  33.501  [56]); and

-  after the handover, the transmission of a TRACKING AREA UPDATE REQUEST message from the UE to the MME. The UE shall send this message integrity protected using the mapped EPS security context, but unciphered. From this time onward, all NAS messages exchanged between the UE and the MME are sent integrity protected using the mapped EPS security context, and except for the messages specified in clause  4.4.5, all NAS messages exchanged between the UE and the MME are sent ciphered using the mapped EPS security context.

During inter-system change from N1 mode to S1 mode in EMM-IDLE mode, if the UE is operating in the single-registration mode and:

1)  if the tracking area updating procedure is initiated as specified in 3GPP  S  24.501  [54], the UE shall transmit a TRACKING AREA UPDATE REQUEST message integrity protected with the current 5G NAS security context and the UE shall derive a mapped EPS security context (see clause  8.6.1 of 3GPP  S  33.501  [56]). The UE shall set the uplink and downlink NAS COUNT counters to the uplink and downlink NAS COUNT counters of the current 5G NAS security context respectively. The UE shall include the eKSI indicating the 5G NAS security context value in the TRACKING AREA UPDATE REQUEST message.

  After receiving the TRACKING AREA UPDATE REQUEST message including the eKSI, the MME forwards the TRACKING AREA UPDATE REQUEST message to the source AMF, if possible, to obtain the mapped EPS security context from the AMF as specified in 3GPP  S  33.501  [56]. The MME shall store the mapped EPS NAS security context with the uplink and downlink NAS COUNT counters associated with the derived K   'ASME key set to the uplink and downlink NAS COUNT counters of the mapped EPS NAS security context respectively. The MME re-establishes the secure exchange of NAS messages by either:

-  replying with a TRACKING AREA UPDATE ACCEPT message that is integrity protected and ciphered using the mapped EPS security context. From this time onward, all NAS messages exchanged between the UE and the MME are sent integrity protected and except for the messages specified in clause  4.4.5, all NAS messages exchanged between the UE and the MME are sent ciphered; or

-  initiating a security mode control procedure. This can be used by the MME to take a non-current EPS security context into use or to modify the current EPS security context by selecting new NAS security algorithms; or

2)  if the attach procedure is initiated as specified in 3GPP  S  24.501  [54] and:

a)  if the UE has received an "interworking without N26 interface not supported" indication from the network and the UE has a valid 5G NAS security context, the UE shall send an ATTACH REQUEST message integrity protected with the current 5G NAS security context and the UE shall derive a mapped EPS security context (see clause  8.6.1 of 3GPP  S  33.501  [56]). The UE shall set the uplink and downlink NAS COUNT counters to the uplink and downlink NAS COUNT counters of the current 5G NAS security context respectively. The UE shall include the eKSI indicating the 5G NAS security context value in the ATTACH REQUEST message.

  After receiving the ATTACH REQUEST message including the eKSI, the MME forwards the ATTACH REQUEST message to the source AMF, if possible, to obtain the mapped EPS security context from the AMF as specified in 3GPP  S  33.501  [56]. The MME shall store the mapped EPS NAS security context with the uplink and downlink NAS COUNT counters associated with the derived K   'ASME key set to the uplink and downlink NAS COUNT counters of the mapped EPS NAS security context respectively. The MME re-establishes the secure exchange of NAS messages by either:

-  replying with an ATTACH ACCEPT message that is integrity protected and ciphered using the mapped EPS NAS security context. From this time onward, all NAS messages exchanged between the UE and the MME are sent integrity protected and except for the messages specified in clause  4.4.5, all NAS messages exchanged between the UE and the MME are sent ciphered; or

-  initiating a security mode control procedure. This can be used by the MME to modify the current EPS security context by selecting new NAS security algorithms; or

b)  otherwise:

i)  if the UE has a valid native EPS security context, the UE shall send an ATTACH REQUEST message integrity protected with the native EPS security context. The UE shall include the eKSI indicating the native EPS security context value in the ATTACH REQUEST message.

  After receiving the ATTACH REQUEST message including the eKSI, the MME shall check whether the eKSI included in the initial NAS message belongs to an EPS security context available in the MME, and shall verify the MAC of the NAS message. If the verification is successful, the MME re-establishes the secure exchange of NAS messages by either:

-  replying with an ATTACH ACCEPT message that is integrity protected and ciphered using the current EPS security context. From this time onward, all NAS messages exchanged between the UE and the MME are sent integrity protected and except for the messages specified in clause  4.4.5, all NAS messages exchanged between the UE and the MME are sent ciphered; or

-  initiating a security mode control procedure. This can be used by the MME to modify the current EPS security context by selecting new NAS security algorithms; or

ii)  if the UE has no valid native EPS security context, the UE shall send an ATTACH REQUEST message without integrity protection and encryption.

The secure exchange of NAS messages shall be continued after S1 mode to S1 mode handover. It is terminated after inter-system handover from S1 mode to A/Gb mode or Iu mode or when the NAS signalling connection is released.

When a UE in EMM-IDLE mode establishes a new NAS signalling connection and has a valid current EPS security context, secure exchange of NAS messages can be re-established in the following ways:

1)  Except for the cases described in items  3 and 4 below, the UE shall transmit the initial NAS message integrity protected with the current EPS security context, but unciphered. The UE shall include the eKSI indicating the current EPS security context value in the initial NAS message. The MME shall check whether the eKSI included in the initial NAS message belongs to an EPS security context available in the MME, and shall verify the MAC of the NAS message. If the verification is successful, the MME may re-establish the secure exchange of NAS messages:

-  by replying with a NAS message that is integrity protected and ciphered using the current EPS security context. From this time onward, all NAS messages exchanged between the UE and the MME are sent integrity protected and except for the messages specified in clause 4.4.5, all NAS messages exchanged between the UE and the MME are sent ciphered; or

-  by initiating a security mode control procedure. This can be used by the MME to take a non-current EPS security context into use or to modify the current EPS security context by selecting new NAS security algorithms; or

2)  If the initial NAS message was a SERVICE REQUEST message or EXTENDED SERVICE REQUEST message, secure exchange of NAS messages is triggered by the indication from the lower layers that the user plane radio bearers are successfully set up. After successful completion of the procedure, all NAS messages exchanged between the UE and the MME are sent integrity protected and except for the messages specified in clause 4.4.5, all NAS messages exchanged between the UE and the MME are sent ciphered.

3)  If the UE has no current EPS security context and performs a tracking area updating procedure after an inter-system change in idle mode from A/Gb mode to S1 mode or Iu mode to S1 mode, the UE shall send the TRACKING AREA UPDATE REQUEST message without integrity protection and encryption. The UE shall include a nonce and a GPRS ciphering key sequence number for creation of a mapped EPS security context. The MME creates a fresh mapped EPS security context and takes this context into use by initiating a security mode control procedure and this context becomes the current EPS security context in both the UE and the MME. This re-establishes the secure exchange of NAS messages.

4)  If the initial NAS message is a CONTROL PLANE SERVICE REQUEST message, the UE shall send the message integrity protected. If an ESM message container information element or a NAS message container information element is included the message shall be sent partially ciphered (see clause  4.4.5), otherwise the message shall be sent unciphered. Secure exchange of NAS messages is re-established in the UE:

-  by the indication from the lower layers that the user plane radio bearers are successfully set up;

-  upon receipt of a NAS message (e.g. a SERVICE ACCEPT message or ESM DATA TRANSPORT message) that is integrity protected and ciphered using the current EPS security context; or

-  upon receipt of a SECURITY MODE COMMAND message that has successfully passed the integrity check.

4.4.2.4  Change of security keys

When the MME initiates a re-authentication to create a new EPS security context, the messages exchanged during the authentication procedure are integrity protected and ciphered using the current EPS security context, if any.

Both UE and MME shall continue to use the current EPS security context, until the MME initiates a security mode control procedure. The SECURITY MODE COMMAND message sent by the MME includes the eKSI of the new EPS security context to be used. The MME shall send the SECURITY MODE COMMAND message integrity protected with the new EPS security context, but unciphered. When the UE responds with a SECURITY MODE COMPLETE, it shall send the message integrity protected and ciphered with the new EPS security context.

The MME can also modify the current EPS security context or take the non-current native EPS security context, if any, into use, by sending a SECURITY MODE COMMAND message including the eKSI of the EPS security context to be modified and including a new set of selected NAS security algorithms. In this case the MME shall send the SECURITY MODE COMMAND message integrity protected with the modified EPS security context, but unciphered. When the UE replies with a SECURITY MODE COMPLETE message, it shall send the message integrity protected and ciphered with the modified EPS security context.

4.4.2.5  Derivation of keys at CS to PS SRVCC handover from A/Gb mode to S1 mode or from Iu mode to S1 mode

At change from A/Gb mode to S1 mode or from Iu mode to S1 mode due to CS to PS SRVCC handover (see 3GPP  S  23.216  [8]), the UE shall derive a mapped EPS security context for the PS domain from the UMTS security context for the CS domain.

At change from A/Gb mode to S1 mode due to CS to PS SRVCC handover, ciphering may be started and integrity protection shall be started (see 3GPP  S  36.331  [22]) without any new authentication procedure.

NOTE  1:  CS to PS SRVCC handover from A/Gb mode to S1 mode or from Iu mode to S1 mode is not supported if the current CS security context is a GSM security context.

NOTE  2:  For emergency calls, CS to PS SRVCC handover from A/Gb mode to S1 mode or from Iu mode to S1 mode is not supported.

In order to derive a mapped EPS security context for a CS to PS SRVCC handover from A/Gb mode or Iu mode to S1 mode, the MSC creates a NONCEMSC and generates the CK   'PS and IK   'PS using the CS UMTS integrity key, the CS UMTS ciphering key and the created NONCEMSC as specified in annex  B.6 in 3GPP  S  33.102  [18]. The MSC associates the CK   'PS and IK   'PS with a KSI   'PS. The KSI   'PS is set to the value of the KSICS associated with the CS UMTS integrity key and the CS UMTS ciphering key. The MSC transfers the CK   'PS, IK   'PS and the KSI   'PS to the MME. The MME shall create a mapped EPS security context by setting the K   'ASME to the concatenation of the CK   'PS and IK   'PS received from the MSC (i.e. CK   'PS || IK   'PS). The MME shall associate the K   'ASME with a KSISGSN. The MME shall set KSISGSN to the value of the KSI   'PS received from the MSC. The MME shall include the selected NAS algorithms, NONCEMME and generated KSISGSN (associated with the K   'ASME) in the NAS security transparent container for the handover to E-UTRAN. The MME shall derive the EPS NAS keys from K   'ASME.

When the UE receives the command to perform CS to PS SRVCC handover to S1 mode, the ME shall generate the CK   'PS and IK   'PS using the CS UMTS integrity key, the CS UMTS ciphering key and the received NONCEMSC value in the transparent container in the CS to PS SRVCC handover command as specified in annex  B.6 in 3GPP  S  33.102  [18]. The ME shall ignore the NONCEMME value received in the NAS Security Transparent Container in the CS to PS SRVCC handover command.

NOTE  3:  The NONCEMME value received in the NAS Security Transparent Container for the handover to E-UTRAN is not used by the ME or MME in any key derivation in this handover.

The ME shall create the key K   'ASME by concatenating the derived CK   'PS and IK   'PS (i.e. CK   'PS || IK   'PS.). The ME shall associate the derived key K   'ASME with a KSISGSN. The ME shall set the KSISGSN associated to K   'ASME to the KSISGSN value received in the NAS Security Transparent Container from the network.

NOTE  4:  Although this case is related to the MSC server enhanced for SRVCC, the name KSISGSN is kept to avoid introducing a new name for the same domain.

The ME shall derive the EPS NAS keys (CK   ' and IK   ') from the K   'ASME as specified in 3GPP  S  33.401  [19]. The ME shall apply these derived EPS NAS security keys (CK   ' and IK   '), reset the uplink and downlink NAS COUNT values for the mapped EPS security context (i.e. to the value 0), and replace an already established mapped EPS security context for the PS domain, if any, in the ME, when the CS to PS SRVCC handover from A/Gb mode or Iu mode has been completed successfully. If the already established current EPS security context is of type native, then it shall become the non-current native EPS security context and overwrite any existing non-current native EPS security context in the ME.

The network shall replace an already established mapped EPS security context for the PS domain, if any, when the CS to PS SRVCC handover from A/Gb mode or Iu mode has been completed successfully. If the already established current EPS security context is of type native, then it shall become the non-current native EPS security context and overwrite any existing non-current native EPS security context in the MME.

If the CS to PS SRVCC handover from A/Gb mode or Iu mode has not been completed successfully, the UE and the network shall delete the new derived mapped EPS security context for the PS domain. Additionally, the network shall delete an already established mapped EPS security context for the PS domain, if any, if the eKSI of the already established EPS security context is equal to the KSISGSN of the new derived EPS security context for the PS domain.

4.4.3  Handling of NAS COUNT and NAS sequence number

4.4.3.1  General

Each EPS security context shall be associated with two separate counters NAS COUNT: one related to uplink NAS messages and one related to downlink NAS messages. The NAS COUNT counters use 24 bit internal representation and are independently maintained by UE and MME. The NAS COUNT shall be constructed as a NAS sequence number (8 least significant bits) concatenated with a NAS overflow counter (16 most significant bits).

When NAS COUNT is input to NAS ciphering or NAS integrity algorithms it shall be considered to be a 32-bit entity which shall be constructed by padding the 24-bit internal representation with 8 zeros in the most significant bits.

The value of the uplink NAS COUNT that is stored or read out of the USIM or non-volatile memory as described in annex  C, is the value that shall be used in the next NAS message.

The value of the downlink NAS COUNT that is stored or read out of the USIM or non-volatile memory as described in annex  C, is the largest downlink NAS COUNT used in a successfully integrity checked NAS message.

The value of the uplink NAS COUNT stored in the MME is the largest uplink NAS COUNT used in a successfully integrity checked NAS message.

The value of the downlink NAS COUNT stored in the MME is the value that shall be used in the next NAS message.

The NAS sequence number part of the NAS COUNT shall be exchanged between the UE and the MME as part of the NAS signalling. After each new or retransmitted outbound security protected NAS message, the sender shall increase the NAS COUNT number by one, except for the initial NAS messages if the lower layers indicated the failure to establish the RRC connection (see 3GPP  S  36.331  [22]). Specifically, on the sender side, the NAS sequence number shall be increased by one, and if the result is zero (due to wrap around), the NAS overflow counter shall also be incremented by one (see clause  4.4.3.5). The receiving side shall estimate the NAS COUNT used by the sending side. Specifically, if the estimated NAS sequence number wraps around, the NAS overflow counter shall be incremented by one.

NOTE  0:  When estimating a NAS COUNT, the receiver is required to ensure that a given NAS COUNT value is accepted at most one time, as specified in clause  4.4.3.2.

After the derivation of a NAS token due to an inter-system change from S1mode to A/Gb mode or Iu mode in idle mode as specified in 3GPP  S  24.008  [13], the UE shall increase the uplink NAS COUNT by one.

When the MME receives a NAS token via SGSN during an idle mode inter-system change from S1 mode to A/Gb mode or Iu mode, the MME shall check the NAS token as specified in 3GPP  S  33.401  [19], clause  9.1.1, and update its uplink NAS COUNT with the uplink NAS COUNT value used for the successful check of the NAS token.

NOTE  1:  The MME does not check the NAS token if it is received via SGSN during a connected mode inter-system change from S1 mode to A/Gb mode or Iu mode.

During the handover from UTRAN/GERAN to E-UTRAN, when a mapped EPS security context is derived and taken into use, the MME shall set both the uplink and downlink NAS COUNT counters of this EPS security context to zero. The UE shall set both the uplink and downlink NAS COUNT counters to zero.

When a mapped EPS security context is derived as specified in 3GPP  S  33.501  [56] and taken into use in the following cases:

-  during the inter-system change from N1 mode to S1 mode in 5GMM-CONNECTED mode; or

-  during the inter-system change from N1 mode to S1 mode in EMM-IDLE mode for the UE operating in single-registration mode in a network supporting N26 interface,

the MME shall store the mapped EPS NAS security context with the uplink and downlink NAS COUNT counters associated with the derived K   'ASME key set to the uplink and downlink NAS COUNT counters of the mapped EPS NAS security context respectively. The UE shall set the uplink and downlink NAS COUNT counters to the uplink and downlink NAS COUNT counters of the current 5G NAS security context respectively.

During the handover from E-UTRAN to UTRAN/GERAN the MME signals the current downlink NAS COUNT value in a NAS security transparent container (see clause  9.9.2.6).

During handover to or from E-UTRAN, the MME shall increment downlink NAS COUNT by one after it has created a NAS security transparent container (see clause  9.9.2.6 and 9.9.2.7).

NOTE  2:  During the handover from UTRAN/GERAN to E-UTRAN, the NAS security transparent container (see clause  9.9.2.7) is treated as an implicit SECURITY MODE COMMAND message for the UE and the MME, and therefore the MME regards the sending of the NAS security transparent container as the sending of an initial SECURITY MODE COMMAND message in order to derive and take into use a mapped EPS security context for the purpose of the NAS COUNT handling.

In some NAS messages only 5 of the 8 NAS sequence number bits are transmitted. When this is the case, the receiver shall estimate the remaining 3 most significant bits of the sequence number.

4.4.3.2  Replay protection

Replay protection shall be supported for received NAS messages both in the MME and the UE. However, since the realization of replay protection does not affect the interoperability between nodes, no specific mechanism is required for implementation.

Replay protection must assure that one and the same NAS message is not accepted twice by the receiver. Specifically, for a given EPS security context, a given NAS COUNT value shall be accepted at most one time and only if message integrity verifies correctly.

Replay protection is not applicable when EIA0 is used.

4.4.3.3  Integrity protection and verification

The sender shall use its locally stored NAS COUNT as input to the integrity protection algorithm.

The receiver shall use the NAS sequence number included in the received message (or estimated from the 5 bits of the NAS sequence number received in the message) and an estimate for the NAS overflow counter as defined in clause  4.4.3.1 to form the NAS COUNT input to the integrity verification algorithm.

The algorithm to calculate the integrity protection information is specified in 3GPP  S  33.401  [19], and the integrity protection shall include octet 6 to n of the security protected NAS message, i.e. the sequence number IE and the NAS message IE. The integrity protection of the SERVICE REQUEST message is defined in clause  9.9.3.28. In addition to the data that is to be integrity protected, the constant BEARER ID, DIRECTION bit, NAS COUNT and NAS integrity key are input to the integrity protection algorithm. These parameters are described in 3GPP  S  33.401  [19].

After successful integrity protection validation, the receiver shall update its corresponding locally stored NAS COUNT with the value of the estimated NAS COUNT for this NAS message.

Integrity verification is not applicable when EIA0 is used.

4.4.3.4  Ciphering and deciphering

The sender shall use its locally stored NAS COUNT as input to the ciphering algorithm.

The receiver shall use the NAS sequence number included in the received message (or estimated from the 5 bits of the NAS sequence number received in the message) and an estimate for the NAS overflow counter as defined in clause  4.4.3.1 to form the NAS COUNT input to the deciphering algorithm.

The input parameters to the NAS ciphering algorithm are the constant BEARER ID, DIRECTION bit, NAS COUNT, NAS encryption key and the length of the key stream to be generated by the encryption algorithm. When an initial plain NAS message for transport of user data via control plane (i.e. CONTROL PLANE SERVICE REQUEST message) is to be partially ciphered, the length of the key stream is set to the length of the part of the initial plain NAS message (i.e. the value part of the ESM message container IE or the value part of the NAS message container) that is to be ciphered.

4.4.3.5  NAS COUNT wrap around

If, when increasing the NAS COUNT as specified above, the MME detects that either its downlink NAS COUNT or the UE   's uplink NAS COUNT is "close" to wrap around, (close to 224), the MME shall take the following actions:

-  If there is no non-current native EPS security context with sufficiently low NAS COUNT values, the MME shall initiate a new AKA procedure with the UE, leading to a new established EPS security context and the NAS COUNT being reset to 0 in both the UE and the MME when the new EPS security context is activated;

-  Otherwise, the MME can activate a non-current native EPS security context with sufficiently low NAS COUNT values or initiate a new AKA procedure as specified above.

If for some reason a new KASME has not been established using AKA before the NAS COUNT wraps around, the node (MME or UE) in need of sending a NAS message shall instead release the NAS signalling connection. Prior to sending the next uplink NAS message, the UE shall delete the eKSI indicating the current EPS security context.

When the EIA0 is used as the NAS integrity algorithm, the UE and the MME shall allow NAS COUNT wrap around. If NAS COUNT wrap around occurs, the following requirements apply:

-  the UE and the MME shall continue to use the current security context;

-  the MME shall not initiate the EPS AKA procedure;

-  the MME shall not release the NAS signalling connection; and

-  the UE shall not perform a local release of the NAS signalling connection.

4.4.4  Integrity protection of NAS signalling messages

4.4.4.1  General

For the UE, integrity protected signalling is mandatory for the NAS messages once a valid EPS security context exists and has been taken into use. For the network, integrity protected signalling is mandatory for the NAS messages once a secure exchange of NAS messages has been established for the NAS signalling connection. Integrity protection of all NAS signalling messages is the responsibility of the NAS. It is the network which activates integrity protection.

The use of "null integrity protection algorithm" EIA0 (see clause  9.9.3.23) in the current security context is only allowed for an unauthenticated UE for which establishment of emergency bearer services or access to RLOS is allowed. For setting the security header type in outbound NAS messages, the UE and the MME shall apply the same rules irrespective of whether the "null integrity protection algorithm" or any other integrity protection algorithm is indicated in the security context.

If the "null integrity protection algorithm" EIA0 has been selected as an integrity protection algorithm, the receiver shall regard the NAS messages with the security header indicating integrity protection as integrity protected.

Details of the integrity protection and verification of NAS signalling messages are specified in 3GPP  S  33.401  [19].

When a NAS message needs to be sent both ciphered and integrity protected, the NAS message is first ciphered and then the ciphered NAS message and the NAS sequence number are integrity protected by calculating the MAC. The same applies when an initial NAS message needs to be sent partially ciphered and integrity protected.

NOTE:  NAS messages that are ciphered or partially ciphered with the "null ciphering algorithm" EEA0 are regarded as ciphered or partially ciphered, respectively (see clause  4.4.5).

When a NAS message needs to be sent only integrity protected and unciphered, the unciphered NAS message and the NAS sequence number are integrity protected by calculating the MAC.

When during the EPS attach procedure or service request procedure an ESM message is piggybacked in an EMM message, there is only one sequence number IE and one message authentication code IE, if any, for the combined NAS message.

4.4.4.2  Integrity checking of NAS signalling messages in the UE

Except the messages listed below, no NAS signalling messages shall be processed by the receiving EMM entity in the UE or forwarded to the ESM entity, unless the network has established secure exchange of NAS messages for the NAS signalling connection:

-  EMM messages:

-  IDENTITY REQUEST (if requested identification parameter is IMSI);

-  AUTHENTICATION REQUEST;

-  AUTHENTICATION REJECT;

-  ATTACH REJECT (if the EMM cause is not #25);

-  DETACH ACCEPT (for non switch off);

-  TRACKING AREA UPDATE REJECT (if the EMM cause is not #25);

-  SERVICE REJECT (if the EMM cause is not #25).

NOTE:  These messages are accepted by the UE without integrity protection, as in certain situations they are sent by the network before security can be activated.

All ESM messages are integrity protected.

Once the secure exchange of NAS messages has been established, the receiving EMM or ESM entity in the UE shall not process any NAS signalling messages unless they have been successfully integrity checked by the NAS. If NAS signalling messages, having not successfully passed the integrity check, are received, then the NAS in the UE shall discard that message. The processing of the SECURITY MODE COMMAND message that has not successfully passed the integrity check is specified in clause  5.4.3.5. If any NAS signalling message is received as not integrity protected even though the secure exchange of NAS messages has been established by the network, then the NAS shall discard this message.

4.4.4.3  Integrity checking of NAS signalling messages in the MME

Except the messages listed below, no NAS signalling messages shall be processed by the receiving EMM entity in the MME or forwarded to the ESM entity, unless the secure exchange of NAS messages has been established for the NAS signalling connection:

-  EMM messages:

-  ATTACH REQUEST;

-  IDENTITY RESPONSE (if requested identification parameter is IMSI);

-  AUTHENTICATION RESPONSE;

-  AUTHENTICATION FAILURE;

-  SECURITY MODE REJECT;

-  DETACH REQUEST;

-  DETACH ACCEPT;

-  TRACKING AREA UPDATE REQUEST.

NOTE  1:  The TRACKING AREA UPDATE REQUEST message is sent by the UE without integrity protection, if the tracking area updating procedure is initiated due to an inter-system change in idle mode and no current EPS security context is available in the UE. The other messages are accepted by the MME without integrity protection, as in certain situations they are sent by the UE before security can be activated.

NOTE  2:  The DETACH REQUEST message can be sent by the UE without integrity protection, e.g. if the UE is attached for emergency bearer services or access to RLOS and there is no shared EPS security context available, or if due to user interaction an attach procedure is cancelled before the secure exchange of NAS messages has been established. For these cases the network can attempt to use additional criteria (e.g. whether the UE is subsequently still performing periodic tracking area updating or still responding to paging) before marking the UE as EMM-DEREGISTERED.

All ESM messages are integrity protected except a PDN CONNECTIVITY REQUEST message if it is sent piggybacked in ATTACH REQUEST message and NAS security is not activated.

Once a current EPS security context exists, until the secure exchange of NAS messages has been established for the NAS signalling connection, the receiving EMM entity in the MME shall process the following NAS signalling messages, even if the MAC included in the message fails the integrity check or cannot be verified, as the EPS security context is not available in the network:

-  ATTACH REQUEST;

-  IDENTITY RESPONSE (if requested identification parameter is IMSI);

-  AUTHENTICATION RESPONSE;

-  AUTHENTICATION FAILURE;

-  SECURITY MODE REJECT;

-  DETACH REQUEST;

-  DETACH ACCEPT;

-  TRACKING AREA UPDATE REQUEST;

-  SERVICE REQUEST;

-  EXTENDED SERVICE REQUEST;

-  CONTROL PLANE SERVICE REQUEST.

NOTE  3:  These messages are processed by the MME even when the MAC that fails the integrity check or cannot be verified, as in certain situations they can be sent by the UE protected with an EPS security context that is no longer available in the network.

If an ATTACH REQUEST message is received without integrity protection or fails the integrity check and it is not an attach request for emergency bearer services and it is not an attach request for access to RLOS, the MME shall authenticate the subscriber before processing the attach request any further. Additionally, if the MME initiates a security mode control procedure, the MME shall include a HASHMME IE in the SECURITY MODE COMMAND message as specified in clause  5.4.3.2. For the case when the attach procedure is for emergency bearer services see clause  5.5.1.2.3 and clause  5.4.2.5.

If a DETACH REQUEST message fails the integrity check, the MME shall proceed as follows:

-  If it is not a detach request due to switch off, and the MME can initiate an authentication procedure, the MME should authenticate the subscriber before processing the detach request any further.

-  If it is a detach request due to switch off, or the MME does not initiate an authentication procedure for any other reason, the MME may ignore the detach request and remain in state EMM-REGISTERED.

NOTE  4:  The network can attempt to use additional criteria (e.g. whether the UE is subsequently still performing periodic tracking area updating or still responding to paging) before marking the UE as EMM-DEREGISTERED.

If a TRACKING AREA UPDATE REQUEST message is received without integrity protection or fails the integrity check and the UE provided a nonceUE, GPRS ciphering key sequence number, P-TMSI and RAI in the TRACKING AREA UPDATE REQUEST message, the MME shall initiate a security mode control procedure to take a new mapped EPS security context into use; otherwise, if the UE has only a PDN connection for non-emergency bearer services established and the PDN connection is not for RLOS, the MME shall initiate an authentication procedure. Additionally, if the MME initiates a security mode control procedure, the MME shall include a HASHMME IE in the SECURITY MODE COMMAND message as specified in clause  5.4.3.2. For the case when the UE has a PDN connection for emergency bearer services or for RLOS see clause  5.5.3.2.3 and clause  5.4.2.5.

If a SERVICE REQUEST, EXTENDED SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST message fails the integrity check and the UE has only PDN connections for non-emergency bearer services established and the PDN connections are not for RLOS, the MME shall send the SERVICE REJECT message with EMM cause #9 "UE identity cannot be derived by the network" and keep the EMM-context and EPS security context unchanged. For the case when the UE has a PDN connection for emergency bearer services or RLOS and integrity check fails, the MME may skip the authentication procedure even if no EPS security context is available and proceed directly to the execution of the security mode control procedure as specified in clause  5.4.3. After successful completion of the service request procedure, the network shall deactivate all non-emergency EPS bearers locally which are not EPS bearers for RLOS. The emergency EPS bearers shall not be deactivated. The network may deactivate the EPS bearers for RLOS.

Once the secure exchange of NAS messages has been established for the NAS signalling connection, the receiving EMM or ESM entity in the MME shall not process any NAS signalling messages unless they have been successfully integrity checked by the NAS. If any NAS signalling message, having not successfully passed the integrity check, is received, then the NAS in the MME shall discard that message. If any NAS signalling message is received, as not integrity protected even though the secure exchange of NAS messages has been established, then the NAS shall discard this message.

4.4.5  Ciphering of NAS signalling messages

The use of ciphering in a network is an operator option subject to MME configuration. When operation of the network without ciphering is configured, the MME shall indicate the use of "null ciphering algorithm" EEA0 (see clause  9.9.3.23) in the current security context for all UEs. For setting the security header type in outbound NAS messages, the UE and the MME shall apply the same rules irrespective of whether the "null ciphering algorithm" or any other ciphering algorithm is indicated in the security context.

When the UE establishes a new NAS signalling connection, it shall send the initial NAS message

-  partially ciphered, if it is a CONTROL PLANE SERVICE REQUEST message including an ESM message container information element or a NAS message container information element; and

-  unciphered, if it is any other initial NAS message.

The UE shall partially cipher the CONTROL PLANE SERVICE REQUEST message by ciphering the value part of the ESM message container IE or the value part of the NAS message container, using the ciphering algorithm of the current EPS security context.

The UE shall send the ATTACH REQUEST message always unciphered.

The UE shall send the TRACKING AREA UPDATE REQUEST message always unciphered.

Except for the CONTROL PLANE SERVICE REQUEST message including an ESM message container information element or a NAS message container information element, the UE shall start the ciphering and deciphering of NAS messages when the secure exchange of NAS messages has been established for a NAS signalling connection. From this time onward, unless explicitly defined, the UE shall send all NAS messages ciphered until the NAS signalling connection is released, or the UE performs intersystem handover to A/Gb mode or Iu mode.

The MME shall start ciphering and deciphering of NAS messages as described in clause  4.4.2.3. From this time onward, except for the SECURITY MODE COMMAND message, the MME shall send all NAS messages ciphered until the NAS signalling connection is released, or the UE performs intersystem handover to A/Gb mode or Iu mode.

Once the encryption of NAS messages has been started between the MME and the UE, the receiver shall discard the unciphered NAS messages which shall have been ciphered according to the rules described in this specification. The MME shall discard any CONTROL PLANE SERVICE REQUEST message including an ESM message container information element or a NAS message container information element which has not been partially ciphered according to the rules described above.

If the "null ciphering algorithm" EEA0 has been selected as a ciphering algorithm, the NAS messages with the security header indicating ciphering are regarded as ciphered.

Details of ciphering and deciphering of NAS signalling messages are specified in 3GPP  S  33.401  [19].

4.5  Disabling and re-enabling of UE   's E-UTRA capability

The UE shall only disable the E-UTRA capability when in EMM-IDLE mode.

When the UE supports both N1 mode and S1 mode then the UE   's capability to access the 5GCN via E-UTRA shall not be affected, if the UE   's E-UTRA capability is disabled or enabled.

When the UE is disabling the E-UTRA capability not due to redirection to 5GCN required, it should proceed as follows:

a)  select another RAT (GERAN, UTRAN, or NG-RAN if the UE has not disabled its N1 mode capability for 3GPP access as specified in 3GPP  S  24.501  [54]) of the registered PLMN or a PLMN from the list of equivalent PLMNs;

b)  if another RAT of the registered PLMN or a PLMN from the list of equivalent PLMNs cannot be found, or the UE does not have a registered PLMN, then perform PLMN selection as specified in 3GPP  S  23.122  [6]. As an implementation option, instead of performing PLMN selection, the UE may select another RAT of the chosen PLMN. If disabling of E-UTRA capability was not due to UE initiated detach procedure for EPS services only, the UE may re-enable the E-UTRA capability for this PLMN selection; or

c)  if no other allowed PLMN and RAT combinations are available, then the UE may re-enable the E-UTRA capability and remain registered for EPS services in E-UTRAN of the registered PLMN. If the UE chooses this option, then it may periodically attempt to select another PLMN and RAT combination that can provide non-EPS services. How this periodic scanning is done, is UE implementation dependent.

When the UE is disabling the E-UTRA capability upon receiving reject cause #31 "Redirection to 5GCN required" as specified in clauses  5.5.1.2.5,  5.5.1.3.5,  5.5.3.2.5,  5.5.3.3.5 and  5.6.1.5, it should proceed as follows:

i)  If the UE is in NB-S1 mode:

1)  if lower layers do not provide an indication that the current E-UTRA cell is connected to 5GCN or lower layers do not provide an indication that the current E-UTRA cell supports CIoT 5GS optimizations that are supported by the UE, search for a suitable NB-IoT cell connected to 5GCN according to 3GPP  S  36.304  [21];

2)  if lower layers provide an indication that the current E-UTRA cell is connected to 5GCN and the current E-UTRA cell supports CIoT 5GS optimizations that are supported by the UE then perform a core network selection to select 5GCN as specified in 3GPP  S  24.501  [54] clause  4.8.4A.1; or

3)  if lower layers cannot find a suitable NB-IoT cell connected to 5GCN or there is no suitable NB-IoT cell connected to 5GCN which supports CIoT 5GS optimizations that are supported by the UE, the UE, as an implementation option, may indicate to lower layers to remain camped in E-UTRA cell connected to EPC, may then start an implementation-specific timer and enter the state EMM-REGISTERED.LIMITED-SERVICE the UE may re-enable the E-UTRA capability for 3GPP access at expiry of the implementation-specific timer, if the timer had been started, and may then, proceed with the appropriate EMM procedure.

ii)  If the UE is in WB-S1 mode:

1)  if lower layers do not provide an indication that the current E-UTRA cell is connected to 5GCN or lower layers do not provide an indication that the current E-UTRA cell supports CIoT 5GS optimizations that are supported by the UE, search for a suitable E-UTRA cell connected to 5GCN according to 3GPP  S  36.304  [21];

2)  if lower layers provide an indication that the current E-UTRA cell is connected to 5GCN and the current E-UTRA cell supports CIoT 5GS optimizations that are supported by the UE, then perform a core network selection to select 5GCN as specified in 3GPP  S  24.501  [54] clause  4.8.4A.1; or

3)  if lower layers cannot find a suitable E-UTRA cell connected to 5GCN or there is no suitable E-UTRA cell connected to 5GCN which supports CIoT 5GS optimizations that are supported by the UE, the UE, as an implementation option, may indicate to lower layers to remain camped in E-UTRA cell connected to EPC, may then start an implementation-specific timer and enter the state EMM-REGISTERED.LIMITED-SERVICE the UE may re-enable the E-UTRA capability for 3GPP access at expiry of the implementation-specific timer, if the timer had been started, and may then, proceed with the appropriate EMM procedure.

The UE shall re-enable the E-UTRA capability when performing a PLMN selection unless:

-  the disabling of E-UTRA capability was due to UE initiated detach procedure for EPS services only; or

-  the UE has already re-enabled the E-UTRA capability when performing bullets b) or c) above.

If due to handover, the UE moves to a new PLMN in A/Gb, Iu, or N1 mode which is not in the list of equivalent PLMNs and not a PLMN memorized by the UE for which E-UTRA capability was disabled, and the disabling of E-UTRA capability was not due to UE initiated detach procedure for EPS services only, the UE shall re-enable the E-UTRA capability after the RR/RRC connection is released.

If UE that has disabled its E-UTRA capability due to IMS voice not available and CS fallback not available re-enables it when PLMN selection is performed, then it should memorize the identity of the PLMNs where E-UTRA capability was disabled and use that stored information in subsequent PLMN selections as specified in 3GPP  S  23.122  [6].

The UE may support "E-UTRA Disabling for EMM cause #15" and implement the following behaviour:

-  if the "E-UTRA Disabling Allowed for EMM cause #15" parameter as specified in 3GPP  S  24.368  [15A] or 3GPP  S  31.102  [17] is present and set to enabled; and

-  if the UE receives an ATTACH REJECT or TRACKING AREA UPDATE REJECT message including both EMM cause #15 "no suitable cells in tracking area" and an Extended EMM cause IE with value "E-UTRAN not allowed";

then the UE shall disable the E-UTRA capability, memorize the identity of the PLMN where the E-UTRA capability was disabled and use that stored information in subsequent PLMN selections as specified in 3GPP  S  23.122  [6].

When the UE supporting the A/Gb and/or Iu mode together with the S1 mode needs to stay in A/Gb or Iu mode, in order to prevent unwanted handover or cell reselection from UTRAN/GERAN to E-UTRAN, the UE shall disable the E-UTRA capability and:

-  The UE shall not set the E-UTRA support bits of the MS Radio Access capability IE (see 3GPP  S  24.008  [13], clause  10.5.5.12a), the E-UTRA support bits of Mobile Station Classmark 3 IE (see 3GPP  S  24.008  [13], clause  10.5.1.7), the PS inter-RAT HO from GERAN to E-UTRAN S1 mode capability bit and the ISR support bit of the MS network capability IE (see 3GPP  S  24.008  [13], clause  10.5.5.12) in the ATTACH REQUEST message and the ROUTING AREA UPDATE REQUEST message after it selects GERAN or UTRAN;

-  the UE shall use the same value of the EPC capability bit of the MS network capability IE (see 3GPP  S  24.008  [13], clause  10.5.5.12) in the ATTACH REQUEST message and the ROUTING AREA UPDATE REQUEST message; and

-  the UE NAS layer shall indicate the access stratum layer(s) of disabling of the E-UTRA capability.

When the UE supporting N1 mode together with S1 mode needs to stay in N1 mode, in order to prevent unwanted handover or cell reselection from NG-RAN to E-UTRAN, the UE shall disable the E-UTRA capability and:

-  the UE shall set the S1 mode bit to "S1 mode not supported" in the 5GMM Capability IE of the REGISTRATION REQUEST message (see 3GPP  S  24.501  [54]);

-  the UE shall not include the S1 UE network capability IE in the REGISTRATION REQUEST message (see 3GPP  S  24.501  [54]); and

-  the UE NAS layer shall indicate the access stratum layer(s) of disabling of the E-UTRA capability.

If the UE is disabling its E-UTRA capability before selecting to GERAN, UTRAN or NG-RAN radio access technology, the UE shall not perform the detach procedure of clause  5.5.2.1.

If the UE is required to disable the E-UTRA capability and select GERAN, UTRAN or NG-RAN radio access technology, and the UE is in the EMM-CONNECTED mode:

-  if the UE has a persistent EPS bearer context and the ongoing procedure is not a detach procedure, then the UE shall wait until the radio bearer associated with the persistent EPS bearer context has been released;

-  otherwise, the UE shall locally release the established NAS signalling connection and enter the EMM-IDLE mode before selecting GERAN, UTRAN or NG-RAN radio access technology.

If the E-UTRA capability was disabled due to the attempt to select GERAN or UTRAN radio access technology progressing the CS emergency call establishment (see clause  4.3.1), the criteria to enable the E-UTRA capability again is UE implementation specific.

If the E-UTRA capability was disabled due to the UE initiated detach procedure for EPS services only (see clause  5.5.2.2.2), upon request of the upper layers to re-attach for EPS services the UE shall enable the E-UTRA capability again. If the E-UTRA capability was disabled due to receipt of EMM cause #14 "EPS services not allowed in this PLMN", then the UE shall enable the E-UTRA capability when the UE powers off and powers on again or the USIM is removed. If E-UTRA capability was disabled for any other reason, the UE shall enable the E-UTRA capability in the following cases:

-  the UE mode of operation changes from CS/PS mode 1 of operation to CS/PS mode 2 of operation;

-  the UE mode of operation changes from PS mode 1 of operation to PS mode 2 of operation; or

-  the UE powers off and powers on again or the USIM is removed;

As an implementation option, the UE may start a timer for enabling E-UTRA when the UE   's attach attempt counter or tracking area updating attempt counter reaches  5 and the UE disables E-UTRA capability for cases described in clauses  5.5.1.2.6, 5.5.1.3.4.3, 5.5.1.3.6, 5.5.3.2.6, 5.5.3.3.4.3 and 5.5.3.3.6. The UE should memorize the identity of the PLMNs where E-UTRA capability were disabled. On expiry of this timer:

-  if the UE is in Iu mode or A/Gb mode and is in idle mode as specified in 3GPP  S  24.008  [13] on expiry of the timer, the UE should enable the E-UTRA capability;

-  if the UE is in Iu mode or A/Gb mode and an RR connection exists, the UE shall delay enabling E-UTRA capability until the RR connection is released;

-  if the UE is in Iu mode and a PS signalling connection exists but no RR connection exists, the UE may abort the PS signalling connection before enabling E-UTRA capability;

-  if the UE is in N1 mode and is in 5GMM-IDLE mode as specified in 3GPP  S  24.501  [54], on expiry of the timer, the UE should enable the E-UTRA capability; and

-  if the UE is in N1 mode and is in 5GMM-CONNECTED mode as specified in 3GPP  S  24.501  [54], on expiry of the timer, the UE shall delay enabling the E-UTRA capability until the N1 NAS signalling connection is released.

If the UE attempts to establish an emergency bearer service or to access RLOS in a PLMN where the E-UTRA capability was disabled due to the UE   's attach attempt counter or tracking area updating attempt counter have reached  5, the UE may enable the E-UTRA capability for that PLMN memorized by the UE.

The UE may support being configured for No E-UTRA Disabling In 5GS (see 3GPP  S  24.368  [50] or 3GPP  S  31.102  [17]). If the UE supports being configured for No E-UTRA Disabling in 5GS, No E-UTRA Disabling In 5GS is enabled if the corresponding configuration parameter is present and set to enabled. Otherwise, No E-UTRA Disabling In 5GS is disabled. If No E-UTRA Disabling In 5GS is enabled at the UE and the UE selects an NG-RAN cell in a PLMN where the E-UTRA capability was disabled due to the UE   's attach attempt counter or tracking area updating attempt counter having reached  5, the UE shall enable the E-UTRA capability for that PLMN.

For other cases, it is up to the UE implementation when to enable the E-UTRA capability.

NOTE:  If the UE is not operating in CS/PS mode 1 operation, the value of the timer for enabling E-UTRA capability is recommended to be not larger than the default value of T3402.

4.6  Applicability of procedures

4.6.1  Relay nodes

A relay node shall support all procedures that are mandatory for a UE supporting S1 mode only.

There is also functionality which is only applicable to a relay node, in which case the specification uses the term "relay node" instead of "UE".

4.7  EPS mobility management and EPS session management in NB-S1 mode

A UE in NB-S1 mode (see  3GPP  S  36.331  [22]) shall calculate the value of the applicable NAS timer:

-  indicated in table  10.2.1 plus 240s; and

-  indicated in table  10.3.1 plus 180s.

The timer value obtained is used as described in the appropriate procedure clause of this specification. The NAS timer value shall be calculated at start of a NAS procedure and shall not re-calculate the use of the NAS timer value until the NAS procedure is completed, restarted or aborted.

When an MME that supports NB-S1 mode performs NAS signalling with a UE, which is using NB-S1 mode, the MME shall calculate the value of the applicable NAS timer:

-  indicated in table  10.2.2 plus 240s; and

-  indicated in table  10.3.2 plus 180s.

The timer value obtained is used as described in the appropriate procedure clause of this specification. The NAS timer value shall be calculated at start of a NAS procedure and shall not re-calculate the use of the NAS timer value until the NAS procedure is completed, restarted or aborted.

NOTE  1:  If the tracking area updating procedure is initiated in EMM-CONNECTED mode, the MME can stop any running implementation specific supervision timer if it is started when sending an ESM DATA TRANSPORT message to the UE.

NOTE  2:  As NB-S1 mode includes the case when satellite access is used in EPS, the values for applicable NAS timers specified in this clause apply also for satellite access.

4.8  EPS mobility management and EPS session management in WB-S1 mode for IoT

4.8.1  UE not using satellite E-UTRAN access

In WB-S1 mode, a UE operating in category CE can operate in either CE mode A or CE mode B (see  3GPP  S  36.306 [44]). If a UE that supports CE mode B and operates in WB-S1 mode not using satellite E-UTRAN access, the UE   's usage setting is not set to "voice centric" (see 3GPP  S  23.401  [10]), and

a)  the use of enhanced coverage is not restricted for the UE; or

b)  CE mode B is not restricted for the UE (see 3GPP  S  23.401  [10]);

the UE shall apply the value of the applicable NAS timer indicated in tables  10.2.1 and indicated in table  10.3.1 for WB-S1/CE mode.

A UE that supports CE mode B and operates in WB-S1 mode not using satellite E-UTRAN access shall not apply the value of the applicable NAS timer indicated in table  10.2.1 and table  10.3.1 for WB-S1/CE mode before receiving an indication from the network that the use of enhanced coverage is not restricted as described in this clause.

The NAS timer value obtained is used as described in the appropriate procedure clause of this specification. The NAS timer value shall be calculated at start of a NAS procedure, and shall not be re-calculated until the NAS procedure is completed, restarted or aborted.

The support of CE mode B by a UE is indicated to the MME by lower layers and shall be stored by the MME. When an MME that supports WB-S1 mode performs NAS signalling with a UE not using satellite E-UTRAN access, which supports CE mode B and operates in WB-S1 mode and the MME determines that

a)  the use of enhanced coverage is not restricted for the UE; or

b)  CE mode B is not restricted for the UE (see 3GPP  S  23.401  [10])

the MME shall calculate the value of the applicable NAS timer indicated in tables  10.2.2 and indicated in table  10.3.2 for WB-S1/CE mode.

The NAS timer value obtained is used as described in the appropriate procedure clause of this specification. The NAS timer value shall be calculated at start of a NAS procedure and shall not be re-calculated until the NAS procedure is completed, restarted or aborted.

4.8.2  UE using satellite E-UTRAN access

In WB-S1 mode via satellite E-UTRAN access, the UE shall apply the value of the applicable NAS timer indicated in tables 10.2.1 and indicated in table 10.3.1 for WB-S1/CE mode.

The NAS timer value obtained is used as described in the appropriate procedure clause of this specification. The NAS timer value shall be calculated at start of a NAS procedure and shall not be re-calculated until the NAS procedure is completed, restarted or aborted.

When an MME that supports WB-S1 mode performs NAS signalling with a UE via satellite E-UTRAN access, the MME shall calculate the value of the applicable NAS timer indicated in tables 10.2.2 and indicated in table 10.3.2 for WB-S1/CE mode.

The NAS timer value obtained is used as described in the appropriate procedure clause of this specification. The NAS timer value shall be calculated at start of a NAS procedure and shall not be re-calculated until the NAS procedure is completed, restarted or aborted.

NOTE:  When using satellite E-UTRAN access, the restriction on use of enhanced coverage indication from the network is not considered when applicable NAS timers are determined.

4.9  Disabling and re-enabling of UE   's NB-IoT capability

If the UE supports disabling and re-enabling of UE   's NB-IoT capability and the UE in NB-S1 mode is disabling the NB-IoT capability, it should proceed as follows:

a)  select E-UTRAN of the registered PLMN or a PLMN from the list of equivalent PLMNs;

b)  if E-UTRAN of the registered PLMN or a PLMN from the list of equivalent PLMNs cannot be found, select another RAT (GERAN, UTRAN, or NG-RAN if the UE has not disabled its N1 mode capability for 3GPP access as specified in 3GPP  S  24.501  [54]) of the registered PLMN or a PLMN from the list of equivalent PLMNs;

c)  if another RAT of the registered PLMN or a PLMN from the list of equivalent PLMNs cannot be found, or the UE does not have a registered PLMN, then perform PLMN selection as specified in 3GPP  S  23.122  [6]. As an implementation option, instead of performing PLMN selection, the UE may select another RAT of the chosen PLMN; or

d)  if no other allowed PLMN and RAT combinations are available, then the UE may re-enable the NB-IoT capability and remain registered for EPS services in NB-IoT of the registered PLMN. If the UE chooses this option, then it may periodically attempt to select another PLMN and RAT combination that can provide non-EPS services. How this periodic scanning is done, is UE implementation dependent.

If the NB-IoT capability is disabled, the UE shall re-enable the NB-IoT capability when:

-  performing a PLMN selection unless the UE has already re-enabled the NB-IoT capability when performing bullets c) or d) above; or

-  the UE powers off and powers on again or the USIM is removed.

If the UE in NB-S1 mode receives an ATTACH REJECT or TRACKING AREA UPDATE REJECT message including both EMM cause #15 "no suitable cells in tracking area" and an Extended EMM cause IE with value "NB-IoT not allowed" after the UE requests access to the NB-IoT, in order to prevent unwanted cell reselection from GERAN, UTRAN, E-UTRAN or NG-RAN to NB-IoT, the UE may:

-  disable the NB-IoT capability:

-  indicate the access stratum layer(s) of disabling of the NB-IoT capability; and

-  memorize the identity of the PLMN where the NB-IoT capability was disabled and use that stored information in subsequent PLMN selections as specified in 3GPP  S  23.122  [6].

NOTE:  The UE can only disable the NB-IoT capability when in EMM-IDLE mode.

If the UE in NB-S1 mode is required to disable the NB-IoT capability and select E-UTRAN radio access technology, and the UE is in the EMM-CONNECTED mode, the UE shall locally release the established NAS signalling connection and enter the EMM-IDLE mode before selecting E-UTRAN radio access technology.

As an implementation option, the UE may start a timer for enabling the NB-IoT capability. On expiry of this timer, the UE may enable the NB-IoT capability.

4.10  Support of MUSIM features

A network and a MUSIM UE may support one or more of the MUSIM features (i.e. the NAS signalling connection release, the paging indication for voice services, the reject paging request, the paging restriction and the paging timing collision control).

If MUSIM UE supports one or more MUSIM features, the UE indicates support of one or more MUSIM features during the attach procedure and the normal tracking area updating procedure. If the UE has indicated support of the NAS signalling connection release or the reject paging request or both and the UE supports the paging restriction, the UE indicates support of the paging restriction.

If the UE indicates support of one or more MUSIM features and the network decides to accept one or more MUSIM features, the network indicates the support of one or more MUSIM features during the attach procedure and the normal tracking area updating procedure. The network only indicates the support of the paging restriction together with the support of either NAS signalling connection release or the reject paging request.

The network does not indicate support for any MUSIM feature to the UE during the attach for emergency bearer services.

If a UE stops fulfilling the condition to be considered a MUSIM UE as defined in subclause  3.1, and the UE has negotiated support of one or more MUSIM features, then the UE shall initiate a normal tracking area update procedure to indicate that all the MUSIM features are not supported as specified in clause  5.5.3.2.

A MUSIM UE operating in NB-S1 mode or in WB-S1 mode CE mode B does not indicate the support for paging indication for voice services during the attach procedure or the normal tracking area update procedure towards the network.

4.11  Satellite access for CIoT

4.11.1  General

The UE and the network may support a satellite E-UTRAN access in WB-S1 mode or NB-S1 mode with CIoT EPS optimization. Support for satellite E-UTRAN access is specified in 3GPP  S  36.300  [20].

An MME can determine a UE is accessing the network using a satellite E-UTRAN access and may enforce mobility restriction for the UE as specified in 3GPP  S  23.401  [10].

4.11.2  Handling list of "PLMNs not allowed to operate at the present UE location"

The UE may be rejected with EMM cause #78 in ATTACH REJECT message, TRACKING AREA UPDATE REJECT message or DETACH REQUEST message. The EMM cause #78 is applicable for the UE only when the UE is accessing a PLMN using a satellite E-UTRAN access.

For the satellite E-UTRAN access the UE shall store a list of "PLMN not allowed to operate at the present UE location". Each entry in the list consists of:

a)  PLMN identity of the PLMN which sent a message including EMM cause value #78 "PLMN not allowed to operate at the present UE location" via the satellite E-UTRAN access technology;

b)  geographical location, if known by the UE, where the EMM cause value #78 was received over the satellite E-UTRAN access technology; and

c)  if the geographical location exists, a UE implementation specific distance value.

Before storing a new entry in the list, the UE shall delete any existing entry with the same PLMN identity. Upon storing a new entry, the UE starts a timer instance associated with the entry with an implementation specific value that shall not be set to a value smaller than the timer value indicated by the network, if any.

Editor   's note:  A minimum value for the timer can be optionally provided by the network in the same message as cause value #78, but IE naming and definition is FFS.

The UE shall not attempt to access a PLMN via the satellite E-UTRAN access technology which is part of the list of "PLMNs not allowed to operate at the present UE location" if:

a)  the current UE location is known, a geographical location is stored for the entry of this PLMN, and the distance from location where EMM cause value #78 was received to the current UE location is smaller than a UE implementation specific value:

b)  the timer associated with the entry of this PLMN has expired; or

c)  the access is for emergency services (see 3GPP  S  23.122  [5] for further details).

NOTE:  If the current location is not known or the geographic location is not stored for the entry of this PLMN, condition a) is ignored. 

The list shall accommodate three or more entries. The maximum number of entries is an implementation decision. When the list is full and a new entry has to be inserted, the oldest entry shall be deleted.

Each entry shall be removed if for the entry:

a)  the UE successfully registers via the satellite E-UTRAN access technology to the PLMN stored in the entry; or

b)  the timer instance associated with the entry expires.

The UE may remove an entry in the list, if the UE   's current location is known, a geographical is stored for the entry of this PLMN, and the distance from location where EMM cause value #78 was received to the current UE location is larger than the UE implementation specific value.

When the UE is switched off, the UE shall keep the list of "PLMNs not allowed to operate at the present UE location" in its non-volatile memory together with the SUPI from the USIM. The UE shall delete the list of "PLMNs not allowed to operate at the present UE location" if the USIM is removed.

5  Elementary procedures for EPS mobility management

5.1  Overview

5.1.1  General

This clause describes the procedures used for mobility management for EPS services (EMM) at the radio interface (reference point "LTE-Uu").

The main function of the mobility management sublayer is to support the mobility of a user equipment, such as informing the network of its present location and providing user identity confidentiality.

A further function of the mobility management sublayer is to provide connection management services to the session management (SM) sublayer and the short message services (SMS) entity of the connection management (CM) sublayer.

All the EMM procedures described in this clause can only be performed if a NAS signalling connection has been established between the UE and the network. Else, the EMM sublayer has to initiate the establishment of a NAS signalling connection (see 3GPP  S  36.331  [22]).

NOTE:  In a satellite E-UTRAN access, a GNSS fix time in lower layers can delay transmission of an initial UL NAS message by up to 100 seconds (GNSS cold state).

5.1.2  Types of EMM procedures

Depending on how they can be initiated, three types of EMM procedures can be distinguished:

1)  EMM common procedures:

  An EMM common procedure can always be initiated whilst a NAS signalling connection exists. The procedures belonging to this type are:

  Initiated by the network:

-  GUTI reallocation;

-  authentication;

-  security mode control;

-  identification;

-  EMM information.

2)  EMM specific procedures:

  At any time only one UE initiated EMM specific procedure can be running. The procedures belonging to this type are:

  Initiated by the UE and used to attach the IMSI in the network for EPS services and/or non-EPS services, and to establish an EMM context and if requested by the UE, a default bearer:

-  attach and combined attach.

  Initiated by the UE and used to attach the IMSI or IMEI for emergency bearer services, and to establish an EMM context and a default bearer to a PDN that provides emergency bearer services:

-  attach.

  Initiated by the UE and used to attach the IMSI or IMEI for access to RLOS, and to establish an EMM context and a default bearer to a PDN connection for RLOS:

-  attach.

  Initiated by the UE or the network and used to detach the IMSI in the network for EPS services and/or non-EPS services and to release an EMM context and all bearers, if any:

-  detach and combined detach.

  Initiated by the UE and used to detach the IMSI in the network for EPS services or non-EPS services and to release an EMM context and all bearers, if any:

-  eCall inactivity procedure.

  Initiated by the UE when an EMM context has been established:

-  normal tracking area updating and combined tracking area updating (S1 mode only);

-  periodic tracking area updating (S1 mode only).

  The tracking area updating procedure can be used to request also the resource reservation for sending data.

3)  EMM connection management procedures (S1 mode only):

  Initiated by the UE and used to establish a secure connection to the network or to request the resource reservation for sending data, or both:

-  service request.

  The service request procedure can only be initiated if no UE initiated EMM specific procedure is ongoing.

  Initiated by the network and used to request the establishment of a NAS signalling connection or to prompt the UE to re-attach if necessary as a result of a network failure:

-  paging procedure.

  Initiated by the UE or the network and used to transport NAS messages:

-  transport of NAS messages;

-  generic transport of NAS messages.

  The transport of NAS messages procedure and the generic transport of NAS messages procedure cannot be initiated while an EMM specific procedure or a service request procedure is ongoing.

5.1.3  EMM sublayer states

5.1.3.1  General

In the following clauses, the EMM protocol of the UE and the network is described by means of two different state machines. In clause  5.1.3.2, the states of the EMM entity in the UE are introduced. The behaviour of the UE depends on an EPS update status that is described in clause  5.1.3.3. The states for the MME side are described in clause  5.1.3.4.

5.1.3.2  EMM sublayer states in the UE

5.1.3.2.1  General

In the following clauses, the possible EMM states of an EMM entity in the UE are described. Clause  5.1.3.2.2 summarizes the main states of an EMM entity. The substates that have been defined are described in clause  5.1.3.2.3 and clause  5.1.3.2.4.

It should be noted, however, that this clause does not include a description of the detailed behaviour of the UE in the single states and does not cover abnormal cases. A detailed description of the behaviour of the UE is given in clause  5.2. For the behaviour of the UE in abnormal cases refer to the description of the elementary EMM procedures in clauses  5.4, 5.5, 5.6 and 5.7.

5.1.3.2.2  Main states

5.1.3.2.2.1  EMM-NULL

EPS services are disabled in the UE. No EPS mobility management function shall be performed in this state.

5.1.3.2.2.2  EMM-DEREGISTERED

In the state EMM-DEREGISTERED, no EMM context has been established and the UE location is unknown to an MME and hence it is unreachable by an MME. In order to establish an EMM context, the UE shall start the attach or combined attach procedure (see clause  5.5.1).

5.1.3.2.2.3  EMM-REGISTERED-INITIATED

A UE enters the state EMM-REGISTERED-INITIATED after it has started the attach or the combined attach procedure and is waiting for a response from the MME (see clause  5.5.1).

5.1.3.2.2.4  EMM-REGISTERED

In the state EMM-REGISTERED an EMM context has been established. Additionally a default EPS bearer context has been activated in the UE:

-  if EMM-REGISTERED without PDN connection is not supported by the UE or the MME; or

-  if EMM-REGISTERED without PDN connection is supported by the UE and the MME, the UE has requested connectivity to a PDN and a default EPS bearer context is successfully established.

When the UE is in EMM-IDLE mode, the UE location is known to the MME with an accuracy of a list of tracking areas containing a certain number of tracking areas. When the UE is in EMM-CONNECTED mode, the UE location is known to the MME with an accuracy of a serving eNodeB. The UE may initiate sending and receiving user data and signalling information and reply to paging. Additionally, tracking area updating or combined tracking area updating procedure is performed (see clause  5.5.3).

5.1.3.2.2.5  EMM-DEREGISTERED-INITIATED

A UE enters the state EMM-DEREGISTERED-INITIATED after it has requested release of the EMM context by starting the detach or combined detach procedure and is waiting for a response from the MME (see clause  5.5.2).

5.1.3.2.2.6  EMM-TRACKING-AREA-UPDATING-INITIATED

A UE enters the state EMM-TRACKING-AREA-UPDATING-INITIATED after it has started the tracking area updating or combined tracking area updating procedure and is waiting for a response from the MME (see clause  5.5.3).

5.1.3.2.2.7  EMM-SERVICE-REQUEST-INITIATED

A UE enters the state EMM-SERVICE-REQUEST-INITIATED after it has started the service request procedure and is waiting for a response from the MME (see clause  5.6.1).



NOTE:  Not all possible transitions are shown in this figure.



Figure 5.1.3.2.2.7.1: EMM main states in the UE

5.1.3.2.3  Substates of state EMM-DEREGISTERED

5.1.3.2.3.1  General

The state EMM-DEREGISTERED is subdivided into a number of substates as described in this clause. Valid subscriber data are available for the UE before it enters the substates, except for the substate EMM-DEREGISTERED.NO-IMSI.

5.1.3.2.3.2  EMM-DEREGISTERED.NORMAL-SERVICE

The substate EMM-DEREGISTERED.NORMAL-SERVICE is chosen in the UE when a suitable cell has been found and the PLMN or tracking area is not in the forbidden list.

5.1.3.2.3.3  EMM-DEREGISTERED.LIMITED-SERVICE

The substate EMM-DEREGISTERED.LIMITED-SERVICE is chosen in the UE, when it is known that a selected cell is unable to provide normal service (e.g. the selected cell is in a forbidden PLMN, is in a forbidden tracking area or the selected cell is a CSG cell whose CSG ID and associated PLMN identity are not included in the UE   's Allowed CSG list or in the UE   's Operator CSG List).

5.1.3.2.3.4  EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH

The substate EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH is chosen in the UE if the attach or combined attach procedure failed due to a missing response from the network or due to the circumstances described in clauses  5.5.1.2.5, 5.5.1.2.6, 5.5.1.3.5 and 5.5.2.3.4.

5.1.3.2.3.5  EMM-DEREGISTERED.PLMN-SEARCH

The substate EMM-DEREGISTERED.PLMN-SEARCH is chosen in the UE, if the UE is searching for PLMNs. This substate is left either when a cell has been selected (the new substate is NORMAL-SERVICE or LIMITED-SERVICE) or when it has been concluded that no cell is available at the moment (the new substate is NO-CELL-AVAILABLE).

5.1.3.2.3.6  EMM-DEREGISTERED.NO-IMSI

The substate EMM-DEREGISTERED.NO-IMSI is chosen in the UE, if the UE has no valid subscriber data available (SIM/USIM not available, or the SIM/USIM is considered invalid by the UE) and a cell has been selected.

5.1.3.2.3.7  EMM-DEREGISTERED.ATTACH-NEEDED

Valid subscriber data are available for the UE and for some reason an attach must be performed as soon as possible. This substate can be entered if the access class is blocked due to access class control, or if the network rejects the NAS signalling connection establishment.

5.1.3.2.3.8  EMM-DEREGISTERED.NO-CELL-AVAILABLE

No E-UTRAN cell can be selected. This substate is entered after a first intensive search failed when in substate EMM-DEREGISTERED.PLMN-SEARCH. Cells are searched for at a low rhythm. No EPS services are offered.

5.1.3.2.3.9  EMM-DEREGISTERED.eCALL-INACTIVE

The substate EMM-DEREGISTERED.eCALL-INACTIVE is chosen in the UE when:

-  the UE is configured for eCall only mode as specified in 3GPP  S  31.102  [17];

-  timer T3444 and timer T3445 have expired or are not running;

-  a PLMN has been selected as specified in 3GPP  S  23.122  [6];

-  the UE does not need to perform an eCall over IMS; and

-  the UE does not need to perform a call to a non-emergency MSISDN or URI for test or terminal reconfiguration service.

In this substate, the UE shall not initiate any signalling towards the network, except to originate an eCall over IMS, or a call to a non-emergency MSISDN or URI for test or terminal reconfiguration service.

5.1.3.2.4  Substates of state EMM-REGISTERED

5.1.3.2.4.1  General

The state EMM-REGISTERED is subdivided into a number of substates as described in this clause.

5.1.3.2.4.2  EMM-REGISTERED.NORMAL-SERVICE

The substate EMM-REGISTERED.NORMAL-SERVICE is chosen by the UE as the primary substate when the UE enters the state EMM-REGISTERED.

5.1.3.2.4.3  EMM-REGISTERED.ATTEMPTING-TO-UPDATE

The substate EMM-REGISTERED.ATTEMPTING-TO-UPDATE is chosen by the UE if the tracking area updating or combined tracking area updating procedure failed due to a missing response from the network or due to the circumstances described in clauses   5.3.9, 5.5.3.2.5, 5.5.3.2.6, 5.5.3.3.5, 5.6.1.5 and 5.6.1.6. No EMM procedure except the tracking area updating or combined tracking area updating procedure shall be initiated by the UE in this substate. No data shall be sent or received.

5.1.3.2.4.4  EMM-REGISTERED.LIMITED-SERVICE

The substate EMM-REGISTERED.LIMITED-SERVICE is chosen in the UE, if the cell the UE selected is known not to be able to provide normal service.

5.1.3.2.4.5  EMM-REGISTERED.PLMN-SEARCH

The substate EMM-REGISTERED.PLMN-SEARCH is chosen in the UE, while the UE is searching for PLMNs.

5.1.3.2.4.6  EMM-REGISTERED.UPDATE-NEEDED

The UE has to perform a tracking area updating or combined tracking area updating procedure, but access to the current cell is barred. This state can be entered if the access class is blocked due to access class control, or if the network rejects the NAS signalling connection establishment.

No EMM procedure except:

-  tracking area updating;

-  combined tracking area updating; or

-  service request as a response to paging

shall be initiated by the UE in this substate.

5.1.3.2.4.7  EMM-REGISTERED.NO-CELL-AVAILABLE

E-UTRAN coverage has been lost or PSM is active in the UE. If PSM is active, the UE can deactivate PSM at any time by activating the AS layer when the UE needs to send mobile originated signalling or user data. Otherwise, the UE shall not initiate any EMM procedure except for cell and PLMN reselection.

5.1.3.2.4.8  EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM

A combined attach procedure or a combined tracking area updating procedure was successful for EPS services only. User data and signalling information may be sent and received.

5.1.3.2.4.9  EMM-REGISTERED.IMSI-DETACH-INITIATED

The UE performs a combined detach procedure for non-EPS services only (detach type "IMSI detach"). This substate is entered if the UE is attached for EPS and non-EPS services and wants to detach for non-EPS services only. User data and signalling information may be sent and received.

5.1.3.3  EPS update status

In order to describe the detailed UE behaviour, the EPS update (EU) status pertaining to a specific subscriber is defined.

The EPS update status is stored in a non-volatile memory in the USIM if the corresponding file is present in the USIM, else in the non-volatile memory in the ME, as described in annex  C.

The EPS update status value is changed only after the execution of an attach or combined attach, network initiated detach, authentication, tracking area update or combined tracking area update, service request or paging for EPS services using IMSI procedure or due to change in TAI which is not part of TAI list while timer T3346 is running.

EU1: UPDATED

  The last attach or tracking area updating attempt was successful.

EU2: NOT UPDATED

  The last attach, service request or tracking area updating attempt failed procedurally, e.g. no response or reject message was received from the MME.

EU3: ROAMING NOT ALLOWED

  The last attach, service request or tracking area updating attempt was correctly performed, but the answer from the MME was negative (because of roaming or subscription restrictions).

5.1.3.4  EMM sublayer states in the MME

5.1.3.4.1  EMM-DEREGISTERED

In the state EMM-DEREGISTERED, the MME has no EMM context or the EMM Context is marked as detached. The UE is detached. The MME may answer to an attach or a combined attach procedure initiated by the UE (see clause  5.5.1). The MME may also answer to a tracking area updating procedure or combined tracking area updating procedure initiated by a UE if the EMM context is marked as detached. The MME may also answer to a detach procedure initiated by the UE (see clause  5.5.1.2.7).

If ISR is not activated or ISR is deactivated during a routing area updating or combined routing area updating procedure or an inter-system handover to A/Gb mode or Iu mode, the MME enters the state EMM-DEREGISTERED after the successful completion of the procedure.

5.1.3.4.2  EMM-COMMON-PROCEDURE-INITIATED

The MME enters the state EMM-COMMON-PROCEDURE-INITIATED, after it has started a common EMM procedure (see clause  5.4) and is waiting for a response from the UE.

5.1.3.4.3  EMM-REGISTERED

In the state EMM-REGISTERED, an EMM context has been established. Additionally a default EPS bearer context has been activated in the MME:

-  if EMM-REGISTERED without PDN connection is not supported by the UE or the MME; or

-  if EMM-REGISTERED without PDN connection is supported by the UE and the MME, the UE has requested connectivity to a PDN and a default EPS bearer context is successfully established.

5.1.3.4.4  EMM-DEREGISTERED-INITIATED

The MME enters the state EMM-DEREGISTERED-INITIATED after it has started a detach procedure and is waiting for a response from the UE (see clause  5.5.2).



Figure 5.1.3.4.4.1: EMM main states in the MME

5.1.4  Coordination between EMM and GMM

If GMM and EMM are both enabled, a UE capable of S1 mode and A/Gb mode or Iu mode or both shall maintain one common registration for GMM and EMM indicating whether the UE is registered for packet services or not.

A UE that is not registered shall be in state GMM-DEREGISTERED and in state EMM-DEREGISTERED.

If the UE performs a successful attach or combined attach procedure in S1 mode, it shall enter substates GMM-REGISTERED.NO-CELL-AVAILABLE and EMM-REGISTERED.NORMAL-SERVICE. The UE resets the attach attempt counter and the GPRS attach attempt counter (see 3GPP  S  24.008  [13]).

If the UE performs a successful GPRS attach or combined GPRS attach procedure in A/Gb or Iu mode, it shall enter substates GMM-REGISTERED.NORMAL-SERVICE and EMM-REGISTERED.NO-CELL-AVAILABLE. The UE resets the attach attempt counter and the GPRS attach attempt counter (see 3GPP  S  24.008  [13]).

At intersystem change from A/Gb or Iu mode to S1 mode when no PDP context is active, if EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the UE shall move to state EMM-DEREGISTERED and state GMM-DEREGISTERED and then initiate an attach procedure. If EMM-REGISTERED without PDN connection is supported by the UE and the MME, the UE shall enter substates EMM-REGISTERED.NORMAL-SERVICE and GMM-REGISTERED.NO-CELL-AVAILABLE and initiate a tracking area updating procedure.

After successful completion of routing area updating or combined routing area updating and tracking area updating or combined tracking area updating procedures in both S1 mode and A/Gb or Iu mode, if the network has indicated that ISR is activated, the UE shall maintain registration and related periodic update timers in both GMM and EMM.

NOTE:  As specified in clause  5.5.3.2.4 of this document or clause  4.7.5.1.3 of 3GPP  S  24.008  [13], the UE does not activate the ISR even if the network has indicated that the ISR is activated e.g. in the tracking area updating procedure triggered due to a change in UE network capability. In these scenarios, the UE only maintains one registration and related periodic update timer in GMM or EMM.

5.1.5  Coordination between EMM and MM

UEs that operate in CS/PS mode 1 or CS/PS mode 2 of operation shall use the combined EPS/IMSI attach procedure in order to attach to both EPS and non-EPS services.

UEs that operate in CS/PS mode 1 or CS/PS mode 2 of operation and are already attached to both EPS and non-EPS services shall use the combined tracking area updating and periodic tracking area updating procedures.

UEs that operate in CS/PS mode 1 or CS/PS mode 2 of operation and are already attached to both EPS and non-EPS services shall perform a combined detach procedure in order to detach for non-EPS services.

UEs that operate in CS/PS mode 1 or CS/PS mode 2 of operation should not use any MM timers related to MM specific procedures (e.g. T3210, T3211, T3212, T3213) while camped on E-UTRAN, unless the re-activation of these timers is explicitly described. If the MM timers are already running, the UE should not react on the expiration of the timers.

If the UE is configured for eCall only mode as specified in 3GPP  S  31.102  [17] and moves from GERAN/UTRAN to E-UTRAN, the UE shall:

-  if timer T3242 is running, start timer T3444 with the time left on T3242 and stop timer T3242;

-  if timer T3243 is running, start timer T3445 with the time left on T3243 and stop timer T3243;

-  if the UE is attached for both EPS services and non-EPS services and timer T3242 or timer T3243 is running, perform a combined tracking area updating procedure; and

NOTE  1:  A UE configured for eCall only mode as specified in 3GPP  S  31.102  [17] being attached for both EPS services and non-EPS services upon moving from GERAN/UTRAN to E-UTRAN is only possible in the case when the UE has performed a combined attach in E-UTRAN, subsequently moved to GERAN/UTRAN and returned to E-UTRAN before timer T3242 or timer T3243 expires.

-  if the UE is attached for non-EPS services only and timer T3242 or timer T3243 is running, perform a combined attach procedure.

NOTE  2:  Timers T3242 and T3243 are specified in 3GPP  S  24.008  [13].

5.2  Behaviour of the UE in state EMM-DEREGISTERED and state EMM-REGISTERED

5.2.1  General

In this clause, the detailed behaviour of the UE in the states EMM-DEREGISTERED and EMM-REGISTERED is described.

5.2.2  UE behaviour in state EMM-DEREGISTERED

5.2.2.1  General

The state EMM-DEREGISTERED is entered in the UE, when:

-  the detach or combined detach is performed either by the UE or by the MME (see clause  5.5.2);

-  the attach request is rejected by the MME (see clause  5.5.1);

-  the tracking area update request is rejected by the MME (see clause  5.5.3);

-  the service request procedure is rejected by the MME (see clause  5.6.1);

-  the UE deactivates all EPS bearer contexts locally (see clause  6.4.4.6);

-  the UE is switched on;

-  an inter-system change from S1 mode to non3GPP access is completed and the non3GPP access network provides PDN connectivity to the same EPC; or

-  the UE attached for emergency bearer services is in EMM-IDLE mode and its periodic tracking area update timer expires (see clause  5.3.5).

In state EMM-DEREGISTERED, the UE shall behave according to the substate as explained in clause  5.2.2.3.

5.2.2.2  Primary substate selection

5.2.2.2.1  Selection of the substate after power on

For a UE configured for eCall only mode as specified in 3GPP  S  31.102  [17], timers T3444 and T3445 are considered to have expired at power on. When the UE is switched on, the substate shall be PLMN-SEARCH if the USIM is available and valid. See 3GPP  S  23.122  [6] for further details.

The substate chosen after PLMN-SEARCH, following power on is:

-  if no cell can be selected, the substate shall be NO-CELL-AVAILABLE;

-  if no USIM is present, the substate shall be NO-IMSI;

-  if a suitable cell has been found and the PLMN or tracking area is not in the forbidden list, then the substate shall be NORMAL-SERVICE;

-  if the selected cell is known not to be able to provide normal service, then the UE shall enter the substate LIMITED-SERVICE;

-  if the UE is in manual network selection mode and no cell of the selected PLMN has been found, the UE shall enter the substate NO-CELL-AVAILABLE;

-  if the selected cell is a non-3GPP cell, the substate shall be NO-CELL-AVAILABLE; and

-  if the UE is configured for eCall only mode as specified in 3GPP  S  31.102  [17], the substate shall be eCALL-INACTIVE.

5.2.2.3  Detailed description of UE behaviour in state EMM-DEREGISTERED

5.2.2.3.1  NORMAL-SERVICE

The UE shall initiate an attach or combined attach procedure if timer T3346 is not running. If timer T3346 is running, the UE shall initiate an attach or combined attach procedure on the expiry of timer T3346.

The UE may initiate attach for emergency bearer services even if timer T3346 is running.

5.2.2.3.2  LIMITED-SERVICE

The UE shall initiate an attach or combined attach procedure when entering a cell which provides normal service.

The UE may initiate attach for emergency bearer services.

The UE may initiate attach for access to RLOS.

5.2.2.3.3  ATTEMPTING-TO-ATTACH

The UE:

-  shall initiate an attach or combined attach procedure on the expiry of timers T3411, T3402 or T3346 (see 3GPP  S  24.008  [13]);

-  may initiate an attach for emergency bearer services even if timer T3346 is running;

-  may initiate an attach if the UE is a UE configured to use AC11 - 15 in the selected PLMN, even if timer T3402, T3346 or timer T3447 is running;

-  shall initiate an attach or combined attach procedure when entering a new PLMN, if timer T3346 is running and the new PLMN is not equivalent to the PLMN where the UE started timer T3346, the PLMN identity of the new cell is not in one of the forbidden PLMN lists and the tracking area is not in one of the lists of forbidden tracking areas;

-  shall initiate an attach or combined attach procedure when the tracking area of the serving cell has changed, if timer T3346 is not running, the PLMN identity of the new cell is not in one of the forbidden PLMN lists and the tracking area of the new cell is not in one of the lists of forbidden tracking areas;

-  shall use requests for non-EPS services for non-emergency call from CM layers to trigger a combined attach procedure, if timer T3346 is not running (see clause  5.5.1.3), or to attempt to select GERAN or UTRAN radio access technology and proceed with the appropriate MM and CC specific procedures;

-  shall use requests for non-EPS services for emergency call from CM layers to attempt to select GERAN or UTRAN radio access technology and proceed with the appropriate MM and CC specific procedures;

-  may initiate an attach procedure upon receiving a request from upper layers to transmit user data related to an exceptional event and the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP  S  24.368  [15A]) if timer T3346 is not already running for "MO exception data" and even if timer T3402 or timer T3411 is running;

-  may initiate an attach procedure upon request of the upper layers to establish a PDN connection for emergency bearer services; and

-  may initiate an attach procedure upon request of the upper layers to establish a PDN connection for RLOS, if timer T3346 is not running.

5.2.2.3.4  PLMN-SEARCH

The UE shall perform PLMN selection. If a new PLMN is selected, the UE shall reset the attach attempt counter and initiate the attach or combined attach procedure (see clause  5.5.1).

If the selected cell is known not to be able to provide normal service:

-  the UE may initiate attach for emergency bearer services; or

-  the UE may initiate attach for access to RLOS.

5.2.2.3.5  NO-IMSI

The UE shall perform cell selection according to 3GPP  S  36.304  [21].

The UE may initiate attach for emergency bearer services.

The UE may initiate attach for access to RLOS.

5.2.2.3.6  ATTACH-NEEDED

The UE shall initiate the attach or combined attach procedure, if still needed, as soon as the access is allowed in the selected cell for one of the access classes of the UE.

The UE may initiate attach for emergency bearer services.

The UE may initiate attach for access to RLOS.

5.2.2.3.7  NO-CELL-AVAILABLE

The UE shall perform cell selection according to 3GPP  S  36.304  [21] and choose an appropriate substate when a cell is found. When the lower layers indicate to prepare for an S101 mode to S1 mode handover and the PLMN identity of the target cell provided with this indication is not in one of forbidden PLMN lists, the UE shall enter substate NORMAL-SERVICE.

NOTE:  It is assumed that the UE can determine the PLMN identity of networks supporting cdma2000   xae HRPD access from the information broadcast over the radio interface. For the purpose of S101 mode to S1 mode handover, the UE can use the PLMN identity of the visited cdma2000   xae HRPD network also as PLMN identity of the target cell.

5.2.2.3.8  eCALL-INACTIVE

The UE camps on a suitable cell or an acceptable cell in a PLMN selected as specified in 3GPP  S  23.122  [6] but initiates no EMM signalling with the network and ignores any paging requests.

The UE shall leave substate EMM-DEREGISTERED.eCALL-INACTIVE state only when one of the following events occur:

-  if the USIM is removed, the UE enters substate EMM-DEREGISTERED.NO-IMSI;

-  if coverage is lost, the UE enters substate EMM-DEREGISTERED.PLMN-SEARCH;

-  if the UE is deactivated (e.g. powered off) by the user, the UE enters state EMM-NULL;

-  if the UE receives a request from upper layers to establish an eCall over IMS, the UE enters state EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH. The UE then uses the relevant EMM and ESM procedures to establish the eCall over IMS at the earliest opportunity; or

-  if the UE receives a request from upper layers to establish a call to an HPLMN designated non-emergency MSISDN or URI for test or terminal reconfiguration service, the UE enters state EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH. Once the attach procedure is completed, the UE uses the relevant EMM and ESM procedures to establish the non-emergency call.

5.2.2.4  Substate when back to state EMM-DEREGISTERED from another EMM state

When returning to state EMM-DEREGISTERED, the UE shall select a cell as specified in 3GPP  S  36.304  [21].

The substate depends on the result of the cell selection procedure, the outcome of the previously performed EMM specific procedures, on the EPS update status of the UE, on the tracking area data stored in the UE, on the presence of the USIM, on the UE configuration and on the reason for moving to EMM-DEREGISTERED:

-  If no cell has been found, the substate is NO-CELL-AVAILABLE, until a cell is found.

-  If no USIM is present or if the inserted USIM is considered invalid by the UE, the substate shall be NO-IMSI.

-  If a suitable cell has been found and the PLMN or tracking area is not in the forbidden list, the substate shall be NORMAL-SERVICE.

-  If an attach shall be performed (e.g. network requested re-attach), the substate shall be ATTEMPTING-TO-ATTACH.

-  If a PLMN reselection (according to 3GPP  S  23.122  [6]) is needed, the substate shall be PLMN-SEARCH.

-  If the selected cell is known not to be able to provide normal service, the substate shall be LIMITED-SERVICE;

-  If the selected cell is a non-3GPP cell, the substate shall be NO-CELL-AVAILABLE; and

-  If the UE is configured for eCall only mode as specified in 3GPP  S  31.102  [17], T3444 and T3445 have expired or are not running, and substate PLMN-SEARCH is not required, the substate shall be eCALL-INACTIVE.

5.2.3  UE behaviour in state EMM-REGISTERED

5.2.3.1  General

The state EMM-REGISTERED is entered at the UE, when:

-  the attach or combined attach procedure is performed by the UE (see clause  5.5.1).

In state EMM-REGISTERED, the UE shall behave according to the substate as explained in clause  5.2.3.2.

5.2.3.2  Detailed description of UE behaviour in state EMM-REGISTERED

5.2.3.2.1  NORMAL-SERVICE

The UE:

-  shall initiate normal and combined tracking area updating (according to conditions given in clause  5.5.3);

-  shall perform periodic tracking area updating (see clause  5.5.3) except when attached for emergency bearer services (see clause  5.3.5);

-  shall initiate a tracking area updating on the expiry of timer T3411;

-  shall respond to paging; and

NOTE:  As an implementation option, the MUSIM UE is allowed to not respond to paging based on the information available in the paging message, e.g. voice service indication.

-  if configured for eCall only mode as specified in 3GPP  S  31.102  [17], shall perform the eCall inactivity procedure at expiry of timer T3444 or T3445 (see clause  5.5.4).

5.2.3.2.2  ATTEMPTING-TO-UPDATE

The UE:

-  shall not send any user data;

-  shall initiate tracking area updating on the expiry of timers T3411, T3402 or T3346;

-  shall initiate tracking area updating when entering a new PLMN, if timer T3346 is running and the new PLMN is not equivalent to the PLMN where the UE started timer T3346, the PLMN identity of the new cell is not in one of the forbidden PLMN lists, and the tracking area is not in one of the lists of forbidden tracking areas;

-  shall initiate tracking area updating when the tracking area of the serving cell has changed, if timer T3346 is not running, the PLMN identity of the new cell is not in one of the forbidden PLMN lists and the tracking area is not in one of the lists of forbidden tracking areas;

-  may initiate a tracking area updating procedure upon request of the upper layers to establish a PDN connection for emergency bearer services;

-  shall initiate tracking area updating procedure upon request of the upper layers to establish a PDN connection without the NAS signalling low priority indication as specified in clause 5.5.3.2.6, item  l), if timer T3346 is running due to a NAS request message (TRACKING AREA UPDATE REQUEST, CONTROL PLANE SERVICE REQUEST or EXTENDED SERVICE REQUEST) which contained the low priority indicator set to "MS is configured for NAS signalling low priority" and timer T3402 and timer T3411 are not running;

-  may detach locally and initiate an attach for emergency bearer services even if timer T3346 is running;

-  shall use requests for non-EPS services from CM layers to trigger a combined tracking area updating procedure, if timer T3346 is not running (see clause  5.5.3.3), or to attempt to select GERAN, UTRAN or cdma2000   xae 1xRTT radio access technology and proceed with the appropriate MM and CC specific procedures;

-  may use requests for an MMTEL voice call or MMTEL video call from the upper layers to initiate tracking area updating, if timer T3346 is not running;

-  shall initiate tracking area updating when the UE performs inter-system change from N1 mode to S1 mode, even if timer T3402 is running;

-  shall initiate tracking area updating in response to paging with S-TMSI or paging with IMSI and domain indicator set to       xb3CS      xb3;

NOTE:  As an implementation option, the MUSIM UE is allowed to not respond to paging based on the information available in the paging message, e.g. voice service indication.

-  shall initiate tracking area updating if the EPS update status is set to EU2 NOT UPDATED, and timers T3411, T3402 and T3346 are not running;

-  if configured for eCall only mode as specified in 3GPP  S  31.102  [17], shall perform the eCall inactivity procedure at expiry of timer T3444 or T3445 (see clause  5.5.4);

-  may initiate tracking area updating upon receiving a request from upper layers to transmit user data related to an exceptional event and the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP  S  24.368  [15A]) if timer T3346 is not already running for "MO exception data" and even if timer T3402 or timer T3411 is running;

-  may initiate tracking area updating if the UE is a UE configured to use AC11        15 in the selected PLMN, even if timer T3402, T3346 or timer T3447 is running; and

-  shall not initiate the detach signalling procedure unless the current TAI is part of the TAI list.

5.2.3.2.3  LIMITED-SERVICE

The UE:

-  shall perform cell selection/reselection according to 3GPP  S  36.304  [21];

-  may respond to paging (with IMSI);

NOTE:  As an implementation option, the MUSIM UE is allowed to not respond to paging based on the information available in the paging message, e.g. voice service indication.

-  may detach locally and initiate attach for emergency bearer services;

-  may detach locally and may initiate attach for access to RLOS; and

-  if configured for eCall only mode as specified in 3GPP  S  31.102  [17], shall perform the eCall inactivity procedure at expiry of timer T3444 or T3445 (see clause  5.5.4).

5.2.3.2.4  PLMN-SEARCH

The UE may enter this substate when it is in automatic network selection mode and the maximum allowed number of subsequently unsuccessful tracking area updating have been performed. The UE may also enter this substate as a result of a tracking area update rejected by the network (see clause  5.5.3) or as a result of a service request rejected by the network (see clause  5.6.1). If a new PLMN is selected, the UE shall reset the tracking area updating attempt counter and initiate the tracking area updating or combined tracking area updating procedure (see clause  5.5.3).

If the selected cell is known not to be able to provide normal service:

-  the UE may detach locally and initiate attach for emergency bearer services; or

-  the UE may detach locally and initiate attach for access to RLOS.

5.2.3.2.5  UPDATE-NEEDED

The UE:

-  shall not send any user data;

-  shall not send signalling information, unless it is a service request a tracking area updating or combined tracking area updating procedure which is triggered:

a)  as a response to paging;

NOTE:  As an implementation option, the MUSIM UE is allowed to not respond to paging based on the information available in the paging message, e.g. voice service indication.

b)  upon request by the upper layers to establish a PDN connection for emergency bearer services; or

c)  upon a request from the upper layers for an MMTEL voice call, MMTEL video call, SMSoIP, SMS over NAS or SMS over S102;

-  shall perform cell selection/reselection according to 3GPP  S  36.304  [21];

-  shall enter the appropriate new substate as soon as the access is allowed in the selected cell for one of the access classes of the UE; and

-  if configured for eCall only mode as specified in 3GPP  S  31.102  [17], shall perform the eCall inactivity procedure at expiry of timer T3444 or T3445 (see clause  5.5.4).

5.2.3.2.6  NO-CELL-AVAILABLE

The UE shall perform cell selection/reselection according to 3GPP  S  36.304  [21].

5.2.3.2.7  ATTEMPTING-TO-UPDATE-MM

The UE:

-  shall perform cell selection/reselection according to 3GPP  S  36.304  [21];

-  shall be able to receive and transmit user data and signalling information;

-  shall initiate combined tracking area updating procedure indicating "combined TA/LA updating with IMSI attach" on the expiry of timers T3411 or T3402 or when the UE enters a tracking area not in the list of registered tracking areas and not in one of the lists of forbidden tracking areas;

-  shall respond to paging with IMSI or S-TMSI for the PS domain;

NOTE:  As an implementation option, the MUSIM UE is allowed to not respond to paging based on the information available in the paging message, e.g. voice service indication.

-  shall use requests for non-EPS services from CM layers to attempt to select GERAN or UTRAN radio access technology and proceed with the appropriate MM and CC specific procedures, unless T3402 is running due to receipt of an ATTACH ACCEPT or TRACKING AREA UPDATING ACCEPT message with EMM cause #22 "congestion";

-  shall use requests for non-EPS services due to emergency call from CM layers to attempt to select GERAN or UTRAN radio access technology and proceed with the appropriate MM and CC specific procedures, even if T3402 is running due to receipt of an ATTACH ACCEPT or TRACKING AREA UPDATING ACCEPT message with EMM cause #22 "congestion"; and

-  if configured for eCall only mode as specified in 3GPP  S  31.102  [17], shall perform the eCall inactivity procedure at expiry of timer T3444 or T3445 (see clause  5.5.4).

5.2.3.2.8  IMSI-DETACH-INITIATED

The UE:

-  shall be able to receive and transmit user data and signalling information;

-  shall initiate combined tracking area updating procedure (according to conditions given in clause  5.5.3.3 or clause 5.5.2.2.4); and

-  if configured for eCall only mode as specified in 3GPP  S  31.102  [17], shall perform the eCall inactivity procedure at expiry of timer T3444 or T3445 (see clause  5.5.4).

5.3  General on elementary EMM procedures

5.3.1  EMM modes and NAS signalling connection

5.3.1.1  Establishment of the NAS signalling connection

When the UE is in EMM-IDLE mode without suspend indication and needs to transmit an initial NAS message, the UE shall request the lower layer to establish a RRC connection. In this request to the lower layer the NAS shall provide to the lower layer the RRC establishment cause and the call type as specified in annex D of this specification and, for the case specified in clause  5.6.1.2.2, shall also provide the initial NAS message, otherwise NAS may also provide the initial NAS message.

Initial NAS messages are:

-  ATTACH REQUEST;

-  DETACH REQUEST;

-  TRACKING AREA UPDATE REQUEST;

-  SERVICE REQUEST;

-  EXTENDED SERVICE REQUEST; and

-  CONTROL PLANE SERVICE REQUEST.

When the UE is in EMM-IDLE mode with suspend indication, the UE shall proceed the behaviour as specified in clauses  5.3.1.3.

For the routing of the initial NAS message to the appropriate MME, the UE NAS provides the lower layers with either the S-TMSI, the registered globally unique MME identifier (GUMMEI) that consists of the PLMN ID, the MME group ID, and the MME code (see 3GPP  S  23.003  [2]), or none of them according to the following rules:

-  If the UE has received the interworking without N26 interface indicator set to "interworking without N26 interface not supported" from the network, the UE holds a valid 5G-GUTI and:

a)  the UE performs an initial EPS attach procedure or tracking area updating procedure following an inter-system change from N1 mode to S1 mode; or

b)  the UE which was previously registered in N1 mode before entering state 5GMM-DEREGISTERED, performs an initial EPS attach procedure,

  then the UE NAS shall provide the lower layers with the MME identifier part of the mapped GUTI, which is generated from the 5G-GUTI as specified in 3GPP  S  23.003  [4], an indication that the identifier is a native GUMMEI and an indication that the identifier is mapped from 5GS;

-  If the TIN indicates "GUTI" or "RAT-related TMSI", or the TIN is not available, and the UE holds a valid GUTI:

a)  When the UE in EMM-IDLE mode initiates a tracking area updating or combined tracking area updating procedure for load balancing purposes, the UE NAS shall provide the lower layers with neither S-TMSI nor registered MME identifier;

b)  When the tracking area of the current cell is in the list of tracking areas that the UE previously registered in the MME during the NAS signalling connection establishment, the UE NAS shall provide the lower layers with the S-TMSI, but shall not provide the registered MME identifier to the lower layers; or

c)  When the tracking area of the current cell is not in the list of tracking areas that the UE previously registered in the MME during the NAS signalling connection establishment, the UE NAS shall provide the lower layers with the MME identifier part of the valid GUTI with an indication that the identifier is a native GUMMEI.

-  If the TIN indicates "P-TMSI", or the TIN is not available, and the UE holds a valid P-TMSI and RAI, the UE NAS shall provide the lower layers with the MME identifier part of the mapped GUTI, which is generated from the P-TMSI and RAI with an indication that the identifier is a mapped GUMMEI; or

-  Otherwise, the UE NAS does not provide the lower layers with the S-TMSI, the registered GUMMEI and the mapped GUMMEI.

The UE NAS also provides the lower layers with the identity of the selected PLMN (see 3GPP  S  36.331  [22]). In a shared network, the UE shall choose one of the PLMN identities as specified in 3GPP  S  23.122  [6].

When an ATTACH REQUEST message, or a TRACKING AREA UPDATE REQUEST message when the current TAI of the current cell is not included in the TAI list, is sent to establish a signalling connection, the UE NAS also provides the lower layers with the DCN-ID according to the following rules:

a)  if a DCN-ID for the PLMN code of the selected PLMN is available in the UE, the UE NAS shall provide this DCN-ID to the lower layers; or

b)  if no DCN-ID for the PLMN code of the selected PLMN is available but a Default_DCN_ID value is available in the UE, as specified in 3GPP  S  24.368  [15A] or in USIM file NASCONFIG as specified in 3GPP  S  31.102  [17], the UE NAS shall provide this DCN-ID to the lower layers.

If a relay node is attaching for relay node operation (see 3GPP  S  23.401  [10]), the NAS in the relay node shall indicate to the lower layers that the establishment of the NAS signalling connection is for a relay node.

In S1 mode, when the RRC connection has been established successfully, the UE shall enter EMM-CONNECTED mode and consider the NAS signalling connection established.

In S101 mode, when the cdma2000   xae HRPD access network resources are available for tunnelled NAS signalling, the UE shall enter EMM-CONNECTED mode and consider the S101 mode NAS signalling connection established.

5.3.1.2  Release of the NAS signalling connection

5.3.1.2.1  General

The signalling procedure for the release of the NAS signalling connection is initiated by the network.

In S1 mode, when the RRC connection has been released, the UE shall enter EMM-IDLE mode and consider the NAS signalling connection released.

If the UE is configured for eCall only mode as specified in 3GPP  S  31.102  [17] then:

-  if the NAS signalling connection that was released had been established for eCall over IMS, the UE shall start timer T3444; and

-  if the NAS signalling connection that was released had been established for a call to an HPLMN designated non-emergency MSISDN or URI for test or terminal reconfiguration service, the UE shall start timer T3445.

The UE shall start the SGC timer T3447 with the service gap time value available in the UE when the NAS signalling connection is released if:

-  the UE supports SGC feature, and the service gap timer value is available in the UE and does not indicate zero; and

-  the NAS signalling connection that was released had been established for mobile originated request for transfer of uplink data.

If the UE receives the "Extended wait time" from the lower layers when no attach, tracking area updating or service request procedure is ongoing, the UE shall ignore the "Extended wait time".

To allow the network to release the NAS signalling connection, the UE:

a)  shall start the timer T3440 if the UE receives any of the EMM cause values #11, #12, #13, #14 (not applicable to the service request procedure), #15, #25, #31, #35 or #42;

b)  shall start the timer T3440 if:

-  the UE receives a TRACKING AREA UPDATE ACCEPT message which does not include a UE radio capability ID deletion indication IE;

-  the UE has not set the "active" flag in the TRACKING AREA UPDATE REQUEST message;

-  the UE has not set the "signalling active" flag in the TRACKING AREA UPDATE REQUEST message;

-  the tracking area updating or combined tracking area updating procedure has been initiated in EMM-IDLE mode, or the UE has set Request type to "NAS signalling connection release" in the UE request type IE in the TRACKING AREA UPDATE REQUEST message and the NAS signalling connection release bit is set to "NAS signalling connection release supported" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message; and

-  the user plane radio bearers have not been set up;

c)  shall start the timer T3440 if the UE receives a DETACH ACCEPT message and the UE has set the detach type to "IMSI detach" in the DETACH REQUEST message and user plane radio bearers have not been set up;

d)  shall start the timer T3440 if the UE receives a TRACKING AREA UPDATE REJECT message indicating:

-  any of the EMM cause values #9 or #10 and the UE has no CS fallback emergency call, CS fallback call, 1xCS fallback emergency call, or 1xCS fallback call pending; or

-  the EMM cause values #40, the TRACKING AREA UPDATE message was not triggered due to receiving a paging for CS fallback or a paging for 1xCS fallback, and the UE has no CS fallback emergency call, CS fallback call, 1xCS fallback emergency call, or 1xCS fallback call pending;

e)  shall start the timer T3440 if the UE receives a SERVICE REJECT message indicating any of the EMM cause values #9, #10 or #40 as a response to a SERVICE REQUEST message CONTROL PLANE SERVICE REQUEST message, or an EXTENDED SERVICE REQUEST message with service type set to "packet services via S1";

f)  may start the timer T3440 if the UE receives any of the EMM cause values #3, #6, #7 or #8 or if it receives an AUTHENTICATION REJECT message;

g)  shall start the timer T3440 if the UE receives a SERVICE REJECT message indicating the EMM cause value #39 and the UE has initiated EXTENDED SERVICE REQUEST in EMM-IDLE and the user plane radio bearers have not been set up;

h)  shall start the timer T3440 if the UE receives a SERVICE REJECT, SERVICE ACCEPT, ATTACH ACCEPT or TRACKING AREA UPDATE ACCEPT message with control plane data back-off timer;

i)  shall start the timer T3440 if the UE receives the EMM cause value #22 along with a T3346 value, and the value indicates that the timer T3346 is neither zero nor deactivated;

j)  shall start the timer T3440 if the UE receives a SERVICE ACCEPT message and the UE has set Request type to "NAS signalling connection release" or to "Rejection of paging" in the UE request type IE in the EXTENDED SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST message;

k)  shall start the timer T3440 if the UE receives a SERVICE ACCEPT message, the UE has set the Control plane service type of the CONTROL PLANE SERVICE REQUEST message to "mobile terminating request" and the "active" flag in the Control plane service type IE to 0, the user plane radio bearers have not been set up, and the CONTROL PLANE SERVICE REQUEST message was sent from EMM-IDLE mode; or

l)  shall start the timer T3440 if the UE receives a DETACH ACCEPT message and the UE has set the detach type to "EPS detach" or "combined EPS/IMSI detach" in the DETACH REQUEST message.

Upon expiry of T3440,

-  in cases a, b, c, f, h, i, j and l, the UE shall locally release the established NAS signalling connection; or

-  in cases d and e, the UE shall locally release the established NAS signalling connection and the UE shall initiate the attach procedure as described in clause  5.5.3.2.5, 5.5.3.3.5 or 5.6.1.5.

In cases b, c and g,

-  upon an indication from the lower layers that the user plane radio bearers are set up, the UE shall stop timer T3440 and may send uplink signalling via the existing NAS signalling connection or user data via the user plane bearers. If the uplink signalling is for CS fallback for emergency call, or for establishing a PDN connection for emergency bearer services, the UE shall send the uplink signalling via the existing NAS signalling connection; or

In cases b, c, g and j,

-  upon receipt of a DETACH REQUEST message, the UE shall stop timer T3440 and respond to the network initiated detach as specified in clause  5.5.2.3.

In case b, j and k,

-  upon receiving a request from upper layers to send NAS signalling not associated with establishing either a CS emergency call or a PDN connection for emergency bearer services, the UE shall wait for the local release of the established NAS signalling connection upon expiry of timer T3440 or T3440 being stopped before proceeding;

-  upon receiving a request from upper layers to establish either a CS emergency call or a PDN connection for emergency bearer services, the UE shall stop timer T3440 and shall locally release the NAS signalling connection, before proceeding as specified in clause  5.6.1;

-  upon receipt of ESM DATA TRANSPORT message, as an implementation option, the UE may reset and restart timer T3440;

-  upon receipt of a DOWNLINK NAS TRANSPORT or DOWNLINK GENERIC NAS TRANSPORT message, the UE which is in EMM-REGISTERED without PDN connections shall stop timer T3440 and may send uplink signalling via the existing NAS signalling connection;

-  upon receipt of an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, MODIFY EPS BEARER CONTEXT REQUEST, DEACTIVATE EPS BEARER CONTEXT REQUEST, DOWNLINK NAS TRANSPORT or DOWNLINK GENERIC NAS TRANSPORT message, if the UE is using control plane CIoT EPS optimization, the UE shall stop timer T3440 and may send uplink signalling via the existing NAS signalling connection; or

-  upon initiation of tracking area updating procedure or combined tracking area updating procedure due to detecting the current TAI is not in the TAI list as specified in clause  5.5.3.2.6 for cases e, i, j, clause  5.5.3.2.2 for case a or clause  5.5.3.3.2 for case a, the UE shall stop timer T3440.

In case c,

-  upon receiving a request from upper layers to send NAS signalling not associated with establishing a PDN connection for emergency bearer services, the UE shall wait for the local release of the established NAS signalling connection upon expiry of timer T3440 or T3440 being stopped before proceeding; or

-  upon receiving a request from upper layers to establish a PDN connection for emergency bearer services, the UE shall stop timer T3440 and shall locally release the NAS signalling connection, before proceeding as specified in clause  5.6.1.

In cases d and e,

-  upon an indication from the lower layers that the RRC connection has been released, the UE shall stop timer T3440 and perform a new attach procedure as specified in clause  5.5.3.2.5, 5.5.3.3.5 or 5.6.1.5; or

-  upon receiving a request from upper layers to establish a PDN connection for emergency bearer services, the UE shall stop timer T3440 and shall locally release the NAS signalling connection, before proceeding as specified in clause  5.5.1.

In cases a and f,

-  upon receiving a request from upper layers to establish a PDN connection for emergency bearer services, the UE shall stop timer T3440 and shall locally release the NAS signalling connection, before proceeding as specified in clause  5.5.1.

In case g,

-  upon receiving a request from upper layers to send NAS signalling not associated with establishing either a CS emergency call or a PDN connection for emergency bearer services, the UE shall wait for the local release of the established NAS signalling connection upon expiry of timer T3440 or T3440 being stopped before proceeding; or

-  upon receiving a request from upper layers to establish either a CS emergency call or a PDN connection for emergency bearer services, the UE shall stop timer T3440 and shall locally release the NAS signalling connection, before proceeding as specified in clause  5.6.1.

In case h,

-  upon an indication from the lower layers that the user plane radio bearers are set up or upon receiving a request from upper layers to send NAS signalling not associated with ESM DATA TRANSPORT, the UE shall stop timer T3440; or

-  the UE shall not send ESM DATA TRANSPORT message until expiry of timer T3440 or times T3440 being stopped.

In EMM-CONNECTED mode, if the UE moves to EMM-SERVICE-REQUEST-INITIATED state upon receipt of a CS SERVICE NOTIFICATION message, the UE shall stop timer T3440.

In S101 mode, when the cdma2000   xae HRPD radio access connection has been released, the UE shall enter EMM-IDLE mode and consider the S101 mode NAS signalling connection released.

5.3.1.2.2  UE is using EPS services with control plane CIoT EPS optimization

Upon receipt of the indication from the ESM layer to release the NAS signalling connection (see clause  6.6.4.2), unless the MME has additional downlink user data or signalling pending, the MME shall initiate release of the NAS signalling connection.

5.3.1.3  Suspend and resume of the NAS signalling connection

Suspend of the NAS signalling connection can be initiated by the network in EMM-CONNECTED mode when user plane CIoT EPS optimization is used. Resume of the suspended NAS signalling connection is initiated by the UE.

In the UE, when user plane CIoT EPS optimization is used:

-  Upon indication from the lower layers that the RRC connection has been suspended, the UE shall enter EMM-IDLE mode with suspend indication, shall not consider the NAS signalling connection released and shall not consider the secure exchange of NAS messages terminated (see clause  4.4.2.3 and 4.4.5). Based on further indications provided by the lower layers, the UE shall update the status of the suspend indication for the EMM-IDLE mode;

-  Upon trigger of a procedure using an initial NAS message when in EMM-IDLE mode with suspend indication, the UE shall:

i)  if the initial NAS message is a TRACKING AREA UPDATE REQUEST message which includes a UE radio capability information update needed IE, enter EMM-IDLE mode without suspend indication and proceed with the tracking area updating procedure; and

ii)  otherwise, request the lower layer to resume the RRC connection. In this request to the lower layer the NAS shall provide to the lower layer the RRC establishment cause and the call type according to annex  D of this document;

NOTE  1:  In NB-S1 mode, in the request to the lower layer the data volume information of the initial NAS message is provided to the lower layers. Interactions between the NAS and the lower layers in order to obtain the data volume information of the initial NAS message (see 3GPP  S  36.321  [49], 3GPP  S  36.331  [22]) is left to implementations.

-  Upon indication from the lower layers that the RRC connection has been resumed when in EMM-IDLE mode with suspend indication, the UE shall enter EMM-CONNECTED mode. If the pending NAS message is:

i)  a SERVICE REQUEST message;

ii)  a CONTROL PLANE SERVICE REQUEST message, and the UE did not include any ESM message container, NAS message container, EPS bearer context status information element, or UE request type information element; or

iii)  an EXTENDED SERVICE REQUEST message, and the Service type information element indicates "packet services via S1" and the UE did not include any EPS bearer context status information element, or UE request type information element;

  the message shall not be sent. Otherwise the UE shall cipher the message as specified in clause  4.4.5 and send the pending initial NAS message upon entering EMM-CONNECTED mode;

NOTE  2:  If a NAS message is discarded and not sent to the network, the uplink NAS COUNT value corresponding to that message is reused for the next uplink NAS message to be sent.

-  Upon fallback indication from the lower layers at RRC connection resume when in EMM-IDLE mode with suspend indication, the UE shall enter EMM-IDLE mode without suspend indication, send any pending initial NAS message and proceed as if RRC connection establishment had been requested;

-  Upon indication from the lower layers that the RRC connection resume has failed and indication from the lower layers that the RRC connection is suspended, the UE shall enter EMM-IDLE mode with suspend indication and restart the ongoing NAS procedure if required; and

-  Upon indication from the lower layers that the RRC connection resume has failed and indication from the lower layers that the RRC connection is not suspended, the UE shall enter EMM-IDLE mode without suspend indication and restart the ongoing NAS procedure if required.

In the network, when user plane CIoT EPS optimization is used:

-  Upon indication from the lower layers that the RRC connection has been suspended, the network shall enter EMM-IDLE mode with suspend indication, shall not consider the NAS signalling connection released and shall not consider the secure exchange of NAS messages terminated; and

-  Upon indication from the lower layers that the RRC connection has been resumed when in EMM-IDLE mode with suspend indication, the network shall enter EMM-CONNECTED mode.

For the case that not all suspended bearers are resumed, see clause  6.4.4.6.

5.3.2  Lists of forbidden tracking areas

The UE shall store a list of "forbidden tracking areas for roaming", as well as a list of "forbidden tracking areas for regional provision of service". These lists shall be erased when the UE is switched off or when the UICC containing the USIM is removed, and periodically (with a period in the range 12 to 24 hours). When the lists are erased, the UE performs cell selection according to 3GPP  S  36.304  [21]. One or more tracking areas is removed from the list of "forbidden tracking areas for roaming" in the UE, as well as the list of "forbidden tracking areas for regional provision of service" if, after a subsequent procedure e.g. attach procedure, tracking area updating procedure and GUTI reallocation procedure, one or more tracking areas in the lists is received from the network. If the UE has only one PDN connection established which is for emergency bearer services, the tracking areas shall not be removed from these lists if one or more tracking areas in the lists are received from the network.

In S1 mode, the UE shall update the suitable list whenever an ATTACH REJECT, TRACKING AREA UPDATE REJECT, SERVICE REJECT or DETACH REQUEST message is received with the EMM cause #12 "tracking area not allowed", #13 "roaming not allowed in this tracking area", or #15 "no suitable cells in tracking area".

Each list shall accommodate 40 or more TAIs. When the list is full and a new entry has to be inserted, the oldest entry shall be deleted.

5.3.3  List of forbidden PLMNs for attach in S101 mode

A UE supporting S101 mode shall store a list of "forbidden PLMNs for attach in S101 mode". The UE shall erase this list when the UE is switched off or when the USIM is removed.

In S101 mode, the UE shall add to the "forbidden PLMNs for attach in S101 mode" list the PLMN identity provided with the indication from the lower layers to prepare for an S101 mode to S1 mode handover whenever an ATTACH REJECT message is received with the EMM cause #11 "PLMN not allowed", #12 "tracking area not allowed", #13 "roaming not allowed in this tracking area", #14 "EPS services not allowed in this PLMN", #15 "no suitable cells in tracking area", or #35 "Requested service option not authorized in this PLMN" as specified in clause  5.5.1.2.5.

The maximum number of possible entries in the "forbidden PLMNs for attach in S101 mode" list is implementation dependent, but the list shall accommodate at least one PLMN identity. When the list is full and a new PLMN identity has to be inserted, the UE shall delete the oldest PLMN identity.

5.3.3a  Forbidden PLMNs for EPS services

The forbidden PLMNs for EPS services are contained in the "forbidden PLMNs for GPRS service" list, as defined in 3GPP  S  24.008  [13]. The UE updates this list as part of the attach procedure, tracking area updating procedure and network initiated detach procedure as described respectively in clauses  5.5.1,  5.5.3  and  5.5.2.3.2.

5.3.4  Equivalent PLMNs list

The UE shall store a list of equivalent PLMNs. These PLMNs shall be regarded by the UE as equivalent to each other for PLMN selection and cell selection/re-selection. The same list is used by 5GMM, EMM, GMM and MM.

The UE shall update or delete this list at the end of each attach or combined attach or tracking area updating or combined tracking area updating procedure. The stored list consists of a list of equivalent PLMNs as downloaded by the network plus the PLMN code of the registered PLMN that downloaded the list. When the UE is switched off, it shall keep the stored list so that it can be used for PLMN selection after switch on. The UE shall delete the stored list if the USIM is removed or when the UE attached for emergency bearer services or access to RLOS enters the state EMM-DEREGISTERED. The maximum number of possible entries in the stored list is 16.

5.3.5  Handling of the periodic tracking area update timer and mobile reachable timer (S1 mode only)

The periodic tracking area updating procedure is used to periodically notify the availability of the UE to the network. The procedure is controlled in the UE by timer T3412. The value of timer T3412 is sent by the network to the UE in the ATTACH ACCEPT message and can be sent in the TRACKING AREA UPDATE ACCEPT message. The UE shall apply this value in all tracking areas of the list of tracking areas assigned to the UE until a new value is received.

If timer T3412 received by the UE in an ATTACH ACCEPT or TRACKING AREA UPDATE ACCEPT message contains an indication that the timer is deactivated or the timer value is zero, then timer T3412 is deactivated and the UE shall not perform the periodic tracking area updating procedure.

Timer T3412 is reset and started with its initial value, when the UE changes from EMM-CONNECTED to EMM-IDLE mode. Timer T3412 is stopped when the UE enters EMM-CONNECTED mode or the EMM-DEREGISTERED state.

If the UE is attached for emergency bearer services, and timer T3412 expires, the UE shall not initiate a periodic tracking area updating procedure, but shall locally detach from the network. When the UE is camping on a suitable cell, it may re-attach to regain normal service.

When a UE is not attached for emergency bearer services, and timer T3412 expires, the periodic tracking area updating procedure shall be started and the timer shall be set to its initial value for the next start.

If the UE is not attached for emergency bearer services, and is in a state other than EMM-REGISTERED.NORMAL-SERVICE when timer T3412 expires, the periodic tracking area updating procedure is delayed until the UE returns to EMM-REGISTERED.NORMAL-SERVICE.

NOTE  1:  When the UE returns to EMM-REGISTERED.NORMAL-SERVICE and it needs to initiate other EMM procedure than the periodic TAU procedure then, based on UE implementation, the EMM procedure can take precedence.

If ISR is activated, the UE shall keep both timer T3412 and timer T3312. The two separate timers run in the UE for updating MME and SGSN independently. The UE shall start timer T3423, if timer T3412 expires, and timer T3346 is running or the UE is in one of the following states:

-  EMM-REGISTERED.NO-CELL-AVAILABLE;

-  EMM-REGISTERED.PLMN-SEARCH;

-  EMM-REGISTERED.UPDATE-NEEDED; or

-  EMM-REGISTERED.LIMITED-SERVICE.

The UE shall initiate the tracking area updating procedure and stop timer T3423 when it enters state EMM-REGISTERED.NORMAL-SERVICE before timer T3423 expires. After expiry of timer T3423 the UE shall set its TIN to "P-TMSI".

If timer T3423 expires the UE shall memorize that it has to initiate a tracking area updating procedure when it returns to state EMM-REGISTERED.NORMAL-SERVICE.

If the UE is attached to both EPS and non-EPS services, and if timer T3412 expires or timer T3423 expires when the UE is in EMM-REGISTERED.NO-CELL-AVAILABLE state, then the UE shall initiate the combined tracking area updating procedure indicating "combined TA/LA updating with IMSI attach" when the UE returns to EMM-REGISTERED.NORMAL-SERVICE state.

When the network includes T3412 extended value IE in the ATTACH ACCEPT message or TRACKING AREA UPDATE ACCEPT message, the network uses timer T3412 extended value IE as the value of timer T3412.

The network supervises the periodic tracking area updating procedure of the UE by means of the mobile reachable timer.

If the UE is not attached for emergency bearer services, the mobile reachable timer shall be longer than T3412. In this case, by default, the mobile reachable timer is 4 minutes greater than timer T3412.

If ISR is not activated, the network behaviour upon expiry of the mobile reachable timer is network dependent, but typically the network stops sending paging messages to the UE on the first expiry, and may take other appropriate actions.

If the UE is attached for emergency bearer services, the MME shall set the mobile reachable timer with a value equal to timer T3412. When the mobile reachable timer expires, the MME shall locally detach the UE.

The mobile reachable timer shall be reset and started with the value as indicated above, when the MME releases the NAS signalling connection for the UE. The mobile reachable timer shall be stopped when a NAS signalling connection is established for the UE.

Upon expiry of the mobile reachable timer the network shall start the implicit detach timer. The value of the implicit detach timer is network dependent. If ISR is activated, the default value of the implicit detach timer is 4 minutes greater than timer T3423. If the implicit detach timer expires before the UE contacts the network, the network shall implicitly detach the UE. If the MME includes timer T3346 in the TRACKING AREA UPDATE REJECT message or the SERVICE REJECT message and timer T3346 is greater than timer T3412, the MME sets the mobile reachable timer and the implicit detach timer such that the sum of the timer values is greater than timer T3346.

If the network includes the T3324 value IE in the ATTACH ACCEPT message or TRACKING AREA UPDATE ACCEPT message, and if the UE is not attached for emergency bearer services and has no PDN connection for emergency bearer services the MME shall set the active timer to a value equal to the value of timer T3324.

NOTE  2:  Timer T3324 is specified in 3GPP  S  24.008  [13].

If the UE has established a PDN connection for emergency services after receiving the timer T3324 value IE in the ATTACH ACCEPT message or the last TRACKING AREA UPDATE ACCEPT message, the active timer shall not be started.

The active timer shall be reset and started with the value as indicated above, when the MME releases the NAS signalling connection for the UE. The active timer shall be stopped when an NAS signalling connection is established for the UE.

The network behaviour upon expiry of the active timer is network dependent, but typically the network stops sending paging messages to the UE on the first expiry, and may take other appropriate actions.

NOTE  3:  ISR is not activated when the network includes the T3324 value IE in the ATTACH ACCEPT message or TRACKING AREA UPDATE ACCEPT message.

The implicit detach timer shall be stopped when a NAS signalling connection is established for the UE.

5.3.6  Handling of timer T3402

The value of timer T3402 can be sent by the network to the UE in the ATTACH ACCEPT message and TRACKING AREA UPDATE ACCEPT message. If the value is different from "deactivated", the UE shall apply this value in all tracking areas of the list of tracking areas assigned to the UE, until a new value is received.

The value of timer T3402 can be sent by the network to the UE in the ATTACH REJECT message. If an ATTACH REJECT message including timer T3402 value different from "deactivated", was received integrity protected, the UE shall apply this value until a new value is received with integrity protection or a new PLMN is selected. Otherwise, the default value of this timer is used.

The default value of this timer is also used by the UE in the following cases:

-  ATTACH ACCEPT message or TRACKING AREA UPDATE ACCEPT message is received without a value specified;

-  the network indicates that the timer is "deactivated";

-  the UE does not have a stored value for this timer;

-  a new PLMN which is not in the list of equivalent PLMNs has been entered, the tracking area updating fails and the tracking area updating attempt counter is equal to 5; or

-  a new PLMN which is not in the list of equivalent PLMNs has been entered, the attach procedure fails, the attach attempt counter is equal to 5 and no ATTACH REJECT message was received from the new PLMN.

5.3.7  Handling of the Local Emergency Numbers List and the Extended Local Emergency Numbers List

The Local Emergency Numbers List and the Extended Local Emergency Numbers list contain additional local emergency numbers used by the serving network. These lists can be downloaded by the network to the UE at successful registration and subsequent registration updates. There is only one Local Emergency Numbers List and only one Extended Local Emergency Numbers list in the UE. The Local Emergency Numbers List can be updated with EMM procedures if the UE is in S1 mode, with GMM and MM procedures if the UE is in A/Gb or Iu mode, and with 5GMM procedures, as specified in 3GPP  S  24.501  [54], if UE is in N1 mode. The Extended Local Emergency Numbers List can be updated with EMM procedures if the UE is in S1 mode and with 5GMM procedures, as specified in 3GPP  S  24.501  [54], if UE is in N1 mode.

The UE shall use the stored Local Emergency Numbers List and the stored Extended Local Emergency Numbers List received from the network in addition to the emergency numbers stored on the USIM or user equipment to detect that the number dialled is an emergency number.

If the UE determines that the number dialled is an emergency number, the procedures specified in 3GPP  S  23.167  [45] and 3GPP  S  24.229  [13D] are utilised to select a domain for the emergency session attempt.

If the domain selected for the emergency session attempt is the PS domain, then the UE shall perform the session establishment procedures specified in 3GPP  S  24.229  [13D] to initiate an emergency session.

If the domain selected for the emergency session attempt is the CS domain (e.g. the UE has selected GERAN or UTRAN radio access technology), then the UE shall use the stored Local Emergency Numbers List, in addition to the emergency numbers stored on the USIM and the ME, to determine if:

-  the UE is to send an EXTENDED SERVICE REQUEST message:

1)  for CS fallback, indicating "mobile originating CS fallback or 1xCS fallback"; or

2)  for CS fallback for emergency call, indicating "mobile originating CS fallback emergency call or 1xCS fallback emergency call"; and

-  the call control entity of the UE specified in 3GPP TS  24.008  [13] is to send an EMERGENCY SETUP message or a SETUP message to the network.

NOTE  1:  The checking of whether the dialled number is an emergency number and the determination of whether an emergency call is to be initiated in the CS domain, can end once a match is found. The Extended Local Emergency Numbers List does not apply when the CS domain is selected.

NOTE  2:  The user equipment can use the emergency numbers in each of the stored lists to assist the end user in determining whether the dialled number is intended for an emergency service or for another destination, e.g. a local directory service. The possible interactions with the end user are implementation specific.

NOTE  3:  A UE that supports procedures specified in 3GPP  S  24.302  [48], can get additional local emergency numbers through those procedures, which can be used based on operator policy, see 3GPP  S  24.302  [48].

The network may send a Local Emergency Numbers List or an Extended Local Emergency Numbers List or both, in the ATTACH ACCEPT or in the TRACKING AREA UPDATE ACCEPT messages, by including the Emergency number list IE and the Extended emergency number list IE, respectively. The user equipment shall store the Local Emergency Numbers List and the Extended Local Emergency Numbers List, as provided by the network. The Local Emergency Numbers List stored in the user equipment shall be replaced on each receipt of the Emergency number list IE. The Extended Local Emergency Numbers List stored in the user equipment shall be replaced on each receipt of the Extended emergency number list IE. The received Local Emergency Numbers List or the received Extended Local Emergency Numbers list or both shall be provided to the upper layers.

The emergency number(s) received in the Emergency number list IE are valid only in networks in the same country as the PLMN from which this IE is received. If no Local Emergency Numbers List is contained in the ATTACH ACCEPT or in the TRACKING AREA UPDATE ACCEPT message, then the stored Local Emergency Numbers List in the user equipment shall be kept, except if the user equipment has successfully registered to a PLMN in a country different from that of the PLMN that sent the list.

The emergency number(s) received in the Extended emergency number list IE are valid only in:

-  networks in the same country as the PLMN from which this IE is received, if the Extended Emergency Number List Validity (EENLV) field within the Extended emergency number list IE indicates "Extended Local Emergency Numbers List is valid in the country of the PLMN from which this IE is received"; and

-  the PLMN from which this IE is received, if the EENLV field within the Extended emergency number list IE indicates "Extended Local Emergency Numbers List is valid only in the PLMN from which this IE is received".

If no Extended Local Emergency Numbers List is contained in the ATTACH ACCEPT or in the TRACKING AREA UPDATE ACCEPT message, and the registered PLMN has not changed, then the stored Extended Local Emergency Numbers List in the user equipment shall be kept. If no Extended Local Emergency Numbers List is contained in the ATTACH ACCEPT or in the TRACKING AREA UPDATE ACCEPT message, but the registered PLMN has changed, then:

-  if the last received indication in the EENLV field within the Extended emergency number list IE indicates "Extended Local Emergency Numbers List is valid only in the PLMN from which this IE is received", the stored Extended Local Emergency Numbers List in the user equipment shall be deleted; and

-  if the last received indication in the EENLV field within the Extended emergency number list IE indicates "Extended Local Emergency Numbers List is valid in the country of the PLMN from which this IE is received" the list shall be kept except if the user equipment has successfully registered to a PLMN in a country different from that of the PLMN that sent the list.

NOTE:  To prevent the misrouting of emergency calls, all operators within a country need to follow the regulation or agree on the setting of the Extended emergency number list IE in accordance to national agreement        either to indicate validity within a country or to indicate validity only within the PLMN.

The Local Emergency Numbers List and the Extended Local Emergency Numbers List shall be deleted at switch off and removal of the USIM. The user equipment shall be able to store up to ten entries in the Local Emergency Numbers List and up to twenty entries in the Extended Local Emergency Numbers List, received from the network.

5.3.7a  Specific requirements for UE configured to use timer T3245

The following requirement applies for an UE that is configured to use timer T3245 (see 3GPP  S  24.368  [15A] or 3GPP  S  31.102  [17]):

When the UE adds a PLMN identity to the "forbidden PLMN list", the "forbidden PLMNs for attach in S101 mode" list, or the "forbidden PLMNs for GPRS service" list or sets the USIM as invalid for non-EPS services or EPS services or both, and timer T3245 (see 3GPP  S  24.008  [13]) is not running, the UE shall start timer T3245 as specified in 3GPP  S  24.008  [13], clause  4.1.1.6.

Upon expiry of the timer T3245, the UE shall erase the "forbidden PLMN list", the "forbidden PLMNs for GPRS service" list, and the "forbidden PLMNs for attach in S101 mode" list and set the USIM to valid for non-EPS and EPS services. When the lists are erased, the UE performs cell selection according to 3GPP  S  36.304  [21].

If the UE is switched off when the timer T3245 is running, the UE shall behave as follows when the UE is switched on and the USIM in the UE remains the same:

-  let t1 be the time remaining for T3245 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1        t. If t1 is equal to or less than t, then the UE will follow the behaviour as defined in the paragraph above upon expiry of the timer T3245. If the UE is not capable of determining t, then the UE shall restart the timer with the value t1.

5.3.7b  Specific requirements for UE when receiving non-integrity protected reject messages

This clause specifies the requirements for a UE that is not configured to use timer T3245 (see 3GPP  S  24.368  [15A] or 3GPP  S  31.102  [17]) and receives an ATTACH REJECT, TRACKING AREA UPDATE REJECT or SERVICE REJECT message without integrity protection with specific EMM causes.

NOTE  1:  Additional UE requirements for this case, requirements for other EMM causes, and requirements for the case when the UE receives an integrity protected reject message are specified in clauses  5.5.1, 5.5.3 and 5.6.1.

The UE may maintain a list of PLMN-specific attempt counters and a list of PLMN-specific PS-attempt counters (see 3GPP TS 24.008 [13]). The maximum number of possible entries in each list is implementation dependent.

Additionally, the UE may maintain one counter for "SIM/USIM considered invalid for non-GPRS services" events and one counter for "SIM/USIM considered invalid for GPRS services" events (see 3GPP  S  24.008  [13]).

If the UE maintains the above lists of attempt counters and the event counters, a UE supporting N1 mode, shall store them in its non-volatile memory. The UE shall erase the lists and reset the event counters to zero when the UICC containing the USIM is removed. The counter values shall not be affected by the activation or deactivation of power saving mode or MICO mode (see 3GPP  S  24.501  [54]).

If the UE receives an ATTACH REJECT, TRACKING AREA UPDATE REJECT or SERVICE REJECT message without integrity protection with EMM cause value #3, #6, #7, #8, #11, #12, #13, #14, #15, #31 or #35 before the network has established secure exchange of NAS messages for the NAS signalling connection, the UE shall start timer T3247 (see 3GPP  S  24.008  [13]) with a random value uniformly drawn from the range between 30 minutes and 60 minutes, if the timer is not running, and take the following actions:

1)  if the EMM cause value received is #3, #6, #7 or #8, and

a)  if the UE maintains a counter for "SIM/USIM considered invalid for GPRS services" events and the counter has a value less than a UE implementation-specific maximum value, the UE shall:

i)  set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI;

-  if the EMM cause value received is #3, #6 or #8, delete the list of equivalent PLMNs if any;

-  increment the counter for "SIM/USIM considered invalid for GPRS services" events;

-  if the EMM cause value received is #3, #6 or #8, and if the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services" and the counter has a value less than a UE implementation-specific maximum value, increment the counter;

-  if an attach, tracking area updating or a service request procedure was performed, reset the attach attempt counter, the tracking area updating attempt counter or the service request attempt counter, respectively;

-  if A/Gb mode or Iu mode is supported by the UE, handle the GMM parameters GPRS attach attempt counter, routing area updating attempt counter or service request attempt counter, GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number as specified in 3GPP  S  24.008  [13] for the case when the GPRS attach, routing area updating or service request procedure is rejected with the GMM cause of the same value in a NAS message without integrity protection;

-  If the UE is operating in single-registration mode and the EMM cause value received is #3, #6 or #7, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, registration attempt counter or service request attempt counter, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP  S  24.501  [54] for the case when the registration request or service request procedure performed over 3GPP access is rejected with the 5GMM cause with the same value in a NAS message without integrity protection.

-  If the UE is operating in single-registration mode and the EMM cause value received is #8, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, the 5GS update status to 5U3 ROAMING NOT ALLOWED, shall reset the registration attempt counter and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI for 3GPP access.

-  store the current TAI in the list of "forbidden tracking areas for roaming", memorize the current TAI was stored in the list of "forbidden tracking areas for roaming" for non-integrity protected NAS reject message and enter the state EMM-DEREGISTERED.LIMITED-SERVICE; and

-  search for a suitable cell in another tracking area or in another location area according to 3GPP  S  36.304  [21]; or

ii)  proceed as specified in clauses  5.5.1, 5.5.3 and 5.6.1;

-  increment the counter for "SIM/USIM considered invalid for GPRS services" events; and

-  if the EMM cause value received is #3, #6 or #8, and if the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services" and the counter has a value less than a UE implementation specific maximum value, increment the counter; and

b)  else the UE shall proceed as specified in clauses  5.5.1, 5.5.3 and 5.6.1;

2)  if the EMM cause value received is #12, #13 or #15, the UE shall additionally proceed as specified in clauses  5.5.1, 5.5.3 and 5.6.1;

3)  if the EMM cause value received is #11, #14 or #35 and the UE is in its HPLMN or EHPLMN (if the EHPLMN list is present),

-  the UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall delete the list of equivalent PLMNs. Additionally, if an attach, tracking area updating or service request procedure was performed, the UE shall reset the attach attempt counter or the tracking area updating attempt counter or the service request attempt counter, respectively.

-  if A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter or routing area updating attempt counter or service request attempt counter as specified in 3GPP  S  24.008  [13] for the case when the procedure is rejected with the GMM cause with the same value in a NAS message without integrity protection;

-  If the UE is operating in single-registration mode and the EMM cause value received is #11, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, registration attempt counter or service request attempt counter, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP  S  24.501  [54] for the case when the registration request procedure or service request procedure performed over 3GPP access is rejected with the 5GMM cause with the same value in a NAS message without integrity protection.

-  If the UE is operating in single-registration mode and the EMM cause value received is #14 or #35, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, the 5GS update status to 5U3 ROAMING NOT ALLOWED, shall reset the registration attempt counter or service request attempt counter, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI for 3GPP access.

-  the UE shall store the current TAI in the list of "forbidden tracking areas for roaming", memorize the current TAI was stored in the list of "forbidden tracking areas for roaming" for non-integrity protected NAS reject message and enter the state EMM-DEREGISTERED.LIMITED-SERVICE; and

-  the UE shall search for a suitable cell in another tracking area or in another location area in the same PLMN according to 3GPP  S  36.304  [21];

4)  if the EMM cause value received is #11 or #35 and the UE is not in its HPLMN or EHPLMN (if the EHPLMN list is present), in addition to the UE requirements specified in clause  5.5.1, 5.5.3 and 5.6.1,

  if the UE maintains a list of PLMN-specific attempt counters and the PLMN-specific attempt counter for the PLMN sending the reject message has a value less than a UE implementation-specific maximum value, the UE shall increment the PLMN-specific attempt counter for the PLMN;

5)  if the EMM cause value received is #14 and the UE is not roaming in its HPLMN or EHPLMN (if the EHPLMN list is present), in addition to the UE requirements specified in clause5.5.1, 5.5.3 and 5.6.1,

  if the UE maintains a list of PLMN-specific PS-attempt counter and the PLMN-specific PS-attempt counter of the PLMN sending the reject message has a value less than a UE implementation-specific maximum value, the UE shall increment the PS-attempt counter of the PLMN; and

6)  if the EMM cause value received is #31 for a UE that has indicated support for CIoT optimizations, the UE may discard the message or alternatively the UE should:

-  set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3);

-  store the current TAI in the list of "forbidden tracking areas for roaming", memorize the current TAI was stored in the list of "forbidden tracking areas for roaming" for non-integrity protected NAS reject message; and

-  search for a suitable cell in another tracking area according to 3GPP  S  36.304  [21].

Upon expiry of timer T3247, the UE shall

-  remove all tracking areas from the list of "forbidden tracking areas for regional provision of service" and the list of "forbidden tracking areas for roaming", which were stored in these lists for non-integrity protected NAS reject message;

-  set the USIM to valid for EPS services, if

-  the UE does not maintain a counter for "SIM/USIM considered invalid for GPRS services" events; or

-  the UE maintains a counter for "SIM/USIM considered invalid for GPRS services" events and this counter has a value less than a UE implementation-specific maximum value;

-  set the USIM to valid for non-EPS services, if

-  the UE does not maintain a counter for "SIM/USIM considered invalid for non-GPRS services" events; or

-  the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services" events and this counter has a value less than a UE implementation-specific maximum value;

-  if the UE maintains a list of PLMN-specific attempt counters, for each PLMN-specific attempt counter that has a value greater than zero and less than a UE implementation-specific maximum value, remove the respective PLMN from the extension of the "forbidden PLMNs" list;

-  if the UE maintains a list of PLMN-specific PS-attempt counters, for each PLMN-specific PS-attempt counter that has a value greater than zero and less than a UE implementation-specific maximum value, remove the respective PLMN from the "forbidden PLMNs for GPRS service" list. If the resulting "forbidden PLMNs for GPRS service" list is empty, the UE shall re-enable the E-UTRA capability (see clause  4.5);

-  if the UE is supporting A/Gb mode or Iu mode, perform the actions as specified in 3GPP  S  24.008  [13] for the case when timer T3247 expires;

-  if the UE is supporting N1 mode, perform the actions as specified in 3GPP  S  24.501  [54], clause  5.3.20.2 for the case when timer T3247 expires; and

-  initiate an EPS attach procedure or tracking area updating procedure, if still needed, dependent on EMM state and EPS update status, or perform PLMN selection according to 3GPP  S  23.122  [6].

If the UE maintains a list of PLMN-specific attempt counters and PLMN-specific PS-attempt counters, when the UE is switched off, the UE shall, for each PLMN-specific attempt counter that has a value greater than zero and less than the UE implementation-specific maximum value, remove the respective PLMN from the forbidden PLMN list. When the USIM is removed, the UE should perform this action.

NOTE  2:  If the respective PLMN was stored in the extension of the "forbidden PLMNs" list, then according to 3GPP  S  23.122  [6] the UE will delete the contents of this extension when the UE is switched off or the USIM is removed.

5.3.8  Abnormal cases in the UE

The following abnormal case can be identified:

a)  EMM uplink message transmission failure indication by lower layers

  When it is specified in the relevant procedure that it is up to the UE implementation to rerun the ongoing procedure that triggered that procedure, the procedure can typically be re-initiated using a retransmission mechanism of the uplink message (the one that has previously failed to be transmitted) with new sequence number and message authentication code information thus avoiding to restart the whole procedure.

5.3.9  Handling of NAS level mobility management congestion control

The network may detect EMM signalling congestion and perform NAS level mobility management congestion control. NAS level mobility management congestion control consists of general NAS level mobility management congestion control and subscribed APN based congestion control.

Under general overload conditions the network may reject mobility management signalling requests from UEs as specified in 3GPP  S  23.401  [10]. The network should not reject the following requests:

-  requests for emergency bearer services;

-  DETACH REQUEST message;

-  service request or tracking area update request triggered by paging;

-  requests from UEs that were received via NAS signalling connections established with RRC establishment cause "High priority access AC 11        15";

-  requests for attach, normal tracking area updating or periodic tracking area updating, when emergency is indicated by lower layers; and

-  requests for CS fallback emergency call or 1xCS fallback emergency call.

When subscribed APN based mobility management congestion control is active for a particular APN, the network may reject attach requests from UEs with a subscription to this APN.

In mobility management the network may detect NAS signalling congestion and start or stop performing the subscribed APN based congestion control based on mobility management level criteria such as:

-  rate of mobility management NAS messages from a group of UEs with a subscription to a particular APN exceeds or falls below certain thresholds; and/or

-  setting in network management.

When the NAS level mobility management congestion control is active, the network may include a value for the mobility management back-off timer T3346 in the reject messages. The UE starts the timer T3346 with the value received in the mobility management reject messages. To avoid that large numbers of UEs simultaneously initiate deferred requests, the network should select the value for the timer T3346 for the rejected UEs so that timeouts are not synchronised.

For subscribed APN based congestion control the value of timer T3346 for a particular APN may be APN dependent.

If the timer T3346 is running when the UE enters state EMM-DEREGISTERED, the UE remains switched on, and the USIM in the UE remains the same, then timer T3346 is kept running until it expires or it is stopped.

If the UE is switched off when the timer T3346 is running, the UE shall behave as follows when the UE is switched on and the USIM in the UE remains the same:

-  let t1 be the time remaining for T3346 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than  , then the timer shall be restarted with the value t1        t. If t1 is equal to or less than t, then the timer need not be restarted. If the UE is not capable of determining t, then the UE shall restart the timer with the value t1; and

-  if prior to switch off, timer T3346 was started due to a NAS request message (ATTACH REQUEST, TRACKING AREA UPDATE REQUEST, CONTROL PLANE SERVICE REQUEST or EXTENDED SERVICE REQUEST) which contained the low priority indicator set to "MS is configured for NAS signalling low priority", then if timer T3346 is restarted at switch on, the UE configured for dual priority shall handle mobility management requests as indicated in clauses  5.5.1.2.6, 5.5.3.2.6 and  5.6.1.6.

If the UE enters a new PLMN while timer T3346 is running, and the new PLMN is not equivalent to the PLMN where the UE started timer T3346, the UE shall stop timer T3346 when initiating mobility management procedures in the new PLMN.

After change in TAI which is not part of TAI list, if the timer T3346 is running and EMM update status is EU1 UPDATED then UE shall set the EMM update status to EU2 NOT UPDATED and enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.

5.3.9A  Handling of congestion control for transport of user data via the control plane

The network may activate congestion control for transport of user data via the control plane, as specified in 3GPP  S  23.401  [10].

If the congestion control for transport of user data via the control plane is active and if the UE has indicated support for the control plane data back-off timer, the network shall include a value for the control plane data back-off timer T3448 in ATTACH ACCEPT, TRACKING AREA UPDATE ACCEPT, SERVICE ACCEPT or SERVICE REJECT message, and shall store a control plane data back-off time on a per UE basis. The UE starts the timer T3448 with the value informed in the message. To avoid that large numbers of UEs simultaneously initiate deferred requests, the network should select the value for the timer T3448 for the informed UEs so that timeouts are not synchronised.

The network sends TRACKING AREA UPDATE ACCEPT message or SERVICE ACCEPT message without T3448 value IE to stop the timer T3448 running in the UE as specified in clause  5.5.3.2.4 and clause  5.6.1.4.2.

Based on the stored control plane data back-off time for the UE, the network may reject the transfer of user data via the control plane initiated by the UE.

While the timer T3448 is running, the UE in EMM-IDLE mode shall not initiate the transport of user data via the control plane procedure (see clause  6.6.4), except if the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP  S  24.368  [15A] or the USIM file EFNASCONFIG in 3GPP  S  31.102  [17]) and the user data is related to an exceptional event.

Upon entering the state EMM-DEREGISTERED or a new PLMN which is not equivalent to the PLMN where the UE started the timer T3448, or upon being switched off while the timer T3448 is running, the UE shall stop the timer T3448. For further criteria to stop of timer T3448, refer to clause  5.5.3.2.4 and clause  5.6.1.4.2.

5.3.10  Access class control

The network can restrict the access for certain groups of UEs by means of barring their access class.

The UE shall evaluate the access control information as specified in 3GPP  S  36.331  [22] for:

-  Access Class Barring;

-  Access Control for CSFB and Extended Access Barring (EAB);

-  Access Control for Application specific Congestion control for Data Communication (ACDC), if the UE supports ACDC; and

-  Access Barring.

5.3.11  Power saving mode

The UE can request the use of power saving mode (PSM) during an attach or tracking area updating procedure (see 3GPP  S  23.682  [11A] and 3GPP  S  23.401  [10]). The UE shall not request the use of PSM during:

-  an attach for emergency bearer services procedure;

-  an attach procedure for initiating a PDN connection for emergency bearer services with attach type not set to "EPS emergency attach";

-  a tracking area updating procedure for initiating a PDN connection for emergency bearer services;

-  a tracking area updating procedure when the UE has a PDN connection established for emergency bearer services; or

-  an attach for access to RLOS.

The network accepts the use of PSM by providing a specific value for timer T3324 when accepting the attach or tracking area updating procedure. The UE may use PSM only if the network has provided the T3324 value IE during the last attach or tracking area updating procedure with a value different from "deactivated".

NOTE:  Timer T3324 is specified in 3GPP  S  24.008  [13].

Upon expiry of the timer T3324 or if the T3324 value provided by the network is zero, the UE may deactivate the AS layer and activate PSM by entering the state EMM-REGISTERED.NO-CELL-AVAILABLE if:

a)  the UE is not attached for emergency bearer services;

b)  the UE has no PDN connection for emergency bearer services;

c)  the UE is in EMM-IDLE mode;

d)  in the EMM-REGISTERED.NORMAL-SERVICE state; and

e)  the UE is not attached for access to RLOS.

If conditions a, b, c and e are fulfilled, but the UE is in a state other than EMM-REGISTERED.NORMAL-SERVICE when timer T3324 expires, the UE may activate PSM when the MS returns to state EMM-REGISTERED.NORMAL-SERVICE.

A UE that has already been allocated timer T3324 with a value different from "deactivated" and the timer T3324 has expired, may activate PSM if it receives an "Extended wait time" from lower layers.

When PSM is activated all NAS timers are stopped and associated procedures aborted except for T3412, T3346, T3396, T3447, any backoff timers, and the timer T controlling the periodic search for HPLMN or EHPLMN (if the EHPLMN list is present) or higher prioritized PLMNs (see 3GPP  S  23.122  [6]).

If the UE is attached for emergency bearer services or has a PDN connection for emergency bearer services, the UE shall not activate PSM.

If the UE is attached for access to RLOS, the UE shall not activate PSM.

The UE may deactivate PSM and activate the AS layer at any time. Upon deactivating PSM, the UE may initiate EMM procedures (e.g. for the transfer of mobile originated signalling or user data).

5.3.12  Extended idle-mode DRX cycle

The UE may request the use of extended idle-mode DRX cycle (eDRX) during an attach or tracking area updating procedure by including the extended DRX parameters IE (see 3GPP  S  23.682  [11A] and 3GPP  S  23.401  [10]). The UE shall not request the use of eDRX during:

-  an attach for emergency bearer services procedure;

-  a tracking area updating procedure for the UE attached for emergency bearer services; or

-  an attach for access to RLOS.

The UE and the network may negotiate eDRX parameters during a tracking area updating procedure when the UE has a PDN connection for emergency bearer services.

The network accepts the request to use the eDRX by providing the extended DRX parameters IE when accepting the attach or the tracking area updating procedure. The UE shall use eDRX only if it received the extended DRX parameters IE during the last attach or tracking area updating procedure and the UE does not have a PDN connection for emergency bearer services.

NOTE:  If the UE wants to keep using eDRX, the UE includes the extended DRX parameters IE in each attach or tracking area updating procedure.

If the UE received the extended DRX parameters IE during the last attach or tracking area updating procedure, upon successful completion of the PDN disconnect procedure of the PDN connection for emergency bearer services or EPS bearer context deactivation procedure of the EPS bearer context for emergency, the UE shall resume eDRX.

If the network has provided the extended DRX parameters IE during the last attach or tracking area updating procedure, upon successful completion of the PDN disconnect procedure of the PDN connection for emergency bearer services or EPS bearer context deactivation procedure of the EPS bearer context for emergency, the network shall resume eDRX.

If the UE or the network locally releases the PDN connection for emergency bearer service, the UE or the network shall not use eDRX until the UE receives eDRX parameters during a tracking area updating procedure with EPS bearer context synchronization or upon successful completion of a service request procedure.

If the UE did not receive the extended eDRX parameters IE, or if the UE has a PDN connection for emergency bearer services, the UE shall use the stored UE specific DRX parameter, if available.

If the network did not accept the request to use eDRX, or if the UE has a PDN connection for emergency bearer services, the network shall use the stored UE specific DRX parameter, if available.

If the network provided the extended DRX parameters IE and also assigned a new GUTI for the UE as described in clause  5.5.3.2.4 during the last tracking area updating procedure, the network shall use the stored UE specific DRX parameter, if available, with the old GUTI and use the eDRX provided by the network with the new GUTI until the old GUTI can be considered as invalid by the network (see clause  5.4.1.4).

5.3.13  Interaction between power saving mode and extended idle mode DRX cycle

The UE can request the use of both PSM and eDRX during an attach or tracking area updating procedure but it is up to the network to decide to enable none, one of them or both (see 3GPP  S  23.682  [11A] and 3GPP  S  23.401  [10]).

If the network accepts the use of both PSM (see clause  5.3.11) and eDRX (see clause  5.3.12), the extended DRX parameters IE provided to the UE should allow for multiple paging occasions before the active timer expires.

5.3.14  Dedicated core network

The network may reject mobility management signalling requests from UEs due to dedicated core network as specified in 3GPP  S  23.401  [10]. When the network rejects mobility management signalling requests due to dedicated core network, the mechanism for general NAS level mobility management congestion control as specified in clause  5.3.9 shall be followed.

5.3.15  CIoT EPS optimizations

  CIoT EPS optimizations provide improved support of small data and SMS transfer. A UE supporting CIoT EPS optimizations can indicate the CIoT network behaviour the UE can support and prefers to use during attach or tracking area updating procedure (see 3GPP  S  23.401  [10]). The UE may indicate the support for control plane CIoT EPS optimization, user plane CIoT EPS optimization, EMM-REGISTERED without PDN connection, S1-U data transfer and header compression (see clause  9.9.3.34). The UE may also request to use SMS transfer without combined attach procedure during the attach procedure. Furthermore, the UE may, separately from the indication of support, indicate preference for control plane CIoT EPS optimization or user plane CIoT EPS optimization (see clause  9.9.3.0B). The indication of preference is also considered as the request to use. A UE supporting CIoT 5GS optimizations can also indicate the 5GS CIoT network behaviour the UE can support during attach or tracking area updating procedure. Furthermore, the UE may, separately from the indication of support, indicate preference for control plane CIoT 5GS optimization or user plane CIoT 5GS optimization.

NOTE  1:  The UE supporting control plane CIoT EPS optimization and S1-U data transfer but not user plane CIoT EPS optimization does not indicate preference for user plane CIoT EPS optimization.

The UE can be in NB-S1 mode or WB-S1 mode when requesting the use of CIoT EPS optimizations during an attach or tracking area updating procedure. A UE in NB-S1 mode always indicates support for control plane CIoT EPS optimization. A UE in NB-S1 mode can also request SMS transfer without combined procedure by using the normal attach or tracking area updating procedure (see clause  5.5.1 and 5.5.3).

In NB-S1 mode, the UE, when requesting the use of CIoT EPS optimization, does not:

-  request an attach for emergency bearer services procedure;

-  request an attach procedure for initiating a PDN connection for emergency bearer services with attach type not set to "EPS emergency attach";

-  indicate voice domain preference and UE   's usage setting; or

-  request an attach for access to RLOS.

The network does not indicate to the UE support of emergency bearer services when the UE is in NB-S1 mode (see clause  5.5.1.2.4 and 5.5.3.2.4).

The control plane CIoT EPS optimization enables support of efficient transport of user data (IP, non-IP, Ethernet) or SMS messages over control plane via the MME without triggering data radio bearer establishment. The support of control plane CIoT EPS optimization is mandatory for the network in NB-S1 mode and optional in WB-S1 mode. Optional header compression of IP data can be applied to IP PDN type PDN connections that are configured to support header compression.

The user plane CIoT EPS optimization enables support for change from EMM-IDLE mode to EMM-CONNECTED mode without the need for using the service request procedure (see clause  5.3.1.3).

If the UE indicates support of EMM-REGISTERED without PDN connection in the attach request, the UE may include an ESM DUMMY MESSAGE instead of a PDN CONNECTIVITY REQUEST message as part of the attach procedure. If the EMM-REGISTERED without PDN connection is supported by the network, the UE and the network can at any time release all the PDN connections and the UE still remains EPS attached.

NOTE  2:  For both the UE and the network, the term "EMM-REGISTERED without PDN connection" is equivalent to the term "EPS attach without PDN connectivity" as specified in 3GPP  S  23.401  [10].

In NB-S1 mode, if the UE indicates "SMS only" during a normal attach or tracking area updating procedure, the MME supporting CIoT EPS optimisations provides SMS so that the UE is not required to perform a combined attach or tracking area updating procedure.

If the UE supports user plane CIoT EPS optimization, it shall also support S1-U data transfer.

If the UE indicates support of one or more CIoT EPS optimizations and the network supports one or more CIoT EPS optimizations and decides to accept the attach or tracking area update request, the network indicates the supported CIoT EPS optimizations to the UE per TAI list when accepting the UE request. Network indication of support is interpreted by the UE as the acceptance to use the respective feature. After completion of the attach or tracking area updating procedure, the UE and the network can then use the accepted CIoT EPS optimizations for the transfer of user data (IP, non-IP, Ethernet and SMS).

The UE supporting control plane CIoT EPS optimization may indicate support for control plane MT-EDT during the attach or tracking area updating procedure. For a UE that supports control plane MT-EDT and for which the network has accepted the use of control plane CIoT EPS optimization, the network may trigger the delivery of downlink data to the UE, when available, using procedures for control plane MT-EDT as specified in 3GPP  S  23.401  [10].

The UE supporting user plane CIoT EPS optimization may indicate support for user plane MT-EDT during the attach or tracking area updating procedure. For a UE that supports user plane MT-EDT and for which the network has accepted the use of user plane CIoT EPS optimization, the network may trigger the delivery of downlink data to the UE, when available, using procedures for user plane MT-EDT as specified in 3GPP  S  23.401  [10].

If the UE and the network support both the control plane CIoT EPS optimization and S1-U data transfer, then when receiving the UE   's request for a PDN connection, the MME decides whether the PDN connection should be SCEF PDN connection or SGi PDN connection as specified in 3GPP  S  23.401  [10]:

-  if SCEF PDN connection is to be established for non-IP data type, the MME shall include Control plane only indication for the requested PDN connection;

-  if SGi PDN connection is to be established and existing SGi PDN connections for this UE were established with Control plane only indication, the MME shall include Control plane only indication for the newly requested SGi PDN connection;

-  if SGi PDN connection is to be established and existing SGi PDN connections for this UE were established without Control plane only indication, the MME shall not include Control plane only indication for the newly requested SGi PDN connection; and

-  if SGi PDN connection is to be established and no SGi PDN connection for this UE exists, the MME determine whether to include Control plane only indication for the requested SGi PDN connection based on local policies, the UE   's preferred CIoT network behaviour and the supported CIoT network behaviour.

If the network supports user plane CIoT EPS optimization, it shall also support S1-U data transfer.

Broadcast system information may provide information about support of CIoT EPS optimizations (see 3GPP  S  36.331  [22]). At reception of new broadcast system information, the lower layers deliver it to the EMM layer in the UE. The information provided by lower layers is per PLMN and used by the UE to determine whether certain CIoT EPS optimizations are supported in the cell.

The UE shall not attempt to use CIoT EPS optimizations which are indicated as not supported.

In NB-S1 mode, when the UE requests the lower layer to establish a RRC connection and the UE requests the use of EMM-REGISTERED without PDN connection or user plane CIoT EPS optimization, the UE shall pass an indication of the requested CIoT EPS optimizations to the lower layers. If the UE requests the use of S1-U data transfer without user plane CIoT optimization, then the UE shall also pass an indication of user plane CIoT EPS optimization to lower layers.

In WB-S1 mode, when the UE requests the lower layer to establish a RRC connection and the UE requests the use of EMM-REGISTERED without PDN connection, control plane CIoT EPS optimization or user plane CIoT EPS optimization, the UE shall pass an indication of the requested CIoT EPS optimizations to the lower layers.

5.3.16  Restriction on use of enhanced coverage

In order to deal with use of extensive resources from the network, the operator may prevent specific subscribers from using enhanced coverage (see 3GPP  S  23.401  [10]). When in NB-S1 mode, the UE shall indicate support for restriction on use of enhanced coverage. When in WB-S1 mode, the UE supporting either CE mode A or CE mode B shall indicate support for restriction on use of enhanced coverage. The UE supporting restriction on use of enhanced coverage indicates its support for restriction on use of enhanced coverage in the ATTACH REQUEST and TRACKING AREA UPDATE REQUEST message. If the UE supports restriction on use of enhanced coverage, the MME indicates whether the use of enhanced coverage is restricted or not in the ATTACH ACCEPT message and TRACKING AREA UPDATE ACCEPT message (see clause  5.5.1.2 and clause  5.5.3.2). If the use of enhanced coverage is restricted, the UE shall not use enhanced coverage in the registered PLMN and in any PLMN which is in the list of equivalent PLMNs.

If the UE supports CE mode B and the network determines that

-  the use of enhanced coverage is not restricted for the UE; or

-  CE mode B is not restricted for the UE;

the applicable NAS timer values shall be calculated by the network as described in clause  4.8.

5.3.17  Service Gap Control

The network may control the frequency UEs can transit from EMM-IDLE mode to EMM-CONNECTED mode via the service gap control (SGC) as specified in 3GPP  S  23.401  [10]. If the network supports service gap control (SGC) feature and the service gap time value is available in the EMM context of the UE, the MME shall consider SGC as active for the UE.

The UE and the network negotiate usage of the service gap control (SGC) feature during the attach and tracking area updating procedures:

-  the UE supporting service gap control indicates its support for service gap control in the ATTACH REQUEST and TRACKING AREA UPDATE REQUEST message. If the UE supports service gap control and the SGC is active for the UE, the MME shall include service gap timer T3447 value in the ATTACH ACCEPT message and TRACKING AREA UPDATE ACCEPT message (see clause  5.5.1.2 and clause  5.5.3.2). The UE shall store the service gap time value; and

-  for UEs that do not support the optional SGC feature when the network rejects mobility management signalling requests due to service gap control is active in the network, the mechanism for general NAS level mobility management congestion control as specified in clause  5.3.9 applies.

The UE shall start the SGC timer T3447 when the NAS signalling connection is released and if:

-  the UE supports SGC feature, and the service gap timer value is available in the UE and does not indicate zero; and

-  the NAS signalling connection released was not established for:

-  paging;

-  attach requests without PDN connection request; or

-  tracking area update requests without "active" or "signalling active" flag set.

If the SGC is active in the network, after the UE transitions from EMM-CONNECTED mode to EMM-IDLE mode except when the UE was in EMM-CONNECTED mode due to:

-  paging;

-  attach requests without PDN connection request; or

-  tracking area update requests without "active" or "signalling active" flag set,

the network shall start the SGC timer T3447:

-  with the service gap time value available in the EMM context minus 4 minutes, if the UE supports SGC feature and the service gap time value has been sent to the UE with a non-zero value; or

-  with the service gap time value available in the EMM context if the UE does not support SGC feature.

When the SGC timer T3447 is running, the network allows:

-  requests for emergency bearer services;

-  requests for exception data reporting;

-  attach requests without PDN connection request;

-  tracking area update requests without "active" or "signalling active" flag set;

-  requests from UEs that were received via NAS signalling connections established with RRC establishment cause "High priority access AC 11        15"; and

-  mobile terminated service requests triggered by paging and subsequent MO signalling or MO data, if any, until the UE enters EMM-IDLE mode.

If the MME determines that the UE operating in single-registration mode has performed an inter-system change from S1 mode to N1 mode and the timer T3447 is running in the MME, the MME stops the T3447.

Upon inter-system change from N1 mode to S1 mode, if the UE supports service gap control, T3447 is running in the UE, and the T3447 value is included in the ATTACH ACCEPT message or TRACKING AREA UPDATE ACCEPT message received from the MME (see clause  5.5.1.2 and clause  5.5.3.2), the UE shall keep T3447 running. Additionally, the UE shall store and replace the currently stored T3447 value with the received T3447 value. Upon expiry of the running T3447 timer, the UE shall use the new value when starting T3447 again.

The UE or the network with a running service gap timer shall keep the timer running when the UE transits from EMM-IDLE mode to EMM-CONNECTED mode.

NOTE:  If the UE transitions from EMM-IDLE mode to EMM-CONNECTED mode due to attach request without PDN connection request or tracking area update request without "active" or "signalling active" flag set, the UE initiates no further MO signalling except for tracking area update request without "active" or "signalling active" flag set until the UE receives network-initiated signalling (e.g. DOWNLINK NAS TRANSPORT message for MT SMS) or MT data over user plane, or after the UE has moved to EMM-IDLE state and the service gap timer is not running.

If the timer T3447 is running when the UE enters state EMM-DEREGISTERED, the UE remains switched on, and the USIM in the UE remains the same, then timer T3447 is kept running until it expires.

If the UE is switched off when the timer T3447 is running, the UE shall behave as follows when the UE is switched on and the USIM in the UE remains the same:

-  let t1 be the time remaining for T3447 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than  , then the timer shall be restarted with the value t1        t. If t1 is equal to or less than t, then the timer need not be restarted. If the UE is not capable of determining t, then the UE shall restart the timer with the value t1.

5.3.18  Restricted local operator services

Restricted local operator services (RLOS) is an optional feature that enables operators to offer access to restricted local operator services to the unauthenticated UEs in limited service state (see 3GPP  S  23.401  [10]). Authenticated UEs in limited service state may also be able to access restricted local operator services. The UE requests access to RLOS during the attach procedure by setting the attach type to "EPS RLOS attach" in the ATTACH REQUEST message. Subject to regulation and local operator policy, if the MME is configured to support access to RLOS, the MME accepts the UE   's attach request regardless of the authentication result or skips the authentication procedure.

When the UE requests the lower layer to establish an RRC connection for access to RLOS, the UE indicates in the RRC signalling that the RRC connection is for access to RLOS to the lower layers.

The UE supporting access to RLOS shall perform PLMN selection according to 3GPP  S  23.122  [6]. Broadcast system information may provide information about support of access to RLOS (see 3GPP  S  36.331  [22]). At reception of new broadcast system information, the lower layers deliver it to the EMM layer in the UE. The information provided by lower layers is per PLMN and used by the UE to determine whether the PLMN is configured to support access to RLOS. The UE shall not attempt to request access to RLOS if the PLMN does not support access to RLOS.

NOTE:  Only authorized applications on the UE are allowed to trigger the initiation of RLOS connection (see 3GPP  S  33.401  [19]).

For UE attached for access to RLOS, only UE originated access to RLOS requests are supported. Mobile terminated access to RLOS request and network triggered service request are not allowed. The UE is not allowed to initiate UE requested PDN connectivity for any additional PDN connection. In addition, intersystem change to other RAT including GERAN and UTRAN and handover between 3GPP and non-3GPP accesses are not supported.

Access to RLOS is applicable to the UEs in WB-S1 mode only. The UEs in NB-S1 mode shall not request access to RLOS.

Location service does not apply to access to RLOS.

If a UE attached for access to RLOS needs to initiate an emergency call, the UE shall first perform a local detach prior to initiating an attach procedure for emergency bearer services.

5.3.19  Core Network selection and redirection for UEs using CIoT optimizations

5.3.19.1  Core network selection

A UE that supports CIoT optimizations performs core network selection as specified in clause  4.8.4A.1 of 3GPP  S  24.501  [54].

5.3.19.2  Redirection of the UE by the core network

The network that supports CIoT optimizations can redirect a UE between EPC and 5GCN as specified in clause  5.31.3 of 3GPP  S  23.501  [58]. The network can take into account the UE   's N1 mode capability or S1 mode capability, the CIoT network behaviour supported and preferred by the UE or the CIoT network behaviour supported by the network to determine the redirection.

NOTE:  It is assumed that the network would avoid redirecting the UE back and forth between EPC and 5GCN.

The network redirects the UE to 5GCN by rejecting the attach request, or tracking area update request, or service request with the EMM cause #31 "Redirection to 5GCN required" as specified in clause  5.5.1.2.5,  5.5.1.3.5,  5.5.3.2.5,  5.5.3.3.5 and  5.6.1.5. Upon receipt of reject message, the UE disables the E-UTRA capability as specified in clause  4.5 and enables the N1 mode capability if it was disabled in order to move to 5GCN.

The network that supports CIoT optimizations can also redirect a UE from 5GCN to EPC as specified in clause  4.8.4A.2 of 3GPP  S  24.501  [54].

5.3.20  UE radio capability signalling optimisation

UE radio capability signalling optimisation (RACS) is a feature that is optional at both the UE and the network and which aims to optimise the transmission of UE radio capability over the radio interface (see 3GPP  S  23.401  [10]). RACS works by assigning an identifier to represent a set of UE radio capabilities. This identifier is called the UE radio capability ID. A UE radio capability ID can be either manufacturer-assigned or network-assigned. The UE radio capability ID is an alternative to the signalling of the radio capabilities container over the radio interface.

In this release of the specification, RACS is not applicable to NB-S1 mode.

If the UE supports RACS:

-  the UE shall indicate support for RACS by setting the RACS bit to "RACS supported" in the UE network capability IE of the ATTACH REQUEST and TRACKING AREA UPDATE REQUEST messages;

-  if the UE performs an attach procedure and the UE has an applicable UE radio capability ID for the current UE radio configuration in the selected network, the UE shall include the UE radio capability ID availability IE in the ATTACH REQUEST message and set the IE to "UE radio capability ID available";

-  if the UE performs a tracking area updating procedure and the UE has an applicable UE radio capability ID for the current UE radio configuration in the selected network, the UE shall include the UE radio capability ID availability IE in the TRACKING AREA UPDATE REQUEST message and set the IE to "UE radio capability ID available";

-  If the UE is requested to provide the UE radio capability ID by the network during a security mode control procedure, the UE shall include the UE radio capability ID in the UE radio capability ID IE of the SECURITY MODE COMPLETE message according to the rules in clause 5.4.3.3.;

-  if the radio configuration at the UE changes (for instance because the UE has disabled a specific radio capability) then:

a)  if the UE has an applicable UE radio capability ID for the new UE radio configuration, the UE shall initiate a tracking area updating procedure, include a UE radio capability information update needed IE in the TRACKING AREA UPDATE REQUEST message and set the URCIDA bit to "UE radio capability ID available" in the UE radio capability ID availability IE in the TRACKING AREA UPDATE REQUEST message; and

b)  if the UE does not have an applicable UE radio capability ID for the new UE radio configuration, the UE shall initiate a tracking area updating procedure and shall include a UE radio capability information update needed IE in the TRACKING AREA UPDATE REQUEST message;

NOTE:  Performing the tracking area updating procedure with the UE radio capability information update needed IE included in the TRACKING AREA UPDATE REQUEST message and without the UE radio capability ID availability IE set to "UE radio capability ID available" in the TRACKING AREA UPDATE REQUEST message as specified in b) above can trigger the network to assign a new UE radio capability ID to the UE.

-  upon receiving a network-assigned UE radio capability ID in the ATTACH ACCEPT message, in the TRACKING AREA UPDATE ACCEPT message or in the GUTI REALLOCATION COMMAND message, the UE shall store the network-assigned UE radio capability ID and the PLMN ID of the serving network along with a mapping to the current UE radio configuration in its non-volatile memory as specified in annex  C. The UE shall be able to store at least the last 16 received network-assigned UE radio capability IDs with the associated PLMN ID and the mapping to the corresponding UE radio configuration;

-  the UE shall not use a network-assigned UE radio capability ID in PLMNs equivalent to the PLMN which assigned it; and

-  upon receiving a UE radio capability ID deletion indication IE set to "Network-assigned UE radio capability IDs deletion requested" in the ATTACH ACCEPT message, in the TRACKING AREA UPDATE ACCEPT message or in the GUTI REALLOCATION COMMAND message, the UE shall delete all network-assigned UE radio capability IDs stored at the UE for the serving network and initiate a tracking area updating procedure. If the UE has an applicable manufacturer-assigned UE radio capability ID for the current UE radio configuration in the selected network, the UE shall include a UE radio capability ID availability IE set to "UE radio capability ID available" in the TRACKING AREA UPDATE REQUEST message.

If the network supports RACS:

-  if the UE has included the UE radio capability ID availability IE in the ATTACH REQUEST message and set the IE to "UE radio capability ID available", the network shall initiate a security mode control procedure to retrieve the UE radio capability ID from the UE;

-  if the UE has included the UE radio capability ID availability IE in the TRACKING AREA UPDATE REQUEST message and set the IE to "UE radio capability ID available", the network may initiate a security mode control procedure to retrieve the UE radio capability ID from the UE;

-  if the UE has included the UE radio capability ID availability IE in the TRACKING AREA UPDATE REQUEST message, set the URCIDA bit to "UE radio capability ID available" in the UE radio capability ID availability IE and no UE radio capability ID is available in the UE context in the MME, the network shall initiate a security mode control procedure to retrieve the UE radio capability ID from the UE;

-  the network may assign a network-assigned UE radio capability ID to a UE which supports RACS by including a UE radio capability ID IE in the ATTACH ACCEPT message, in the TRACKING AREA UPDATE ACCEPT message or in the GUTI REALLOCATION COMMAND message; and

-  the network may trigger the UE to delete all network-assigned UE radio capability IDs stored at the UE for the serving network by including a UE radio capability ID deletion indication IE set to "Network-assigned UE radio capability IDs deletion requested" in the ATTACH ACCEPT message, in the TRACKING AREA UPDATE ACCEPT message or in the GUTI REALLOCATION COMMAND message.

5.3.21  Wake-up signal assistance

A UE supporting wake-up signal (WUS) assistance can indicate its WUS assistance capability during attach or tracking area updating procedure (see 3GPP  S  23.401  [10]). The UE supporting WUS assistance may include its UE paging probability information in the Requested WUS assistance information IE during an attach or tracking area updating procedure (see 3GPP  S  23.401  [10]). The UE shall not include its UE paging probability information during:

-  an attach for emergency bearer services procedure; or

-  a tracking area updating procedure for the UE attached for emergency bearer services.

The UE and the network may negotiate the UE paging probability information during an attach or tracking area updating procedure when the UE is not attached for emergency bearer services. The UE paging probability information is an assistance information used to determine the WUS group for paging UE (see 3GPP  S  23.401  [10], 3GPP  S  36.300  [20]).

NOTE:  The determination of UE paging probability information is up to UE implementation.

If the UE is not attached for emergency bearer services and the network accepts the use of the WUS assistance for the UE, the network determines the negotiated UE paging probability information for the UE based on the requested UE paging probability information, if any, local configuration or previous statistical information for the UE, and then indicates the negotiated UE paging probability information in the Negotiated WUS assistance information IE to the UE when accepting the attach or the tracking area updating procedure. The network shall store the negotiated UE paging probability information in the EMM context of the UE for paging.

The UE shall use WUS assistance only if it received the Negotiated WUS assistance information IE during the last attach or tracking area updating procedure. If the UE did not receive the Negotiated WUS assistance information IE during the last attach or tracking area updating procedure, the UE shall not use WUS assistance.

If the network did not accept the request to use WUS assistance, the network shall delete the stored negotiated UE paging probability information for the UE, if available.

When a PDN connection for emergency bearer service is successfully established after the UE received the Negotiated WUS assistance information IE during the last attach or tracking area updating procedure, the UE and the network shall not use WUS assistance information until:

-  the successful completion of the PDN disconnect procedure of the PDN connection for emergency bearer services or EPS bearer context deactivation procedure of the EPS bearer context for emergency, or

-  the UE receives WUS assistance information during a tracking area updating procedure with EPS bearer context synchronization or upon successful completion of a service request procedure, if the UE or the network locally releases the PDN connection for emergency bearer service.

5.3.22  Handling multiple tracking area codes from the lower layers

When a UE camps on a satellite E-UTRAN cell, the UE may receive multiple TACs from the lower layers. The UE shall construct TAIs from the multiple TACs (i.e. concatenate the identity of the current PLMN and each of the TACs) and select a TAI as follows:

a)  if at least one TAI belongs to the TAI list of the UE, the UE shall select a TAI which belongs to the TAI list. If there are multiple TAIs which belong to the TAI list the UE shall consider each of these TAIs equal and:

-  if the UE can determine a TAI which represents the best the tracking area of the UE   's geographical location, the UE shall select a TAI which represents the best the tracking area of the UE   's geographical location; and

-  otherwise, the UE shall select a TAI in an implementation-specific way.

b)  if no TAI belongs to the TAI list of the UE and:

1)  there is a TAI which belongs to neither the list of "forbidden tracking areas for roaming" nor the list of "forbidden tracking areas for regional provision of service", the UE shall select a TAI which belongs to neither the list of "forbidden tracking areas for roaming" nor the list of "forbidden tracking areas for regional provision of service". In this case, if there are multiple TAIs which belong to neither the list of "forbidden tracking areas for roaming" nor the list of "forbidden tracking areas for regional provision of service", then the UE shall consider each of these TAIs equal and:

-  if the UE can determine a TAI which represents the best the tracking area of the UE   's geographical location, the UE shall select a TAI which represents the best the tracking area of the UE   's geographical location; and

-  otherwise, the UE shall select a TAI in an implementation-specific way.

2)  all TAIs belong to the list of "forbidden tracking areas for roaming" or the list of "forbidden tracking areas for regional provision of service", then the UE shall consider each of these TAIs equal and:

-  if the UE can determine a TAI which represents the best the tracking area of the UE   's geographical location, the UE shall select a TAI which represents the best the tracking area of the UE   's geographical location; and

-  otherwise, the UE shall select a TAI in an implementation-specific way.

The UE shall consider the selected TAI as the current TAI. The UE shall select a TAI as described above when:

a)  the UE receives multiple TACs from the lower layers; or

b)  the UE has received multiple TACs from the lower layers upon starting to camping on the current cell and the TAI list, the list of "forbidden tracking areas for roaming", or the list of "forbidden tracking areas for regional provision of service" is updated.

Handling of the list of "forbidden tracking areas for roaming" and the list of "forbidden tracking areas for regional provision of service" is specified in clause  5.3.2.

5.4  EMM common procedures

5.4.1  GUTI reallocation procedure

5.4.1.1  General

The purpose of the GUTI reallocation procedure is to allocate a GUTI and optionally to provide one or more of the following to a particular UE:

-  a new TAI list;

-  a new DCN-ID; and

-  in WB-S1 mode, if the UE supports RACS, either a UE radio capability ID deletion indication or a UE radio capability ID.

The reallocation of a GUTI is performed by the unique procedure defined in this clause. This procedure can only be initiated by the MME in state EMM-REGISTERED.

The GUTI can also be implicitly reallocated at attach or tracking area updating procedures. The implicit reallocation of a GUTI is described in the clauses which specify these procedures (see clause  5.5.1 and 5.5.3).

The PLMN identity in the GUTI indicates the current registered PLMN.

NOTE  1:  The GUTI reallocation procedure is usually performed in ciphered mode.

NOTE  2:  Normally, the GUTI reallocation will take place in conjunction with another mobility management procedure, e.g. as part of tracking area updating.

5.4.1.2  GUTI reallocation initiation by the network

The MME shall initiate the GUTI reallocation procedure by sending a GUTI REALLOCATION COMMAND message to the UE and starting the timer T3450 (see example in figure  5.4.1.2.1).

The GUTI REALLOCATION COMMAND message shall include a GUTI and may include one or more of the following:

-  a TAI list;

-  a DCN-ID; and

-  in WB-S1 mode, if the UE supports RACS, either a UE radio capability ID deletion indication or a UE radio capability ID.



Figure 5.4.1.2.1: GUTI reallocation procedure

5.4.1.3  GUTI reallocation completion by the UE

Upon receipt of the GUTI REALLOCATION COMMAND message, the UE shall:

-  store the GUTI;

-  store the TAI list, if provided;

-  store the DCN-ID, if provided;

-  in WB-S1 mode, if the UE supports RACS and the GUTI REALLOCATION COMMAND message includes:

a)  a UE radio capability ID deletion indication IE set to "Network-assigned UE radio capability IDs deletion requested", delete any network-assigned UE radio capability IDs associated with the registered PLMN stored at the UE, then the UE shall, after the completion of the ongoing GUTI reallocation procedure, initiate a tracking area updating procedure as specified in clause  5.5.3. If the UE has an applicable manufacturer-assigned UE radio capability ID for the current UE radio configuration, the UE shall include the UE radio capability ID availability IE set to "UE radio capability ID available" in the TRACKING AREA UPDATE REQUEST message; and

b)  a UE radio capability ID IE, store the UE radio capability ID as specified in annex  C; and

-  send a GUTI REALLOCATION COMPLETE message to the MME.

The UE considers the new GUTI as valid and the old GUTI as invalid. If the UE receives a new TAI list in the GUTI REALLOCATION COMMAND message, the UE shall consider the new TAI list as valid and the old TAI list as invalid; otherwise, the UE shall consider the old TAI list as valid.

If the GUTI REALLOCATION COMMAND message contains the DCN-ID IE, then the UE shall store the included DCN-ID value together with the PLMN code of the registered PLMN in a DCN-ID list in a non-volatile memory in the ME as specified in annex  C.

5.4.1.4  GUTI reallocation completion by the network

Upon receipt of the GUTI REALLOCATION COMPLETE message, the MME shall stop the timer T3450 and consider the new GUTI as valid and the old GUTI as invalid. If a new TAI list is provided in the GUTI REALLOCATION COMMAND message, the MME shall consider the new TAI list as valid and the old TAI list as invalid.

5.4.1.5  Abnormal cases in the UE

The following abnormal cases can be identified:

a)  Transmission failure of GUTI REALLOCATION COMPLETE message indication with TAI change from lower layers

  If the current TAI is not in the TAI list, the GUTI reallocation procedure shall be aborted and a tracking area updating procedure shall be initiated.

  If the current TAI is still part of the TAI list, it is up to the UE implementation how to re-run the ongoing procedure that triggered the GUTI reallocation procedure.

b)  Transmission failure of GUTI REALLOCATION COMPLETE message indication without TAI change from lower layers

  It is up to the UE implementation how to re-run the ongoing procedure that triggered the GUTI reallocation procedure.

5.4.1.6  Abnormal cases on the network side

The following abnormal cases can be identified:

a)  Lower layer failure

  If a lower layer failure is detected before the GUTI REALLOCATION COMPLETE message is received, the old and the new GUTI shall be considered as valid until the old GUTI can be considered as invalid by the network. If a new TAI list was provided in the GUTI REALLOCATION COMMAND message, the old and new TAI list shall also be considered as valid until the old TAI list can be considered as invalid by the network.

  During this period the network:

-  may first use the old S-TMSI from the old GUTI for paging within the area defined by the old TAI list for an implementation dependent number of paging attempts for network originated transactions. If a new TAI list was provided with old GUTI in the GUTI REALLOCATION COMMAND message, the new TAI list should also be used for paging. Upon response from the UE, the network may re-initiate the GUTI reallocation. If the response is received from a tracking area within the old and new TAI list, the network shall re-initiate the GUTI reallocation. If no response is received to the paging attempts, the network may use the new S-TMSI from the new GUTI for paging for an implementation dependent number of paging attempts. In this case, if a new TAI list was provided with new GUTI in the GUTI REALLOCATION COMMAND message, the new TAI list shall be used instead of the old TAI list. Upon response from the UE the network shall consider the new GUTI as valid and the old GUTI as invalid. If no response is received to the paging attempts, the network may use the IMSI for paging for an implementation dependent number of paging attempts;

NOTE  1:  Paging with IMSI causes the UE to re-attach as described in clause  5.6.2.2.2.

-  shall consider the new GUTI as valid if it is used by the UE and, additionally, the new TAI list as valid if it was provided with this GUTI in the GUTI REALLOCATION COMMAND message;

-  may use the identification procedure followed by a new GUTI reallocation if the UE uses the old GUTI; and

-  if the network accepted to use eDRX for the UE, may determine the next paging window from both old GUTI and new GUTI, and may first use the S-TMSI from the GUTI which led the first eDRX for paging. If no response is received to the paging attempts for the first eDRX, the network may use the other S-TMSI from the other GUTI which led the second eDRX for paging. For this paging procedure, the network shall start timer T3415 long enough to care the paging attempts for both eDRXs.

NOTE  2:  If the second eDRX comes during the first eDRX ongoing, the paging attempts for the second eDRX can be initiated with stopping further paging attempts for the first eDRX.

b)  Expiry of timer T3450

  The GUTI reallocation procedure is supervised by the timer T3450. The network shall, on the first expiry of timer T3450, reset and restart timer T3450 and shall retransmit the GUTI REALLOCATION COMMAND. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3450, the network shall abort the reallocation procedure and shall follow the rules described for case a above.

c)  GUTI reallocation and attach procedure collision

  If the network receives an ATTACH REQUEST message before the ongoing GUTI reallocation procedure has been completed the network shall proceed with the attach procedure after deletion of the EMM context.

d)  GUTI reallocation and UE initiated detach procedure collision

  If the network receives a DETACH REQUEST message before the ongoing GUTI reallocation procedure has been completed, the network shall abort the GUTI reallocation procedure and shall progress the detach procedure.

e)  GUTI reallocation and tracking area updating procedure collision

  If the network receives a TRACKING AREA UPDATE REQUEST message before the ongoing GUTI reallocation procedure has been completed, the network shall abort the GUTI reallocation procedure and shall progress the tracking area updating procedure. The network may then perform a new GUTI reallocation.

f)  GUTI reallocation and service request procedure collision

  If the network receives an EXTENDED SERVICE REQUEST message for CS fallback or 1xCS fallback before the ongoing GUTI reallocation procedure has been completed, the network shall progress both procedures.

g)  Lower layer indication of non-delivered NAS PDU due to handover

  If the GUTI REALLOCATION COMMAND message could not be delivered due to an intra MME handover and the target TA is included in the TAI list, then upon successful completion of the intra MME handover the MME shall retransmit the GUTI REALLOCATION COMMAND message. If a failure of the handover procedure is reported by the lower layer and the S1 signalling connection exists, the MME shall retransmit the GUTI REALLOCATION COMMAND message.

If there is a different new GUTI and optionally a new TAI list included in a subsequent GUTI REALLOCATION COMMAND message, the UE always regards the newest GUTI and the newest TAI list as valid for the recovery time.

5.4.2  Authentication procedure

5.4.2.1  General

The purpose of the EPS authentication and key agreement (AKA) procedure is to provide mutual authentication between the user and the network and to agree on a key KASME (see 3GPP  S  33.401  [19]). The cases when the EPS AKA procedure should be used are defined in 3GPP  S  33.401  [19].

The EPS AKA procedure is always initiated and controlled by the network. However, the UE can reject the EPS authentication challenge sent by the network.

The UE shall proceed with an EPS authentication challenge only if a USIM is present.

A partial native EPS security context is established in the UE and the network when an EPS authentication is successfully performed. During a successful EPS authentication procedure, the CK and IK are computed by the USIM. CK and IK are then used by the ME as key material to compute a new key, KASME. KASME is stored in the EPS security contexts (see 3GPP  S  33.401  [19]) of both the network and in the volatile memory of the ME while attached to the network, and is the root for the EPS integrity protection and ciphering key hierarchy.

5.4.2.2  Authentication initiation by the network

When a NAS signalling connection exists, the network can initiate an authentication procedure at any time. For restrictions applicable after handover or inter-system handover to S1 mode see clause  5.5.3.2.3.

The network initiates the authentication procedure by sending an AUTHENTICATION REQUEST message to the UE and starting the timer T3460 (see example in figure  5.4.2.2.1). The AUTHENTICATION REQUEST message contains the parameters necessary to calculate the authentication response (see 3GPP  S  33.401  [19]).

If an eKSI is contained in an initial NAS message during an EMM procedure, the network shall include a different eKSI value in the AUTHENTICATION REQUEST message when it initiates an authentication procedure.



Figure 5.4.2.2.1: Authentication procedure

5.4.2.3  Authentication response by the UE

The UE shall respond to an AUTHENTICATION REQUEST message. With the exception of the cases described in clauses  5.4.2.6 and 5.4.2.7 case k, the UE shall process the authentication challenge data and respond with an AUTHENTICATION RESPONSE message to the network.

Upon a successful EPS authentication challenge, the UE shall determine the PLMN identity to be used for the calculation of the new KASME from the authentication challenge data according to the following rules:

a)  When the UE moves from EMM-IDLE mode to EMM-CONNECTED mode, until the first handover, the UE shall use the PLMN identity of the selected PLMN; and

b)  After handover or inter-system handover to S1 mode,

-  if the target cell is not a shared network cell, the UE shall use the PLMN identity received as part of the broadcast system information;

-  if the target cell is a shared network cell and the UE has a valid GUTI, the UE shall use the PLMN identity that is part of the GUTI; and

-  if the target cell is a shared network cell, the UE does not have a valid GUTI and,

-  the EPS authentication challenge is performed after inter-system handover from A/Gb mode to S1 mode or from Iu mode to S1 mode and the UE has a valid P-TMSI and RAI, the UE shall use the PLMN identity that is part of the RAI; or

-  the EPS authentication challenge is performed after inter-system handover from N1 mode to S1 mode and the UE has a valid 5G-GUTI, the UE shall use the PLMN identity that is part of the 5G-GUTI.

Upon a successful EPS authentication challenge, the new KASME calculated from the authentication challenge data shall be stored in a new EPS security context in the volatile memory of the ME.

The USIM will compute the authentication response (RES) using the authentication challenge data received from the ME, and pass RES to the ME.

In order to avoid a synchronisation failure, when the UE receives an AUTHENTICATION REQUEST message, the UE shall store the received RAND together with the RES returned from the USIM in the volatile memory of the ME. When the UE receives a subsequent AUTHENTICATION REQUEST message, if the stored RAND value is equal to the new received value in the AUTHENTICATION REQUEST message, then the ME shall not pass the RAND to the USIM, but shall send the AUTHENTICATION RESPONSE message with the stored RES. If there is no valid stored RAND in the ME or the stored RAND is different from the new received value in the AUTHENTICATION REQUEST message, the ME shall pass the RAND to the USIM, shall override any previously stored RAND and RES with the new ones and start, or reset and restart timer T3416.

The RAND and RES values stored in the ME shall be deleted and timer T3416, if running, shall be stopped:

-  upon receipt of a

-  SECURITY MODE COMMAND,

-  SERVICE REJECT,

-  SERVICE ACCEPT,

-  TRACKING AREA UPDATE REJECT,

-  TRACKING AREA UPDATE ACCEPT, or

-  AUTHENTICATION REJECT message;

-  upon expiry of timer T3416;

-  if the UE enters the EMM state EMM-DEREGISTERED or EMM-NULL; or

-  if the UE enters EMM-IDLE mode.

5.4.2.4  Authentication completion by the network

Upon receipt of an AUTHENTICATION RESPONSE message, the network stops the timer T3460 and checks the correctness of RES (see 3GPP  S  33.401  [19]).

If the authentication procedure has been completed successfully and the related eKSI is stored in the EPS security context of the network, the network shall include a different eKSI value in the AUTHENTICATION REQUEST message when it initiates a new authentication procedure.

Upon receipt of an AUTHENTICATION FAILURE message, the network stops the timer T3460. In the case where the EMM cause #21 "synch failure" is received, the core network may renegotiate with the HSS/AuC and provide the UE with new authentication parameters.

5.4.2.5  Authentication not accepted by the network

If the authentication response (RES) returned by the UE is not valid, the network response depends upon the type of identity used by the UE in the initial NAS message, that is:

-  if the GUTI was used; or

-  if the IMSI was used.

If the GUTI was used, the network should initiate an identification procedure. If the IMSI given by the UE during the identification procedure differs from the IMSI the network had associated with the GUTI, the authentication should be restarted with the correct parameters. Otherwise, if the IMSI provided by the UE is the same as the IMSI stored in the network (i.e. authentication has really failed), the network should send an AUTHENTICATION REJECT message to the UE.

If the IMSI was used for identification in the initial NAS message, or the network decides not to initiate the identification procedure after an unsuccessful authentication procedure, the network should send an AUTHENTICATION REJECT message to the UE.

Upon receipt of an AUTHENTICATION REJECT message,

a)  if the message has been successfully integrity checked by the NAS, the UE shall set the update status to EU3 ROAMING NOT ALLOWED, delete the stored GUTI, TAI list, last visited registered TAI and KSIASME. The USIM shall be considered invalid until switching off the UE or the UICC containing the USIM is removed. If the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", then the UE shall set this counter to UE implementation-specific maximum value. If the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.

  If A/Gb or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number and the MM parameters update status, TMSI, LAI and ciphering key sequence number as specified in 3GPP  S  24.008  [13] for the case when the authentication and ciphering procedure is not accepted by the network; and

  if the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP  S  24.501  [54] for the case when the authentication procedure performed over 3GPP access is not accepted by the network; and

b)  if the message is received without integrity protection and if timer T3416, T3418 or T3420 is running, the UE shall start timer T3247 (see 3GPP  S  24.008  [13]) with a random value uniformly drawn from the range between 30 minutes and 60 minutes, if the timer is not running (see clause  5.3.7b). Additionally, the UE shall:

-  if the UE maintains a counter for "SIM/USIM considered invalid for GPRS services" events and the counter has a value less than a UE implementation-specific maximum value, proceed as specified in clause  5.3.7b, list item 1a for the case that the EMM cause value received is #3; and

-  otherwise proceed as specified under list item a above for the case that the message has been successfully integrity checked.

If the AUTHENTICATION REJECT message is received by the UE, the UE shall abort any EMM signalling procedure, stop any of the timers T3410, T3416, T3417, T3430, T3421, T3418 or T3420 (if they were running) and enter state EMM-DEREGISTERED.

Depending on local requirements or operator preference for emergency bearer services, if the UE has a PDN connection for emergency bearer services established or is establishing a PDN connection for emergency bearer services, the MME need not follow the procedures specified for the authentication failure in the present clause. The MME may continue a current EMM specific procedure or PDN connectivity request procedure. Upon completion of the authentication procedure, if not initiated as part of another procedure, or upon completion of the EMM procedure or PDN connectivity request procedure, the MME shall deactivate all non-emergency EPS bearers, if any, by initiating an EPS bearer context deactivation procedure. The network shall consider the UE to be attached for emergency bearer services only.

Depending on local regulation and operator policy, if the UE is requesting attach for access to RLOS, the MME need not follow the procedures specified for the authentication failure in the present clause. The MME may continue a current EMM specific procedure.

5.4.2.6  Authentication not accepted by the UE

In an EPS authentication challenge, the UE shall check the authenticity of the core network by means of the AUTN parameter received in the AUTHENTICATION REQUEST message. This enables the UE to detect a false network.

During an EPS authentication procedure, the UE may reject the core network due to an incorrect AUTN parameter (see 3GPP  S  33.401  [19]). This parameter contains three possible causes for authentication failure:

a)  MAC code failure:

  If the UE finds the MAC code (supplied by the core network in the AUTN parameter) to be invalid, the UE shall send an AUTHENTICATION FAILURE message to the network, with the EMM cause #20 "MAC failure". The UE shall then follow the procedure described in clause  5.4.2.7, item  c.

b)  Non-EPS authentication unacceptable:

  If the UE finds that the "separation bit" in the AMF field of AUTN supplied by the core network is 0, the UE shall send an AUTHENTICATION FAILURE message to the network, with the EMM cause #26 "non-EPS authentication unacceptable" (see clause  6.1.1 in 3GPP  S  33.401  [19]). The UE shall then follow the procedure described in clause  5.4.2.7, item d.

c)  SQN failure:

  If the UE finds the SQN (supplied by the core network in the AUTN parameter) to be out of range, the UE shall send an AUTHENTICATION FAILURE message to the network, with the EMM cause #21 "synch failure" and a re-synchronization token AUTS provided by the USIM (see 3GPP  S  33.102  [18]). The UE shall then follow the procedure described in clause  5.4.2.7, item  e.

If the UE returns an AUTHENTICATION FAILURE message to the network, the UE shall delete any previously stored RAND and RES and shall stop timer T3416, if running.

If the UE has a PDN connection for emergency bearer services established or is establishing such a PDN connection, additional UE requirements are specified in clause  5.4.2.7, under "for items c, d, e".

If the UE is attached for access to RLOS and has a PDN connection for RLOS established or is establishing such a PDN connection, additional UE requirements are specified in clause  5.4.2.7, under "for items c, d, e".

5.4.2.7  Abnormal cases

a)  Lower layer failure:

  Upon detection of lower layer failure before the AUTHENTICATION RESPONSE message is received, the network shall abort the procedure.

b)  Expiry of timer T3460:

  The network shall, on the first expiry of the timer T3460, retransmit the AUTHENTICATION REQUEST message and shall reset and start timer T3460. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3460, the network shall abort the authentication procedure and any ongoing EMM specific procedure and release the NAS signalling connection.

c)  Authentication failure (EMM cause #20 "MAC failure"):

  The UE shall send an AUTHENTICATION FAILURE message, with EMM cause #20 "MAC failure" according to clause  5.4.2.6, to the network and start timer T3418 (see example in figure  5.4.2.7.1). Furthermore, the UE shall stop any of the retransmission timers that are running (e.g. T3410, T3417, T3421 or T3430). Upon the first receipt of an AUTHENTICATION FAILURE message from the UE with EMM cause #20 "MAC failure", the network may initiate the identification procedure described in clause  5.4.4. This is to allow the network to obtain the IMSI from the UE. The network may then check that the GUTI originally used in the authentication challenge corresponded to the correct IMSI. Upon receipt of the IDENTITY REQUEST message from the network, the UE shall send the IDENTITY RESPONSE message.

NOTE  1:  Upon receipt of an AUTHENTICATION FAILURE message from the UE with EMM cause #20 "MAC failure", the network may also terminate the authentication procedure (see clause  5.4.2.5).

  If the GUTI/IMSI mapping in the network was incorrect, the network should respond by sending a new AUTHENTICATION REQUEST message to the UE. Upon receiving the new AUTHENTICATION REQUEST message from the network, the UE shall stop the timer T3418, if running, and then process the challenge information as normal. If the GUTI/IMSI mapping in the network was correct, the network should terminate the authentication procedure by sending an AUTHENTICATION REJECT message (see clause  5.4.2.5).

  If the network is validated successfully (an AUTHENTICATION REQUEST message that contains a valid SQN and MAC is received), the UE shall send the AUTHENTICATION RESPONSE message to the network and shall start any retransmission timers (e.g. T3410, T3417, T3421 or T3430) if they were running and stopped when the UE received the first failed AUTHENTICATION REQUEST message.

  If the UE receives the second AUTHENTICATION REQUEST message while T3418 is running, and the MAC value cannot be resolved, the UE shall follow the procedure specified in this clause, item  c, starting again from the beginning, or if the message contains a UMTS authentication challenge, the UE shall follow the procedure specified in item  d. If the SQN is invalid, the UE shall proceed as specified in item  e.



Figure 5.4.2.7.1: Authentication failure procedure (EMM cause #20 "MAC failure" or 
#26 "non-EPS authentication unacceptable")

d)  Authentication failure (EMM cause #26 "non-EPS authentication unacceptable"):

  The UE shall send an AUTHENTICATION FAILURE message, with EMM cause #26 "non-EPS authentication unacceptable", to the network and start the timer T3418 (see example in figure 5.4.2.7.1). Furthermore, the UE shall stop any of the retransmission timers that are running (e.g. T3410, T3417, T3421 or T3430). Upon the first receipt of an AUTHENTICATION FAILURE message from the UE with EMM cause #26 "non-EPS authentication unacceptable", the network may initiate the identification procedure described in clause  5.4.4. This is to allow the network to obtain the IMSI from the UE. The network may then check that the GUTI originally used in the authentication challenge corresponded to the correct IMSI. Upon receipt of the IDENTITY REQUEST message from the network, the UE shall send the IDENTITY RESPONSE message.

NOTE  2:  Upon receipt of an AUTHENTICATION FAILURE message from the UE with EMM cause #26 "non-EPS authentication unacceptable", the network may also terminate the authentication procedure (see clause  5.4.2.5).

  If the GUTI/IMSI mapping in the network was incorrect, the network should respond by sending a new AUTHENTICATION REQUEST message to the UE. Upon receiving the new AUTHENTICATION REQUEST message from the network, the UE shall stop the timer T3418, if running, and then process the challenge information as normal. If the GUTI/IMSI mapping in the network was correct, the network should terminate the authentication procedure by sending an AUTHENTICATION REJECT message (see clause  5.4.2.5).

e)  Authentication failure (EMM cause #21 "synch failure"):

  The UE shall send an AUTHENTICATION FAILURE message, with EMM cause #21 "synch failure", to the network and start the timer T3420 (see example in figure  5.4.2.7.2). Furthermore, the UE shall stop any of the retransmission timers that are running (e.g. T3410, T3417, T3421 or T3430). Upon the first receipt of an AUTHENTICATION FAILURE message from the UE with the EMM cause #21 "synch failure", the network shall use the returned AUTS parameter from the authentication failure parameter IE in the AUTHENTICATION FAILURE message, to re-synchronise. The re-synchronisation procedure requires the MME to delete all unused authentication vectors for that IMSI and obtain new vectors from the HSS. When re-synchronisation is complete, the network shall initiate the authentication procedure. Upon receipt of the AUTHENTICATION REQUEST message, the UE shall stop the timer T3420, if running.

NOTE  3:  Upon receipt of two consecutive AUTHENTICATION FAILURE messages from the UE with EMM cause #21 "synch failure", the network may terminate the authentication procedure by sending an AUTHENTICATION REJECT message.

  If the network is validated successfully (a new AUTHENTICATION REQUEST message is received which contains a valid SQN and MAC) while T3420 is running, the UE shall send the AUTHENTICATION RESPONSE message to the network and shall start any retransmission timers (e.g. T3410, T3417, T3421 or T3430), if they were running and stopped when the UE received the first failed AUTHENTICATION REQUEST message.

  If the UE receives the second AUTHENTICATION REQUEST message while T3420 is running, and the MAC value cannot be resolved, the UE shall follow the procedure specified in item  c or if the message contains a UMTS authentication challenge, the UE shall proceed as specified in item  d; if the SQN is invalid, the UE shall follow the procedure specified in this clause, item  e, starting again from the beginning.



Figure 5.4.2.7.2: Authentication failure procedure (EMM cause #21 "synch failure")

  Upon receipt of an AUTHENTICATION REJECT message, the UE shall perform the actions as specified in clause  5.4.2.5.

f)  Network failing the authentication check:

  If the UE deems that the network has failed the authentication check, then it shall request RRC to locally release the RRC connection and treat the active cell as barred (see 3GPP  S  36.304  [21]). The UE shall start any retransmission timers (e.g. T3410, T3417, T3421 or T3430), if they were running and stopped when the UE received the first AUTHENTICATION REQUEST message containing an incorrect authentication challenge data causing the authentication failure.

g)  Transmission failure of AUTHENTICATION RESPONSE message or AUTHENTICATION FAILURE message indication from lower layers (if the authentication procedure is triggered by a tracking area updating procedure or an attach procedure)

  The UE shall stop any of the timers T3418 and T3420, if running, and re-initiate the tracking area updating procedure if the authentication procedure is triggered by a tracking area updating procedure.

  The UE shall stop any of the timers T3418 and T3420, if running, and re-initiate the attach procedure if the authentication procedure is triggered by an attach procedure.

h)  Transmission failure of AUTHENTICATION RESPONSE message or AUTHENTICATION FAILURE message indication with TAI change from lower layers (if the authentication procedure is triggered by a service request procedure)

  The UE shall stop any of the timers T3418 and T3420, if running.

  If the current TAI is not in the TAI list, the authentication procedure shall be aborted and a tracking area updating procedure shall be initiated.

  If the current TAI is still part of the TAI list, it is up to the UE implementation how to re-run the ongoing procedure that triggered the authentication procedure.

i)  Transmission failure of AUTHENTICATION RESPONSE message or AUTHENTICATION FAILURE message indication without TAI change from lower layers (if the authentication procedure is triggered by a service request procedure)

  The UE shall stop any of the timers T3418 and T3420, if running. It is up to the UE implementation how to re-run the ongoing procedure that triggered the authentication procedure.

j)  Lower layers indication of non-delivered NAS PDU due to handover

  If the AUTHENTICATION REQUEST message could not be delivered due to an intra MME handover and the target TA is included in the TAI list, then upon successful completion of the intra MME handover the MME shall retransmit the AUTHENTICATION REQUEST message. If a failure of handover procedure is reported by the lower layer and the S1 signalling connection exists, the MME shall retransmit the AUTHENTICATION REQUEST message.

k)  Change of cell into a new tracking area

  If the UE detects the current TAI is not in the TAI list occurs before the AUTHENTICATION RESPONSE message is sent, the UE may discard sending the AUTHENTICATION RESPONSE message to the network and continue with the initiation of tracking area updating procedure as described in clause  5.5.3.

l)  AUTHENTICATION REJECT message is received without integrity protection and none of the timers T3416, T3418 and T3420 is running

  If an AUTHENTICATION REJECT message is received and if none of the timers T3416, T3418 and T3420 is running, then the UE shall discard the AUTHENTICATION REJECT message. Additionally, the UE may request RRC to locally release the RRC connection and treat the active cell as barred (see 3GPP  S  36.304  [21]).

For items  c, d, and e if the UE does not have a PDN connection for emergency bearer services established, is not establishing a PDN connection for emergency bearer services, does not have a PDN connection for RLOS established and is not establishing a PDN connection for RLOS:

  The UE shall stop any of the timers T3418 and T3420, if running, and the UE enters EMM-IDLE mode, e.g. upon detection of a lower layer failure, release of the NAS signalling connection, or as the result of an inter-system handover to A/Gb mode, Iu mode or N1 mode.

  The UE shall deem that the network has failed the authentication check or that the source of the authentication challenge is not genuine and proceed as described in item  f if any of the following occurs:

-  the timer T3418 or T3420 expires;

-  the UE detects any combination of the authentication failures: EMM cause #20 "MAC failure", #21 "synch failure", or #26 "non-EPS authentication unacceptable", during three consecutive authentication challenges. The authentication challenges shall be considered as consecutive only if the authentication challenges causing the second and third authentication failure are received by the UE while the timer T3418 or T3420 started after the previous authentication failure is running.

For items  c, d, and e if the UE has a PDN connection for emergency bearer services established, is establishing a PDN connection for emergency bearer services, has a PDN connection for RLOS established, or is establishing a PDN connection for RLOS:

1)  The UE shall stop any of the timers T3418 and T3420, if running, and the UE enters EMM-IDLE mode, e.g. upon detection of a lower layer failure, release of the NAS signalling connection, or as the result of an inter-system handover to A/Gb mode, Iu mode or N1 mode.

2)  Depending on local requirements or operator preference for emergency bearer services, if the UE has a PDN connection for emergency bearer services established or is establishing a PDN connection for emergency bearer services, the MME need not follow the procedures specified for the authentication failure specified in the present clause. The MME may respond to the AUTHENTICATION FAILURE message by initiating the security mode control procedure selecting the "null integrity protection algorithm" EIA0, "null ciphering algorithm" EEA0 or may abort the authentication procedure and continue using the current security context, if any. The MME shall deactivate all non-emergency EPS bearer contexts, if any, by initiating an EPS bearer context deactivation procedure. If there is an ongoing PDN connectivity procedure, the MME shall deactivate all non-emergency EPS bearer contexts upon completion of the PDN connectivity procedure. The network shall consider the UE to be attached for emergency bearer services only.

  If a UE has a PDN connection for emergency bearer services established or is establishing a PDN connection for emergency bearer services and sends an AUTHENTICATION FAILURE message to the MME with the EMM cause appropriate for these cases (#20, #21, or #26, respectively) and receives the SECURITY MODE COMMAND message before the timeout of timer T3418 or T3420, the UE shall deem that the network has passed the authentication check successfully, stop timer T3418 or T3420, respectively, and execute the security mode control procedure.

  If a UE has a PDN connection for emergency bearer services established or is establishing a PDN connection for emergency bearer services when timer T3418 or T3420 expires, the UE shall not deem that the network has failed the authentication check and not behave as described in item f. Instead the UE shall continue using the current security context, if any, deactivate all non-emergency EPS bearer contexts, if any, by initiating UE requested PDN disconnect procedure. If there is an ongoing PDN connectivity procedure, the UE shall deactivate all non-emergency EPS bearer contexts upon completion of the PDN connectivity procedure.

  The UE shall start any retransmission timers (e.g. T3410, T3417, T3421 or T3430) if:

-  they were running and stopped when the UE received the AUTHENTICATION REQUEST message and detected an authentication failure; and

-  the procedures associated with these timers have not yet been completed.

  The UE shall consider itself to be attached for emergency bearer services only.

3)  Depending on local regulation and operator policy, if the UE has a PDN connection for RLOS established or is establishing a PDN connection for RLOS, the MME need not follow the procedures specified for the authentication failure specified in the present clause. The MME may respond to the AUTHENTICATION FAILURE message by initiating the security mode control procedure selecting the "null integrity protection algorithm" EIA0, "null ciphering algorithm" EEA0 or may abort the authentication procedure and continue using the current security context, if any. The network shall consider the UE to be attached for access to RLOS.

  If a UE has a PDN connection for RLOS established or is establishing a PDN connection for RLOS and sends an AUTHENTICATION FAILURE message to the MME with the EMM cause appropriate for these cases (#20, #21, or #26, respectively) and receives the SECURITY MODE COMMAND message before the timeout of timer T3418 or T3420, the UE shall deem that the network has passed the authentication check successfully, stop timer T3418 or T3420, respectively, and execute the security mode control procedure.

  If a UE has a PDN connection for RLOS established or is establishing a PDN connection for RLOS when timer T3418 or T3420 expires, the UE shall not deem that the network has failed the authentication check and not behave as described in item f. Instead the UE shall continue using the current security context, if any.

  The UE shall start any retransmission timers (e.g. T3410, T3417, T3421 or T3430) if:

-  they were running and stopped when the UE received the AUTHENTICATION REQUEST message and detected an authentication failure; and

-  the procedures associated with these timers have not yet been completed.

  The UE shall consider itself to be attached for access to RLOS.

5.4.3  Security mode control procedure

5.4.3.1  General

The purpose of the NAS security mode control procedure is to take an EPS security context into use, and initialise and start NAS signalling security between the UE and the MME with the corresponding EPS NAS keys and EPS security algorithms.

Furthermore, the network may also initiate the security mode control procedure in the following cases:

-  in order to change the NAS security algorithms for a current EPS security context already in use;

-  in order to change the value of uplink NAS COUNT used in the latest SECURITY MODE COMPLETE message as described in 3GPP  S  33.401  [19],  clause  7.2.9.2; and

-  in order to request the UE radio capability ID from the UE.

For restrictions concerning the concurrent running of a security mode control procedure with other security related procedures in the AS or inside the core network see 3GPP  S  33.401  [19], clause  7.2.10.

5.4.3.2  NAS security mode control initiation by the network

The MME initiates the NAS security mode control procedure by sending a SECURITY MODE COMMAND message to the UE and starting timer T3460 (see example in figure  5.4.3.2.1).

The MME shall reset the downlink NAS COUNT counter and use it to integrity protect the initial SECURITY MODE COMMAND message if the security mode control procedure is initiated:

-  to take into use the EPS security context created after a successful execution of the EPS authentication procedure;

-  upon receipt of TRACKING AREA UPDATE REQUEST message including a GPRS ciphering key sequence number IE, if the MME wishes to create a mapped EPS security context (i.e. the type of security context flag is set to "mapped security context" in the NAS key set identifier IE included in the SECURITY MODE COMMAND message).

The MME shall send the SECURITY MODE COMMAND message unciphered, but shall integrity protect the message with the NAS integrity key based on KASME or mapped K   'ASME indicated by the eKSI included in the message. The MME shall set the security header type of the message to "integrity protected with new EPS security context".

The MME shall create a locally generated KASME and send the SECURITY MODE COMMAND message including a KSI value in the NAS key set identifier IE set to "000" and EIA0 and EEA0 as the selected NAS security algorithms only when the security mode control procedure is initiated:

-  during an attach procedure for emergency bearer services if no shared EPS security context is available;

-  during an attach procedure for access to RLOS if no valid EPS security context is available;

-  during a tracking area updating procedure for a UE that has a PDN connection for emergency bearer services if no shared EPS security context is available;

-  during a tracking area updating procedure for a UE that has a PDN connection for access to RLOS if no valid EPS security context is available;

-  during a service request procedure for a UE that has a PDN connection for emergency bearer services if no shared EPS security context is available;

-  during a service request procedure for a UE that has a PDN connection for access to RLOS if no valid EPS security context is available;

-  after a failed authentication procedure for a UE that has a PDN connection for emergency bearer services or that is establishing a PDN connection for emergency bearer services, if continued usage of a shared security context is not possible; or

-  after a failed authentication procedure for a UE that has a PDN connection for access to RLOS or that is establishing a PDN connection for access to RLOS, if continued usage of a valid security context is not possible.

The UE shall process a SECURITY MODE COMMAND message including a KSI value in the NAS key set identifier IE set to "000" and EIA0 and EEA0 as the selected NAS security algorithms and, if accepted, create a locally generated KASME when the security mode control procedure is initiated:

-  during an attach procedure for emergency bearer services;

-  during an attach procedure for access to RLOS;

-  during a tracking area updating procedure when the UE has a PDN connection for emergency bearer services;

-  during a tracking area updating procedure when the UE has a PDN connection for access to RLOS;

-  during a service request procedure when the UE has a PDN connection for emergency bearer services;

-  during a service request procedure when the UE has a PDN connection for access to RLOS;

-  after an authentication procedure when the UE has a PDN connection for emergency bearer services or is establishing a PDN connection for emergency bearer services; or

-  after an authentication procedure when the UE has a PDN connection for access to RLOS or is establishing a PDN connection for access to RLOS.

NOTE  1:  The process for creation of the locally generated KASME by the MME and the UE is implementation dependent.

Upon receipt of a TRACKING AREA UPDATE REQUEST message including a GPRS ciphering key sequence number IE, if the MME does not have the valid current EPS security context indicated by the UE, the MME shall either:

-  indicate the use of the new mapped EPS security context to the UE by setting the type of security context flag in the NAS key set identifier IE to "mapped security context" and the KSI value related to the security context of the source system; or

-  set the KSI value "000" in the NAS key set identifier IE if the MME sets EIA0 and EEA0 as the selected NAS security algorithms for a UE that has a PDN connection for emergency bearer services.

While having a current mapped EPS security context with the UE, if the MME wants to take the native EPS security context into use, the MME shall include the eKSI that indicates the native EPS security context in the SECURITY MODE COMMAND message.

The MME shall include the replayed security capabilities of the UE (including the security capabilities with regard to NAS, RRC and UP (user plane) ciphering as well as NAS and RRC integrity, and other possible target network security capabilities, i.e. UTRAN/GERAN if the UE included them in the message to network), the replayed nonceUE when creating a mapped EPS security context and if the UE included it in the message to the network, the selected NAS ciphering and integrity algorithms and the Key Set Identifier (eKSI). If the MME supports handling of UE additional security capabilities and the UE included a UE additional security capability IE in the message to the network, the MME shall include the replayed additional security capabilities of the UE.

The MME shall include both the nonceMME and the nonceUE when creating a mapped EPS security context during inter-system change from A/Gb mode to S1 mode or Iu mode to S1 mode in EMM-IDLE mode.

The MME may initiate a SECURITY MODE COMMAND in order to change the NAS security algorithms for a current EPS security context already in use. The MME re-derives the NAS keys from KASME with the new NAS algorithm identities as input and provides the new NAS algorithm identities within the SECURITY MODE COMMAND message. The MME shall set the security header type of the message to "integrity protected with new EPS security context".

If, during an ongoing attach or tracking area updating procedure, the MME is initiating a SECURITY MODE COMMAND (i.e. after receiving the ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message, but before sending a response to that message) and the ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message is received without integrity protection or does not successfully pass the integrity check at the MME, the MME shall calculate the HASHMME of the entire plain ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message as described in 3GPP  S  33.401  [19] and shall include the HASHMME in the SECURITY MODE COMMAND message.

Additionally, the MME may request the UE to include its IMEISV in the SECURITY MODE COMPLETE message.

NOTE  2:  The AS and NAS security capabilities will be the same, i.e. if the UE supports one algorithm for NAS, the same algorithm is also supported for AS.

If:

-  the NAS security mode control procedure is initiated during an ongoing attach procedure in WB-S1 mode;

-  the network supports RACS;

-  the UE has set the RACS bit to "RACS supported" in the UE network capability IE of the ATTACH REQUEST message; and

-  the UE has set the URCIDA bit to "UE radio capability ID available" in the UE radio capability ID availability IE of the ATTACH REQUEST message,

then the MME shall request the UE to include its UE radio capability ID in the SECURITY MODE COMPLETE message.

If:

-  the NAS security mode control procedure is initiated during an ongoing tracking area updating procedure in WB-S1 mode;

-  the network supports RACS;

-  the UE has set the RACS bit to "RACS supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message; and

-  the UE has set the URCIDA bit to "UE radio capability ID available" in the UE radio capability ID availability IE of the TRACKING AREA UPDATE REQUEST message,

then the MME may request the UE to include its UE radio capability ID in the SECURITY MODE COMPLETE message.

If:

-  the NAS security mode control procedure is initiated during an ongoing tracking area updating procedure in WB-S1 mode;

-  the network supports RACS;

-  the UE has set the RACS bit to "RACS supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message;

-  the UE has set the URCIDA bit to "UE radio capability ID available" in the UE radio capability ID availability IE of the TRACKING AREA UPDATE REQUEST message; and

-  no UE radio capability ID is available in the UE context in the MME,

then the MME shall request the UE to include its UE radio capability ID in the SECURITY MODE COMPLETE message.



Figure 5.4.3.2.1: Security mode control procedure

5.4.3.3  NAS security mode command accepted by the UE

Upon receipt of the SECURITY MODE COMMAND message, the UE shall check whether the security mode command can be accepted or not. This is done by performing the integrity check of the message and by checking that the received replayed UE security capabilities, the received replayed UE additional security capabilities, if included in the SECURITY MODE COMMAND message, and the received nonceUE have not been altered compared to the latest values that the UE sent to the network. However, the UE is not required to perform the checking of the received nonceUE if the UE does not want to re-generate the K   'ASME (i.e. the SECURITY MODE COMMAND message is to derive and take into use a mapped EPS security context and the eKSI matches the current EPS security context, if it is a mapped EPS security context). When the UE has a PDN connection for emergency bearer services established or the UE is establishing a PDN connection for emergency bearer services or the UE is requesting attach for access to RLOS, the UE is not required to locally re-generate the KASME (i.e. the SECURITY MODE COMMAND message is used to derive and take into use a native EPS security context where the KSI value "000" is included in the NAS key set identifier IE and the EIA0 and EEA0 are included as the selected NAS security algorithms).

The UE shall accept a SECURITY MODE COMMAND message indicating the "null integrity protection algorithm" EIA0 as the selected NAS integrity algorithm only if the message is received for a UE that has a PDN connection for emergency bearer services established, or a UE that is attached for access to RLOS, or a UE that is establishing a PDN connection for emergency bearer services or a UE that is requesting attach for access to RLOS.

If the type of security context flag included in the SECURITY MODE COMMAND message is set to "native security context" and if the KSI matches a valid non-current native EPS security context held in the UE while the UE has a mapped EPS security context as the current EPS security context, the UE shall take the non-current native EPS security context into use which then becomes the current native EPS security context and delete the mapped EPS security context.

If the SECURITY MODE COMMAND message can be accepted, the UE shall take the EPS security context indicated in the message into use. The UE shall in addition reset the uplink NAS COUNT counter if:

-  the SECURITY MODE COMMAND message is received in order to take an EPS security context into use created after a successful execution of the EPS authentication procedure;

-  the SECURITY MODE COMMAND message received includes the type of security context flag set to "mapped security context" in the NAS key set identifier IE the eKSI does not match the current EPS security context, if it is a mapped EPS security context.

  If the SECURITY MODE COMMAND message can be accepted and a new EPS security context is taken into use and SECURITY MODE COMMAND message does not indicate the "null integrity protection algorithm" EIA0 as the selected NAS integrity algorithm, the UE shall:

-  if the SECURITY MODE COMMAND message has been successfully integrity checked using an estimated downlink NAS COUNT equal 0, then the UE shall set the downlink NAS COUNT of this new EPS security context to 0;

-  otherwise the UE shall set the downlink NAS COUNT of this new EPS security context to the downlink NAS COUNT that has been used for the successful integrity checking of the SECURITY MODE COMMAND message.

  If the SECURITY MODE COMMAND message can be accepted, the UE shall send a SECURITY MODE COMPLETE message integrity protected with the selected NAS integrity algorithm and the EPS NAS integrity key based on the KASME or mapped K   'ASME if the type of security context flag is set to "mapped security context" indicated by the eKSI. When the SECURITY MODE COMMAND message includes the type of security context flag set to "mapped security context" in the NAS key set identifier IE, the nonceMME and the nonceUE, then the UE shall either:

-  generate K   'ASME from both the nonceMME and the nonceUE as indicated in 3GPP  S  33.401  [19]; or

-  check whether the SECURITY MODE COMMAND message indicates the eKSI of the current EPS security context, if it is a mapped EPS security context, in order not to re-generate the K   'ASME.

Furthermore, if the SECURITY MODE COMMAND message can be accepted, the UE shall cipher the SECURITY MODE COMPLETE message with the selected NAS ciphering algorithm and the EPS NAS ciphering key based on the KASME or mapped K   'ASME indicated by the eKSI. The UE shall set the security header type of the message to "integrity protected and ciphered with new EPS security context".

From this time onward the UE shall cipher and integrity protect all NAS signalling messages with the selected NAS ciphering and NAS integrity algorithms.

If the MME indicated in the SECURITY MODE COMMAND message that the IMEISV is requested, the UE shall include its IMEISV in the SECURITY MODE COMPLETE message.

In WB-S1 mode, if the MME indicated in the SECURITY MODE COMMAND message that the UE radio capability ID is requested, the UE shall:

-  if the UE has an applicable network-assigned UE radio capability ID for the current UE radio configuration in the selected PLMN, include the applicable network-assigned UE radio capability ID in the UE radio capability ID IE of the SECURITY MODE COMPLETE message; and

-  if the UE:

a)  does not have an applicable network-assigned UE radio capability ID for the current UE radio configuration in the selected PLMN; and

b)  has an applicable manufacturer-assigned UE radio capability ID for the current UE radio configuration,

  include the applicable manufacturer-assigned UE radio capability ID in the UE radio capability ID IE of the SECURITY MODE COMPLETE message.

If, during an ongoing attach or tracking area updating procedure, the SECURITY MODE COMMAND message includes a HASHMME, the UE shall compare HASHMME with a hash value locally calculated as described in 3GPP  S  33.401  [19] from the entire plain ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message that the UE had sent to initiate the procedure. If HASHMME and the locally calculated hash value are different, the UE shall include the complete ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message which the UE had previously sent in the Replayed NAS message container IE of the SECURITY MODE COMPLETE message.

5.4.3.4  NAS security mode control completion by the network

The MME shall, upon receipt of the SECURITY MODE COMPLETE message, stop timer T3460. From this time onward the MME shall integrity protect and encipher all signalling messages with the selected NAS integrity and ciphering algorithms.

If the SECURITY MODE COMPLETE message contains a Replayed NAS container message IE with an ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message, the MME shall complete the ongoing attach or tracking area updating procedure by considering the ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message contained in the Replayed NAS message container IE as the message that triggered the procedure.

5.4.3.5  NAS security mode command not accepted by the UE

If the security mode command cannot be accepted, the UE shall send a SECURITY MODE REJECT message. The SECURITY MODE REJECT message contains an EMM cause that typically indicates one of the following cause values:

#23:  UE security capabilities mismatch;

#24:  security mode rejected, unspecified.

Upon receipt of the SECURITY MODE REJECT message, the MME shall stop timer T3460. The MME shall also abort the ongoing procedure that triggered the initiation of the NAS security mode control procedure.

Both the UE and the MME shall apply the EPS security context in use before the initiation of the security mode control procedure, if any, to protect the SECURITY MODE REJECT message and any other subsequent messages according to the rules in clauses  4.4.4 and  4.4.5.

5.4.3.6  Abnormal cases in the UE

The following abnormal cases can be identified:

a)  Transmission failure of SECURITY MODE COMPLETE message or SECURITY MODE REJECT message indication from lower layers (if the security mode control procedure is triggered by a tracking area updating procedure or an attach procedure)

  The UE shall abort the security mode control procedure and re-initiate the tracking area updating procedure if the security mode control procedure is triggered by a tracking area updating procedure.

  The UE shall abort the security mode control procedure and re-initiate the attach procedure if the security mode control procedure is triggered by an attach procedure.

b)  Transmission failure of SECURITY MODE COMPLETE message or SECURITY MODE REJECT message indication with TAI change from lower layers (if the security mode control procedure is triggered by a service request procedure)

  If the current TAI is not in the TAI list, the security mode control procedure shall be aborted and a tracking area updating procedure shall be initiated.

  If the current TAI is still part of the TAI list, the security mode control procedure shall be aborted and it is up to the UE implementation how to re-run the ongoing procedure that triggered the security mode control procedure.

c)  Transmission failure of SECURITY MODE COMPLETE message or SECURITY MODE REJECT message indication without TAI change from lower layers (if the security mode control procedure is triggered by a service request procedure)

  The security mode control procedure shall be aborted and it is up to the UE implementation how to re-run the ongoing procedure that triggered the security mode control procedure.

5.4.3.7  Abnormal cases on the network side

The following abnormal cases can be identified:

a)  Lower layer failure before the SECURITY MODE COMPLETE or SECURITY MODE REJECT message is received

  The network shall abort the security mode control procedure.

b)  Expiry of timer T3460

  The network shall, on the first expiry of the timer T3460, retransmit the SECURITY MODE COMMAND message and shall reset and start timer T3460. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3460, the procedure shall be aborted.

NOTE:  If the SECURITY MODE COMMAND message was sent to create a mapped EPS security context during inter-system change from A/Gb mode to S1 mode or Iu mode to S1 mode, then the network does not generate new values for the nonceMME and the nonceUE, but includes the same values in the SECURITY MODE COMMAND message (see the clause  7.2.4.4 in 3GPP  S  33.401  [19]).

c)  Collision between security mode control procedure and attach, service request, tracking area updating procedure or detach procedure not indicating switch off

  The network shall abort the security mode control procedure and proceed with the UE initiated procedure.

d)  Collision between security mode control procedure and other EMM procedures than in item  c

  The network shall progress both procedures.

e)  Lower layers indication of non-delivered NAS PDU due to handover

  If the SECURITY MODE COMMAND message could not be delivered due to an intra MME handover and the target TA is included in the TAI list, then upon successful completion of the intra MME handover the MME shall retransmit the SECURITY MODE COMMAND message. If a failure of the handover procedure is reported by the lower layer and the S1 signalling connection exists, the MME shall retransmit the SECURITY MODE COMMAND message.

5.4.4  Identification procedure

5.4.4.1  General

The identification procedure is used by the network to request a particular UE to provide specific identification parameters, e.g. the International Mobile Subscriber Identity (IMSI) or the International Mobile Equipment Identity (IMEI). IMEI and IMSI definition and structure are specified in 3GPP  S  23.003  [2].

For mobile device supporting both 3GPP access and cdma2000   xae access a single IMEI is used to identify the device as specified in 3GPP  S  22.278  [1C]. If the UE is a MUSIM UE, the UE uses a separate IMEI for each USIM the UE operates.

5.4.4.2  Identification initiation by the network

The network initiates the identification procedure by sending an IDENTITY REQUEST message to the UE and starting the timer T3470 (see example in figure  5.4.4.2.1). The IDENTITY REQUEST message specifies the requested identification parameters in the Identity type information element.



Figure 5.4.4.2.1: Identification procedure

5.4.4.3  Identification response by the UE

A UE shall be ready to respond to an IDENTITY REQUEST message at any time whilst in EMM-CONNECTED mode.

Upon receipt of the IDENTITY REQUEST message the UE shall send an IDENTITY RESPONSE message to the network. The IDENTITY RESPONSE message shall contain the identification parameters as requested by the network.

5.4.4.4  Identification completion by the network

Upon receipt of the IDENTITY RESPONSE the network shall stop the timer T3470.

5.4.4.5  Abnormal cases in the UE

The following abnormal cases can be identified:

a)  Requested identity is not available

  If the UE cannot encode the requested identity in the IDENTITY RESPONSE message, e.g. because no valid USIM is available, then it shall encode the identity type as "no identity".

b)  Transmission failure of IDENTITY RESPONSE message indication from lower layers (if the identification procedure is triggered by a tracking area updating procedure or an attach procedure)

  The UE shall abort the identification procedure and re-initiate the tracking area updating procedure if the identification procedure is triggered by a tracking area updating procedure.

  The UE shall abort the identification procedure and re-initiate the attach procedure if the identification procedure is triggered by an attach procedure.

c)  Transmission failure of IDENTITY RESPONSE message indication with TAI change from lower layers (if the identification procedure is triggered by a service request procedure)

  If the current TAI is not in the TAI list, the identification procedure shall be aborted and a tracking area updating procedure shall be initiated.

  If the current TAI is still part of the TAI list, the identification procedure shall be aborted and it is up to the UE implementation how to re-run the ongoing procedure that triggered the identification procedure.

d)  Transmission failure of IDENTITY RESPONSE message indication without TAI change from lower layers (if the identification procedure is triggered by a service request procedure)

  The identification procedure shall be aborted and it is up to the UE implementation how to re-run the ongoing procedure that triggered the identification procedure.

5.4.4.6  Abnormal cases on the network side

The following abnormal cases can be identified:

a)  Lower layer failure

  Upon detection of a lower layer failure before the IDENTITY RESPONSE is received, the network shall abort any ongoing EMM procedure.

b)  Expiry of timer T3470

  The identification procedure is supervised by the network by the timer T3470. The network shall, on the first expiry of the timer T3470, retransmit the IDENTITY REQUEST message and reset and restart the timer T3470. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3470, the network shall abort the identification procedure and any ongoing EMM procedure.

c)  Collision of an identification procedure with an attach procedure

  If the network receives an ATTACH REQUEST message before the ongoing identification procedure has been completed and no attach procedure is pending on the network (i.e. no ATTACH ACCEPT/REJECT message has still to be sent as an answer to an ATTACH REQUEST message), the network shall proceed with the attach procedure.

d)  Collision of an identification procedure with an attach procedure when the identification procedure has been caused by an attach procedure

  If the network receives an ATTACH REQUEST message before the ongoing identification procedure has been completed and an attach procedure is pending (i.e. an ATTACH ACCEPT/REJECT message has to be sent as an answer to an earlier ATTACH REQUEST message), then:

-  If one or more of the information elements in the ATTACH REQUEST message differ from the ones received within the previous ATTACH REQUEST message, the network shall proceed with the new attach procedure; or

-  If the information elements do not differ, then the network shall not treat any further this new ATTACH REQUEST.

e)  Collision of an identification procedure with a UE initiated detach procedure

  Detach containing cause "switch off" within the Detach type IE:

  If the network receives a DETACH REQUEST message before the ongoing identification procedure has been completed, the network shall abort the identification procedure and shall progress the detach procedure.

  Detach containing other causes than "switch off" within the Detach type IE:

  If the network receives a DETACH REQUEST message before the ongoing identification procedure has been completed, the network shall complete the identification procedure and shall respond to the detach procedure as described in clause  5.5.2.

f)  Collision of an identification procedure with a tracking area updating procedure

  If the network receives a TRACKING AREA UPDATE REQUEST message before the ongoing identification procedure has been completed, the network shall progress both procedures.

g)  Collision of an identification procedure with a service request procedure

  If the network receives an EXTENDED SERVICE REQUEST message for CS fallback or 1xCS fallback before the ongoing identification procedure has been completed, the network shall progress both procedures.

h)  Lower layers indication of non-delivered NAS PDU due to handover

  If the IDENTITY REQUEST message could not be delivered due to an intra MME handover and the target TA is included in the TAI list, then upon successful completion of the intra MME handover the MME shall retransmit the IDENTITY REQUEST message. If a failure of the handover procedure is reported by the lower layer and the S1 signalling connection exists, the MME shall retransmit the IDENTITY REQUEST message.

5.4.5  EMM information procedure

5.4.5.1  General

The purpose of sending the EMM INFORMATION message is to allow the network to provide information to the UE. The message implementation is optional in the network. The UE may use the received information if the UE supports implementing this message.

The EMM information procedure may be invoked by the network at any time during an established EMM context.

5.4.5.2  EMM information procedure initiation by the network

The EMM information procedure consists only of the EMM INFORMATION message sent from the network to the UE (see example in figure  5.4.5.2.1). During an established EMM context, the network may send none, one, or more EMM INFORMATION messages to the UE. If more than one EMM INFORMATION message is sent, the messages need not have the same content.



Figure 5.4.5.2.1: EMM information procedure

5.4.5.3  EMM information procedure in the UE

When the UE (supporting the EMM information message) receives an EMM INFORMATION message, it shall accept the message and optionally use the contents to update appropriate information stored within the UE.

If the UE does not support the EMM information message the UE shall ignore the contents of the message and return an EMM STATUS message with EMM cause #97 "message type non-existent or not implemented".

5.4.5.4  Abnormal cases on the network side

The following abnormal case can be identified:

a)  Lower layers indication of non-delivered NAS PDU due to handover

  If the EMM INFORMATION message could not be delivered due to an intra MME handover and the target TA is included in the TAI list, then upon successful completion of the intra MME handover the MME shall retransmit the EMM INFORMATION message. If a failure of the handover procedure is reported by the lower layer and the S1 signalling connection exists, the MME shall retransmit the EMM INFORMATION message.

5.5  EMM specific procedures

5.5.1  Attach procedure

5.5.1.1  General

The attach procedure is used to attach to an EPC for packet services in EPS.

The attach procedure is used for the following purposes:

-  by a UE in PS mode of operation to attach for EPS services only;

-  by a UE in CS/PS mode 1 or CS/PS mode 2 of operation to attach for both EPS and non-EPS services;

-  by a UE supporting NB-S1 mode only in PS mode of operation to attach for EPS services and "SMS only";

-  to attach for emergency bearer services; or

-  an attach for access to RLOS.

The lower layers indicate to NAS that the network does not support emergency bearer services for the UE in limited service state (3GPP  S  36.331  [22]). This information is taken into account when deciding whether to initiate attach for emergency bearer services in WB-S1 mode.

If the MME does not support an attach for emergency bearer services, the MME shall reject any request to attach with an attach type set to "EPS emergency attach".

If the MUSIM UE initiates the attach procedure and sets the attach type to "EPS emergency attach" in the ATTACH REQUEST message, the network shall not indicate the support of:

-  the NAS signalling connection release;

-  the paging indication for voice services;

-  the reject paging request;

-  the paging restriction; or

-  the paging timing collision control;

in the ATTACH ACCEPT message.

The lower layers may indicate to NAS whether the network supports access to RLOS (3GPP  S  36.331  [22]). This information is taken into account when deciding whether to initiate attach for access to RLOS in WB-S1 mode.

With a successful attach procedure, a context is established for the UE in the MME. Furthermore, if the UE requested PDN connectivity, a default bearer is established between the UE and the PDN GW, thus enabling always-on IP connectivity to the UE. In WB-S1 mode, the network may also initiate the activation of dedicated bearers as part of the attach procedure. In NB-S1 mode the network shall not initiate the activation of dedicated bearers.

With a successful attach procedure in NB-S1 mode, a context is established for the UE in the MME. If the attach request included information to request PDN connectivity, a default bearer is also established between the UE and the PDN.

If EMM-REGISTERED without PDN connection is supported by the UE and the MME, a default bearer need not be requested by the UE during the attach procedure. If EMM-REGISTERED without PDN connection is not supported by the UE or the MME, then the UE shall request establishment of a default bearer.

During the attach procedure with default bearer establishment, the UE may also obtain the home agent IPv4 or IPv6 address or both.

In a shared network, the UE shall choose one of the PLMN identities as specified in 3GPP  S  23.122  [6]. The UE shall construct the TAI of the cell from this chosen PLMN identity and the TAC received for this PLMN identity as part of the broadcast system information. The chosen PLMN identity shall be indicated to the E-UTRAN (see 3GPP  S  36.331  [22]). Whenever an ATTACH REJECT message with the EMM cause #11 "PLMN not allowed" is received by the UE, the chosen PLMN identity shall be stored in the "forbidden PLMN list" and if the UE is configured to use timer T3245 (see 3GPP  S  24.368  [15A] or 3GPP  S  31.102  [17]) then the UE shall start timer T3245 and proceed as described in clause  5.3.7a. Whenever an ATTACH REJECT message with the EMM cause #14 "EPS services not allowed in this PLMN" is received by the UE, the chosen PLMN identity shall be stored in the "forbidden PLMNs for GPRS service" and if the UE is configured to use timer T3245 (see 3GPP  S  24.368  [15A] or 3GPP  S  31.102  [17]) then the UE shall start timer T3245 and proceed as described in clause  5.3.7a. Whenever an ATTACH REJECT message is received by the UE with the EMM cause #12  "tracking area not allowed", #13 "roaming not allowed in this tracking area", or #15 "no suitable cells in tracking area", the constructed TAI shall be stored in the suitable list.

An attach attempt counter is used to limit the number of subsequently rejected attach attempts. The attach attempt counter shall be incremented as specified in clause  5.5.1.2.6. Depending on the value of the attach attempt counter, specific actions shall be performed. The attach attempt counter shall be reset when:

-  the UE is powered on;

-  a USIM is inserted;

-  an attach or combined attach procedure is successfully completed;

NOTE:  The attach procedure can be initiated in S1 or S101 mode as described in clause  5.5.1.

-  a GPRS attach or combined GPRS attach procedure is successfully completed in A/Gb or Iu mode;

-  a registration procedure for initial registration performed over 3GPP access is successfully completed in N1 mode and the UE is operating in single-registration mode;

-  a combined attach procedure is completed for EPS services only with cause #2, #16, #17, #18 or #22;

-  an attach or combined attach procedure is rejected with cause #11, #12, #13, #14, #15, #25 or #35:

-  a network initiated detach procedure is completed with cause #11, #12, #13, #14, #15 or #25; or

-  a new PLMN is selected.

Additionally the attach attempt counter shall be reset when the UE is in substate EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH and:

-  a new tracking area is entered;

-  timer T3402 expires; or

-  timer T3346 is started.

5.5.1.2  Attach procedure for EPS services

5.5.1.2.1  General

This procedure can be used by a UE to attach for:

-  EPS services only; or

-  EPS services and "SMS only" if the UE supports NB-S1 mode only.

When the UE initiates the attach procedure for normal service, the UE shall indicate "EPS attach" in the EPS attach type IE.

When the UE initiates the attach procedure for emergency bearer services, the UE shall indicate "EPS emergency attach" in the EPS attach type IE. The attach procedure for emergency bearer services is not applicable for NB-S1 mode (see 3GPP  S  23.401  [10]).

This procedure can also be used by a UE in limited service state to attach for access to RLOS.

When the UE initiates the attach procedure for access to RLOS, the UE shall indicate "EPS RLOS attach" in the EPS attach type IE. The attach procedure for access to RLOS is not applicable for NB-S1 mode (see 3GPP  S  23.401  [10]).

5.5.1.2.2  Attach procedure initiation

In state EMM-DEREGISTERED, the UE initiates the attach procedure by sending an ATTACH REQUEST message to the MME, starting timer T3410 and entering state EMM-REGISTERED-INITIATED (see example in figure  5.5.1.2.2.1). If timer T3402 is currently running, the UE shall stop timer T3402. If timer T3411 is currently running, the UE shall stop timer T3411.

The UE shall include the IMSI in the EPS mobile identity IE in the ATTACH REQUEST message if the selected PLMN is neither the registered PLMN nor in the list of equivalent PLMNs and:

a)  the UE is configured for "AttachWithIMSI" as specified in 3GPP  S  24.368  [15A] or 3GPP  S  31.102  [17]; or

b)  the UE is in NB-S1 mode.

For all other cases, the UE shall handle the EPS mobile identity IE in the ATTACH REQUEST message as follows:

a)  if the UE operating in the single-registration mode is performing an inter-system change from N1 mode to S1 mode or the UE was previously registered in N1 mode before entering state 5GMM-DEREGISTERED and:

1)  the UE has received the interworking without N26 interface indicator set to "interworking without N26 interface supported" from the network and:

i)  if the UE holds a valid GUTI, the UE shall include the valid GUTI into the EPS mobile identity IE, include Old GUTI type IE with GUTI type set to "native GUTI" and include the UE status IE with a 5GMM registration status set to:

-  "UE is in 5GMM-REGISTERED state" if the UE is in 5GMM-REGISTERED state; or

-  "UE is in 5GMM-DEREGISTERED state" if the UE is in 5GMM-DEREGISTERED state; or

ii)  if the UE does not hold a valid GUTI, the UE shall include the IMSI in the EPS mobile identity IE; or

2)  the UE has received the interworking without N26 interface indicator set to "interworking without N26 interface not supported" from the network and:

i)  if the UE holds a valid native 5G-GUTI, the UE shall include a GUTI, mapped from the 5G-GUTI into the EPS mobile identity IE, include Old GUTI type IE with GUTI type set to "native GUTI" and include the UE status IE with a 5GMM registration status set to "UE is in 5GMM-DEREGISTERED state";

ii)  if the UE holds a valid GUTI and does not hold a valid 5G-GUTI, the UE shall indicate the GUTI in the EPS mobile identity IE and include Old GUTI type IE with GUTI type set to "native GUTI"; or

iii)  if the UE holds neither a valid GUTI nor a valid 5G-GUTI, the UE shall include the IMSI in the EPS mobile identity IE; or

NOTE  1:  The value of the EMM registration status included by the UE in the UE status IE is not used by the MME.

b)  otherwise:

1)  if the UE supports neither A/Gb mode nor Iu mode, the UE shall include in the ATTACH REQUEST message a valid GUTI together with the last visited registered TAI, if available. In addition, the UE shall include Old GUTI type IE with GUTI type set to "native GUTI". If there is no valid GUTI available, the UE shall include the IMSI in the ATTACH REQUEST message; or

2)  If the UE supports A/Gb mode or Iu mode or both and:

i)  if the TIN indicates "P-TMSI" and the UE holds a valid native P-TMSI and RAI, the UE shall map the P-TMSI and RAI into the EPS mobile identity IE, and include Old GUTI type IE with GUTI type set to "mapped GUTI". If a P-TMSI signature is associated with the P-TMSI, the UE shall include it in the Old P-TMSI signature IE. Additionally, if the UE holds a valid GUTI, the UE shall indicate the GUTI in the Additional GUTI IE;

NOTE  2:  The mapping of the P-TMSI and the RAI to the GUTI is specified in 3GPP  S  23.003  [2].

ii)  if the TIN indicates "GUTI" or "RAT-related TMSI" and the UE holds a valid GUTI, the UE shall indicate the GUTI in the EPS mobile identity IE, and include Old GUTI type IE with GUTI type set to "native GUTI";

iii)  if the TIN is deleted and:

-  the UE holds a valid GUTI, the UE shall indicate the GUTI in the EPS mobile identity IE, and include Old GUTI type IE with GUTI type set to "native GUTI";

-  the UE does not hold a valid GUTI but holds a valid native P-TMSI and RAI, the UE shall map the P-TMSI and RAI into the EPS mobile identity IE, and include Old GUTI type IE with GUTI type set to "mapped GUTI". If a P-TMSI signature is associated with the P-TMSI, the UE shall include it in the Old P-TMSI signature IE; or

-  the UE does not hold a valid GUTI, P-TMSI or RAI, the UE shall include the IMSI in the EPS mobile identity IE; or

iv)  otherwise the UE shall include the IMSI in the EPS mobile identity IE.

If the UE is operating in the dual-registration mode and it is in 5GMM state 5GMM-REGISTERED, the UE shall include the UE status IE with the 5GMM registration status set to "UE is in 5GMM-REGISTERED state".

NOTE  3:  The value of the EMM registration status included by the UE in the UE status IE is not used by the MME.

If the UE is attaching for emergency bearer services and does not hold a valid GUTI, P-TMSI or IMSI as described above, the IMEI shall be included in the EPS mobile identity IE.

If the UE in limited service state is attaching for access to RLOS and does not hold a valid GUTI, P-TMSI or IMSI as described above, the IMEI shall be included in the EPS mobile identity IE.

If the UE supports A/Gb mode or Iu mode or if the UE needs to indicate its UE specific DRX parameter to the network, the UE shall include the UE specific DRX parameter in the DRX parameter IE in the ATTACH REQUEST message. If the UE in NB-S1 mode needs to indicate the UE specific DRX parameter in NB-S1 mode to the network, it shall include the UE specific DRX parameter in NB-S1 mode in the DRX parameter in NB-S1 mode IE in the ATTACH REQUEST message.

If the UE supports eDRX and requests the use of eDRX, the UE shall include the extended DRX parameters IE in the ATTACH REQUEST message.

If the UE supports WUS assistance, then the UE shall set the WUSA bit to "WUS assistance supported" in the UE network capability IE, and if the UE is not attaching for emergency bearer services, the UE may include its UE paging probability information in the Requested WUS assistance information IE of the ATTACH REQUEST message.

If the UE supports SRVCC to GERAN/UTRAN, the UE shall set the SRVCC to GERAN/UTRAN capability bit to "SRVCC from UTRAN HSPA or E-UTRAN to GERAN/UTRAN supported".

If the UE supports vSRVCC from S1 mode to Iu mode, then the UE shall set the H.245 after handover capability bit to "H.245 after SRVCC handover capability supported" and additionally set the SRVCC to GERAN/UTRAN capability bit to "SRVCC from UTRAN HSPA or E-UTRAN to GERAN/UTRAN supported" in the ATTACH REQUEST message.

If the UE supports PSM and requests the use of PSM, then the UE shall include the T3324 value IE with a requested timer value in the ATTACH REQUEST message. When the UE includes the T3324 value IE and the UE indicates support for extended periodic timer value in the MS network feature support IE, it may also include the T3412 extended value IE to request a particular T3412 value to be allocated.

If the UE supports ProSe direct discovery, then the UE shall set the ProSe bit to "ProSe supported" and set the ProSe direct discovery bit to "ProSe direct discovery supported" in the UE network capability IE of the ATTACH REQUEST message.

If the UE supports ProSe direct communication, then the UE shall set the ProSe bit to "ProSe supported" and set the ProSe direct communication bit to "ProSe direct communication supported" in the UE network capability IE of the ATTACH REQUEST message.

If the UE supports acting as a ProSe UE-to-network relay, then the UE shall set the ProSe bit to "ProSe supported" and set the ProSe UE-to-network relay bit to "acting as a ProSe UE-to-network relay supported" in the UE network capability IE of the ATTACH REQUEST message.

If the UE supports NB-S1 mode, Non-IP or Ethernet PDN type, N1 mode, UAS services or if the UE supports DNS over (D)TLS (see 3GPP  S  33.501  [24]), then the UE shall support the extended protocol configuration options IE.

NOTE  4:  Support of DNS over (D)TLS is based on the informative requirements as specified in 3GPP  S  33.501  [24].

If the UE supports the extended protocol configuration options IE, then the UE shall set the ePCO bit to "extended protocol configuration options supported" in the UE network capability IE of the ATTACH REQUEST message.

If the UE supports providing PDU session ID in the protocol configuration option IE or the extended protocol configuration option IE when its N1 mode capability is disabled, then the UE shall set the ePCO bit to "extended protocol configuration options supported" in the UE network capability IE of the ATTACH REQUEST message.

If the UE supports the restriction on use of enhanced coverage, then the UE shall set the RestrictEC bit to "Restriction on use of enhanced coverage supported" in the UE network capability IE of the ATTACH REQUEST message.

If the UE supports the control plane data back-off timer T3448, the UE shall set the CP backoff bit to "back-off timer for transport of user data via the control plane supported" in the UE network capability IE of the ATTACH REQUEST message.

If the UE supports EPS-UPIP, the UE shall set the EPS-UPIP bit to "EPS-UPIP supported" in the UE network capability IE of the ATTACH REQUEST message.

If the UE is in NB-S1 mode, then the UE shall set the Control plane CIoT EPS optimization bit to "Control plane CIoT EPS optimization supported" in the UE network capability IE of the ATTACH REQUEST message. If the UE is capable of NB-N1 mode, then the UE shall set the Control plane CIoT 5GS optimization bit to "Control plane CIoT 5GS optimization supported" in the N1 UE network capability IE of the ATTACH REQUEST message.

If the UE is in NB-S1 mode, supports NB-S1 mode only, and requests to attach for EPS services and "SMS only", the UE shall indicate the SMS only requested bit to "SMS only" in the additional update type IE and shall set the EPS attach type IE to "EPS attach" in the ATTACH REQUEST message.

If the UE supports CIoT EPS optimizations, it shall indicate in the UE network capability IE of the ATTACH REQUEST message whether it supports EMM-REGISTERED without PDN connection.

If the UE supports S1-U data transfer and multiple user plane radio bearers (see 3GPP  S  36.306  [44], 3GPP  S  36.331  [22]) in NB-S1 mode, then the UE shall set the Multiple DRB support bit to "Multiple DRB supported" in the UE network capability IE of the ATTACH REQUEST message.

If the UE supports control plane MT-EDT, then the UE shall set the CP-MT-EDT bit to "Control plane Mobile Terminated-Early Data Transmission supported" in the UE network capability IE of the ATTACH REQUEST message.

If the UE supports user plane MT-EDT, then the UE shall set the UP-MT-EDT bit to "User plane Mobile Terminated-Early Data Transmission supported" in the UE network capability IE of the ATTACH REQUEST message.

If the UE supports V2X communication over E-UTRA-PC5, then the UE shall set the V2X PC5 bit to "V2X communication over E-UTRA-PC5 supported" in the UE network capability IE of the ATTACH REQUEST message.

If the UE supports V2X communication over NR-PC5, then the UE shall set the V2X NR-PC5 bit to "V2X communication over NR-PC5 supported" in the UE network capability IE of the ATTACH REQUEST message.

If the UE supports service gap control, then the UE shall set the SGC bit to "service gap control supported" in the UE network capability IE of the ATTACH REQUEST message.

If the UE supports dual connectivity with New Radio (NR), then the UE shall set the DCNR bit to "dual connectivity with NR supported" in the UE network capability IE of the ATTACH REQUEST message and shall include the UE additional security capability IE in the ATTACH REQUEST message.

If the UE supports N1 mode for 3GPP access, the UE shall set the N1mode bit to "N1 mode for 3GPP access supported" in the UE network capability IE of the ATTACH REQUEST message and shall include the UE additional security capability IE in the ATTACH REQUEST message.

If the UE supports signalling for a maximum number of 15 EPS bearer contexts, then the UE shall set the 15 bearers bit to "Signalling for a maximum number of 15 EPS bearer contexts supported" in the UE network capability IE of the ATTACH REQUEST message.

If the MUSIM UE supports the NAS signalling connection release, then the UE shall set the NAS signalling connection release bit to "NAS signalling connection release supported" in the UE network capability IE of the ATTACH REQUEST message otherwise the UE shall not set the NAS signalling connection release bit to "NAS signalling connection release supported" in the UE network capability IE of the ATTACH REQUEST message.

If the MUSIM UE supports the paging indication for voice services, then the UE shall set the paging indication for voice services bit to "paging indication for voice services supported" in the UE network capability IE of the ATTACH REQUEST message otherwise the UE shall not set the paging indication for voice services bit to "paging indication for voice services supported" in the UE network capability IE of the ATTACH REQUEST message.

If the MUSIM UE supports the reject paging request, then the UE shall set the reject paging request bit to "reject paging request supported" in the UE network capability IE of the ATTACH REQUEST message otherwise the UE shall not set the reject paging request bit to "reject paging request supported" in the UE network capability IE of the ATTACH REQUEST message.

If the MUSIM UE sets:

-  the reject paging request bit to "reject paging request supported";

-  the NAS signalling connection release bit to "NAS signalling connection release supported"; or

-  both of them;

and supports the paging restriction, then the UE shall set the paging restriction bit to "paging restriction supported" in the UE network capability IE of the ATTACH REQUEST message otherwise the UE shall not set the paging restriction bit to "paging restriction supported" in the UE network capability IE of the ATTACH REQUEST message.

If the MUSIM UE supports the paging timing collision control, then the UE shall set the paging timing collision control bit to "paging timing collision control supported" in the UE network capability IE of the ATTACH REQUEST message otherwise the UE shall not set the paging timing collision control bit to "paging timing collision control supported" in the UE network capability IE of the ATTACH REQUEST message.

If the UE supports ciphered broadcast assistance data and needs to obtain new ciphering keys, the UE shall include the Additional information requested IE with the CipherKey bit set to "ciphering keys for ciphered broadcast assistance data requested" in the ATTACH REQUEST message.

For MUSIM UE if the UE needs to indicate an IMSI offset value to the network, the UE shall include the IMSI offset value in the Requested IMSI offset IE in the ATTACH REQUEST message.

If EMM-REGISTERED without PDN connection is not supported by the UE or the MME, or if the UE wants to request PDN connection with the attach procedure, the UE shall send the ATTACH REQUEST message together with a PDN CONNECTIVITY REQUEST message contained in the ESM message container IE.

If EMM-REGISTERED without PDN connection is supported by the UE and the MME, and the UE does not want to request PDN connection with the attach procedure, the UE shall send the ATTACH REQUEST message together with an ESM DUMMY MESSAGE contained in the ESM message container information element.

In WB-S1 mode, if the UE supports RACS, the UE shall:

a)  set the RACS bit to "RACS supported" in the UE network capability IE of the ATTACH REQUEST message; and

b)  if the UE has an applicable UE radio capability ID for the current UE radio configuration in the selected PLMN, set the URCIDA bit to "UE radio capability ID available" in the UE radio capability ID availability IE of the ATTACH REQUEST message.

If the attach procedure is initiated following an inter-system change from N1 mode to S1 mode in EMM-IDLE mode or the UE which was previously registered in N1 mode before entering state 5GMM-DEREGISTERED initiates the attach procedure:

a)  if the UE has received an "interworking without N26 interface not supported" indication from the network and a valid 5G NAS security context exists in the UE, the UE shall integrity protect the ATTACH REQUEST message combined with the message included in the ESM message container IE using the 5G NAS security context;

b)  otherwise:

1)  if a valid EPS security context exists, the UE shall integrity protect the ATTACH REQUEST message combined with the message included in the ESM message container IE using the EPS security context; or

2)  if the UE does not have a valid EPS security context, the ATTACH REQUEST message combined with the message included in the ESM message container IE is not integrity protected.



Figure 5.5.1.2.2.1: Attach procedure and combined attach procedure

5.5.1.2.3  EMM common procedure initiation

The network may initiate EMM common procedures, e.g. the identification, authentication and security mode control procedures during the attach procedure, depending on the information received in the ATTACH REQUEST message (e.g. IMSI, GUTI and KSI).

If the network receives an ATTACH REQUEST message containing the Old GUTI type IE and the EPS mobile identity IE with type of identity indicating "GUTI", and the network does not follow the use of the most significant bit of the <MME group id> as specified in 3GPP  S  23.003  [2], clause  2.8.2.2.2, the network shall use the Old GUTI type IE to determine whether the mobile identity included in the EPS mobile identity IE is a native GUTI or a mapped GUTI.

During an attach for emergency bearer services or an attach for access to RLOS, the MME may choose to skip the authentication procedure even if no EPS security context is available and proceed directly to the execution of the security mode control procedure as specified in clause  5.4.3.

5.5.1.2.4  Attach accepted by the network

During an attach for emergency bearer services, if not restricted by local regulations, the MME shall not check for mobility and access restrictions, regional restrictions, subscription restrictions, or perform CSG access control when processing the ATTACH REQUEST message. The network shall not apply subscribed APN based congestion control during an attach procedure for emergency bearer services.

During an attach for access to RLOS, the MME shall not check for access restrictions, regional restrictions and subscription restrictions when processing the ATTACH REQUEST message.

If the attach request is accepted by the network, the MME shall send an ATTACH ACCEPT message to the UE and start timer T3450.

If the attach request included the PDN CONNECTIVITY REQUEST message in the ESM message container information element to request PDN connectivity, the MME when accepting the attach request shall:

-  send the ATTACH ACCEPT message together with an ESM DUMMY MESSAGE contained in the ESM message container information element and discard the ESM message container information element included in the attach request if:

-  the UE indicated support of EMM-REGISTERED without PDN connection in the UE network capability IE of the ATTACH REQUEST message;

-  the MME supports EMM-REGISTERED without PDN connection and PDN connection is restricted according to the user   's subscription data;

-  the attach type is not set to "EPS emergency attach" or "EPS RLOS attach"; and

-  the request type of the UE requested PDN connection is not set to "handover of emergency bearer services", "emergency" or "RLOS";

-  otherwise, send the ATTACH ACCEPT message together with an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message contained in the ESM message container information element to activate the default bearer (see clause  6.4.1). In WB-S1 mode, the network may also initiate the activation of dedicated bearers towards the UE by invoking the dedicated EPS bearer context activation procedure (see clause  6.4.2). In NB-S1 mode the network shall not initiate the activation of dedicated bearers.

If EMM-REGISTERED without PDN connection is supported by the UE and the MME, and the UE included an ESM DUMMY MESSAGE in the ESM message container information element of the ATTACH REQUEST message, the MME shall send the ATTACH ACCEPT message together with an ESM DUMMY MESSAGE contained in the ESM message container information element.

If the attach request is accepted by the network, the MME shall delete the stored UE radio capability information or the UE radio capability ID, if any.

In NB-S1 mode, if the attach request is accepted by the network, the MME shall set the EMC BS bit to zero in the EPS network feature support IE included in the ATTACH ACCEPT message to indicate that support of emergency bearer services in NB-S1 mode is not available.

If the UE has included the UE network capability IE or the MS network capability IE or both in the ATTACH REQUEST message, the MME shall store all octets received from the UE, up to the maximum length defined for the respective information element.

NOTE  1:  This information is forwarded to the new MME during inter-MME handover or to the new SGSN during inter-system handover to A/Gb mode or Iu mode.

NOTE  2:  For further details concerning the handling of the MS network capability and UE network capability in the MME see also 3GPP  S  23.401  [10].

If the UE specific DRX parameter was included in the DRX Parameter IE in the ATTACH REQUEST message, the MME shall replace any stored UE specific DRX parameter with the received parameter and use it for the downlink transfer of signalling and user data in WB-S1 mode.

In NB-S1 mode, if the DRX parameter in NB-S1 mode IE was included in the ATTACH REQUEST message, the MME shall provide to the UE the Negotiated DRX parameter in NB-S1 mode IE in the ATTACH ACCEPT message. The MME shall replace any stored UE specific DRX parameter in NB-S1 mode with the negotiated DRX parameter and use it for the downlink transfer of signalling and user data in NB-S1 mode.

NOTE  3:  In NB-S1 mode, if a DRX parameter was included in the Negotiated DRX parameter in NB-S1 mode IE in the ATTACH ACCEPT message, then the UE stores and uses the received DRX parameter in NB-S1 mode (see 3GPP  S  36.304  [21]). If the UE did not receive a DRX parameter in the Negotiated DRX parameter in NB-S1 mode IE, or if the Negotiated DRX parameter in NB-S1 mode IE was not included in the ATTACH ACCEPT message, then the UE uses the cell specific DRX value in NB-S1 mode (see 3GPP  S  36.304  [21]).

In NB-S1 mode, if the UE requested "SMS only" in the Additional update type IE, supports NB-S1 mode only and the MME decides to accept the attach request for EPS services and "SMS only", the MME shall indicate "SMS only" in the Additional update result IE and shall set the EPS attach result IE to "EPS only" in the ATTACH ACCEPT message.

The MME shall include the extended DRX parameters IE in the ATTACH ACCEPT message only if the extended DRX parameters IE was included in the ATTACH REQUEST message, and the MME supports and accepts the use of eDRX.

If

-  the UE supports WUS assistance; and

-  the MME supports and accepts the use of WUS assistance,

then the MME shall determine the negotiated UE paging probability information for the UE, store it in the EMM context of the UE, and if the UE is not attaching for emergency bearer services, the MME shall include it in the Negotiated WUS assistance information IE in the ATTACH ACCEPT message. The MME may take into account the UE paging probability information received in the Requested WUS assistance information IE when determining the negotiated UE paging probability information for the UE.

NOTE  4:  Besides the UE paging probability information requested by the UE, the MME can take local configuration or previous statistical information for the UE into account when determining the negotiated UE paging probability information for the UE (see 3GPP  S  23.401  [10]).

The MME shall assign and include the TAI list the UE is registered to in the ATTACH ACCEPT message. The MME shall not assign a TAI list containing both tracking areas in NB-S1 mode and tracking areas in WB-S1 mode. The UE, upon receiving an ATTACH ACCEPT message, shall delete its old TAI list and store the received TAI list.

NOTE  5:  When assigning the TAI list, the MME can take into account the eNodeB   's capability of support of CIoT EPS optimization.

The MME may include T3412 extended value IE in the ATTACH ACCEPT message only if the UE indicates support of the extended periodic timer T3412 in the MS network feature support IE in the ATTACH REQUEST message.

The MME shall include the T3324 value IE in the ATTACH ACCEPT message only if the T3324 value IE was included in the ATTACH REQUEST message, and the MME supports and accepts the use of PSM.

If the MME supports and accepts the use of PSM, and the UE included the T3412 extended value IE in the ATTACH REQUEST message, then the MME shall take into account the T3412 value requested when providing the T3412 value IE and the T3412 extended value IE in the ATTACH ACCEPT message.

NOTE  6:  Besides the value requested by the UE, the MME can take local configuration or subscription data provided by the HSS into account when selecting a value for T3412 (3GPP  S  23.401  [10] clause  4.3.17.3).

If the UE indicates support for EMM-REGISTERED without PDN connection in the ATTACH REQUEST message and the MME supports EMM-REGISTERED without PDN connection, the MME shall indicate support for EMM-REGISTERED without PDN connection in the EPS network feature support IE of the ATTACH ACCEPT message. The UE and the MME shall use the information whether the peer entity supports EMM-REGISTERED without PDN connection as specified in the present clause  5 and in clause  6.

If the UE requests "control plane CIoT EPS optimization" in the Additional update type IE, indicates support of control plane CIoT EPS optimization in the UE network capability IE and the MME decides to accept the requested CIoT EPS optimization and the attach request, the MME shall indicate "control plane CIoT EPS optimization supported" in the EPS network feature support IE.

If the MME supports NB-S1 mode, non-IP or Ethernet PDN type, inter-system change with 5GS, UAS services or the network wants to enforce the use of DNS over (D)TLS (see 3GPP  S  33.501  [24]), then the MME shall support the extended protocol configuration options IE.

NOTE  7:  Support of DNS over (D)TLS is based on the informative requirements as specified in 3GPP TS 33.401 [19] and it is implemented based on the operator requirement.

If the MME supports the extended protocol configuration options IE and the UE indicated support of the extended protocol configuration options IE, then the MME shall set the ePCO bit to "extended protocol configuration options supported" in the EPS network feature support IE of the ATTACH ACCEPT message.

If the UE indicates support for restriction on use of enhanced coverage in the ATTACH REQUEST message, and the network decides to restrict the use of enhanced coverage for the UE, then the MME shall set the RestrictEC bit to "Use of enhanced coverage is restricted" in the EPS network feature support IE of the ATTACH ACCEPT message.

If the UE has indicated support for the control plane data back-off timer, and the MME decides to activate the congestion control for transport of user data via the control plane, then the MME shall include the T3448 value IE in the ATTACH ACCEPT message.

If the UE indicates support for dual connectivity with NR in the ATTACH REQUEST message, and the MME decides to restrict the use of dual connectivity with NR for the UE, then the MME shall set the RestrictDCNR bit to "Use of dual connectivity with NR is restricted" in the EPS network feature support IE of the ATTACH ACCEPT message.

If the UE indicates support for N1 mode in the ATTACH REQUEST message and the MME supports inter-system interworking with 5GS, the MME may set the IWK N26 bit to either:

-  "interworking without N26 interface not supported" if the MME supports N26 interface; or

-  "interworking without N26 interface supported" if the MME does not support N26 interface

in the EPS network feature support IE in the ATTACH ACCEPT message.

If the UE requests ciphering keys for ciphered broadcast assistance data in the ATTACH REQUEST message and the MME has valid ciphering key data applicable to the UE   's subscription, then the MME shall include the ciphering key data in the Ciphering key data IE of the ATTACH ACCEPT message.

If the UE indicates support of the NAS signalling connection release in the ATTACH REQUEST message and the network decides to accept the NAS signalling connection release, then the MME shall set the NAS signalling connection release bit to "NAS signalling connection release supported" in the EPS network feature support IE of the ATTACH ACCEPT message.

If the UE indicates support of the paging indication for voice services in the ATTACH REQUEST message and the network decides to accept the paging indication for voice services, then the MME shall set the paging indication for voice services bit to "paging indication for voice services supported" in the EPS network feature support IE of the ATTACH ACCEPT message. Upon receipt of ATTACH ACCEPT message with the paging indication for voice services bit set to "paging indication for voice services supported", the UE NAS layer informs the lower layers that paging indication for voice services is supported. Otherwise, the UE NAS layer informs the lower layers that paging indication for voice services is not supported.

If the UE indicates support of the reject paging request in the ATTACH REQUEST message and the network decides to accept the reject paging request, then the MME shall set the reject paging request bit to "reject paging request supported" in the EPS network feature support IE of the ATTACH ACCEPT message.

If the UE indicates support of the paging restriction in the ATTACH REQUEST message, and the MME sets:

-  the reject paging request bit to "reject paging request supported";

-  the NAS signalling connection release bit to "NAS signalling connection release supported"; or

-  both of them;

in the EPS network feature support IE of the ATTACH ACCEPT message, and the network decides to accept the paging restriction, then the MME shall set the paging restriction bit to "paging restriction supported" in the EPS network feature support IE of the ATTACH ACCEPT message.

If the UE indicates support of the paging timing collision control in the ATTACH REQUEST message and the network decides to accept the paging timing collision control, then the MME shall set the paging timing collision control bit to "paging timing collision control supported" in the EPS network feature support IE of the ATTACH ACCEPT message.

If the MUSIM UE has included a Requested IMSI offset IE in the ATTACH REQUEST message and if the MME supports paging timing collision control, the MME shall include the Negotiated IMSI offset IE in the ATTACH ACCEPT message, and the MME shall set the IMSI offset value to:

-  A value that is different than what the UE has provided, if the MME has a different value; or

-  A value that is same as what the UE has provided, if the MME does not have a different value;

and the MME shall calculate an alternative IMSI value using the IMSI offset value and store it in the UE context as specified in 3GPP  S  23.401  [10]. The alternative IMSI value is used for deriving the paging occasion as specified in 3GPP  S  36.304  [21].

If the MUSIM UE has not included a Requested IMSI offset IE in the ATTACH REQUEST message, the MME shall erase any stored alternative IMSI value for that UE, if available.

If due to operator policies unsecured redirection to a GERAN cell is not allowed in the current PLMN, the MME shall set the redir-policy bit to "Unsecured redirection to GERAN not allowed" in the Network policy IE of the ATTACH ACCEPT message.

The MME may include the T3447 value IE set to the service gap time value in the ATTACH ACCEPT message if:

-  the UE has indicated support for service gap control; and

-  a service gap time value is available in the EMM context.

If the network supports signalling for a maximum number of 15 EPS bearer contexts and the UE indicated support of signalling for a maximum number of 15 EPS bearer contexts in the ATTACH REQUEST message, then the MME shall set the 15 bearers bit to "Signalling for a maximum number of 15 EPS bearer contexts supported" in the EPS network feature support IE of the ATTACH ACCEPT message.

Upon receiving the ATTACH ACCEPT message, the UE shall stop timer T3410.

  The GUTI reallocation may be part of the attach procedure. When the ATTACH REQUEST message includes the IMSI or IMEI, or the MME considers the GUTI provided by the UE is invalid, or the GUTI provided by the UE was assigned by another MME, the MME shall allocate a new GUTI to the UE. The MME shall include in the ATTACH ACCEPT message the new assigned GUTI together with the assigned TAI list. In this case the MME shall enter state EMM-COMMON-PROCEDURE-INITIATED as described in clause  5.4.1.

For a shared network, the TAIs included in the TAI list can contain different PLMN identities. The MME indicates the selected core network operator PLMN identity to the UE in the GUTI (see 3GPP  S  23.251  [8B]).

If the ATTACH ACCEPT message contains a GUTI, the UE shall use this GUTI as the new temporary identity. The UE shall delete its old GUTI and store the new assigned GUTI. If no GUTI has been included by the MME in the ATTACH ACCEPT message, the old GUTI, if any available, shall be kept.

If A/Gb mode or Iu mode is supported in the UE, the UE shall set its TIN to "GUTI" when receiving the ATTACH ACCEPT message.

If the ATTACH ACCEPT message contains the T3412 extended value IE, then the UE shall use the value in T3412 extended value IE as periodic tracking area update timer (T3412). If the ATTACH ACCEPT message does not contain T3412 extended value IE, then the UE shall use the value in T3412 value IE as periodic tracking area update timer (T3412).

If the ATTACH ACCEPT message contains the T3324 value IE, then the UE shall use the included timer value for T3324 as specified in 3GPP  S  24.008  [13], clause  4.7.2.8.

If the ATTACH ACCEPT message contains the DCN-ID IE, then the UE shall store the included DCN-ID value together with the PLMN code of the registered PLMN in a DCN-ID list in a non-volatile memory in the ME as specified in annex  C.

If the ATTACH ACCEPT message contains Negotiated IMSI offset IE, the MUSIM UE shall forward the IMSI offset value to lower layers. If the ATTACH ACCEPT message does not contain Negotiated IMSI offset IE, the MUSIM UE shall indicate to lower layers to erase any IMSI offset value, if available.

The MME may also include a list of equivalent PLMNs in the ATTACH ACCEPT message. Each entry in the list contains a PLMN code (MCC+MNC). The UE shall store the list as provided by the network, and if the attach procedure is neither for emergency bearer services nor for access to RLOS, the UE shall remove from the list any PLMN code that is already in the list of "forbidden PLMNs" or in the list of "forbidden PLMNs for GPRS service". In addition, the UE shall add to the stored list the PLMN code of the registered PLMN that sent the list. The UE shall replace the stored list on each receipt of the ATTACH ACCEPT message. If the ATTACH ACCEPT message does not contain a list, then the UE shall delete the stored list.

If the MME received the list of TAIs from the satellite E-UTRAN as described in 3GPP  S  23.401  [10], and determines that any but not all TAIs in the received list of TAIs is forbidden for roaming or for regional provision of service as per operator   's choice, the MME shall include the TAI(s) in:

a)   the Forbidden TAI(s) for the list of "Forbidden tracking areas for roaming" IE;

b)   the Forbidden TAI(s) for the list of "Forbidden tracking areas for regional provision of service" IE; or

c)  both;

in the ATTACH ACCEPT message.

NOTE  8:  "Forbidden tracking areas for roaming" corresponds to cause values #13 and #15, and "Forbidden tracking areas for regional provision of service" corresponds to cause value #12.

If the attach procedure is neither for emergency bearer services nor for access to RLOS, and if the PLMN identity of the registered PLMN is a member of the list of "forbidden PLMNs" or the list of "forbidden PLMNs for GPRS service", any such PLMN identity shall be deleted from the corresponding list(s).

The network informs the UE about the support of specific features, such as IMS voice over PS session, location services (EPC-LCS, CS-LCS), emergency bearer services, or CIoT EPS optimizations, in the EPS network feature support information element. In a UE with IMS voice over PS capability, the IMS voice over PS session indicator and the emergency bearer services indicator shall be provided to the upper layers. The upper layers take the IMS voice over PS session indicator into account as specified in 3GPP  S  23.221  [8A], clause  7.2a and clause  7.2b, when selecting the access domain for voice sessions or calls. When initiating an emergency call, the upper layers also take both the IMS voice over PS session indicator and the emergency bearer services indicator into account for the access domain selection. In a UE with LCS capability, location services indicators (EPC-LCS, CS-LCS) shall be provided to the upper layers. When MO-LR procedure is triggered by the UE   's application, those indicators are taken into account as specified in 3GPP  S  24.171  [13C].

If the RestrictDCNR bit is set to "Use of dual connectivity with NR is restricted" in the EPS network feature support IE of the ATTACH ACCEPT message, the UE shall provide the indication that dual connectivity with NR is restricted to the upper layers.

The UE supporting N1 mode shall operate in the mode for inter-system interworking with 5GS as follows:

-  if the IWK N26 bit in the EPS network feature support IE is set to "interworking without N26 interface not supported", the UE shall operate in single-registration mode;

-  if the IWK N26 bit in the EPS network feature support IE is set to "interworking without N26 interface supported" and the UE supports dual-registration mode, the UE may operate in dual-registration mode; or

NOTE  9:  The registration mode used by the UE is implementation dependent.

-  if the IWK N26 bit in the EPS network feature support IE is set to "interworking without N26 interface supported" and the UE only supports single-registration mode, the UE shall operate in single-registration mode.

The UE shall treat the interworking without N26 interface indicator as valid in the entire PLMN and equivalent PLMNs. The interworking procedures required for coordination between 5GMM and EMM without N26 interface are specified in 3GPP  S  24.501  [54].

If the redir-policy bit is set to "Unsecured redirection to GERAN not allowed" in the Network policy IE of the ATTACH ACCEPT message, the UE shall set the network policy on unsecured redirection to GERAN for the current PLMN to "Unsecured redirection to GERAN not allowed" and indicate to the lower layers that unsecured redirection to a GERAN cell is not allowed. If the redir-policy bit is set to "Unsecured redirection to GERAN allowed" or if the Network policy IE is not included in the ATTACH ACCEPT message, the UE shall set the network policy for the current PLMN to "Unsecured redirection to GERAN allowed" and indicate to the lower layers that unsecured redirection to a GERAN cell is allowed. The UE shall set the network policy on unsecured redirection to GERAN to "Unsecured redirection to GERAN not allowed" and indicate this to the lower layers when any of the following events occurs:

-  the UE initiates an EPS attach or tracking area updating procedure in a PLMN different from the PLMN where the UE performed the last successful EPS attach or tracking area updating procedure;

-  the UE is switched on; or

-  the UICC containing the USIM is removed.

If the UE has initiated the attach procedure due to manual CSG selection and receives an ATTACH ACCEPT message; and the UE sent the ATTACH REQUEST message in a CSG cell, the UE shall check if the CSG ID and associated PLMN identity of the cell are contained in the Allowed CSG list. If not, the UE shall add that CSG ID and associated PLMN identity to the Allowed CSG list and the UE may add the HNB Name (if provided by lower layers) to the Allowed CSG list if the HNB Name is present in neither the Operator CSG list nor the Allowed CSG list.

When the UE receives the ATTACH ACCEPT message combined with the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, and if the UE has requested PDN connectivity the UE shall forward the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message to the ESM sublayer. Upon receipt of an indication from the ESM sublayer that the default EPS bearer context has been activated, the UE shall send an ATTACH COMPLETE message together with an ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message contained in the ESM message container information element to the network.

Additionally, the UE shall reset the attach attempt counter, enter state EMM-REGISTERED, and set the EPS update status to EU1 UPDATED.

If EMM-REGISTERED without PDN connection is supported by the UE and the MME, and the UE receives the ATTACH ACCEPT message combined with an ESM DUMMY MESSAGE, the UE shall send an ATTACH COMPLETE message together with an ESM DUMMY MESSAGE contained in the ESM message container information element to the network.

If the UE receives the ATTACH ACCEPT message from a PLMN for which a PLMN-specific attempt counter or PLMN-specific PS-attempt counter is maintained (see clause  5.3.7b), then the UE shall reset these counters. If the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", then the UE shall reset this counter.

When the UE receives any ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST messages during the attach procedure, and if the UE has requested PDN connectivity the UE shall forward the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message(s) to the ESM sublayer. The UE shall send a response to the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message(s) after successful completion of the attach procedure.

If the attach procedure was initiated in S101 mode, the lower layers are informed about the successful completion of the procedure.

Upon receiving an ATTACH COMPLETE message, the MME shall stop timer T3450, enter state EMM-REGISTERED and consider the GUTI sent in the ATTACH ACCEPT message as valid.

If the T3448 value IE is present in the received ATTACH ACCEPT message, the UE shall:

-  stop timer T3448 if it is running; and

-  start timer T3448 with the value provided in the T3448 value IE.

If the UE is using EPS services with control plane CIoT EPS optimization, the T3448 value IE is present in the ATTACH ACCEPT message and the value indicates that this timer is either zero or deactivated, the UE shall consider this case as an abnormal case and proceed as if the T3448 value IE is not present.

If the UE has indicated "service gap control supported" in the ATTACH REQUEST message and:

-  the ATTACH ACCEPT message contains the T3447 value IE, then the UE shall store the new T3447 value, erase any previous stored T3447 value if exists and use the new T3447 value with the T3447 timer next time it is started; or

-  the ATTACH ACCEPT message does not contain the T3447 value IE, then the UE shall erase any previous stored T3447 value if exists and stop the T3447 timer if running.

In WB-S1 mode, if the UE has set the RACS bit to "RACS supported" in the UE network capability IE of the ATTACH REQUEST message, the MME may include a UE radio capability ID IE or a UE radio capability ID deletion indication IE in the ATTACH ACCEPT message.

In WB-S1 mode, if the UE has set the RACS bit to "RACS supported" in the UE network capability IE of the ATTACH REQUEST message and the ATTACH ACCEPT message includes:

-  a UE radio capability ID deletion indication IE set to "Network-assigned UE radio capability IDs deletion requested", the UE shall delete any network-assigned UE radio capability IDs associated with the registered PLMN stored at the UE, then the UE shall, after the completion of the ongoing attach procedure, initiate a tracking area updating procedure as specified in clause  5.5.3 over the existing NAS signalling connection; and

-  a UE radio capability ID IE, the UE shall store the UE radio capability ID as specified in annex  C.

If the UE receives the Forbidden TAI(s) for the list of "forbidden tracking areas for roaming" IE in the ATTACH ACCEPT message and the TAI(s) included in the IE is not part of the list of "forbidden tracking areas for roaming", the UE shall store the TAI(s) included in the IE into the list of "forbidden tracking areas for roaming".

If the UE receives the Forbidden TAI(s) for the list of "forbidden tracking areas for regional provision of service" IE in the ATTACH ACCEPT message and the TAI(s) included in the IE is not part of the list of "forbidden tracking areas for regional provision of service", the UE shall store the TAI(s) included in the IE into the list of "forbidden tracking areas for regional provision of service".

5.5.1.2.4A  Attach successful for EPS services and not accepted for SMS services

Apart from the actions on the tracking area updating attempt counter, the description for attach for EPS services as specified in clause  5.5.1.2.4 shall be followed. In addition, the following description for attach for SMS services applies.

In NB-S1 mode, if the UE requested "SMS only" in the Additional update type IE and supports NB-S1 mode only, the MME decides to accept the attach request for EPS services only and:

-  the location update for non-EPS services is not accepted by the VLR as specified in 3GPP  S  29.118  [16A]; or

-  the MME decides to not accept the attach request for "SMS only",

the MME shall set the EPS attach result IE to "EPS only", shall not indicate "SMS only" in the Additional update result IE in the ATTACH ACCEPT message and shall include an appropriate SMS services status value.

The UE receiving the ATTACH ACCEPT message takes one of the following actions depending on the value included in the SMS services status IE:

"SMS services not available"

  The UE shall stop timer T3410 if still running, shall reset the tracking area updating attempt counter, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE. The USIM shall be considered as invalid for SMS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in clause  5.3.7a.

"SMS services not available in this PLMN"

  The UE shall stop timer T3410 if still running, shall reset the tracking area updating attempt counter, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE.

  The UE may provide a notification to the user or the upper layers that the SMS services are not available.

  The UE shall not attempt normal attach or tracking area updating procedures indicating "SMS only" with current PLMN until switching off the UE or the UICC containing the USIM is removed. Additionally, the UE may perform a PLMN selection according to 3GPP  S  23.122  [6].

"Network failure"

  The UE shall stop timer T3410 if still running. The tracking area updating attempt counter shall be incremented, unless it was already set to 5.

  If the tracking area updating attempt counter is less than 5:

-  the UE shall start timer T3411, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE. When timer T3411 expires the normal tracking area updating procedure for EPS services and "SMS only" or the combined tracking area updating procedure for EPS services and "SMS only" is triggered.

  If the tracking area updating attempt counter is equal to 5:

-  the UE shall start timer T3402, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE. When timer T3402 expires the normal tracking area updating procedure for EPS services and "SMS only" or the combined tracking area updating procedure for EPS services and "SMS only" is triggered.

"Congestion"

  The UE shall stop the timer T3410 if still running. The tracking area updating attempt counter shall be set to  5. The UE shall start the timer T3402, shall set the EPS update status to EU1 UPDATED, and shall enter state EMM-REGISTERED.NORMAL-SERVICE. When timer T3402 expires the normal tracking area updating procedure for EPS services and "SMS only" or the combined tracking area updating procedure for EPS services and "SMS only" is triggered.

Other values are considered as abnormal cases. The attach procedure shall be considered as failed for SMS services. The behaviour of the UE in those cases is specified in clause  5.5.1.2.6A.

5.5.1.2.5  Attach not accepted by the network

If the attach request cannot be accepted by the network, the MME shall send an ATTACH REJECT message to the UE including an appropriate EMM cause value.

If EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the attach request included a PDN CONNECTIVITY REQUEST message, the attach procedure fails due to:

-  a default EPS bearer setup failure;

-  an ESM procedure failure; or

-  operator determined barring is applied on default EPS bearer context activation during attach procedure,

the MME shall:

-  combine the ATTACH REJECT message with a PDN CONNECTIVITY REJECT message contained in the ESM message container information element. In this case the EMM cause value in the ATTACH REJECT message shall be set to #19 "ESM failure"; or

-  send the ATTACH REJECT message with the EMM cause set to #15 "No suitable cells in tracking area", if the PDN connectivity reject is due to ESM cause #29 subject to operator policies (see 3GPP  S  29.274  [16D] for further details). In this case, the network may additionally include the Extended EMM cause IE with value "E-UTRAN not allowed".

If the attach request is rejected due to NAS level mobility management congestion control, the network shall set the EMM cause value to #22 "congestion" and assign a value for back-off timer T3346.

In NB-S1 mode, if the attach request is rejected due to operator determined barring (see 3GPP  S  29.272  [16C]), the network shall set the EMM cause value to #22 "congestion" and assign a value for back-off timer T3346.

If the attach request is rejected due to service gap control as specified in clause  5.3.17 i.e. the T3447 timer is running, the network shall set the EMM cause value to #22 "congestion" and may assign a back-off timer T3346 with the remaining time of the running T3447 timer.

If the attach request is rejected due to incompatibility between the CIoT EPS optimizations supported by the UE and what the network supports and the network sets the EMM cause value to #15 "no suitable cells in tracking area", the network may additionally include the Extended EMM cause IE with value "requested EPS optimization not supported".

NOTE  1:  How the UE uses the Extended EMM cause IE with value "requested EPS optimization not supported" is implementation specific. The UE still behaves according to the EMM cause value #15.

Based on operator policy, if the attach request is rejected due to core network redirection for CIoT optimizations, the network shall set the EMM cause value to #31 "Redirection to 5GCN required".

NOTE  2:  The network can take into account the UE   's N1 mode capability, the 5GS CIoT network behaviour supported by the UE or the 5GS CIoT network behaviour supported by the 5GCN to determine the rejection with the EMM cause value #31 "Redirection to 5GCN required".

In NB-S1 mode or WB-S1 mode via satellite E-UTRAN access, if the attach request is from a UE via a satellite E-UTRA cell and the network using the User Location Information provided by the eNodeB (see 3GPP  S  36.413  [23]), is able to determine that the UE is in a location where the network is not allowed to operate, the network shall set the EMM cause value in the ATTACH REJECT message to #78 "PLMN not allowed to operate at the present UE location".

Upon receiving the ATTACH REJECT message, if the message is integrity protected or contains a reject cause other than EMM cause value #25, the UE shall stop timer T3410.

If the ATTACH REJECT message with EMM cause #25 was received without integrity protection, then the UE shall discard the message.

Regardless of the EMM cause value received in the ATTACH REJECT message,

-  if the UE receives the Forbidden TAI(s) for the list of "forbidden tracking areas for roaming" IE in the ATTACH REJECT message, the UE shall store the TAI(s) included in the IE, if not already stored, into the list of "forbidden tracking areas for roaming" and remove the TAI(s) from the stored TAI list if present; and

-  if the UE receives the Forbidden TAI(s) for the list of "forbidden tracking areas for regional provision of service" IE in the ATTACH REJECT message, the UE shall store the TAI(s) included in the IE, if not already stored, into the list of "forbidden tracking areas for regional provision of service" and remove the TAI(s) from the stored TAI list if present.

Furthermore, the UE shall take the following actions depending on the EMM cause value received in the ATTACH REJECT message.

#3  (Illegal UE);

#6  (Illegal ME); or

#8  (EPS services and non-EPS services not allowed);

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall consider the USIM as invalid for EPS services and non-EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in clause  5.3.7a. Additionally, the UE shall delete the list of equivalent PLMNs and enter state EMM-DEREGISTERED.NO-IMSI. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", then the UE shall set this counter to UE implementation-specific maximum value. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.

  If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the MM parameters update status, TMSI, LAI and ciphering key sequence number, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP  S  24.008  [13] for the case when the normal attach procedure is rejected with the GMM cause with the same value.

  For the EMM cause value #3 or #6, if the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP  S  24.501  [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.

  For the EMM cause value #8, if the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.

NOTE  3:  The possibility to configure a UE so that the radio transceiver for a specific RAT is not active, although it is implemented in the UE, is out of scope of the present specification.

#7  (EPS services not allowed);

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall consider the USIM as invalid for EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in clause  5.3.7a. Additionally, the UE shall enter state EMM-DEREGISTERED. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.

  If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP  S  24.008  [13] for the case when the normal attach procedure is rejected with the GMM cause with the same value.

  If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP  S  24.501  [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.

#11  (PLMN not allowed); or

#35  (Requested service option not authorized in this PLMN);

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. Additionally, the UE shall delete the list of equivalent PLMNs and reset the attach attempt counter.

  In S1 mode, the UE shall store the PLMN identity in the "forbidden PLMN list" and enter state EMM-DEREGISTERED.PLMN-SEARCH and if the UE is configured to use timer T3245 (see 3GPP  S  24.368  [15] or 3GPP  S  31.102  [17]) then the UE shall start timer T3245 and proceed as described in clause  5.3.7a. The UE shall perform a PLMN selection according to 3GPP  S  23.122  [6]. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.

  In S101 mode, the UE shall store the PLMN identity provided with the indication from the lower layers to prepare for an S101 mode to S1 mode handover in the list of "forbidden PLMNs for attach in S101 mode" and enter the state EMM-DEREGISTERED.NO-CELL-AVAILABLE and if the UE is configured to use timer T3245 (see 3GPP  S  24.368  [15A] or 3GPP  S  31.102  [17]) then the UE shall start timer T3245 and proceed as described in clause  5.3.7a.

  If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and location update attempt counter, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP  S  24.008  [13] for the case when the normal attach procedure is rejected with the GMM cause value #11and no RR connection exists.

  For the EMM cause value #11, if the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list, ngKSI and registration attempt counter as specified in 3GPP  S  24.501  [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.

  For the EMM cause value #35, if the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. Additionally, the UE shall reset the registration attempt counter.

#12  (Tracking area not allowed);

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. Additionally, the UE shall reset the attach attempt counter.

  In S1 mode, the UE shall store the current TAI in the list of "forbidden tracking areas for regional provision of service" and enter the state EMM-DEREGISTERED.LIMITED-SERVICE. If the ATTACH REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of "forbidden tracking areas for regional provision of service" for non-integrity protected NAS reject message.

  In S101 mode, the UE shall store the PLMN identity provided with the indication from the lower layers to prepare for an S101 mode to S1 mode handover in the list of "forbidden PLMNs for attach in S101 mode" and enter the state EMM-DEREGISTERED.NO-CELL-AVAILABLE and if the UE is configured to use timer T3245 (see 3GPP  S  24.368  [15A] or 3GPP  S  31.102  [17]) then the UE shall start timer T3245 and proceed as described in clause  5.3.7a.

  If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP  S  24.008  [13] for the case when the normal attach procedure is rejected with the GMM cause with the same value.

  If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list, ngKSI and registration attempt counter as specified in 3GPP  S  24.501  [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.

#13  (Roaming not allowed in this tracking area);

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall delete the list of equivalent PLMNs and reset the attach attempt counter.

  In S1 mode, the UE shall store the current TAI in the list of "forbidden tracking areas for roaming". If the ATTACH REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of "forbidden tracking areas for roaming" for non-integrity protected NAS reject message. Additionally, the UE shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE or optionally EMM-DEREGISTERED.PLMN-SEARCH. If the UE is registered in N1 mode and operating in dual-registration mode, the PLMN that the UE chooses to register in is specified in 3GPP  S  24.501  [54] clause  4.8.3. Otherwise the UE shall perform a PLMN selection according to 3GPP  S  23.122  [6].

  In S101 mode, the UE shall store the PLMN identity provided with the indication from the lower layers to prepare for an S101 mode to S1 mode handover in the list of "forbidden PLMNs for attach in S101 mode" and enter the state EMM-DEREGISTERED.NO-CELL-AVAILABLE and if the UE is configured to use timer T3245 (see 3GPP  S  24.368  [15A] or 3GPP  S  31.102  [17]) then the UE shall start timer T3245 and proceed as described in clause  5.3.7a.

  If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP  S  24.008  [13] for the case when the normal attach procedure is rejected with the GMM cause with the same value.

  If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list, ngKSI and registration attempt counter as specified in 3GPP  S  24.501  [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.

#14  (EPS services not allowed in this PLMN);

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. Additionally, the UE shall delete the list of equivalent PLMNs and reset the attach attempt counter.

  In S1 mode, the UE shall store the PLMN identity in the "forbidden PLMNs for GPRS service" list. Additionally, the UE shall enter state EMM-DEREGISTERED.PLMN-SEARCH and if the UE is configured to use timer T3245 (see 3GPP  S  24.368  [15A] or 3GPP  S  31.102  [17]) then the UE shall start timer T3245 and proceed as described in clause  5.3.7a. The UE shall perform a PLMN selection according to 3GPP  S  23.122  [6]. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific PS-attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.

  In S101 mode, the UE shall store the PLMN identity provided with the indication from the lower layers to prepare for an S101 mode to S1 mode handover in the list of "forbidden PLMNs for attach in S101 mode" and enter the state EMM-DEREGISTERED.NO-CELL-AVAILABLE and if the UE is configured to use timer T3245 (see 3GPP  S  24.368  [15A] or 3GPP  S  31.102  [17]) then the UE shall start timer T3245 and proceed as described in clause  5.3.7a.

  If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP  S  24.008  [13] for the case when the normal attach procedure is rejected with the GMM cause with the same value.

  If the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. Additionally, the UE shall reset the registration attempt counter.

#15  (No suitable cells in tracking area);

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. Additionally, the UE shall reset the attach attempt counter.

  The UE shall store the current TAI in the list of "forbidden tracking areas for roaming". If the ATTACH REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of "forbidden tracking areas for roaming" for non-integrity protected NAS reject message. Additionally, the UE shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE and:

-  if the UE is in WB-S1 mode and the Extended EMM cause IE with value "E-UTRAN not allowed" is included in the ATTACH REJECT message, the UE supports "E-UTRA Disabling for EMM cause #15", and the "E-UTRA Disabling Allowed for EMM cause #15" parameter as specified in 3GPP  S  24.368  [15A] or 3GPP  S  31.102  [17] is present and set to enabled; then the UE shall disable the E-UTRA capability as specified in clause  4.5 and search for a suitable cell in GERAN, UTRAN or NG-RAN radio access technology;

-  if the UE is in NB-S1 mode and the Extended EMM cause IE with value "NB-IoT not allowed" is included in the ATTACH REJECT message, then the UE may disable the NB-IoT capability as specified in clause  4.9 and search for a suitable cell in E-UTRAN radio access technology;

-  otherwise, the UE shall search for a suitable cell in another tracking area or in another location area according to 3GPP  S  36.304  [21].

  In S101 mode, the UE shall store the PLMN identity provided with the indication from the lower layers to prepare for an S101 mode to S1 mode handover in the list of "forbidden PLMNs for attach in S101 mode" and enter the state EMM-DEREGISTERED.NO-CELL-AVAILABLE and if the UE is configured to use timer T3245 (see 3GPP  S  24.368  [15A] or 3GPP  S  31.102  [17]) then the UE shall start timer T3245 and proceed as described in clause  5.3.7a.

  If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP  S  24.008  [13] for the case when the normal attach procedure is rejected with the GMM cause with the same value.

  If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list, ngKSI and registration attempt counter as specified in 3GPP  S  24.501  [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.

#22  (Congestion);

  If the T3346 value IE is present in the ATTACH REJECT message and the value indicates that this timer is neither zero nor deactivated, the UE shall proceed as described below; otherwise it shall be considered as an abnormal case and the behaviour of the UE for this case is specified in clause  5.5.1.2.6.

  The UE shall abort the attach procedure, reset the attach attempt counter, set the EPS update status to EU2 NOT UPDATED and enter state EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH.

  The UE shall stop timer T3346 if it is running.

  If the ATTACH REJECT message is integrity protected, the UE shall start timer T3346 with the value provided in the T3346 value IE.

  If the ATTACH REJECT message is not integrity protected, the UE shall start timer T3346 with a random value from the default range specified in 3GPP  S  24.008  [13].

  The UE stays in the current serving cell and applies the normal cell reselection process. The attach procedure is started if still needed when timer T3346 expires or is stopped.

  If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status and GPRS attach attempt counter as specified in 3GPP  S  24.008  [13] for the case when the normal attach procedure is rejected with the GMM cause with the same value.

  If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status and registration attempt counter as specified in 3GPP  S  24.501  [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.

#25  (Not authorized for this CSG);

  EMM cause #25 is only applicable when received from a CSG cell. EMM cause #25 received from a non-CSG cell is considered as an abnormal case and the behaviour of the UE is specified in clause  5.5.1.2.6.

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and store it according to clause  5.1.3.3). Additionally, the UE shall reset the attach attempt counter and shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE.

  If the CSG ID and associated PLMN identity of the cell where the UE has sent the ATTACH REQUEST message are contained in the Allowed CSG list, the UE shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.

  If the CSG ID and associated PLMN identity of the cell where the UE has sent the ATTACH REQUEST message are contained in the Operator CSG list, the UE shall apply the procedures defined in 3GPP  S  23.122  [6] clause  3.1A.

  The UE shall search for a suitable cell according to 3GPP  S  36.304  [21].

  If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status and GPRS attach attempt counter as specified in 3GPP  S  24.008  [13] for the case when the normal attach procedure is rejected with the GMM cause with the same value.

  If the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED and set the 5GS update status to 5U3 ROAMING NOT ALLOWED and reset the registration attempt counter.

#31  (Redirection to 5GCN required);

  EMM cause #31 received by a UE that has not indicated support for CIoT optimizations or not indicated support for N1 mode is considered as an abnormal case and the behaviour of the UE is specified in clause  5.5.1.2.6.

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. Additionally, the UE shall reset the attach attempt counter.

  The UE shall enable N1 mode capability for 3GPP access if it was disabled and disable the E-UTRA capability (see clause  4.5) and enter state EMM-DEREGISTERED.NO-CELL-AVAILABLE.

  If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list, ngKSI and registration attempt counter as specified in 3GPP  S  24.501  [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.

#42  (Severe network failure);

  The UE shall set the EPS update status to EU2 NOT UPDATED, and shall delete any GUTI, last visited registered TAI, TAI list, eKSI, and list of equivalent PLMNs, and set the attach attempt counter to 5. The UE shall start an implementation specific timer setting its value to 2 times the value of T as defined in 3GPP  S  23.122  [6]. While this timer is running, the UE shall not consider the PLMN + RAT combination that provided this reject cause a candidate for PLMN selection. The UE then enters state EMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP  S  23.122  [6].

  If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition set the GMM state to GMM-DEREGISTERED, GPRS update status to GU2 NOT UPDATED, and shall delete the P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number.

  If the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U2 NOT UPDATED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.

#78  (PLMN not allowed to operate at the present UE location).

  This cause value received from a non-satellite E-UTRA cell is considered as an abnormal case and the behaviour of the UE is specified in clause  5.5.1.2.6.

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. Additionally, the UE shall reset the registration attempt counter and shall enter state EMM-DEREGISTERED.PLMN-SEARCH and perform a PLMN selection according to 3GPP  S  23.122  [6].

  If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status and registration attempt counter as specified in 3GPP  S  24.501  [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.

Editor   's note:  [IoT_SAT_ARCH_EPS, CR#3620]. It is FFS how to prevent the UE from making repeated attempts at selecting the same satellite access PLMN if there are no other available PLMNs at UE   's location.

Other values are considered as abnormal cases. The behaviour of the UE in those cases is specified in clause  5.5.1.2.6.

5.5.1.2.5A  Attach for emergency bearer services not accepted by the network

If the attach request for emergency bearer services cannot be accepted by the network, the MME shall send an ATTACH REJECT message to the UE including EMM cause #5 "IMEI not accepted" or one of the EMM cause values as described in clause  5.5.1.2.5.

NOTE  1:  If EMM cause #11 is sent to a UE of a roaming subscriber attaching for emergency bearer services and the UE is in automatic network selection mode, it cannot obtain normal service provided by this PLMN.

Upon receiving the ATTACH REJECT message including EMM cause #5, the UE shall enter the state EMM-DEREGISTERED.NO-IMSI.

Upon receiving the ATTACH REJECT message including one of the other EMM cause values, the UE shall perform the actions as described in clause  5.5.1.2.5 with the following addition: the UE shall inform the upper layers of the failure of the procedure.

NOTE  2:  This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain), or other implementation specific mechanisms, e.g. procedures specified in 3GPP  S  24.229  [13D] can result in the emergency call being attempted to another IP-CAN.

If the attach request for emergency bearer services fails due to abnormal case a) in clause  5.5.1.2.6, the UE shall perform the actions as described in clause  5.5.1.2.6 and inform the upper layers of the failure to access the network.

NOTE  3:  This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain), or other implementation specific mechanisms, e.g. procedures specified in 3GPP  S  24.229  [13D] can result in the emergency call being attempted to another IP-CAN.

If the attach request for emergency bearer services fails due to abnormal cases b), c) or d) in clause  5.5.1.2.6, the UE shall perform the actions as described in clause  5.5.1.2.6 with the following addition: the UE shall inform the upper layers of the failure of the procedure.

NOTE  4:  This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain), or other implementation specific mechanisms, e.g. procedures specified in 3GPP  S  24.229  [13D] can result in the emergency call being attempted to another IP-CAN.

In a shared network, upon receiving the ATTACH REJECT message, the UE shall perform the actions as described in clause  5.5.1.2.5, and shall:

a)  inform the upper layers of the failure of the procedure; or

NOTE  5:  This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain), or other implementation specific mechanisms, e.g. procedures specified in 3GPP  S  24.229  [13D] can result in the emergency call being attempted to another IP-CAN .

b)  attempt to perform a PLMN selection in the shared network and, if an attach for emergency bearer services was not already attempted with the selected PLMN and the ATTACH REQUEST message:

-  did not include a PDN CONNECTIVITY REQUEST message with request type set to "handover of emergency bearer services", initiate an attach for emergency bearer services to the selected PLMN; or

-  did include a PDN CONNECTIVITY REQUEST message with request type set to "handover of emergency bearer services" and:

i)  the selected PLMN is an equivalent PLMN, initiate an attach for emergency bearer services to the selected PLMN; and

ii)  the selected PLMN is not an equivalent PLMN, perform a PLMN selection and initiate an attach for emergency bearer services to the selected PLMN if an attach for emergency bearer services was not already attempted with the selected PLMN.



In a shared network, if the attach request for emergency bearer services fails due to abnormal case a) in clause  5.5.1.2.6, the UE shall perform the actions as described in clause  5.5.1.2.6 and shall:

a)  inform the upper layers of the failure to access the network; or

NOTE  6:  This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain), or other implementation specific mechanisms, e.g. procedures specified in 3GPP  S  24.229  [13D] can result in the emergency call being attempted to another IP-CAN .

b)  attempt to perform a PLMN selection in the shared network and, if an attach for emergency bearer services was not already attempted with the selected PLMN and the ATTACH REQUEST message:

-  did not include a PDN CONNECTIVITY REQUEST message with request type set to "handover of emergency bearer services", initiate an attach for emergency bearer services to the selected PLMN; or

-  did include a PDN CONNECTIVITY REQUEST message with request type set to "handover of emergency bearer services" and:

i)  the selected PLMN is an equivalent PLMN, initiate an attach for emergency bearer services to the selected PLMN; and

ii)  the selected PLMN is not an equivalent PLMN, perform a PLMN selection and initiate an attach for emergency bearer services to the selected PLMN if an attach for emergency bearer services was not already attempted with the selected PLMN.

In a shared network, if the attach request for emergency bearer services fails due to abnormal cases b), c) or d) in clause  5.5.1.2.6, the UE shall perform the actions as described in clause  5.5.1.2.6, and shall:

a)  inform the upper layers of the failure of the procedure; or

NOTE  7:  This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain), or other implementation specific mechanisms, e.g. procedures specified in 3GPP  S  24.229  [13D] can result in the emergency call being attempted to another IP-CAN .

b)  attempt to perform a PLMN selection in the shared network and, if an attach for emergency bearer services was not already attempted with the selected PLMN and the ATTACH REQUEST message

-  did not include a PDN CONNECTIVITY REQUEST message with request type set to "handover of emergency bearer services", initiate an attach for emergency bearer services to the selected PLMN; or

-  did include a PDN CONNECTIVITY REQUEST message with request type set to "handover of emergency bearer services" and:

i)  the selected PLMN is an equivalent PLMN, initiate an attach for emergency bearer services to the selected PLMN; and

ii)  the selected PLMN is not an equivalent PLMN, perform a PLMN selection and initiate an attach for emergency bearer services to the selected PLMN if an attach for emergency bearer services was not already attempted with the selected PLMN.

5.5.1.2.5B  Attach for initiating a PDN connection for emergency bearer services not accepted by the network

If the network cannot accept an attach request with attach type not set to "EPS emergency attach" and including a PDN CONNECTIVITY REQUEST message with request type set to "emergency", the UE shall perform the procedures as described in clause  5.5.1.2.5. Then if the UE is in the same selected PLMN where the last attach request was attempted, the UE shall:

a)  inform the upper layers of the failure of the procedure; or

NOTE  1:  This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP  S  24.229  [13D] can result in the emergency call being attempted to another IP-CAN.

b)  attempt EPS attach for emergency bearer services including the PDN CONNECTIVITY REQUEST message.

If the network cannot accept an attach request with attach type not set to "EPS emergency attach" and including a PDN CONNECTIVITY REQUEST message with request type set to "handover of emergency bearer services", the UE shall perform the procedures as described in clause  5.5.1.2.5. Then if the UE is in the same selected PLMN or equivalent PLMN where the last attach request was attempted, the UE shall attempt EPS attach for emergency bearer services including the PDN CONNECTIVITY REQUEST message.

If the attach request with attach type not set to "EPS emergency attach" for initiating a PDN connection for emergency bearer services fails due to abnormal case a) in clause  5.5.1.2.6, the UE shall perform the actions as described in clause  5.5.1.2.6 and inform the upper layers of the failure to access the network.

NOTE  2:  This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP  S  24.229  [13D] can result in the emergency call being attempted to another IP-CAN.

If the attach request with attach type not set to "EPS emergency attach" and including a PDN CONNECTIVITY REQUEST message with request type set to "emergency" fails due to abnormal cases b), c) or d) in clause  5.5.1.2.6, the UE shall perform the procedures as described in clause  5.5.1.2.6. Then if the UE is in the same selected PLMN where the last attach request was attempted, the UE shall:

a)  inform the upper layers of the failure of the procedure; or

NOTE  3:  This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP  S  24.229  [13D] can result in the emergency call being attempted to another IP-CAN.

b)  attempt EPS attach for emergency bearer services including the PDN CONNECTIVITY REQUEST message.

If the attach request with attach type not set to "EPS emergency attach" and including a PDN CONNECTIVITY REQUEST message with request type set to "handover of emergency bearer services" fails due to abnormal cases b), c), d) or o) in clause  5.5.1.2.6, the UE shall perform the procedures as described in clause  5.5.1.2.6. Then if the UE is in the same selected PLMN or equivalent PLMN where the last attach request was attempted, the UE shall attempt EPS attach for emergency bearer services including the PDN CONNECTIVITY REQUEST message.

5.5.1.2.5B1  Attach by a UE transferring an emergency PDU session using a standalone PDN CONNECTIVITY REQUEST message

If the network cannot accept attach request including a PDN CONNECTIVITY REQUEST message with request type set to "handover" and the UE also intends to transfer an emergency PDU session, the UE shall attempt EPS attach for emergency bearer services including a PDN CONNECTIVITY REQUEST message with request type set to "handover of emergency bearer services" for the emergency PDU session.

If the attach request, including a PDN CONNECTIVITY REQUEST message with request type set "handover", fails due to abnormal case a) in clause  5.5.1.2.6 and the UE intends to transfer an emergency PDU session, the UE shall attempt EPS attach including a PDN CONNECTIVITY REQUEST message with request type set to "handover of emergency bearer services" for the emergency PDU session.

If the attach request including a PDN CONNECTIVITY REQUEST message with request type set "handover" fails due to abnormal cases b), c), d) or o) in clause  5.5.1.2.6, the UE intends to transfer an emergency PDU session:

-  if an EMM cause set to #19 "ESM failure" is received, the UE shall attempt EPS attach; and

-  otherwise, the UE shall attempt EPS attach for emergency bearer services,

with the ATTACH REQUEST message including a PDN CONNECTIVITY REQUEST message with request type set to "handover of emergency bearer services" for the emergency PDU session.

5.5.1.2.5C  Attach for access to RLOS not accepted by the network

If the attach request for access to RLOS is received by the network and the UE requesting attach is not in limited service state, the MME shall reject the UE   's attach request.

If the attach request for access to RLOS cannot be accepted by the network, the MME shall send an ATTACH REJECT message to the UE including EMM cause #35 "Requested service option not authorized in this PLMN" or one of the EMM cause values as described in clause  5.5.1.2.5.

Upon receiving the ATTACH REJECT message including EMM cause #35, the UE shall enter the state EMM-DEREGISTERED.PLMN-SEARCH and perform a PLMN selection according to 3GPP  S  23.122  [6] to attempt EPS attach for access to RLOS via another PLMN.

Upon receiving the ATTACH REJECT message including one of the other EMM cause values, the UE shall perform the actions as described in clause  5.5.1.2.5. along with the following conditions:

a)  if the action for the reject involves searching for a suitable cell in E-UTRAN radio access technology, the UE shall proceed with the action and shall attempt to attach for access to RLOS in the new tracking area, if found; and

b)  if the action for the reject involves attempting to select GERAN or UTRAN radio access technology or disabling the E-UTRA capability, the UE shall skip the action for as long as access to RLOS is still needed.

NOTE:  How long the UE attempts to access RLOS is up to UE implementation.

Then if the UE is in the same selected PLMN where the last attach procedure was attempted and rejected and if timer T3346 is not running, perform a PLMN selection according to 3GPP  S  23.122  [6] to attempt EPS attach for access to RLOS via another PLMN.

If the attach request for access to RLOS fails due to abnormal cases b), c) or d) in clause  5.5.1.2.6, the UE shall perform the procedures as described in clause  5.5.1.2.6 with the exception that the UE shall skip actions that involve attempting to select GERAN or UTRAN radio access technology and actions that involve disabling the E-UTRA capability, for as long as access to RLOS is still needed.

5.5.1.2.6  Abnormal cases in the UE

The following abnormal cases can be identified:

a)  Access barred because of access class barring, EAB, ACDC or NAS signalling connection establishment rejected by the network without "Extended wait time" received from lower layers

  In WB-S1 mode, if access is barred for "originating signalling" (see 3GPP  S  36.331  [22]), the attach procedure shall not be started. The UE stays in the current serving cell and applies the normal cell reselection process. The attach procedure is started as soon as possible, i.e. when access for "originating signalling" is granted on the current cell or when the UE moves to a cell where access for "originating signalling" is granted.

  In NB-S1 mode, if access is barred for "originating signalling" (see 3GPP  S  36.331  [22]), the attach procedure shall not be started. The UE stays in the current serving cell and applies the normal cell reselection process. Further UE behaviour is implementation specific, e.g. the attach procedure is started again after an implementation dependent time.

  In NB-S1 mode, if access is barred for "originating signalling" (see 3GPP  S  36.331  [22]), a request for an exceptional event is received from the upper layers, then the attach procedure shall be started.

NOTE  1:  In NB-S1 mode, the EMM layer cannot receive the access barring alleviation indication from the lower layers (see 3GPP  S  36.331  [22]).

  If access is barred because of access class barring for "originating signalling" (see 3GPP  S  36.331  [22]), ACDC is applicable to the request from the upper layers and the UE supports ACDC, then the attach procedure shall be started.

  If access is barred for a certain ACDC category (see 3GPP  S  36.331  [22]), a request with a higher ACDC category is received from the upper layers and the UE supports ACDC, then the attach procedure shall be started.

  If an access request for an uncategorized application is barred due to ACDC (see 3GPP  S  36.331  [22]), a request with a certain ACDC category is received from the upper layers and the UE supports ACDC, then the attach procedure shall be started.

aa)  Lower layer failure to establish the RRC connection and:

-  the UE is in its HPLMN or in an EHPLMN (if the EHPLMN list is present);

-  the attach request is neither for emergency bearer services nor for initiating a PDN connection for emergency bearer services with attach type not set to "EPS emergency attach";

-  the UE supports being configured with CustomLLFailureRetry as specified in 3GPP  S  24.368  [15A]); and

-  CustomLLFailureRetry leaf is present as specified in 3GPP  S  24.368  [15A]);

  The UE shall abort the attach procedure and wait for a UE implementation specific timer which shall be set to MinRetryTimer or MaxRetryTimer as specified in 3GPP  S  24.368  [15A]. The UE shall not set the UE implementation specific timer to MinRetryTimer for more than MaxMinRetry consecutive attempts as specified in 3GPP  S  24.368  [15A]. After the expiration of the UE implementation specific timer, the UE shall restart the attach procedure, if still needed.

b)  Lower layer failure not covered in case aa) or release of the NAS signalling connection without "Extended wait time" and without "Extended wait time CP data" received from lower layers before the ATTACH ACCEPT or ATTACH REJECT message is received

  The attach procedure shall be aborted, and the UE shall proceed as described below.

c)  T3410 timeout

  The UE shall abort the attach procedure. The NAS signalling connection, if any, shall be released locally.

NOTE  2:  The NAS signalling connection can also be released if the UE deems that the network has failed the authentication check as specified in clause  5.4.2.7.

  The UE shall proceed as described below.

d)  ATTACH REJECT, other EMM cause values than those treated in clause  5.5.1.2.5, and cases of EMM cause values #22, #25, #31 and #78, if considered as abnormal cases according to clause  5.5.1.2.5

  Upon reception of the EMM cause #19 "ESM failure", if the UE is not configured for NAS signalling low priority and the ESM cause value received in the PDN CONNECTIVITY REJECT message is not #54 "PDN connection does not exist", the UE may set the attach attempt counter to 5. Subsequently, if the UE needs to retransmit the ATTACH REQUEST message to request PDN connectivity towards a different APN, the UE may stop T3411 or T3402, if running, and send the ATTACH REQUEST message. If the UE needs to attempt EPS attach to request transfer of a PDN connection for emergency bearer services by including a PDN CONNECTIVITY REQUEST message with request type set to "handover of emergency bearer services", the UE shall stop T3411 or T3402, if running, and send the ATTACH REQUEST message.

NOTE  3:  When receiving EMM cause #19 "ESM failure", coordination is required between the EMM and ESM sublayers in the UE to determine whether to set the attach attempt counter to 5.

  If the attach request is neither for emergency bearer services nor for initiating a PDN connection for emergency bearer services with attach type not set to "EPS emergency attach", upon reception of the EMM causes #95, #96, #97, #99 and #111 the UE should set the attach attempt counter to 5.

  The UE shall proceed as described below.

e)  Change of cell into a new tracking area

  If a cell change into a new tracking area occurs before the attach procedure is completed, the attach procedure shall be aborted and re-initiated immediately. If a tracking area border is crossed when the ATTACH ACCEPT message has been received but before an ATTACH COMPLETE message is sent, the attach procedure shall be re-initiated. If a GUTI was allocated during the attach procedure, this GUTI shall be used in the attach procedure.

f)  Mobile originated detach required

  The attach procedure shall be aborted, and the UE initiated detach procedure shall be performed.

g)  Detach procedure collision

  If the UE receives a DETACH REQUEST message from the network in state EMM-REGISTERED-INITIATED and the detach type indicates "re-attach not required" and no EMM cause IE, or "re-attach not required" and the EMM cause value is not #2 "IMSI unknown in HSS", the detach procedure shall be progressed and the attach procedure shall be aborted. If the UE receives a DETACH REQUEST message from the network in state EMM-REGISTERED-INITIATED and the detach type indicates "re-attach required", the detach procedure shall be progressed and the UE shall locally release the NAS signalling connection, before re-initiating the attach procedure. Otherwise the attach procedure shall be progressed and the DETACH REQUEST message shall be ignored.

h)  Transmission failure of ATTACH REQUEST message indication from lower layers

  The UE shall restart the attach procedure immediately.

i)  Transmission failure of ATTACH COMPLETE message indication from lower layers

  If the current TAI is not in the TAI list, the UE shall restart the attach procedure.

  If the current TAI is still in the TAI list, it is up to the UE implementation how to re-run the ongoing procedure. The EMM sublayer notifies the ESM sublayer that the ESM message in the ESM message container IE of the ATTACH COMPLETE has failed to be transmitted.

j)  If EMM-REGISTERED without PDN connection is not supported by the UE or the MME, and the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message combined with the ATTACH ACCEPT is not accepted by the UE due to failure in the UE ESM sublayer, then the UE shall initiate the detach procedure by sending a DETACH REQUEST message to the network. Further UE behaviour is implementation specific.

  If EMM-REGISTERED without PDN connection is supported by the UE and the MME, and the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message combined with the ATTACH ACCEPT is not accepted by the UE due to failure in the UE ESM sublayer, then the UE shall either send an ATTACH COMPLETE message together with an ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT contained in the ESM message container information element to the network or initiate the detach procedure by sending a DETACH REQUEST message. Further UE behaviour is implementation specific.

k)  Indication from the lower layers that an S101 mode to S1 mode handover has been cancelled (S101 mode only)

  The UE shall abort the attach procedure and enter state EMM-DEREGISTERED.NO-CELL-AVAILABLE.

l)  "Extended wait time" from the lower layers

  If the ATTACH REQUEST message contained the low priority indicator set to "MS is configured for NAS signalling low priority", the UE shall start timer T3346 with the "Extended wait time" value and reset the attach attempt counter.

  If the ATTACH REQUEST message did not contain the low priority indicator set to "MS is configured for NAS signalling low priority", the UE is operating in NB-S1 mode and the UE is not a UE configured to use AC11        15 in selected PLMN, then the UE shall start timer T3346 with the "Extended wait time" value and reset the attach attempt counter.

  In other cases the UE shall ignore the "Extended wait time".

  The UE shall abort the attach procedure, stay in the current serving cell, change the state to EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH and apply the normal cell reselection process.

  The UE shall proceed as described below.

la)  "Extended wait time CP data" from the lower layers

  If the UE is operating in NB-S1 mode, the UE shall start the timer T3346 with the "Extended wait time CP data" value and reset the attach attempt counter.

  In other cases the UE shall ignore the "Extended wait time CP data".

  The UE shall abort the attach procedure, stay in the current serving cell, change the state to EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH and apply the normal cell reselection process.

  The UE shall proceed as described below.

m)  Timer T3346 is running

  The UE shall not start the attach procedure unless:

-  the UE is a UE configured to use AC11        15 in selected PLMN;

-  the UE needs to attach for emergency bearer services;

-  the UE in NB-S1 mode is requested by the upper layer to transmit user data related to an exceptional event and

i)  the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP  S  24.368  [15A] or the USIM file EFNASCONFIG in 3GPP  S  31.102  [17]); and

ii)  timer T3346 was not started when NAS signalling connection was established with RRC establishment cause set to "MO exception data"; or

-  the UE needs to attach without the NAS signalling low priority indication and if the timer T3346 was started due to rejection of a NAS request message (e.g. ATTACH REQUEST, TRACKING AREA UPDATE REQUEST or EXTENDED SERVICE REQUEST) which contained the low priority indicator set to "MS is configured for NAS signalling low priority".

  The UE stays in the current serving cell and applies the normal cell reselection process.

NOTE  4:  It is considered an abnormal case if the UE needs to initiate an attach procedure while timer T3346 is running independent on whether timer T3346 was started due to an abnormal case or a non successful case.

  The UE shall proceed as described below.

n)  If EMM-REGISTERED without PDN connection is supported by the UE and the MME, an ESM DUMMY MESSAGE is included in the ESM message container information element of the ATTACH REQUEST message and the UE receives the ATTACH ACCEPT message combined with a PDN CONNECTIVITY REJECT message, the UE shall send an ATTACH COMPLETE message together with an ESM DUMMY MESSAGE contained in the ESM message container information element to the network. Further UE behaviour is implementation specific.

o)  Timer T3447 is running

  The UE shall not start the attach procedure unless:

-  the UE is a UE configured to use AC11        15 in selected PLMN;

-  the UE attempts to attach for emergency bearer services; or

-  the UE attempts to attach without PDN connection request.

  The UE stays in the current serving cell and applies the normal cell reselection process. The attach request procedure is started, if still necessary, when timer T3447 expires.

For the cases b, c, d, l, la and m:

-  Timer T3410 shall be stopped if still running.

-  For the cases b, c, d, l when the "Extended wait time" is ignored, and la when the "Extended wait time CP data" is ignored, if the attach request is neither for emergency bearer services nor for initiating a PDN connection for emergency bearer services with attach type not set to "EPS emergency attach", the attach attempt counter shall be incremented, unless it was already set to 5.

-  If the attach attempt counter is less than 5:

-  for the cases l, la and m, the attach procedure is started, if still necessary, when timer T3346 expires or is stopped;

-  for the cases b, c, d, l when the "Extended wait time" is ignored, and la when the "Extended wait time CP data" is ignore, if the attach request is neither for emergency bearer services nor for initiating a PDN connection for emergency bearer services with attach type not set to "EPS emergency attach", timer T3411 is started and the state is changed to EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH. When timer T3411 expires the attach procedure shall be restarted, if still required by ESM sublayer.

-  If the attach attempt counter is equal to 5:

-  the UE shall delete any GUTI, TAI list, last visited registered TAI, list of equivalent PLMNs and KSI, shall set the update status to EU2 NOT UPDATED, and shall start timer T3402. The state is changed to EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH or optionally to EMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP  S  23.122  [6]; and

-  if A/Gb mode, Iu mode or N1 mode is supported by the UE:

-  if A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP  S  24.008  [13] for the abnormal case when a normal attach procedure fails and the attach attempt counter is equal to 5;

-  if the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP  S  24.501  [54] for the abnormal case when an initial registration procedure performed over 3GPP access fails and the registration attempt counter is equal to 5; and

-  the UE shall attempt to select GERAN, UTRAN or NG-RAN radio access technology and proceed with appropriate GMM or 5GMM specific procedures. Additionally, if the UE selects GERAN or UTRAN radio access technology, the UE may disable the E-UTRA capability as specified in clause  4.5. If No E-UTRA Disabling In 5GS is enabled at the UE (see 3GPP  S  24.368  [50] or 3GPP  S  31.102  [17]) and the UE selects NG-RAN radio access technology, it shall not disable the E-UTRA capability; otherwise, the UE may disable the E-UTRA capability as specified in clause  4.5.

NOTE  5:  Whether the UE requests RRC to treat the active E-UTRA cell as barred (see 3GPP  S  36.304  [21]) is left to the UE implementation.

5.5.1.2.6A  Abnormal cases in the UE, SMS services not accepted

The UE shall proceed as follows:

1)  if the attach was successful for EPS services only and the ATTACH ACCEPT message contained a value included in the SMS services status IE not treated in clause  5.5.1.2.4A, the UE shall proceed as follows:

a)  The UE shall stop timer T3410 if still running. The tracking area updating attempt counter shall be incremented, unless it was already set to 5;

b)  If the tracking area updating attempt counter is less than 5:

-  the UE shall start timer T3411, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE. When timer T3411 expires the normal tracking area updating procedure for EPS services and "SMS only" or the combined tracking area updating procedure for EPS services and "SMS only" is triggered;

c)  If the tracking area updating attempt counter is equal to 5:

-  the UE shall start timer T3402, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE. When timer T3402 expires the normal tracking area updating procedure for EPS services and "SMS only" or the combined tracking area updating procedure for EPS services and "SMS only" is triggered; and

2)  otherwise, the abnormal cases specified in clause  5.5.1.2.6 apply.

5.5.1.2.7  Abnormal cases on the network side

The following abnormal cases can be identified:

a)  Lower layer failure

  If a lower layer failure occurs before the message ATTACH COMPLETE has been received from the UE, the network shall locally abort the attach procedure, enter state EMM-DEREGISTERED and shall not resend the message ATTACH ACCEPT. If a new GUTI was assigned to the UE in the attach procedure, the MME shall consider both the old and the new GUTI as valid until the old GUTI can be considered as invalid by the network or the EMM context which has been marked as detached in the network is released.

  If the old GUTI was allocated by an MME other than the current MME, the current MME does not need to retain the old GUTI. If the old GUTI is used by the UE in a subsequent attach message, the network may use the identification procedure to request the UE   's IMSI.

b)  Protocol error

  If the ATTACH REQUEST message is received with a protocol error, the network shall return an ATTACH REJECT message with one of the following EMM cause values:

  #96:  invalid mandatory information;

  #99:  information element non-existent or not implemented;

  #100:  conditional IE error; or

  #111:  protocol error, unspecified.

c)  T3450 time-out

  On the first expiry of the timer, the network shall retransmit the ATTACH ACCEPT message and shall reset and restart timer T3450.

  This retransmission is repeated four times, i.e. on the fifth expiry of timer T3450, the attach procedure shall be aborted and the MME enters state EMM-DEREGISTERED. If a new GUTI was allocated in the ATTACH ACCEPT message, the network shall consider both the old and the new GUTI as valid until the old GUTI can be considered as invalid by the network or the EMM context which has been marked as detached in the network is released. If the old GUTI was allocated by an MME other than the current MME, the current MME does not need to retain the old GUTI.

  If the old GUTI is used by the UE in a subsequent attach message, the network acts as specified for case  a above.

d)  ATTACH REQUEST received after the ATTACH ACCEPT message has been sent and before the ATTACH COMPLETE message is received

-  If one or more of the information elements in the ATTACH REQUEST message differ from the ones received within the previous ATTACH REQUEST message, the previously initiated attach procedure shall be aborted if the ATTACH COMPLETE message has not been received and the new attach procedure shall be progressed; or

-  if the information elements do not differ, then the ATTACH ACCEPT message shall be resent and the timer T3450 shall be restarted if an ATTACH COMPLETE message is expected. In that case, the retransmission counter related to T3450 is not incremented.

e)  More than one ATTACH REQUEST received and no ATTACH ACCEPT or ATTACH REJECT message has been sent

-  If one or more of the information elements in the ATTACH REQUEST message differs from the ones received within the previous ATTACH REQUEST message, the previously initiated attach procedure shall be aborted and the new attach procedure shall be executed;

-  if the information elements do not differ, then the network shall continue with the previous attach procedure and shall ignore the second ATTACH REQUEST message.

f)  ATTACH REQUEST received in state EMM-REGISTERED

  If an ATTACH REQUEST message is received in state EMM-REGISTERED the network may initiate the EMM common procedures; if it turned out that the ATTACH REQUEST message was sent by a genuine UE that has already been attached, the EMM context, EPS bearer contexts, if any, are deleted and the new ATTACH REQUEST is progressed.

NOTE  1:  The network can determine that the UE is genuine by executing the authentication procedure as described in clause  5.4.2.

g)  TRACKING AREA UPDATE REQUEST message received before ATTACH COMPLETE message.

  Timer T3450 shall be stopped. The allocated GUTI in the attach procedure shall be considered as valid and the tracking area updating procedure shall be rejected with the EMM cause #10 "implicitly detached" as described in clause  5.5.3.2.5.

h)  DETACH REQUEST message received before ATTACH COMPLETE message.

  The network shall abort the attach procedure and shall progress the detach procedure as described in clause  5.5.2.2.

i)  If EMM-REGISTERED without PDN connection is supported by the UE and the MME, the MME receives an ATTACH REQUEST message with an ESM message included in the ESM message container information element, and the ESM sublayer in the MME detects a message error according to clause  7, the MME may decide to proceed with the attach procedure or to reject it. When sending the ATTACH ACCEPT or ATTACH REJECT message to the UE, the MME shall include the ESM message provide by the ESM layer in the ESM message container information element.

j)  UE security capabilities invalid or unacceptable

  If the ATTACH REQUEST message is received with invalid or unacceptable UE security capabilities (e.g. no EPS encryption algorithms (all bits zero), no EPS integrity algorithms (all bits zero), mandatory EPS encryption algorithms not supported or mandatory EPS integrity algorithms not supported, etc.), the MME shall return an ATTACH REJECT message.

NOTE  2:  EMM cause value to be used in ATTACH REJECT message is up to the network implementation.

5.5.1.3  Combined attach procedure for EPS services and non-EPS services (S1  mode only)

5.5.1.3.1  General

The combined attach procedure is used by a UE in CS/PS mode 1 or CS/PS mode 2 of operation to attach for both EPS and non-EPS services, or both EPS services and "SMS only".

The combined attach procedure is also used by a UE in CS/PS mode 1 or CS/PS mode 2 of operation to attach for EPS services if it is already IMSI attached for non-EPS services.

When the UE initiates a combined attach procedure, the UE shall indicate "combined EPS/IMSI attach" in the EPS attach type IE.

The combined attach procedure follows the attach procedure for EPS described in clause  5.5.1.2 with exception of clause  5.5.1.2.4A and clause  5.5.1.2.6A.

5.5.1.3.2  Combined attach procedure initiation

If the UE is in EMM state EMM-DEREGISTERED, the UE initiates the combined attach procedure by sending an ATTACH REQUEST message to the network, starting timer T3410 and entering state EMM-REGISTERED-INITIATED (see example in figure  5.5.1.2.2.1).

The UE shall include the TMSI status IE if no valid TMSI is available. Furthermore, if the UE has stored a valid location area identification, the UE shall include it in the Old location area identification IE in the ATTACH REQUEST message.

If the UE has stored a valid TMSI, the UE shall include the TMSI based NRI container IE in the ATTACH REQUEST message.

If the UE initiates a combined attach procedure for EPS services and "SMS only", the UE shall indicate "SMS only" in the Additional update type IE.

5.5.1.3.3  EMM common procedure initiation

The network may initiate EMM common procedures, e.g. the identification, authentication and security mode control procedures, depending on the received information such as IMSI, GUTI and KSI.

5.5.1.3.4  Combined attach accepted by the network

5.5.1.3.4.1  General

Depending on the value of the EPS attach result IE received in the ATTACH ACCEPT message, the following different cases can be distinguished:

1)  The EPS attach result IE value indicates "combined EPS/IMSI attach": attach for EPS and non-EPS services, or for EPS services and "SMS only" have been successful.

2)  The EPS attach result IE value indicates "EPS only": attach for EPS services has been successful but attach for non-EPS services or "SMS only" has failed.

5.5.1.3.4.2  Combined attach successful

The description for attach for EPS services as specified in clause  5.5.1.2.4 shall be followed. In addition, the following description for attach for non-EPS services or "SMS only" applies.

The TMSI reallocation may be part of the combined attach procedure. The TMSI allocated is then included in the ATTACH ACCEPT message, together with the location area identification (LAI). In this case the MME shall start timer T3450 as described in clause  5.4.1.4, and enter state EMM-COMMON-PROCEDURE-INITIATED. If the MME does not indicate "SMS only" in the ATTACH ACCEPT message, subject to operator policies the MME should allocate a TAI list that does not span more than one location area.

For a shared network in CS domain, the MME indicates the selected PLMN for CS domain in the LAI to the UE as specified in 3GPP  S  23.272  [9].

The UE, receiving an ATTACH ACCEPT message, stores the received location area identification, stops timer T3410, resets the location update attempt counter and sets the update status to U1 UPDATED. If the message contains an IMSI, the UE is not allocated any TMSI, and shall delete any TMSI accordingly. If the message contains a TMSI, the UE shall use this TMSI as the new temporary identity. The UE shall delete its old TMSI and shall store the new TMSI. If neither a TMSI nor an IMSI has been included by the network in the ATTACH ACCEPT message, the old TMSI, if any available, shall be kept.

If the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services" events (see clause  5.3.7b), then the UE shall reset this counter.

If the UE requested "SMS only" in the Additional update type IE, or if the UE requested a combined attach for EPS and non-EPS services, but the network decides to accept the attach request for EPS services and "SMS only", the network shall indicate "SMS only" in the Additional update result IE. In addition, if the SMS services are provided via SMS in MME, the network shall provide a non-broadcast LAI in the ATTACH ACCEPT message. If a TMSI has to be allocated, then the network shall also provide a TMSI value which cannot cause any ambiguity with assigned TMSI values.

If the ATTACH ACCEPT message includes the Additional update result IE with value "SMS only", a UE operating in CS/PS mode 2 and a UE operating in CS/PS mode 1 with "IMS voice available" shall not attempt to use CS fallback for mobile originating services.

As an implementation option, if the ATTACH ACCEPT message does not include the Additional update result IE with value "SMS only" and the UE is not configured for NAS signalling low priority then the UE may stop timer T3246 if running.

If the ATTACH ACCEPT message includes the Additional update result IE with value "CS Fallback not preferred", this indicates to a UE operating in CS/PS mode 2 and a UE operating in CS/PS mode 1 with "IMS voice available" that it is attached for EPS and non-EPS services and that it can use CS fallback.

If the LAI contained in the ATTACH ACCEPT message is a member of the list of "forbidden location areas for regional provision of service" or the list of "forbidden location areas for roaming" then such entry shall be deleted.

If the PLMN identity for the CS domain which is provided as part of the LAI contained in the ATTACH ACCEPT message differs from the PLMN identity provided as part of the GUTI, the MME shall include the PLMN identity for the CS domain in the list of equivalent PLMNs in the ATTACH ACCEPT message.

The UE, when having requested PDN connectivity as contained in the ATTACH REQUEST and on receiving the ATTACH ACCEPT message combined with the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, shall send an ATTACH COMPLETE message combined with an ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message to the network.

Upon transmission of the ATTACH COMPLETE message the UE shall enter state EMM-REGISTERED and MM state MM-IDLE and set the EPS update status to EU1 UPDATED.

If the ATTACH ACCEPT message includes the Additional update result IE with value "SMS only" or "CS Fallback not preferred", a UE operating in CS/PS mode 1 with "IMS voice not available" shall attempt to select GERAN or UTRAN radio access technology and disable the E-UTRA capability (see clause  4.5).

Upon receiving an ATTACH COMPLETE message, the MME shall stop timer T3450, enter state EMM-REGISTERED.

NOTE:  Upon receiving an ATTACH COMPLETE message, the MME sends an SGsAP-TMSI-REALLOCATION-COMPLETE message as specified in 3GPP  S  29.118  [16A].

After the UE performs intersystem change from N1 mode to S1 mode, if:

-  the network supports SRVCC for IMS emergency sessions (see 3GPP  S  23.216  [8]);

-  the UE has an emergency PDN connection;

-  the UE has set the SRVCC to GERAN/UTRAN capability bit in the MS network capability IE to "SRVCC from UTRAN HSPA or E-UTRAN to GERAN/UTRAN supported; and

-  the MME has neither an IMEI nor an IMEISV for the UE;

then the MME shall initiate the identification procedure (see clause  5.4.4) or the security mode control procedure (see clause  5.4.3) with the UE.

5.5.1.3.4.3  Combined attach successful for EPS services only

Apart from the actions on the tracking area updating attempt counter, the description for attach for EPS services as specified in clause  5.5.1.2.4 shall be followed. In addition, the following description for attach for non-EPS services applies.

If, due to emergency services fallback (see 3GPP  S  23.502  [59], clause  4.13.4), there is

a request for emergency services pending and the emergency bearer services indicator in the EPS network feature support IE indicates "emergency bearer services in S1 mode not supported",

then the UE shall skip the requirements defined below in the present clause for the receipt of an ATTACH ACCEPT message including an EMM cause value, attempt to select GERAN or UTRAN radio access technology, select a setup message as defined in clause  5.3.7, proceed with appropriate MM specific procedures, and send the setup message.

The UE receiving the ATTACH ACCEPT message takes one of the following actions depending on the EMM cause value:

#2  (IMSI unknown in HSS)

  The UE shall stop T3410 if still running and shall reset the tracking area updating attempt counter. The UE shall set the update status to U3 ROAMING NOT ALLOWED and shall delete any TMSI, LAI and ciphering key sequence number. The UE shall enter state EMM-REGISTERED.NORMAL-SERVICE. The new MM state is MM IDLE. The USIM shall be considered as invalid for non-EPS services until the UE is switched off, the UICC containing the USIM is removed or the timer T3245 expires as described in clause  5.3.7a. If the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.

  If, due to emergency services fallback (see 3GPP  S  23.502  [59]), there is a request for CS fallback call pending (see clause  5.3.7), the UE shall attempt to select GERAN or UTRAN radio access technology and attempt emergency call setup.

  A UE operating in CS/PS mode 1 of operation with "IMS voice not available" shall disable the E-UTRA capability (see clause  4.5).

#16  (MSC temporarily not reachable); or

#17  (Network failure)

  The UE shall stop timer T3410 if still running, and shall enter state MM IDLE. The tracking area updating attempt counter shall be incremented, unless it was already set to 5.

  If the tracking area updating attempt counter is less than 5:

-  the UE shall start timer T3411, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. When timer T3411 expires the combined tracking area updating procedure indicating "combined TA/LA updating with IMSI attach" is triggered.

  If the tracking area updating attempt counter is equal to 5:

-  a UE operating in CS/PS mode 2 of operation and a UE operating in CS/PS mode 1 of operation with "IMS voice available" shall start timer T3402, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. When timer T3402 expires the combined tracking area updating procedure indicating "combined TA/LA updating with IMSI attach" is triggered;

-  a UE operating in CS/PS mode 1 of operation with "IMS voice not available" shall attempt to select GERAN or UTRAN radio access technology and proceed with appropriate MM or GMM specific procedures and disable the E-UTRA capability (see clause  4.5).

#18  (CS domain not available)

  The UE shall stop timer T3410 if still running, shall reset the tracking area updating attempt counter, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE.

  The UE shall enter state MM IDLE and shall set the update status to U2 NOT UPDATED.

  A UE in CS/PS mode 1 of operation with "IMS voice not available" shall attempt to select GERAN or UTRAN radio access technology and disable the E-UTRA capability (see clause  4.5).

  A UE in CS/PS mode 2 of operation and a UE operating in CS/PS mode 1 of operation with "IMS voice available" may provide a notification to the user or the upper layers that the CS domain is not available.

  The UE shall not attempt combined attach or combined tracking area updating procedures with current PLMN until switching off the UE or the UICC containing the USIM is removed.

#22  (Congestion)

  The UE shall stop the timer T3410 if still running. The tracking area updating attempt counter shall be set to  5. The UE shall start the timer T3402, shall set the EPS update status to EU1 UPDATED, shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM, and shall enter state MM IDLE.

Other EMM cause values and the case that no EMM cause IE was received are considered as abnormal cases. The combined attach procedure shall be considered as failed for non-EPS services. The behaviour of the UE in those cases is specified in clause  5.5.1.3.6.

5.5.1.3.5  Combined attach not accepted by the network

If the attach request can neither be accepted by the network for EPS nor for non-EPS services, the MME shall send an ATTACH REJECT message to the UE including an appropriate EMM cause value. If EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the attach request included a PDN CONNECTIVITY REQUEST message, and the attach procedure fails due to a default EPS bearer setup failure, an ESM procedure failure or operator determined barring, the MME shall:

-  combine the ATTACH REJECT message with a PDN CONNECTIVITY REJECT message contained in the ESM message container information element. In this case the EMM cause value in the ATTACH REJECT message shall be set to #19, "ESM failure"; or

-  send the ATTACH REJECT message with the EMM cause set to #15 "No suitable cells in tracking area", if the PDN connectivity reject is due to ESM cause #29 subject to operator policies (see 3GPP  S  29.274  [16D] for further details). In this case, the network may additionally include the Extended EMM cause IE with value "E-UTRAN not allowed".

If the attach request is rejected due to NAS level mobility management congestion control, the network shall set the EMM cause value to #22 "congestion" and assign a back-off timer T3346.

If the attach request is rejected due to service gap control as specified in clause  5.3.17 i.e. the T3447 timer is running, the network shall set the EMM cause value to #22 "congestion" and may assign a back-off timer T3346 with the remaining time of the running T3447 timer.

Based on operator policy, if the attach request is rejected due to core network redirection for CIoT optimizations, the network shall set the EMM cause value to #31 "Redirection to 5GCN required".

NOTE  1:  The network can take into account the UE   's N1 mode capability, the 5GS CIoT network behaviour supported by the UE or the 5GS CIoT network behaviour supported by the 5GCN to determine the rejection with the EMM cause value #31 "Redirection to 5GCN required".

Upon receiving the ATTACH REJECT message, if the message is integrity protected or contains a reject cause other than EMM cause value #25, the UE shall stop timer T3410 and enter MM state MM IDLE.

If the ATTACH REJECT message with EMM cause #25 was received without integrity protection, then the UE shall discard the message.

The UE shall take the following actions depending on the EMM cause value received in the ATTACH REJECT message.

#3  (Illegal UE);

#6  (Illegal ME); or

#8  (EPS services and non-EPS services not allowed);

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI.

  The UE shall consider the USIM as invalid for EPS and non-EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in clause  5.3.7a. Additionally, the UE shall delete the list of equivalent PLMNs and shall enter the state EMM-DEREGISTERED.NO-IMSI. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", then the UE shall set this counter to UE implementation-specific maximum value. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.

  If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the MM parameters update status, TMSI, LAI and ciphering key sequence number, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP  S  24.008  [13] for the case when the combined attach procedure is rejected with the GMM cause with the same value.

  For the EMM cause value #3 or #6, if the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP  S  24.501  [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.

  For the EMM cause value #8, if the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.

#7  (EPS services not allowed);

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall consider the USIM as invalid for EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in clause  5.3.7a. Additionally, the UE shall enter the state EMM-DEREGISTERED. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.

  A UE which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services and shall set the update status to U2 NOT UPDATED.

  The UE shall attempt to select GERAN or UTRAN radio access technology and shall proceed with the appropriate MM specific procedure according to the MM service state. The UE shall not reselect E-UTRAN radio access technology until switching off or the UICC containing the USIM is removed.

  If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP  S  24.008  [13] for the case when the combined attach procedure is rejected with the GMM cause with the same value.

  If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP  S  24.501  [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.

#11  (PLMN not allowed); or

#35  (Requested service option not authorized in this PLMN);

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI, and reset the attach attempt counter. The UE shall delete the list of equivalent PLMNs and enter the state EMM-DEREGISTERED.PLMN-SEARCH.

  The UE shall store the PLMN identity in the "forbidden PLMN list" and if the UE is configured to use timer T3245 (see 3GPP  S  24.368  [15A] or 3GPP  S  31.102  [17]) then the UE shall start timer T3245 and proceed as described in clause  5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.

  The UE shall perform a PLMN selection according to 3GPP  S  23.122  [6].

  If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and location update attempt counter, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP  S  24.008  [13] for the case when the combined attach procedure is rejected with the GMM cause value #11 and no RR connection exists.

  For the EMM cause value #11, if the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list, ngKSI and registration attempt counter as specified in 3GPP  S  24.501  [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.

  For the EMM cause value #35, if the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. Additionally, the UE shall reset the registration attempt counter.

#12  (Tracking area not allowed);

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall reset the attach attempt counter and enter the state EMM-DEREGISTERED.LIMITED-SERVICE.

  The UE shall store the current TAI in the list of "forbidden tracking areas for regional provision of service". If the ATTACH REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of "forbidden tracking areas for regional provision of service" for non-integrity protected NAS reject message.

  If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and location update attempt counter, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP  S  24.008  [13] for the case when the combined attach procedure is rejected with the GMM cause with the same value.

  If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list, ngKSI and registration attempt counter as specified in 3GPP  S  24.501  [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.

#13  (Roaming not allowed in this tracking area);

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall delete the list of equivalent PLMNs and reset the attach attempt counter. Additionally the UE enter the state EMM-DEREGISTERED.LIMITED-SERVICE or optionally EMM-DEREGISTERED.PLMN-SEARCH.

  The UE shall store the current TAI in the list of "forbidden tracking areas for roaming". If the ATTACH REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of "forbidden tracking areas for roaming" for non-integrity protected NAS reject message.

  If the UE is registered in N1 mode and operating in dual-registration mode, the PLMN that the UE chooses to register in is specified in 3GPP  S  24.501  [54] clause  4.8.3. Otherwise the UE shall perform a PLMN selection according to 3GPP  S  23.122  [6].

  If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and location update attempt counter, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP  S  24.008  [13] for the case when the combined attach procedure is rejected with the GMM cause with the same value.

  If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list, ngKSI and registration attempt counter as specified in 3GPP  S  24.501  [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.

#14  (EPS services not allowed in this PLMN);

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. Additionally the UE shall reset the attach attempt counter and enter the state EMM-DEREGISTERED.PLMN-SEARCH.

  The UE shall store the PLMN identity in the "forbidden PLMNs for GPRS service" list and if the UE is configured to use timer T3245 (see 3GPP  S  24.368  [15A] or 3GPP  S  31.102  [17]) then the UE shall start timer T3245 and proceed as described in clause  5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific PS-attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.

  A UE operating in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services and shall set the update status to U2 NOT UPDATED.

  A UE operating in CS/PS mode 1 of operation and supporting A/Gb or Iu mode may select GERAN or UTRAN radio access technology and proceed with the appropriate MM specific procedure according to the MM service state. In this case, the UE shall disable the E-UTRA capability (see clause  4.5).

  A UE operating in CS/PS mode 1 of operation and supporting A/Gb or Iu mode may perform a PLMN selection according to 3GPP  S  23.122  [6].

  A UE operating in CS/PS mode 1 of operation and supporting S1 mode only, or operating in CS/PS mode 2 of operation shall delete the list of equivalent PLMNs and shall perform a PLMN selection according to 3GPP  S  23.122  [6].

  If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP  S  24.008  [13] for the case when the combined attach procedure is rejected with the GMM cause with the same value.

  If the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. Additionally, the UE shall reset the registration attempt counter.

#15  (No suitable cells in tracking area);

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. Additionally the UE shall reset the attach attempt counter and enter the state EMM-DEREGISTERED.LIMITED-SERVICE.

  The UE shall store the current TAI in the list of "forbidden tracking areas for roaming". If the ATTACH REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of "forbidden tracking areas for roaming" for non-integrity protected NAS reject message. Additionally, the UE shall proceed as follows:

-  if the UE is in WB-S1 mode and the Extended EMM cause IE with value "E-UTRAN not allowed" is included in the ATTACH REJECT message, the UE supports "E-UTRA Disabling for EMM cause #15", and the "E-UTRA Disabling Allowed for EMM cause #15" parameter as specified in 3GPP  S  24.368  [15A] or 3GPP  S  31.102  [17] is present and set to enabled, then the UE shall disable the E-UTRA capability as specified in clause  4.5 and search for a suitable cell in another location area or 5GS tracking area;

-  if the UE is in NB-S1 mode and the Extended EMM cause IE with value "NB-IoT not allowed" is included in the ATTACH REJECT message, then the UE may disable the NB-IoT capability as specified in clause  4.9 and search for a suitable cell in E-UTRAN radio access technology;

-  otherwise, the UE shall search for a suitable cell in another tracking area or in another location area according to 3GPP  S  36.304  [21].

  If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and location update attempt counter, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP  S  24.008  [13] for the case when the combined attach procedure is rejected with the GMM cause with the same value.

  If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list, ngKSI and registration attempt counter as specified in 3GPP  S  24.501  [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.

#22  (Congestion);

  If the T3346 value IE is present in the ATTACH REJECT message and the value indicates that this timer is neither zero nor deactivated, the UE shall proceed as described below; otherwise it shall be considered as an abnormal case and the behaviour of the UE for this case is specified in clause  5.5.1.3.6.

  The UE shall abort the attach procedure, reset the attach attempt counter, set the EPS update status to EU2 NOT UPDATED and enter state EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH.

  The UE shall stop timer T3346 if it is running.

  If the ATTACH REJECT message is integrity protected, the UE shall start timer T3346 with the value provided in the T3346 value IE.

  If the ATTACH REJECT message is not integrity protected, the UE shall start timer T3346 with a random value from the default range specified in 3GPP  S  24.008  [13].

  The UE stays in the current serving cell and applies the normal cell reselection process. The attach procedure is started if still needed when timer T3346 expires or is stopped.

  If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status and GPRS attach attempt counter as specified in 3GPP  S  24.008  [13] for the case when the combined attach procedure is rejected with the GMM cause with the same value.

  If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status and registration attempt counter as specified in 3GPP  S  24.501  [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.

#25  (Not authorized for this CSG);

  EMM cause #25 is only applicable when received from a CSG cell. EMM cause #25 received from a non-CSG cell is considered as an abnormal case and the behaviour of the UE is specified in clause  5.5.1.3.6.

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and store it according to clause  5.1.3.3). Additionally, the UE shall reset the attach attempt counter and shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE.

  If the CSG ID and associated PLMN identity of the cell where the UE has sent the ATTACH REQUEST message are contained in the Allowed CSG list, the UE shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.

  If the CSG ID and associated PLMN identity of the cell where the UE has sent the ATTACH REQUEST message are contained in the Operator CSG list, the UE shall apply the procedures defined in 3GPP  S  23.122  [6] clause  3.1A.

  The UE shall search for a suitable cell according to 3GPP  S  36.304  [21].

  If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the MM parameters update status and location update attempt counter, and GMM parameters GMM state, GPRS update status and GPRS attach attempt counter as specified in 3GPP  S  24.008  [13] for the case when the combined attach procedure is rejected with the GMM cause with the same value.

  If the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED and set the 5GS update status to 5U3 ROAMING NOT ALLOWED and reset the registration attempt counter.

#31  (Redirection to 5GCN required);

  EMM cause #31 received by a UE that has not indicated support for CIoT optimizations or not indicated support for N1 mode is considered as an abnormal case and the behaviour of the UE is specified in clause  5.5.1.3.6.

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. Additionally, the UE shall reset the attach attempt counter.

  The UE shall enable N1 mode capability for 3GPP access if it was disabled and disable the E-UTRA capability (see clause  4.5) and enter state EMM-DEREGISTERED.NO-CELL-AVAILABLE.

  If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list, ngKSI and registration attempt counter as specified in 3GPP  S  24.501  [54] for the case when the initial registration procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.

#42  (Severe network failure);

  The UE shall set the EPS update status to EU2 NOT UPDATED, and shall delete any GUTI, last visited registered TAI, TAI list, eKSI, and list of equivalent PLMNs, and set the attach attempt counter to 5. The UE shall start an implementation specific timer, setting its value to 2 times the value of T as defined in 3GPP  S  23.122  [6]. While this timer is running, the UE shall not consider the PLMN + RAT combination that provided this reject cause as a candidate for PLMN selection. The UE then enters state EMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP  S  23.122  [6].

  If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition set the GMM state to GMM-DEREGISTERED, GPRS update status to GU2 NOT UPDATED signature, RAI and GPRS ciphering key sequence number TMSI and ciphering key sequence number.

  If the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U2 NOT UPDATED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.

Other values are considered as abnormal cases. The behaviour of the UE in those cases is specified in clause  5.5.1.3.6.

5.5.1.3.6  Abnormal cases in the UE

The UE shall proceed as follows:

1)  if the UE requested the combined attach for EPS services and "SMS only" and the ATTACH ACCEPT message indicates a combined attach successful for EPS and non-EPS services, the UE shall behave as if the combined attach was successful for EPS services and "SMS only";

NOTE:  In this case the UE can ignore the CS SERVICE NOTIFICATION message or the Paging with CN domain indicator set to "CS", as specified in clause  5.6.2.3.2.

2)  if the combined attach was successful for EPS services only and the ATTACH ACCEPT message contained an EMM cause value not treated in clause  5.5.1.3.4.3 or the EMM cause IE is not included in the message, the UE shall proceed as follows:

a)  The UE shall stop timer T3410 if still running, and shall enter state MM IDLE. The tracking area updating attempt counter shall be incremented, unless it was already set to 5;

b)  If the tracking area updating attempt counter is less than 5:

-  the UE shall start timer T3411, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. When timer T3411 expires the combined tracking area updating procedure indicating "combined TA/LA updating with IMSI attach" is triggered;

c)  If the tracking area updating attempt counter is equal to 5:

-  a UE operating in CS/PS mode 2 of operation and a UE operating in CS/PS mode 1 of operation with "IMS voice available" shall start timer T3402, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. When timer T3402 expires the combined tracking area updating procedure indicating "combined TA/LA updating with IMSI attach" is triggered; and

-  a UE operating in CS/PS mode 1 of operation with "IMS voice not available" shall attempt to select GERAN, UTRAN or NG-RAN radio access technology and proceed with appropriate MM, GMM or 5GMM specific procedures. If the UE selects GERAN or UTRAN radio access technology, the UE may disable the E-UTRA capability (see clause  4.5). If No E-UTRA Disabling In 5GS is enabled at the UE (see 3GPP  S  24.368  [50] or 3GPP  S  31.102  [17]) and the UE selects NG-RAN radio access technology, it shall not disable the E-UTRA capability; otherwise, the UE may disable the E-UTRA capability as specified in clause  4.5; and

NOTE  2:  Whether the UE requests RRC to treat the active E-UTRA cell as barred (see 3GPP  S  36.304  [21]) is left to the UE implementation.

d)  If there is a CS fallback emergency call pending or CS fallback call pending, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures; otherwise the EMM sublayer shall indicate the abort of the EMM procedure to the MM sublayer; and

3)  otherwise, the abnormal cases specified in clause  5.5.1.2.6 apply with the following modification.

  If the attach attempt counter is incremented according to clause  5.5.1.2.6 the next actions depend on the value of the attach attempt counter:

-  if the attach attempt counter is less than 5, the UE shall set the update status to U2 NOT UPDATED but shall not delete any LAI, TMSI, ciphering key sequence number and list of equivalent PLMNs; or

-  if the attach attempt counter is equal to 5, then the UE shall delete any LAI, TMSI, ciphering key sequence number and list of equivalent PLMNs and set the update status to U2 NOT UPDATED.

-  The UE shall attempt to select GERAN, UTRAN or NG-RAN radio access technology and proceed with appropriate MM, GMM or 5GMM specific procedures. Additionally, if the UE selects GERAN or UTRAN radio access technology, the UE may disable the E-UTRA capability as specified in clause  4.5. If No E-UTRA Disabling In 5GS is enabled at the UE (see 3GPP  S  24.368  [50] or 3GPP  S  31.102  [17]) and the UE selects NG-RAN radio access technology, it shall not disable the E-UTRA capability; otherwise, the UE may disable the E-UTRA capability as specified in clause  4.5.

NOTE  3:  Whether the UE requests RRC to treat the active E-UTRA cell as barred (see 3GPP  S  36.304  [21]) is left to the UE implementation.

  If there is a CS fallback emergency call pending or CS fallback call pending, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures; otherwise the EMM sublayer shall indicate the abort of the EMM procedure to the MM sublayer.

5.5.1.3.7  Abnormal cases on the network side

The abnormal cases specified in clause  5.5.1.2.7 apply.

5.5.2  Detach procedure

5.5.2.1  General

The detach procedure is used:

-  by the UE to detach for EPS services only;

-  by the UE to disconnect from the last remaining PDN it is connected to if EMM-REGISTERED without PDN connection is not supported by the UE or the MME;

-  by the UE in CS/PS mode 1 or CS/PS mode 2 of operation to detach for both EPS services and non-EPS services or for non-EPS services only via a combined detach procedure;

-  by the network to inform the UE that it is detached for EPS services or non-EPS services or both;

-  by the network to disconnect the UE from the last remaining PDN to which it is connected if EMM-REGISTERED without PDN connection is not supported by the UE or the MME; and

-  by the network to inform the UE to re-attach to the network and re-establish all PDN connections.

NOTE  1:  After a successful completion of an inter-system change of the UE from S1 mode to non-3GPP access, if the non-3GPP network provides PDN connectivity to the same EPC and EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the MME performs a local detach of the UE.

NOTE  2:  If EMM-REGISTERED without PDN connection is supported by the UE and the MME, the detach procedure is not triggered when disconnecting the UE from the last remaining PDN to which it is connected.

The detach procedure also applies to the UE which is IMSI attached for "SMS only".

The detach procedure with appropriate detach type shall be invoked by the UE if the UE is switched off, the USIM card is removed from the UE, the UE wishes to detach for EPS services, the UE wishes to detach for non-EPS services or as part of the eCall inactivity procedure defined in clause  5.5.4.

If the detach procedure is triggered due to USIM removal, the UE shall indicate "switch off" in the detach type IE.

When upper layers indicate that emergency bearer services are no longer required, the UE if still attached for emergency bearer services, may perform a detach followed by a re-attach to regain normal services, if the UE is in or moves to a suitable cell.

If a detach is requested by the HSS for a UE that has bearers for emergency services, the MME shall not send a DETACH REQUEST message to the UE, and shall follow the procedures in clause  6.4.4.1 for a UE that has bearers for emergency services.

If the detach procedure for EPS services is performed, the EPS bearer context(s), if any, for this particular UE are deactivated locally without peer-to-peer signalling between the UE and the MME.

If the UE supports A/Gb mode or Iu mode or both, the UE shall store the TIN in the non-volatile memory in the ME, as described in annex  C, for a subsequent attach procedure.

The UE is allowed to initiate the detach procedure even if the timer T3346 is running.

The network proceeds with the detach procedure even if NAS level mobility management congestion control is active.

5.5.2.2  UE initiated detach procedure

5.5.2.2.1  UE initiated detach procedure initiation

The detach procedure is initiated by the UE by sending a DETACH REQUEST message (see example in figure  5.5.2.2.1.1). The Detach type IE included in the message indicates whether detach is due to a "switch off" or not. The Detach type IE also indicates whether the detach is for EPS services only, for non-EPS services only, or for both. If the UE has a mapped EPS security context as the current EPS security context, the UE shall set the type of security context flag to "mapped security context". Otherwise, the UE shall set the type of security context flag to "native security context".

If the UE has a valid GUTI, the UE shall populate the EPS mobile identity IE with the valid GUTI. If the UE does not have a valid GUTI, the UE shall populate the EPS mobile identity IE with its IMSI.

If the UE does not have a valid GUTI and it does not have a valid IMSI, then the UE shall populate the EPS mobile identity IE with its IMEI.

NOTE:  During the attach for emergency bearer services or attach for access to RLOS when the UE (with no USIM or invalid USIM) is in EMM-REGISTERED-INITIATED STATE, the UE has neither a valid GUTI nor a valid IMSI.

If the detach is not due to switch off and the UE is in the state EMM-REGISTERED or EMM-REGISTERED-INITIATED, timer T3421 shall be started in the UE after the DETACH REQUEST message has been sent. If the detach type indicates that the detach is for non-EPS services only the UE shall enter the state EMM-REGISTERED.IMSI-DETACH-INITIATED, otherwise the UE shall enter the state EMM-DEREGISTERED-INITIATED. If the detach type indicates that the detach is for non-EPS services or both EPS and non-EPS services, the UE shall enter the state MM IMSI DETACH PENDING.

If the UE to be switched off is not operating in NB-S1 mode and not operating in WB-S1 mode in any enhanced coverage CE mode, the UE shall try for a period of 5 seconds to send the DETACH REQUEST message. If the UE to be switched off:

-  is operating in NB-S1 mode, then the UE should try for at least a period of 85 seconds to send the DETACH REQUEST; or

-  is operating in WB-S1 mode in any enhanced coverage CE mode, then the UE should try for at least a period of 14 seconds to send the DETACH REQUEST.

During this period, the UE may be switched off as soon as the DETACH REQUEST message has been sent.

After the last DETACH REQUEST message is sent, the UE shall proceed as follows:

-  if the current EPS security context is a native EPS security context, then the UE shall store the current EPS security context as specified in annex  C and mark it as valid;

-  else if the current EPS security context is a mapped EPS security context and a non-current full native EPS security context exists, then the UE shall store the non-current EPS security context as specified in annex  C and mark it as valid, and finally the UE shall delete any mapped EPS security context or partial native EPS security context.



Figure 5.5.2.2.1.1: UE initiated detach procedure

5.5.2.2.2  UE initiated detach procedure completion for EPS services only

When the DETACH REQUEST message is received by the network, the network shall send a DETACH ACCEPT message to the UE, if the Detach type IE does not indicate "switch off". Otherwise, the procedure is completed when the network receives the DETACH REQUEST message.

The network and the UE shall deactivate the EPS bearer context(s), if any, for this UE locally without peer-to-peer signalling between the UE and the MME.

The UE is marked as inactive in the network for EPS services. The network shall enter the state EMM-DEREGISTERED.

The UE, when receiving the DETACH ACCEPT message, shall stop timer T3421. Furthermore, if the UE is operating in PS mode of operation, or is operating in CS/PS mode of operation and supports S1 mode only then:

-  If the detach procedure was performed due to disabling of EPS services, then the UE shall enter the EMM-NULL state.

-  Otherwise, the UE shall enter the EMM-DEREGISTERED state.

The UE operating in CS/PS mode 1 or CS/PS mode 2 of operation, and supporting A/Gb mode or Iu mode, shall further set the update status to U2 NOT UPDATED, disable the EUTRA capability (see clause  4.5) and attempt to select GERAN or UTRAN access technology.

5.5.2.2.3  UE initiated combined detach procedure completion

When the DETACH REQUEST message is received by the network, a DETACH ACCEPT message shall be sent to the UE, if the Detach type IE does not indicate "switch off". Otherwise, the procedure is completed when the network receives the DETACH REQUEST message.

Depending on the value of the Detach type IE the following applies:

-  combined EPS/IMSI detach:

  The network and the UE shall deactivate the EPS bearer context(s) for this UE locally without peer-to-peer signalling between the UE and the MME. The UE is marked as inactive in the network for EPS and for non-EPS services. The states EMM-DEREGISTERED and MM-NULL are entered in both the UE and the network.

-  IMSI detach:

  The UE is marked as inactive in the network for non-EPS services. The states MM-NULL and EMM-REGISTERED are entered in both the UE and the network.

The UE, when receiving the DETACH ACCEPT message, shall stop timer T3421.

5.5.2.2.4  Abnormal cases in the UE

The following abnormal cases can be identified:

a)  Access barred because of access class barring, EAB or NAS signalling connection establishment rejected by the network

  In WB-S1 mode, if access is barred for "originating signalling" (see 3GPP  S  36.331  [22]), the detach signalling procedure shall not be started. The UE stays in the current serving cell and applies the normal cell reselection process. The detach signalling procedure is started as soon as possible and if still necessary, i.e. when access for "originating signalling" is granted on the current cell or when the UE moves to a cell where access for "originating signalling" is granted. The UE may perform a local detach either immediately or after an implementation dependent time.

  In NB-S1 mode, if access is barred for "originating signalling" (see 3GPP  S  36.331  [22]), the detach signalling procedure shall not be started. The UE stays in the current serving cell and applies the normal cell reselection process. Further UE behaviour is implementation specific, e.g. the detach signalling procedure is started again after an implementation dependent time.

NOTE  1:  In NB-S1 mode, the EMM layer cannot receive the access barring alleviation indication from the lower layers (see 3GPP  S  36.331  [22]).

b)  Lower layer failure or release of the NAS signalling connection before reception of DETACH ACCEPT message

  The detach procedure shall be aborted and the UE proceeds as follows:

-  if the detach procedure was performed due to disabling of EPS services, the UE shall enter the EMM-NULL state;

-  if "EPS detach" was requested for reasons other than disabling of EPS services, the UE shall enter the EMM-DEREGISTERED state;

-  if "IMSI detach" was requested, the UE shall enter the EMM-REGISTERED.NORMAL-SERVICE state and the MM-NULL state; or

-  if "combined EPS/IMSI detach" was requested, the UE shall enter the EMM-DEREGISTERED state and the MM-NULL state.

c)  T3421 timeout

  On the first four expiries of the timer, the UE shall retransmit the DETACH REQUEST message and shall reset and restart timer T3421. On the fifth expiry of timer T3421, the detach procedure shall be aborted and the UE proceeds as follows:

-  if the detach procedure was performed due to disabling of EPS services, the UE shall enter the EMM-NULL state;

-  if "EPS detach" was requested for reasons other than disabling of EPS services, the UE shall enter the EMM-DEREGISTERED state;

-  if "IMSI detach" was requested, the UE shall enter the EMM-REGISTERED.NORMAL-SERVICE state and the MM-NULL state; or

-  if "combined EPS/IMSI detach" was requested, the UE shall enter the EMM-DEREGISTERED state and the MM-NULL state.

d)  Detach procedure collision

  Detach containing cause "switch off" within the Detach type IE:

-  If the UE receives a DETACH REQUEST message before the UE initiated detach procedure has been completed, this message shall be ignored and the UE initiated detach procedure shall continue.

  Detach containing other causes than "switch off" within the Detach type IE:

-  If the UE receives a DETACH REQUEST message before the UE initiated detach procedure has been completed, it shall treat the message as specified in clause  5.5.2.3.2 with the following modifications:

-  If the DETACH REQUEST message received by the UE contains detach type "re-attach required", and the UE initiated detach procedure is with detach type "EPS detach" or "combined EPS/IMSI detach", the UE need not initiate the attach or combined attach procedure.

-  If the DETACH REQUEST message received by the UE contains detach type "IMSI detach", and the UE initiated detach procedure is with detach type "IMSI detach", the UE need not re-attach to non-EPS services.

-  If the DETACH REQUEST message received by the UE contains detach type "IMSI detach", and the UE initiated detach procedure is with detach type "EPS detach" or "combined EPS/IMSI detach", the UE shall progress both procedures. The UE need not re-attach to non-EPS services.

e)  Detach and EMM common procedure collision

  Detach containing cause "switch off":

-  If the UE receives a message used in an EMM common procedure before the detach procedure has been completed, this message shall be ignored and the detach procedure shall continue.

  Detach containing other causes than "switch off" and containing detach type "IMSI detach":

-  If the UE receives a message used in an EMM common procedure before the detach procedure has been completed, both the EMM common procedure and the detach procedure shall continue.

  Detach containing other causes than "switch off" and containing other detach types than "IMSI detach":

-  If the UE receives a GUTI REALLOCATION COMMAND, an EMM STATUS or an EMM INFORMATION message before the detach procedure is completed, this message shall be ignored and the detach procedure shall continue.

-  If the UE receives an AUTHENTICATION REQUEST, SECURITY MODE COMMAND or IDENTITY REQUEST message before the detach procedure has been completed, the UE shall respond to it as described in clause  5.4.2, 5.4.3 and 5.4.4 respectively and the detach procedure shall continue.

f)  Change of cell into a new tracking area

  If the UE detects the current TAI is not in the stored TAI list occurs before the UE initiated detach procedure is completed, the UE proceeds as follows:

1)  If the detach procedure was initiated for reasons other than removal of the USIM or the UE is to be switched off, the detach procedure shall be aborted and re-initiated after successfully performing a tracking area updating procedure; or

2)  If the detach procedure was initiated due to removal of the USIM or the UE is to be switched off, the UE shall abort the detach procedure, perform a local detach and enter the state EMM-DEREGISTERED.

g)  Transmission failure of DETACH REQUEST message indication with TAI change from lower layers

  If the current TAI is not in the TAI list, the UE proceeds as follows:

1)  If the detach procedure was initiated for reasons other than removal of the USIM or the UE is to be switched off, the detach procedure shall be aborted and re-initiated after successfully performing a tracking area updating procedure; or

2)  If the detach procedure was initiated due to removal of the USIM or the UE is to be switched off, the UE shall abort the detach procedure, perform a local detach and enter the state EMM-DEREGISTERED.

  If the current TAI is still part of the TAI list, the UE shall restart the detach procedure.

h)  Transmission failure of DETACH REQUEST message indication without TAI change from lower layers

  The UE shall restart the detach procedure.

i)  Detach and paging procedure collision

  If the UE receives a CS SERVICE NOTIFICATION message before the UE initiated combined detach procedure with detach type "IMSI detach" or "combined EPS/IMSI detach" has been completed, then this message shall be ignored and the UE initiated combined detach procedure shall continue.

For the cases b, f and g:

-  Timer T3421 shall be stopped if still running.

5.5.2.2.5  Abnormal cases on the network side

The following abnormal cases can be identified:

a)  Detach request received in a CSG cell for which the UE has no valid CSG subscription

  If the UE initiates a detach procedure in a CSG cell the CSG ID of which is not valid for the UE, and the detach procedure is not due to "switch off", the network shall proceed as follows:

-  if the detach type is "IMSI detach" and the UE has a PDN connection for emergency bearer services active, the MME shall send a DETACH ACCEPT message and deactivate all non-emergency EPS bearers, if any, by initiating an EPS bearer context deactivation procedure;

-  otherwise, the network shall initiate the detach procedure. The MME shall send a DETACH REQUEST message including the EMM cause #25,"not authorized for this CSG".

b)  Lower layers indication of non-delivered NAS PDU due to handover

  If the DETACH ACCEPT message could not be delivered due to an intra MME handover and the target TA is included in the TAI list, then upon successful completion of the intra MME handover the MME shall retransmit the DETACH ACCEPT message. If a failure of the handover procedure is reported by the lower layer and the S1 signalling connection exists, the MME shall retransmit the DETACH ACCEPT message.

5.5.2.3  Network initiated detach procedure

5.5.2.3.1  Network initiated detach procedure initiation

The network initiates the detach procedure by sending a DETACH REQUEST message to the UE (see example in figure  5.5.2.3.1).

NOTE:  If the MME performs a local detach, it will inform the UE with an EMM messages (e.g. SERVICE REJECT or TRACKING AREA UPDATE reject) with EMM cause #10 "implicitly detached" only when the UE initiates an EMM procedure.

The network may include an EMM cause IE to specify the reason for the detach request. The network shall start timer T3422. If the Detach type IE indicates "re-attach required" or "re-attach not required" and the EMM cause value is not #2 "IMSI unknown in HSS", or if the MME performs a local detach, the MME shall either store the current EPS security context if it is a native EPS security context, or the MME shall delete the current EPS security context if it is a mapped EPS security context. If the detach type IE indicates "re-attach required" or "re-attach not required" and the EMM cause value is not #2 "IMSI unknown in HSS", the network shall deactivate the EPS bearer context(s), if any, for the UE locally and enter state EMM-DEREGISTERED-INITIATED.

In NB-S1 mode or WB-S1 mode via satellite E-UTRAN access, if the network initiates the detach procedure because the network determines that the UE is in a location where the network is not allowed to operate (see 3GPP  S  23.401  [10]), the network shall set the EMM cause value in the DETACH REQUEST message to #78 "PLMN not allowed to operate at the present UE location".



Figure 5.5.2.3.1: Network initiated detach procedure

5.5.2.3.2  Network initiated detach procedure completion by the UE

When receiving the DETACH REQUEST message and the detach type indicates "re-attach required", the UE shall deactivate the EPS bearer context(s), if any, including the default EPS bearer context locally without peer-to-peer signalling between the UE and the MME. The UE shall stop the timer T3346, if it is running. The UE shall also stop timer(s) T3396 and ESM back-off timer(s) not related to congestion control (see clause  6.3.6), if running. If the UE is operating in single-registration mode, the UE shall also stop 5GSM back-off timer(s) not related to congestion control (see clause  6.2.12 in 3GPP  S  24.501  [54]), if running. The UE shall send a DETACH ACCEPT message to the network and enter the state EMM-DEREGISTERED. Furthermore, the UE shall, after the completion of the detach procedure, and the release of the existing NAS signalling connection, initiate an attach or combined attach procedure. The UE shall enable N1 mode capability for 3GPP access if it was previously disabled (see 3GPP  S  24.501  [54]) and the UE is configured with the "Re_enable_N1_upon_reattach" leaf of the NAS configuration MO which indicates the "re-enabling N1 mode capability when performing re-attach" is enabled (see 3GPP  S  24.368  [15A]). The UE should also re-establish any previously established PDN connection(s).

NOTE  1:  When the detach type indicates "re-attach required", user interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s), if any, automatically.

A UE which receives a DETACH REQUEST message with detach type indicating "re-attach required" or "re-attach not required" and no EMM cause IE, is detached only for EPS services.

When receiving the DETACH REQUEST message and the detach type indicates "IMSI detach", the UE shall not deactivate the EPS bearer context(s) including the default EPS bearer context. The UE shall set the MM update status to U2 NOT UPDATED. A UE may send a DETACH ACCEPT message to the network, and shall re-attach to non-EPS services by performing the combined tracking area updating procedure according to clause  5.5.3.3, sending a TRACKING AREA UPDATE REQUEST message with EPS update type IE indicating "combined TA/LA updating with IMSI attach".

If the UE is attached for EPS and non-EPS services, then the UE shall set the update status to U2 NOT UPDATED if:

-  the Detach type IE indicates "re-attach required"; or

-  the Detach type IE indicates "re-attach not required" and no EMM cause IE is included.

When receiving the DETACH REQUEST message and the detach type indicates "re-attach not required" and no EMM cause IE, or "re-attach not required" and the EMM cause value is not #2 "IMSI unknown in HSS", the UE shall deactivate the EPS bearer context(s), if any, including the default EPS bearer context locally without peer-to-peer signalling between the UE and the MME. The UE shall then send a DETACH ACCEPT message to the network and enter state EMM-DEREGISTERED.

Regardless of the EMM cause value received in the DEREGISTRATION REQUEST message,

-  if the UE receives the Forbidden TAI(s) for the list of "forbidden tracking areas for roaming" IE in the DETACH REQUEST message, the UE shall store the TAI(s) included in the IE, if not already stored, into the list of "forbidden tracking areas for roaming" and remove the TAI(s) from the stored TAI list if present; and

-  if the UE receives the Forbidden TAI(s) for the list of "forbidden tracking areas for regional provision of service" IE in the DETACH REQUEST message, the UE shall store the TAI(s) included in the IE, if not already stored, into the list of "forbidden tracking areas for regional provision of service" and remove the TAI(s) from the stored TAI list if present.

If the detach type indicates "IMSI detach" or "re-attach required", then the UE shall ignore the EMM cause IE if received.

If the detach type indicates "re-attach not required", the UE shall take the following actions depending on the received EMM cause value:

#2  (IMSI unknown in HSS);

  The UE shall handle the MM parameters update status, TMSI, LAI and ciphering key sequence number as specified in 3GPP  S  24.008  [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to "re-attach not required". The USIM shall be considered as invalid for non-EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in clause  5.3.7a. If the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.

  The UE is still attached for EPS services in the network.

#3  (Illegal UE);

#6  (Illegal ME); or

#8  (EPS services and non-EPS services not allowed);

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and KSI. The UE shall consider the USIM as invalid for EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in clause  5.3.7a. The UE shall delete the list of equivalent PLMNs and shall enter the state EMM-DEREGISTERED.NO-IMSI. If the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", then the UE shall set this counter to UE implementation-specific maximum value. If the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.

  If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the MM parameters update status, TMSI, LAI and ciphering key sequence number and the GMM parameters GMM state, RAI, P-TMSI, P-TMSI signature, GPRS ciphering key sequence number and GPRS update status as specified in 3GPP  S  24.008  [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to "re-attach not required". The USIM shall also be considered as invalid for non-EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in clause  5.3.7a.

  For the EMM cause value #3 or #6, if the UE is operating in single-registration mode, the UE shall handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP  S  24.501  [54] for the case when a DEREGISTRATION REQUEST is received over 3GPP access with the 5GMM cause with the same value, with de-registration type set to "re-registration not required" and with access type set to "3GPP access".

  For the EMM cause value #8, if the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.

NOTE  2:  The possibility to configure a UE so that the radio transceiver for a specific radio access technology is not active, although it is implemented in the UE, is out of scope of the present specification.

#7  (EPS services not allowed);

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and KSI. The UE shall consider the USIM as invalid for EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in clause  5.3.7a. The UE shall enter the state EMM-DEREGISTERED. If the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.

  If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, RAI, PTMSI, P-TMSI signature, GPRS ciphering key sequence number and GPRS update status as specified in 3GPP  S  24.008  [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to "re-attach not required".

  A UE operating in CS/PS mode 1 or CS/PS mode 2 of operation which is IMSI attached for non-EPS services is still IMSI attached for non-EPS services in the network. The UE operating in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED, shall attempt to select GERAN or UTRAN access technology and shall proceed with the appropriate MM specific procedure according to the MM service state. The UE shall not reselect E-UTRAN radio access technology until switching off or the UICC containing the USIM is removed.

  If the UE is operating in single-registration mode, the UE shall handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP  S  24.501  [54] for the case when a DEREGISTRATION REQUEST is received over 3GPP access with the 5GMM cause with the same value, with de-registration type set to "re-registration not required" and with access type set to "3GPP access".

#11  (PLMN not allowed);

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and KSI. The UE shall delete the list of equivalent PLMNs, shall reset the attach attempt counter and enter the state EMM-DEREGISTERED.PLMN-SEARCH.

  The UE shall store the PLMN identity in the "forbidden PLMN list" and if the UE is configured to use timer T3245 (see 3GPP  S  24.368  [15A] or 3GPP  S  31.102  [17]) then the UE shall start timer T3245 and proceed as described in clause  5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.

  The UE shall perform a PLMN selection according to 3GPP  S  23.122  [6].

  If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the MM parameters update status, TMSI, LAI and ciphering key sequence number and the GMM parameters GMM state, RAI, P-TMSI, P-TMSI signature, GPRS ciphering key sequence number, GPRS update status and GPRS attach attempt counter as specified in 3GPP  S  24.008  [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to "re-attach not required".

  If the UE is operating in single-registration mode, the UE shall handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list, ngKSI and registration attempt counter as specified in 3GPP  S  24.501  [54] for the case when a DEREGISTRATION REQUEST is received over 3GPP access with the 5GMM cause with the same value, with de-registration type set to "re-registration not required" and with access type set to "3GPP access".

#12  (Tracking area not allowed);

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and KSI. The UE shall reset the attach attempt counter and shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE.

  The UE shall store the current TAI in the list of "forbidden tracking areas for regional provision of service".

  If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, RAI, PTMSI, P-TMSI signature, GPRS ciphering key sequence number, GPRS update status and GPRS attach attempt counter as specified in 3GPP  S  24.008  [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to "re-attach not required". If the UE is IMSI attached for non-EPS services, the UE shall in addition handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and location update attempt counter as specified in 3GPP  S  24.008  [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to "re-attach not required".

  If the UE is operating in single-registration mode, the UE shall handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP  S  24.501  [54] for the case when a DEREGISTRATION REQUEST is received over 3GPP access with the 5GMM cause with the same value, with de-registration type set to "re-registration not required" and with access type set to "3GPP access".

#13  (Roaming not allowed in this tracking area);

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and KSI. The UE shall delete the list of equivalent PLMNs, reset the attach attempt counter and shall change to state EMM-DEREGISTERED.PLMN-SEARCH.

  The UE shall store the current TAI in the list of "forbidden tracking areas for roaming".

  The UE shall perform a PLMN selection according to 3GPP  S  23.122  [6]

  If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, RAI, PTMSI, P-TMSI signature, GPRS ciphering key sequence number, GPRS update status and GPRS attach attempt counter as specified in 3GPP  S  24.008  [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to "re-attach not required". If the UE is IMSI attached for non-EPS services, the UE shall in addition handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and location update attempt counter and as specified in 3GPP  S  24.008  [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to "re-attach not required".

  If the UE is operating in single-registration mode, the UE shall handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list, ngKSI and registration attempt counter as specified in 3GPP  S  24.501  [54] for the case when a DEREGISTRATION REQUEST is received over 3GPP access with the 5GMM cause with the same value, with de-registration type set to "re-registration not required" and with access type set to "3GPP access".

#14  (EPS services not allowed in this PLMN);

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3). Furthermore, the UE shall delete any GUTI, last visited registered TAI, TAI list and KSI. The UE shall reset the attach attempt counter and shall enter the state EMM-DEREGISTERED.PLMN-SEARCH.

  The UE shall store the PLMN identity in the "forbidden PLMNs for GPRS service" list and if the UE is configured to use timer T3245 (see 3GPP  S  24.368  [15A] or 3GPP  S  31.102  [17]) then the UE shall start timer T3245 and proceed as described in clause  5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific PS-attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.

  A UE in PS mode 1 or PS mode 2 of operation shall delete the list of equivalent PLMNs and perform a PLMN selection according to 3GPP  S  23.122  [6].

  A UE operating in CS/PS mode 1 or CS/PS mode 2 of operation which is IMSI attached for non-EPS services is still IMSI attached for non-EPS services and shall set the update status to U2 NOT UPDATED.

  A UE operating in CS/PS mode 1 of operation and supporting A/Gb mode or Iu mode may select GERAN or UTRAN radio access technology and proceed with the appropriate MM specific procedure according to the MM service state. In this case, the UE shall disable the E-UTRA capability (see clause  4.5).

  A UE operating in CS/PS mode 1 of operation and supporting A/Gb mode or Iu mode may perform a PLMN selection according to 3GPP  S  23.122  [6].

  A UE operating in CS/PS mode 1 of operation and supporting S1 mode only or operating in CS/PS mode 2 of operation shall delete the list of equivalent PLMNs and shall perform a PLMN selection according to 3GPP  S  23.122  [6].

  If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, RAI, P-TMSI, P-TMSI signature, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP  S  24.008  [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to "re-attach not required".

  If the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. Additionally, the UE shall reset the registration attempt counter.

#15  (No suitable cells in tracking area);

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and KSI. The UE shall reset the attach attempt counter and shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE.

  The UE shall store the current TAI in the list of "forbidden tracking areas for roaming".

  The UE shall search for a suitable cell in another tracking area or in another location area according to 3GPP  S  36.304  [21].

  If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, RAI, PTMSI, P-TMSI signature, GPRS ciphering key sequence number, GPRS update status and GPRS attach attempt counter as specified in 3GPP  S  24.008  [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to "re-attach not required". If the UE is IMSI attached for non-EPS services, the UE shall in addition handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and location update attempt counter as specified in 3GPP  S  24.008  [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to "re-attach not required".

  If the UE is operating in single-registration mode, the UE shall handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list, ngKSI and registration attempt counter as specified in 3GPP  S  24.501  [54] for the case when a DEREGISTRATION REQUEST is received over 3GPP access with the 5GMM cause with the same value, with de-registration type set to "re-registration not required" and with access type set to "3GPP access".

#25  (Not authorized for this CSG);

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3). The UE shall reset the attach attempt counter and shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE.

  If the cell where the UE has received the DETACH REQUEST message is a CSG cell and the CSG ID and associated PLMN identity of the cell are contained in the Allowed CSG list, the UE shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.

  If the cell where the UE has received the DETACH REQUEST message is a CSG cell and the CSG ID and associated PLMN identity of the cell are contained in the Operator CSG list, the UE shall apply the procedures defined in 3GPP  S  23.122  [6] clause  3.1A.

  The UE shall search for a suitable cell according to 3GPP  S  36.304  [21].

  If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status and GPRS attach attempt counter as specified in 3GPP  S  24.008  [13] for the case when a DETACH REQUEST is received with GMM cause with the same value and with detach type set to "re-attach not required". If the UE is IMSI attached for non-EPS services, the UE shall in addition handle the MM parameters update status and location update attempt counter as specified in 3GPP  S  24.008  [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to "re-attach not required".

  If the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED and set the 5GS update status to 5U3 ROAMING NOT ALLOWED and reset the registration attempt counter.

#78  (PLMN not allowed to operate at the present UE location).

  This cause value received from a non-satellite E-UTRA cell is considered as an abnormal case and the behaviour of the UE is specified in clause  5.5.2.3.4.

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. Additionally, the UE shall reset the registration attempt counter and shall enter state EMM-DEREGISTERED.PLMN-SEARCH and perform a PLMN selection according to 3GPP  S  23.122  [6].

  If the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. Additionally, the UE shall reset the registration attempt counter.

Editor   's note:  [IoT_SAT_ARCH_EPS, CR#3620]. It is FFS how to prevent the UE from making repeated attempts at selecting the same satellite access PLMN if there are no other available PLMNs at UE   's location.

Other EMM cause values or if no EMM cause IE is included is considered as abnormal cases. The behaviour of the UE in those cases is described in clause  5.5.2.3.4.

5.5.2.3.3  Network initiated detach procedure completion by the network

The network shall stop timer T3422 upon receipt of the DETACH ACCEPT message. If the Detach type IE indicates "IMSI detach", or "re-attach not required" and the EMM cause value is #2 "IMSI unknown in HSS", the network shall not change the current EMM state; otherwise the network shall enter state EMM-DEREGISTERED.

5.5.2.3.4  Abnormal cases in the UE

The following abnormal cases can be identified:

a)  Transmission failure of DETACH ACCEPT message indication from lower layers

  The detach procedure shall be progressed and the UE shall send the DETACH ACCEPT message.

b)  DETACH REQUEST, other EMM cause values than those treated in clause  5.5.2.3.2 or no EMM cause IE is included, and the Detach type IE indicates "re-attach not required"

  The UE shall delete any GUTI, TAI list, last visited registered TAI, list of equivalent PLMNs, KSI, shall set the update status to EU2 NOT UPDATED and shall start timer T3402.

  A UE operating in CS/PS mode 1 or CS/PS mode 2 of operation which is IMSI attached for non-EPS services is still IMSI attached for non-EPS services and shall set the update status to U2 NOT UPDATED.

  A UE not supporting any of A/Gb mode, Iu mode or N1 mode may enter the state EMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP  S  23.122  [6]; otherwise the UE shall enter the state EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH.

  A UE supporting A/Gb mode, Iu mode or N1 mode shall

-  enter the state EMM-DEREGISTERED and attempt to select GERAN, UTRAN, or NR radio access technology and proceed with the appropriate MM, GMM or 5GMM specific procedures. In this case, the UE may disable the E-UTRA capability (see clause  4.5);

-  enter the state EMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP  S  23.122  [6]; or

-  enter the state EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH.

  If A/Gb mode or Iu mode is supported by the UE, the UE shall set the GPRS update status to GU2 NOT UPDATED and shall delete the GMM parameters P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and shall enter the state GMM-DEREGISTERED.

  If the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U2 NOT UPDATED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.

5.5.2.3.5  Abnormal cases on the network side

The following abnormal cases can be identified:

a)  T3422 time-out

  On the first expiry of the timer, the network shall retransmit the DETACH REQUEST message and shall start timer T3422. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3422, the detach procedure shall be aborted. If the detach type is "IMSI detach", or "re-attach not required" and the EMM cause value is #2 "IMSI unknown in HSS", the network shall not change the current EMM state; otherwise the network shall change to state EMM-DEREGISTERED.

b)  Lower layer failure

  The detach procedure is aborted. If the detach type indicates "IMSI detach", or "re-attach not required" and the EMM cause value is #2 "IMSI unknown in HSS", the network shall not change the current EMM state; otherwise the network shall change to state EMM-DEREGISTERED.

c)  Detach procedure collision

  If the network receives a DETACH REQUEST message with "switch off" indication, before the network initiated detach procedure has been completed, both procedures shall be considered completed.

  If the network receives a DETACH REQUEST message without "switch off" indication, before the network initiated detach procedure has been completed, the network shall send a DETACH ACCEPT message to the UE.

d)  Detach and attach procedure collision

  If the network receives an ATTACH REQUEST message before the network initiated detach procedure with detach type "re-attach not required" with no EMM cause IE, or "re-attach not required" and the EMM cause value not #2 "IMSI unknown in HSS", has been completed, the network shall ignore the ATTACH REQUEST message. If the Detach type IE, sent in the DETACH REQUEST message, indicates "re-attach required" the detach procedure is aborted and the attach procedure shall be progressed after the EPS bearer context(s) have been deleted. If the Detach type IE, sent in DETACH REQUEST message, indicates "IMSI detach", or "re-attach not required" and the EMM cause value is #2 "IMSI unknown in HSS", the detach procedure is aborted and the attach procedure shall be progressed.

e)  Detach and tracking area updating procedure collision

  If the Detach type IE, sent in DETACH REQUEST message, indicates "re-attach not required" with no EMM cause IE, or "re-attach not required" with EMM cause other than #2 "IMSI unknown in HSS" or indicates "re-attach required", and the network receives a TRACKING AREA UPDATE REQUEST message before the network initiated detach procedure has been completed, the detach procedure shall be progressed, i.e. the TRACKING AREA UPDATE REQUEST message shall be ignored.

  If the Detach type IE, sent in DETACH REQUEST message, indicates "re-attach not required" with EMM cause #2 "IMSI unknown in HSS" or indicates "IMSI detach" and the network receives a TRACKING AREA UPDATE REQUEST message before the network initiated detach procedure has been completed, the network shall abort the detach procedure, shall stop T3422 and shall progress the tracking area updating procedure.

f)  Detach and service request procedure collision

  If the network receives a SERVICE REQUEST message or an EXTENDED SERVICE REQUEST message for packet services before the network initiated detach procedure has been completed (e.g. the DETACH REQUEST message is pending to be sent to the UE) and the DETACH REQUEST contains detach type "re-attach not required" with EMM cause #2 "IMSI unknown in HSS" or detach type "IMSI detach", the network shall progress both procedures. If the DETACH REQUEST message contains detach type "re-attach not required" with no EMM cause IE, or "re-attach not required" with EMM cause other than #2 "IMSI unknown in HSS" or detach type "re-attach required", the network shall progress the detach procedure.

  If the network receives an EXTENDED SERVICE REQUEST message for CS fallback, but not for CS fallback for emergency call, before the network initiated detach procedure has been completed (e.g. the DETACH REQUEST message is pending to be sent to the UE) and the DETACH REQUEST contains detach type "re-attach not required" with EMM cause #2 "IMSI unknown in HSS" or detach type "IMSI detach", the network shall ignore the EXTENDED SERVICE REQUEST message and progress the detach procedure.

  If the network receives an EXTENDED SERVICE REQUEST message for CS fallback for emergency call before the network initiated detach procedure has been completed (e.g. the DETACH REQUEST message is pending to be sent to the UE) and the DETACH REQUEST contains detach type "re-attach not required" with EMM cause #2 "IMSI unknown in HSS" or detach type "IMSI detach", the network shall progress both procedures.

g)  Lower layers indication of non-delivered NAS PDU due to handover

  If the DETACH REQUEST message could not be delivered due to an intra MME handover and the target TA is included in the TAI list, then upon successful completion of the intra MME handover the MME shall retransmit the DETACH REQUEST message. If a failure of the handover procedure is reported by the lower layer and the S1 signalling connection exists, the MME shall retransmit the DETACH REQUEST message.

5.5.3  Tracking area updating procedure (S1 mode only)

5.5.3.1  General

The tracking area updating procedure is always initiated by the UE and is used for the following purposes:

-  normal tracking area updating to update the registration of the actual tracking area of a UE in the network;

-  combined tracking area updating to update the registration of the actual tracking area for a UE in CS/PS mode 1 or CS/PS mode 2 of operation;

-  periodic tracking area updating to periodically notify the availability of the UE to the network;

-  IMSI attach for non-EPS services when the UE is attached for EPS services. This procedure is used by a UE in CS/PS mode 1 or CS/PS mode 2 of operation;

-  in various cases of inter-system change from Iu mode to S1 mode or from A/Gb mode to S1 mode;

-  in various cases of inter-system change from N1 mode to S1 mode if the UE operates in single-registration mode and as described in 3GPP  S  24.501  [54];

-  S101 mode to S1 mode inter-system change;

-  MME load balancing;

-  to update certain UE specific parameters in the network;

-  recovery from certain error cases;

-  to indicate that the UE enters S1 mode after CS fallback or 1xCS fallback;

-  to indicate to the network that the UE has selected a CSG cell whose CSG identity and associated PLMN identity are not included in the UE   's Allowed CSG list or in the UE   's Operator CSG list;

-  to indicate the current radio access technology to the network for the support of terminating access domain selection for voice calls or voice sessions;

-  to indicate to the network that the UE has locally released EPS bearer context(s); and

-  to indicate to the network that the MUSIM UE needs to use an IMSI Offset value as specified in 3GPP  S  23.401  [10] that is used for deriving the paging occasion as specified in 3GPP  S  36.304  [21].

Details on the conditions for the UE to initiate the tracking area updating procedure are specified in clause  5.5.3.2.2 and clause  5.5.3.3.2.

If the MUSIM UE is attached for emergency bearer services and initiates a tracking area updating procedure, the network shall not indicate the support of:

-  the NAS signalling connection release;

-  the paging indication for voice services;

-  the reject paging request;

-  the paging restriction; or

-  the paging timing collision control;

in the TRACKING AREA UPDATE ACCEPT message.

While a UE has a PDN connection for emergency bearer services, the UE shall not perform manual CSG selection.

If control plane CIoT EPS optimization is not used by the UE, a UE initiating the tracking area updating procedure in EMM-IDLE mode may request the network to re-establish the radio and S1 bearers for all active EPS bearer contexts during the procedure. If control plane CIoT EPS optimization is used by the UE, a UE initiating the tracking area updating procedure in EMM-IDLE mode may request the network to re-establish the radio and S1 bearers for all active EPS bearer contexts associated with PDN connections established without control plane only indication during the procedure.

In a shared network, the UE shall choose one of the PLMN identities as specified in 3GPP  S  23.122  [6]. The UE shall construct the TAI of the cell from this chosen PLMN identity and the TAC received for this PLMN identity on the broadcast system information. The chosen PLMN identity shall be indicated to the E-UTRAN (see 3GPP  S  36.331  [22]). Whenever a TRACKING AREA UPDATE REJECT message with the EMM cause #11 "PLMN not allowed" is received by the UE, the chosen PLMN identity shall be stored in the "forbidden PLMN list" and if the UE is configured to use timer T3245 (see 3GPP  S  24.368  [15A] or 3GPP  S  31.102  [17]) then the UE shall start timer T3245 and proceed as described in clause  5.3.7a. Whenever a TRACKING AREA UPDATE REJECT message with the EMM cause #14 "EPS services not allowed in this PLMN" is received by the UE, the chosen PLMN identity shall be stored in the "forbidden PLMNs for GPRS service". Whenever a TRACKING AREA UPDATE REJECT message is received by the UE with the EMM cause #12 "tracking area not allowed", #13 "roaming not allowed in this tracking area", or #15 "no suitable cells in tracking Area", the constructed TAI shall be stored in the suitable list.

In a shared network, if TRACKING AREA UPDATE REJECT is received as a response to a tracking area updating procedure initiated in EMM-CONNECTED mode, the UE need not update forbidden lists.

A tracking area updating attempt counter is used to limit the number of subsequently rejected tracking area update attempts. The tracking area updating attempt counter shall be incremented as specified in clause  5.5.3.2.6. Depending on the value of the tracking area updating attempt counter, specific actions shall be performed. The tracking area updating attempt counter shall be reset when:

-  a normal or periodic tracking area updating or a combined tracking area updating procedure is successfully completed;

-  a normal or periodic tracking area updating or a combined tracking area updating procedure is rejected with EMM cause #11, #12, #13, #14, #15, #25 or #35:

-  a combined attach procedure or a combined tracking area updating procedure is completed for EPS services only with cause #2 or #18; or

-  a new PLMN is selected.

Additionally the tracking area updating attempt counter shall be reset when the UE is in substate EMM-REGISTERED.ATTEMPTING-TO-UPDATE or EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM, and:

-  a new tracking area is entered;

-  timer T3402 expires; or

-  timer T3346 is started.

5.5.3.2  Normal and periodic tracking area updating procedure

5.5.3.2.1  General

The periodic tracking area updating procedure is controlled in the UE by timer T3412. When timer T3412 expires, the periodic tracking area updating procedure is started. Start and reset of timer T3412 is described in clause  5.3.5.

5.5.3.2.2  Normal and periodic tracking area updating procedure initiation

The UE in state EMM-REGISTERED shall initiate the tracking area updating procedure by sending a TRACKING AREA UPDATE REQUEST message to the MME,

a)  when the UE detects that the current TAI is not in the list of tracking areas that the UE previously registered in the MME, unless the UE is configured for "AttachWithIMSI" as specified in 3GPP  S  24.368  [15A] or 3GPP  S  31.102  [17] and is entering a tracking area in a new PLMN that is neither the registered PLMN nor in the list of equivalent PLMNs;

b)  when the periodic tracking area updating timer T3412 expires;

c)  when the UE enters EMM-REGISTERED.NORMAL-SERVICE and the UE   's TIN indicates "P-TMSI";

d)  when the UE performs an inter-system change from S101 mode to S1 mode and has no user data pending;

e)  when the UE receives an indication from the lower layers that the RRC connection was released with cause "load balancing TAU required";

f)  when the UE deactivated EPS bearer context(s) locally while in EMM-REGISTERED, because it could not establish a NAS signalling connection, and then returns to EMM-REGISTERED.NORMAL-SERVICE and no EXTENDED SERVICE REQUEST message, CONTROL PLANE SERVICE REQUEST message or DETACH REQUEST message with detach type is "EPS detach" or "combined EPS/IMSI detach" is pending to be sent by the UE;

g)  when the UE changes any one of the UE network capability information, the MS network capability information or the N1 UE network capability information;

h)  when the UE changes the UE specific DRX parameter (in WB-S1 mode or NB-S1 mode);

i)  when the UE receives an indication of "RRC Connection failure" from the lower layers and has no signalling or user uplink data pending (i.e. when the lower layer requests NAS signalling connection recovery);

j)  when the UE enters S1 mode after 1xCS fallback or 1xSRVCC;

k)  when due to manual CSG selection the UE has selected a CSG cell whose CSG identity and associated PLMN identity are not included in the UE   's Allowed CSG list or in the UE   's Operator CSG list;

l)  when the UE reselects an E-UTRAN cell while it was in GPRS READY state or PMM-CONNECTED mode;

m)  when the UE supports SRVCC to GERAN or UTRAN or supports vSRVCC to UTRAN and changes the mobile station classmark 2 or the supported codecs, or the UE supports SRVCC to GERAN and changes the mobile station classmark 3;

n)  when the UE changes the radio capability for GERAN, or cdma2000   xae or both;

o)  when the UE   's usage setting or the voice domain preference for E-UTRAN change in the UE;

NOTE  1:  For the change of UE   's usage setting or the voice domain preference for E-UTRAN which results in disabling UE   's E-UTRA capability, the UE can skip sending TRACKING AREA UPDATE REQUEST message and directly perform disabling of UE   's E-UTRA capability.

p)  when the UE activates mobility management for IMS voice termination as specified in 3GPP  S  24.008  [13], annex  P.2, and the TIN indicates "RAT-related TMSI";

q)  when the UE performs an inter-system change from A/Gb mode to S1 mode and the TIN indicates "RAT-related TMSI", but the UE is required to perform tracking area updating for IMS voice termination as specified in 3GPP  S  24.008  [13], annex  P.4;

r)  upon reception of a paging indication using S-TMSI and the UE is in state EMM-REGISTERED.ATTEMPTING-TO-UPDATE;

NOTE  2:  As an implementation option, the MUSIM UE is allowed to not respond to paging based on the information available in the paging message, e.g. voice service indication.

s)  when the UE needs to update the network with EPS bearer context status due to local de-activation of EPS bearer context(s) as specified in clause  6.5.1.4A;

t)  when the UE needs to request the use of PSM or needs to stop the use of PSM;

u)  when the UE needs to request the use of eDRX or needs to stop the use of eDRX;

v)  when a change in the eDRX usage conditions at the UE requires different extended DRX parameters;

w)  when a change in the PSM usage conditions at the UE requires a different timer T3412 value or different timer T3324 value;

NOTE  3:  A change in the PSM or eDRX usage conditions at the UE can include e.g. a change in the UE configuration, a change in requirements from upper layers or the battery running low at the UE.

x)  when the CIoT EPS optimizations the UE needs to use, change in the UE;

y)  when the Default_DCN_ID value changes, as specified in 3GPP  S  24.368  [15A] or in USIM file NASCONFIG as specified in 3GPP  S  31.102  [17];

NOTE  4:  The tracking area updating procedure is initiated after deleting the DCN-ID list as specified in annex  C.

z)  when the UE performs inter-system change from N1 mode to S1 mode in EMM-IDLE mode, the UE operates in single-registration mode, and conditions specified in 3GPP  S  24.501  [54] apply;

za)  when the UE in EMM-IDLE mode changes the radio capability for E-UTRAN;

zb)  when the UE needs to request new ciphering keys for ciphered broadcast assistance data;

zc)  when the UE in EMM-IDLE mode changes the radio capability for NG-RAN;

zd)  when the UE performs inter-system change from N1 mode to S1 mode in EMM-CONNECTED mode;

ze)  in WB-S1 mode, when the applicable UE radio capability ID for the current UE radio configuration changes due to a revocation of the network-assigned UE radio capability IDs by the serving PLMN;

zf)  when the UE needs to use the WUS assistance, stop to use the WUS assistance, or change the conditions for using the WUS assistance; or

zg)  when the MUSIM UE needs to request an IMSI Offset value as specified in 3GPP  S  23.401  [10] that is used for deriving the paging occasion as specified in 3GPP  S  36.304  [21].

If case b) is the only reason for initiating the normal and periodic tracking area updating procedure, the UE shall indicate "periodic updating" in the EPS update type IE; otherwise the UE shall indicate "TA updating".

For cases n, za and zc, the UE shall include a UE radio capability information update needed IE in the TRACKING AREA UPDATE REQUEST message.

If the UE is in the EMM-CONNECTED mode and the UE changes the radio capability for E-UTRAN or for NG-RAN, the UE may locally release the established NAS signalling connection and enter the EMM-IDLE mode. Then, the UE shall initiate the tracking area updating procedure including a UE radio capability information update needed IE in the TRACKING AREA UPDATE REQUEST message.

For case l, if the TIN indicates "RAT-related TMSI", the UE shall set the TIN to "P-TMSI" before initiating the tracking area updating procedure.

For case r, the "active" flag in the EPS update type IE shall be set to 1. If a UE is only using EPS services with control plane CIoT EPS optimization, the "signalling active" flag in the Additional update type IE shall be set to 1.

If the UE is using only control plane CIoT EPS optimization, the case i only applies to the case that the UE has indicated to the network that subsequent to the uplink data transmission a downlink data transmission is expected during the transport of uplink user data via the control plane procedure (see clause  6.6.4).

If the UE has to request resources for ProSe direct discovery or Prose direct communication (see 3GPP  S  36.331  [22]), then the UE shall set the "active" flag to 1 in the TRACKING AREA UPDATE REQUEST message.

If the UE does not have any established PDN connection, and the inter-system change from N1 mode to S1 mode is not due to emergency services fallback, the "active" flag in the EPS update type IE shall be set to 0.

When the UE has user data pending and performs an inter-system change from S101 mode to S1 mode to a tracking area included in the TAI list stored in the UE, the UE shall perform a service request procedure instead of a tracking area updating procedure.

When initiating a tracking area updating procedure while in S1 mode, the UE shall use the current EPS NAS integrity key to integrity protect the TRACKING AREA UPDATE REQUEST message, unless the UE is performing inter-system change from N1 mode to S1 mode.

In order to indicate its UE specific DRX parameter for WB-S1 mode while in E-UTRAN coverage, the UE shall send the TRACKING AREA UPDATE REQUEST message containing the UE specific DRX parameter in the DRX parameter IE to the network, with the exception of the case if the UE had indicated its DRX parameter for WB-S1 mode (3GPP  S  24.008  [13]) to the network while in GERAN or UTRAN coverage. In this case, when the UE enters E-UTRAN coverage and initiates a tracking area updating procedure, the UE shall not include the UE specific DRX parameter in the DRX parameter IE in the TRACKING AREA UPDATE REQUEST message.

In NB-S1 mode, a UE that wishes to use or change a UE specific DRX parameter in NB-S1 mode shall include its requested value in every TRACKING AREA UPDATE REQUEST message except when initiating the periodic tracking area updating procedure.

If the UE supports eDRX and requests the use of eDRX, the UE shall include the extended DRX parameters IE in the TRACKING AREA UPDATE REQUEST message.

If the UE supports PSM and requests the use of PSM, the UE shall include the T3324 value IE with a requested timer value in the TRACKING AREA UPDATE REQUEST message. When the UE includes the T3324 value IE and the UE indicates support for extended periodic timer value in the MS network feature support IE, it may also include the T3412 extended value IE to request a particular T3412 value to be allocated.

If a UE supporting CIoT EPS optimizations in NB-S1 mode initiates the tracking area updating procedure for EPS services and "SMS only", the UE shall indicate "SMS only" in the Additional update type IE and shall set the EPS update type IE to "TA updating".

If the UE supports S1-U data transfer and multiple user plane radio bearers (see 3GPP  S  36.306  [44], 3GPP  S  36.331  [22]) in NB-S1 mode, then the UE shall set the Multiple DRB support bit to "Multiple DRB supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.

If the UE is in NB-S1 mode, then the UE shall set the Control plane CIoT EPS optimization bit to "Control plane CIoT EPS optimization supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message. If the UE is capable of NB-N1 mode, then the UE shall set the Control plane CIoT 5GS optimization bit to "Control plane CIoT 5GS optimization supported" in the N1 UE network capability IE of the TRACKING AREA UPDATE REQUEST message.

If the UE supports control plane MT-EDT, then the UE shall set the CP-MT-EDT bit to "Control plane Mobile Terminated-Early Data Transmission supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.

If the UE supports user plane MT-EDT, then the UE shall set the UP-MT-EDT bit to "User plane Mobile Terminated-Early Data Transmission supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.

If the UE supports EPS-UPIP, the UE shall set the EPS-UPIP bit to "EPS-UPIP supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.

If the UE has to request resources for V2X communication over PC5 (see 3GPP  S  23.285  [47]), then the UE shall set the "active" flag to 1 in the TRACKING AREA UPDATE REQUEST message.

After sending the TRACKING AREA UPDATE REQUEST message to the MME, the UE shall start timer T3430 and enter state EMM-TRACKING-AREA-UPDATING-INITIATED (see example in figure  5.5.3.2.2.1). If timer T3402 is currently running, the UE shall stop timer T3402. If timer T3411 is currently running, the UE shall stop timer T3411. If timer T3442 is currently running, the UE shall stop timer T3442.

For all cases except cases z and zd:

1)  if the UE supports neither A/Gb mode nor Iu mode, the UE shall include a valid GUTI in the Old GUTI IE in the TRACKING AREA UPDATE REQUEST message. In addition, the UE shall include Old GUTI type IE with GUTI type set to "native GUTI"; or

2)  if the UE supports A/Gb mode or Iu mode or both, the UE shall handle the Old GUTI IE as follows:

-  If the TIN indicates "P-TMSI" and the UE holds a valid native P-TMSI and RAI, the UE shall map the P-TMSI and RAI into the Old GUTI IE, and include Old GUTI type IE with GUTI type set to "mapped GUTI". If a P-TMSI signature is associated with the P-TMSI, the UE shall include it in the Old P-TMSI signature IE. Additionally, if the UE holds a valid GUTI, the UE shall indicate the GUTI in the Additional GUTI IE.

NOTE  5:  The mapping of the P-TMSI and RAI to the GUTI is specified in 3GPP  S  23.003  [2].

-  If the TIN indicates "GUTI" or "RAT-related TMSI" and the UE holds a valid GUTI, the UE shall indicate the GUTI in the Old GUTI IE, and include Old GUTI type IE with GUTI type set to "native GUTI".

If a UE has established PDN connection(s) and uplink user data pending to be sent via user plane when it initiates the tracking area updating procedure, or uplink signalling not related to the tracking area updating procedure when the UE does not support control plane CIoT EPS optimization, it may set the "active" flag in the TRACKING AREA UPDATE REQUEST message to indicate the request to establish the user plane to the network and to keep the NAS signalling connection after the completion of the tracking area updating procedure.

If a UE is using EPS services with control plane CIoT EPS optimization and has user data pending to be sent via control plane over MME but no user data pending to be sent via user plane, or uplink signalling not related to the tracking area updating procedure, the UE may set the "signalling active" flag in the TRACKING AREA UPDATE REQUEST message to indicate the request to keep the NAS signalling connection after the completion of the tracking area updating procedure.

For all cases except cases z and zd, if the UE has a current EPS security context, the UE shall include the eKSI (either KSIASME or KSISGSN) in the NAS Key Set Identifier IE in the TRACKING AREA UPDATE REQUEST message. Otherwise, the UE shall set the NAS Key Set Identifier IE to the value "no key is available". If the UE has a current EPS security context, the UE shall integrity protect the TRACKING AREA UPDATE REQUEST message with the current EPS security context. Otherwise the UE shall not integrity protect the TRACKING AREA UPDATE REQUEST message.

When the tracking area updating procedure is initiated in EMM-IDLE mode to perform an inter-system change from A/Gb mode or Iu mode to S1 mode and the TIN is set to "P-TMSI", the UE shall include the GPRS ciphering key sequence number applicable for A/Gb mode or Iu mode and a nonceUE in the TRACKING AREA UPDATE REQUEST message.

When the tracking area updating procedure is initiated in EMM-CONNECTED mode to perform an inter-system change from A/Gb mode or Iu mode to S1 mode, the UE shall derive the EPS NAS keys from the mapped K   'ASME using the selected NAS algorithms, nonceMME and KSISGSN (to be associated with the mapped K   'ASME) provided by lower layers as indicated in 3GPP  S  33.401  [19]. The UE shall reset both the uplink and downlink NAS COUNT counters of the mapped EPS security context which shall be taken into use. If the UE has a non-current native EPS security context, the UE shall include the KSIASME in the Non-current native NAS key set identifier IE and its associated GUTI, as specified above, either in the Old GUTI IE or in the Additional GUTI IE of the TRACKING AREA UPDATE REQUEST message. The UE shall set the TSC flag in the Non-current native NAS key set identifier IE to "native security context".

For the case z, if upper layers have indicated that IMS signalling or IMS emergency signalling was already ongoing in N1 mode before performing the inter-system change from N1 mode to S1 mode, or if the inter-system change from N1 mode to S1 mode is due to emergency services fallback, the "active" flag in the EPS update type IE shall be set to 1.

For the case z, the TRACKING AREA UPDATE REQUEST message shall be integrity protected using the 5G NAS security context available in the UE. If there is no valid 5G NAS security context available in the UE, the TRACKING AREA UPDATE REQUEST message shall be sent without integrity protection. The UE shall include a GUTI, mapped from 5G-GUTI (see 3GPP  S  23.501  [58] and 3GPP  S  23.003  [2]), in the Old GUTI IE in the TRACKING AREA UPDATE REQUEST message. In addition, the UE shall include Old GUTI type IE with GUTI set to "Native GUTI", and the UE shall include a UE status IE with a 5GMM registration status set to "UE is in 5GMM-REGISTERED state". Additionally, if the UE holds a valid GUTI, the UE shall indicate the GUTI in the Additional GUTI IE.

NOTE  6:  The value of the EMM registration status included by the UE in the UE status IE is not used by the MME.

For the case zd, the TRACKING AREA UPDATE REQUEST message shall be integrity protected using the mapped EPS security context as derived when triggering the handover to E-UTRAN (see clause  4.4.2.2). The UE shall include a GUTI, mapped from 5G-GUTI (see 3GPP  S  23.501  [58] and 3GPP  S  23.003  [2]), in the Old GUTI IE in the TRACKING AREA UPDATE REQUEST message. In addition, the UE shall include Old GUTI type IE with GUTI set to "Native GUTI", and the UE shall include a UE status IE with a 5GMM registration status set to "UE is in 5GMM-REGISTERED state". Additionally, if the UE holds a valid GUTI, the UE shall indicate the GUTI in the Additional GUTI IE. If the UE has a non-current native EPS security context, the UE shall include the KSIASME in the Non-current native NAS key set identifier IE of the TRACKING AREA UPDATE REQUEST message. The UE shall set the TSC flag in the Non-current native NAS key set identifier IE to "native security context".

NOTE  7:  The value of the EMM registration status included by the UE in the UE status IE is not used by the MME.

When the tracking area updating procedure is initiated in EMM-IDLE mode, the UE may also include an EPS bearer context status IE in the TRACKING AREA UPDATE REQUEST message, indicating which EPS bearer contexts are active in the UE. The UE shall include the EPS bearer context status IE in TRACKING AREA UPDATE REQUEST message:

a)  for the case f;

b)  for the case s;

c)  for the case z;

d)  if the UE has established PDN connection(s) of "non IP" or Ethernet PDN type; and

e)  if the UE:

1)  locally deactivated at least one dedicated EPS bearer context upon an inter-system mobility from WB-S1 mode to NB-S1 mode in EMM-IDLE mode;

2)  locally deactivated at least one dedicated EPS bearer context upon an inter-system change from WB-N1 mode to NB-S1 mode in EMM-IDLE mode for the UE operating in single-registration mode (see clause  6.4.2.1); or

3)  locally deactivated at least one default EPS bearer context upon an inter-system change from N1 mode to NB-S1 mode in EMM-IDLE mode for the UE operating in single-registration mode (see clause  6.5.0).

If the UE initiates the first tracking area updating procedure following an attach in A/Gb mode or Iu mode, the UE shall include a UE radio capability information update needed IE in the TRACKING AREA UPDATE REQUEST message.

If the UE initiates the first tracking area updating procedure following an initial registration in N1 mode and the UE is operating in the single-registration mode, the UE shall include a UE radio capability information update needed IE in the TRACKING AREA UPDATE REQUEST message.

For all cases except case b, if the UE supports SRVCC to GERAN/UTRAN, the UE shall set the SRVCC to GERAN/UTRAN capability bit in the MS network capability IE to "SRVCC from UTRAN HSPA or E-UTRAN to GERAN/UTRAN supported".

For all cases except case b, if the UE supports vSRVCC from S1 mode to Iu mode, then the UE shall set the H.245 after handover capability bit in the UE network capability IE to "H.245 after SRVCC handover capability supported" and additionally set the SRVCC to GERAN/UTRAN capability bit in the MS network capability IE to "SRVCC from UTRAN HSPA or E-UTRAN to GERAN/UTRAN supported" in the TRACKING AREA UPDATE REQUEST message.

For all cases except case b, if the UE supports ProSe direct discovery, then the UE shall set the ProSe bit to "ProSe supported" and set the ProSe direct discovery bit to "ProSe direct discovery supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.

For all cases except case b, if the UE supports ProSe direct communication, then the UE shall set the ProSe bit to "ProSe supported" and set the ProSe direct communication bit to "ProSe direct communication supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.

For all cases except case b, if the UE supports acting as a ProSe UE-to-network relay, then the UE shall set the ProSe bit to "ProSe supported" and set the ProSe UE-to-network relay bit to "acting as a ProSe UE-to-network relay supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.

If the UE supports NB-S1 mode, Non-IP or Ethernet PDN type, N1 mode, UAS services or if the UE supports DNS over (D)TLS (see 3GPP  S  33.501  [24]), then the UE shall support the extended protocol configuration options IE.

NOTE  8:  Support of DNS over (D)TLS is based on the informative requirements as specified in 3GPP  S  33.501  [24].

For all cases except case b, if the UE supports the extended protocol configuration options IE, then the UE shall set the ePCO bit to "extended protocol configuration options supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.

If the UE supports providing PDU session ID in the protocol configuration option IE or the extended protocol configuration option IE when its N1 mode capability is disabled, then the UE shall set the ePCO bit to "extended protocol configuration options supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.

For all cases except case b, if the UE supports V2X communication over E-UTRAN-PC5, then the UE shall set the V2X PC5 bit to "V2X communication over E-UTRAN-PC5 supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.

For all cases except case b, if the UE supports V2X communication over NR-PC5, then the UE shall set the V2X NR-PC5 bit to "V2X communication over NR-PC5 supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.

For all cases except case b, if the UE supports the restriction on use of enhanced coverage, then the UE shall set the RestrictEC bit to "Restriction on use of enhanced coverage supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.

For all cases except case b, if the UE supports the control plane data back-off timer T3448, the UE shall set the CP backoff bit to "backoff timer for transport of user data via the control plane supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.

For all cases except case b, if the UE supports dual connectivity with NR, then the UE shall set the DCNR bit to "dual connectivity with NR supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message and shall include the UE additional security capability IE in the TRACKING AREA UPDATE REQUEST message.

For all cases except case b, if the UE supports SGC, then the UE shall set the SGC bit to "service gap control supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.

For all cases except case b, if the UE supports signalling for a maximum number of 15 EPS bearer contexts, then the UE shall set the 15 bearers bit to "Signalling for a maximum number of 15 EPS bearer contexts supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.

For all cases except case b, if the MUSIM UE supports the NAS signalling connection release, then the UE shall set the NAS signalling connection release bit to "NAS signalling connection release supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message otherwise the UE shall not set the NAS signalling connection release bit to "NAS signalling connection release supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.

For all cases except case b, if the MUSIM UE supports the paging indication for voice services, then the UE shall set the paging indication for voice services bit to "paging indication for voice services supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message otherwise the UE shall not set the paging indication for voice services bit to "paging indication for voice services supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.

For all cases except case b, if the MUSIM UE supports the reject paging request, then the UE shall set the reject paging request bit to "reject paging request supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message otherwise the UE shall not set the reject paging request bit to "reject paging request supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.

For all cases except case b, if the MUSIM UE sets:

-  the reject paging request bit to "reject paging request supported";

-  the NAS signalling connection release bit to "NAS signalling connection release supported"; or

-  both of them;

and supports the paging restriction, then the UE shall set the paging restriction bit to "paging restriction supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message otherwise the UE shall not set the paging restriction bit to "paging restriction supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.

For all cases except case b, if the MUSIM UE supports the paging timing collision control, then the UE shall set the paging timing collision control bit to "paging timing collision control supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message otherwise the UE shall not set the paging timing collision control bit to "paging timing collision control supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.

For all cases except cases b and zb, if the UE supports ciphered broadcast assistance data and the UE needs to obtain new ciphering keys, the UE shall include the Additional information requested IE with the CipherKey bit set to "ciphering keys for ciphered broadcast assistance data requested" in the TRACKING AREA UPDATE REQUEST message.

For case ee, the UE shall include the Additional information requested IE with the CipherKey bit set to "ciphering keys for ciphered broadcast assistance data requested" in the TRACKING AREA UPDATE REQUEST message.

For case a, if the UE supports ciphered broadcast assistance data and the UE detects entering a tracking area for which one or more ciphering keys stored at the UE is not applicable, the UE should include the Additional information requested IE with the CipherKey bit set to "ciphering keys for ciphered broadcast assistance data requested" in the TRACKING AREA UPDATE REQUEST message.

For case b, if the UE supports ciphered broadcast assistance data and the remaining validity time for one or more ciphering keys stored at the UE is less than timer T3412, the UE should include the Additional information requested IE with the CipherKey bit set to "ciphering keys for ciphered broadcast assistance data requested" in the TRACKING AREA UPDATE REQUEST message.

For all cases except case b, if the UE supports N1 mode for 3GPP access, the UE shall set the N1mode bit to "N1 mode for 3GPP access supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message and shall include the UE additional security capability IE in the TRACKING AREA UPDATE REQUEST message.

For all cases except case b, in WB-S1 mode, if the UE supports RACS the UE shall set the RACS bit to "RACS supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.

For cases n, za and zc, in WB-S1 mode, if the UE supports RACS and the UE has an applicable UE radio capability ID for the new UE radio configuration in the selected PLMN, the UE shall set the URCIDA bit to "UE radio capability ID available" in the UE radio capability ID availability IE of the TRACKING AREA UPDATE REQUEST message.

For all cases except cases b, n, za and zc, in WB-S1 mode, if the UE has an applicable UE radio capability ID for the current UE radio configuration in the selected PLMN, the UE shall set the URCIDA bit to "UE radio capability ID available" in the UE radio capability ID availability IE of the TRACKING AREA UPDATE REQUEST message.

For all cases except case b, if the UE supports WUS assistance, then the UE shall set the WUSA bit to "WUS assistance supported" in the UE network capability IE, and if the UE is not attaching for emergency bearer services, the UE may include its UE paging probability information in the Requested WUS assistance information IE in the TRACKING AREA UPDATE REQUEST message.

For all cases except case a, except case b, for a MUSIM UE if the UE needs to indicate an IMSI offset value to the network and the network has indicated to the UE that it supports paging timing collision control, the UE shall include the IMSI offset value in the Requested IMSI offset IE in the TRACKING AREA UPDATE REQUEST message.

For case a, MUSIM UE may include the IMSI offset value in the Requested IMSI offset IE in the TRACKING AREA UPDATE REQUEST message even if the network has not indicated that it supports paging timing collision control.

If the network supports the NAS signalling connection release and the MUSIM UE requests the network to release the NAS signalling connection, the UE shall set Request type to "NAS signalling connection release" in the UE request type IE and, if the network supports the paging restriction, may set the paging restriction preference in the Paging restriction IE in the TRACKING AREA UPDATE REQUEST message. In addition, the UE shall

-  set the "active" flag to 0 in the EPS update type IE; and

-  set the "signalling active" flag to 0 in the Additional update type IE, if the Additional update type IE is included.

NOTE  9:  If the network has already indicated support for NAS signalling connection release in the current stored tracking area list and the UE doesn   't have a PDN connection for emergency bearer services established, the MUSIM UE is allowed to request the network to release the NAS signalling connection during tracking area updating procedure that is due to mobility to a tracking area outside the current tracking area list even before detecting whether the network supports the NAS signalling connection release in the new tracking area.

NOTE  10:  If the network has already indicated support for paging restriction in the current stored tracking area list and the UE doesn   't have a PDN connection for emergency bearer services established, the MUSIM UE is allowed to include paging restriction together with the request to the network to release the NAS signalling connection during tracking area updating procedure that is due to mobility to a tracking area outside the current tracking area list even before detecting whether the network supports the paging restriction in the new tracking area.



Figure 5.5.3.2.2.1: Tracking area updating procedure

5.5.3.2.3  EMM common procedure initiation

If the network receives a TRACKING AREA UPDATE REQUEST message containing the Old GUTI type IE, and the network does not follow the use of the most significant bit of the <MME group id> to distinguish the node type as specified in 3GPP  S  23.003  [2], clause  2.8.2.2.2, the network shall use the Old GUTI type IE to determine whether the mobile identity included in the Old GUTI IE is a native GUTI or a mapped GUTI.

  During the tracking area updating procedure, the MME may initiate EMM common procedures, e.g. the EMM authentication and security mode control procedures.

  The MME may be configured to skip the authentication procedure even if no EPS security context is available and proceed directly to the execution of the security mode control procedure as specified in clause  5.4.3, during a tracking area updating procedure for a UE that has only a PDN connection for emergency bearer services or for RLOS.

  The MME shall not initiate an EMM authentication procedure before completion of the tracking area updating procedure, if the following conditions apply:

a)  the UE initiated the tracking area updating procedure after handover or inter-system handover to S1 mode;

b)  the target cell is a shared network cell; and

-  the UE has provided its GUTI in the Old GUTI IE or the Additional GUTI IE in the TRACKING AREA UPDATE REQUEST message, and the PLMN identity included in the GUTI is different from the selected PLMN identity of the target cell; or

-  the UE has mapped the P-TMSI and RAI into the Old GUTI IE and not included an Additional GUTI IE in the TRACKING AREA UPDATE REQUEST message, and the PLMN identity included in the RAI is different from the selected PLMN identity of the target cell.

5.5.3.2.4  Normal and periodic tracking area updating procedure accepted by the network

If the tracking area update request has been accepted by the network, the MME shall send a TRACKING AREA UPDATE ACCEPT message to the UE. If the MME assigns a new GUTI for the UE, a GUTI shall be included in the TRACKING AREA UPDATE ACCEPT message. If the MME includes the GUTI IE in the TRACKING AREA UPDATE ACCEPT message, the MME shall start timer T3450 and enter state EMM-COMMON-PROCEDURE-INITIATED as described in clause  5.4.1. The MME may include a new TAI list for the UE in the TRACKING AREA UPDATE ACCEPT message. The MME shall not assign a TAI list containing both tracking areas in NB-S1 mode and tracking areas in WB-S1 mode.

NOTE  1:  When assigning the TAI list, the MME can take into account the eNodeB   's capability of support of CIoT EPS optimization.

If the UE has included the UE network capability IE or the MS network capability IE or both in the TRACKING AREA UPDATE REQUEST message, the MME shall store all octets received from the UE, up to the maximum length defined for the respective information element.

NOTE  2:  This information is forwarded to the new MME during inter-MME handover or to the new SGSN during inter-system handover to A/Gb mode or Iu mode.

NOTE  3:  For further details concerning the handling of the MS network capability and UE network capability in the MME see also 3GPP  S  23.401  [10].

In NB-S1 mode, if the tracking area update request is accepted by the network, the MME shall set the EMC BS bit to zero in the EPS network feature support IE included in the TRACKING AREA UPDATE ACCEPT message to indicate that support of emergency bearer services in NB-S1 mode is not available.

If a UE radio capability information update needed IE is included in the TRACKING AREA UPDATE REQUEST message, the MME shall delete the stored UE radio capability information or the UE radio capability ID, if any.

If the UE specific DRX parameter was included in the DRX Parameter IE in the TRACKING AREA UPDATE REQUEST message, the network shall replace any stored UE specific DRX parameter with the received parameter and use it for the downlink transfer of signalling and user data in WB-S1 mode.

In NB-S1 mode, if the DRX parameter in NB-S1 mode IE was included in the TRACKING AREA UPDATE REQUEST message, the MME shall provide to the UE the Negotiated DRX parameter in NB-S1 mode IE in the TRACKING AREA UPDATE ACCEPT message. The MME shall replace any stored UE specific DRX parameter in NB-S1 mode with the negotiated DRX parameter and use it for the downlink transfer of signalling and user data in NB-S1 mode.

NOTE  4:  In NB-S1 mode, if a DRX parameter was included in the Negotiated DRX parameter in NB-S1 mode IE in the TRACKING AREA UPDATE ACCEPT message, then the UE stores and uses the received DRX parameter in NB-S1 mode (see 3GPP  S  36.304  [21]). If the UE has included the DRX parameter in NB-S1 mode IE in the TRACKING AREA UPDATE REQUEST message, but did not receive a DRX parameter in the Negotiated DRX parameter in NB-S1 mode IE, or if the Negotiated DRX parameter in NB-S1 mode IE was not included in the TRACKING AREA UPDATE ACCEPT message, then the UE uses the cell specific DRX value in NB-S1 mode (see 3GPP  S  36.304  [21]).If the UE requests "control plane CIoT EPS optimization" in the Additional update type IE, indicates support of control plane CIoT EPS optimization in the UE network capability IE and the MME decides to accept the requested CIoT EPS optimization and the tracking area update request, the MME shall indicate "control plane CIoT EPS optimization supported" in the EPS network feature support IE.

In NB-S1 mode, if the UE requested "SMS only" in the Additional update type IE, supports NB-S1 mode only and the MME decides to accept the tracking area update request for EPS services and "SMS only", the MME shall indicate "SMS only" in the Additional update result IE and shall set the EPS update type IE to "TA updating" in the TRACKING AREA UPDATE ACCEPT message.

The MME shall include the extended DRX parameters IE in the TRACKING AREA UPDATE ACCEPT message only if the extended DRX parameters IE was included in the TRACKING AREA UPDATE REQUEST message, and the MME supports and accepts the use of eDRX.

If:

-  the UE supports WUS assistance; and

-  the MME supports and accepts the use of WUS assistance,

then the MME shall determine the negotiated UE paging probability information for the UE, store it in the EMM context of the UE, and if the UE is not attaching for emergency bearer services, the MME shall include it in the Negotiated WUS assistance information IE in the TRACKING AREA UPDATE ACCEPT message. The MME may take into account the UE paging probability information received in the Requested WUS assistance information IE when determining the negotiated UE paging probability information for the UE.

NOTE  5:  Besides the UE paging probability information requested by the UE, the MME can take local configuration or previous statistical information for the UE into account when determining the negotiated UE paging probability information for the UE (see 3GPP  S  23.401  [10]).

If the UE indicates support for EMM-REGISTERED without PDN connection in the TRACKING AREA UPDATE REQUEST message and the MME supports EMM-REGISTERED without PDN connection, the MME shall indicate this in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message. The UE and the MME shall use the information whether the peer entity supports EMM-REGISTERED without PDN connection as specified in the present clause  5 and in clause  6.

If an EPS bearer context status IE is included in the TRACKING AREA UPDATE REQUEST message, the MME shall deactivate all those EPS bearer contexts locally (without peer-to-peer signalling between the MME and the UE) which are in ESM state BEARER CONTEXT ACTIVE or BEARER CONTEXT MODIFY PENDING on the network side, but are indicated by the UE as being in ESM state BEARER CONTEXT INACTIVE. If a default EPS bearer context is marked as inactive in the EPS bearer context status IE included in the TRACKING AREA UPDATE REQUEST message, and this default bearer is not associated with the last remaining PDN connection of the UE in the MME, the MME shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the UE. If the default bearer is associated with the last remaining PDN connection of the UE in the MME, and EMM-REGISTERED without PDN connection is supported by the UE and the MME, the MME shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the UE. If the default EPS bearer context of a PDN connection established as a user-plane resource of an MA PDU session as specified in clause  5.3 of 3GPP  S  24.193  [61] is deactivated locally and the MA PDU session does not have user plane resources established on non-3GPP access in N1 mode, the network shall perform a local release of the MA PDU session.

If the EPS bearer context status IE is included in the TRACKING AREA UPDATE REQUEST, the MME shall include an EPS bearer context status IE in the TRACKING AREA UPDATE ACCEPT message, indicating which EPS bearer contexts are active in the MME except for the case no EPS bearer context exists on the network side.

If the EPS update type IE included in the TRACKING AREA UPDATE REQUEST message indicates "periodic updating", and the UE was previously successfully attached for EPS and non-EPS services, subject to operator policies the MME should allocate a TAI list that does not span more than one location area.

The MME shall indicate "combined TA/LA updated" or "combined TA/LA updated and ISR activated" in the EPS update result IE in the TRACKING AREA UPDATE ACCEPT message, if the following conditions apply:

-  the EPS update type IE included in the TRACKING AREA UPDATE REQUEST message indicates "periodic updating" and the UE was previously successfully attached for EPS and non-EPS services; and

-  location area updating for non-EPS services as specified in 3GPP  S  29.118  [16A] is successful.

The MME may include T3412 extended value IE in the TRACKING AREA UPDATE ACCEPT message only if the UE indicates support of the extended periodic timer T3412 in the MS network feature support IE in the TRACKING AREA UPDATE REQUEST message.

The MME shall include the T3324 value IE in the TRACKING AREA UPDATE ACCEPT message only if the T3324 value IE was included in the TRACKING AREA UPDATE REQUEST message, and the MME supports and accepts the use of PSM.

If the MME supports and accepts the use of PSM, and the UE included the T3412extended value IE in the TRACKING AREA UPDATE REQUEST message, then the MME shall take into account the T3412 value requested when providing the T3412 value IE and the T3412 extended value IE in the TRACKING AREA UPDATE ACCEPT message.

NOTE  6:  Besides the value requested by the MS, the MME can take local configuration or subscription data provided by the HSS into account when selecting a value for T3412 (see 3GPP  S  23.401  [10] clause  4.3.17.3).

If the MME includes the T3324 value IE indicating a value other than deactivated in the TRACKING AREA UPDATE ACCEPT message, then the MME shall indicate in the EPS update result IE in the TRACKING AREA UPDATE ACCEPT message that ISR is not activated.

Also, during the tracking area updating procedure without the "active" flag set, if the MME has deactivated EPS bearer context(s) locally for any reason, the MME shall inform the UE of the deactivated EPS bearer context(s) by including the EPS bearer context status IE in the TRACKING AREA UPDATE ACCEPT message.

Also, during the tracking area updating procedure with the "active" flag set, if the MME has deactivated EPS bearer context(s) associated with control plane only indication locally for any reason, the MME shall inform the UE of the deactivated EPS bearer context(s) by including the EPS bearer context status IE in the TRACKING AREA UPDATE ACCEPT message.

If the TRACKING AREA UPDATE ACCEPT message contains the DCN-ID IE, then the UE shall store the included DCN-ID value together with the PLMN code of the registered PLMN in a DCN-ID list in a non-volatile memory in the ME as specified in annex  C.

If due to regional subscription restrictions or access restrictions the UE is not allowed to access the TA, but it has a PDN connection for emergency bearer services established, the MME may accept the TRACKING AREA UPDATE REQUEST message and deactivate all non-emergency EPS bearer contexts by initiating an EPS bearer context deactivation procedure when the tracking area updating procedure is initiated in EMM-CONNECTED mode. When the tracking area updating procedure is initiated in EMM-IDLE mode, the MME locally deactivates all non-emergency EPS bearer contexts and informs the UE via the EPS bearer context status IE in the TRACKING AREA UPDATE ACCEPT message. The MME shall not deactivate the emergency EPS bearer contexts. The network shall consider the UE to be attached for emergency bearer services only and shall indicate in the EPS update result IE in the TRACKING AREA UPDATE ACCEPT message that ISR is not activated.

If a TRACKING AREA UPDATE REQUEST message is received from a UE with a LIPA PDN connection, and if:

-  a GW Transport Layer Address IE value identifying a L-GW is provided by the lower layer together with the TRACKING AREA UPDATE REQUEST message, and the P-GW address included in the EPS bearer context of the LIPA PDN Connection is different from the provided GW Transport Layer Address IE value (see 3GPP  S  36.413  [23]); or

-  no GW Transport Layer Address is provided together with the TRACKING AREA UPDATE REQUEST message by the lower layer,

then the MME locally deactivates all EPS bearer contexts associated with the LIPA PDN connection. Furthermore, the MME takes one of the following actions:

-  if no active EPS bearer contexts remain for the UE, the MME shall not accept the tracking area update request as specified in clause  5.5.3.2.5;

-  if active EPS bearer contexts remain for the UE and the TRACKING AREA UPDATE REQUEST message is accepted, the MME informs the UE via the EPS bearer context status IE in the TRACKING AREA UPDATE ACCEPT message that EPS bearer contexts were locally deactivated.

If a TRACKING AREA UPDATE REQUEST message is received from a UE with a SIPTO at the local network PDN connection, is accepted by the network, the following different cases can be distinguished:

1)  If the PDN connection is a SIPTO at the local network PDN connection with collocated L-GW and if:

-  a SIPTO L-GW Transport Layer Address IE value identifying a L-GW is provided by the lower layer together with the TRACKING AREA UPDATE REQUEST message, and the P-GW address included in the EPS bearer context of the SIPTO at the local network PDN connection is different from the provided SIPTO L-GW Transport Layer Address IE value (see 3GPP  S  36.413  [23]); or

-  no SIPTO L-GW Transport Layer Address is provided together with the TRACKING AREA UPDATE REQUEST message by the lower layer,

2)  If the PDN connection is a SIPTO at the local network PDN connection with stand-alone GW and if:

-  a LHN-ID value is provided by the lower layer together with the TRACKING AREA UPDATE REQUEST message, and the LHN-ID stored in the EPS bearer context of the SIPTO at the local network PDN connection is different from the provided LHN-ID value (see 3GPP  S  36.413  [23]); or

-  no LHN-ID value is provided together with the TRACKING AREA UPDATE REQUEST message by the lower layer,

then the MME takes one of the following actions:

-  if the SIPTO at the local network PDN connection is the last remaining PDN connection for the UE, and EMM-REGISTERED without PDN connection is not supported by the UE or the MME, then the MME shall upon completion of the tracking area updating procedure detach the UE by using detach type "re-attach required" (see clause  5.5.2.3.1);

-  if the SIPTO at the local network PDN connection is the last remaining PDN connection for the UE, and EMM-REGISTERED without PDN connection is supported by the UE and the MME, then the MME shall upon completion of the tracking area updating procedure initiate an EPS bearer context deactivation procedure with ESM cause #39 "reactivation requested" for the default EPS bearer context of the SIPTO at the local network PDN connection (see clause 6.4.4.2); and

-  if a PDN connection remains that is not SIPTO at the local network PDN connection, the MME shall upon completion of the tracking area updating procedure initiate an EPS bearer context deactivation procedure with ESM cause  #39 "reactivation requested" for the default EPS bearer context of each SIPTO at the local network PDN connection (see clause  6.4.4.2);

For a SIPTO at the local network PDN connection with stand-alone GW, the conditions to deactivate ISR are specified in 3GPP  S  23.401  [10], clause  4.3.5.6.

For a shared network, the TAIs included in the TAI list can contain different PLMN identities. The MME indicates the selected core network operator PLMN identity to the UE in the GUTI (see 3GPP  S  23.251  [8B]).

If the "active" flag is set in the TRACKING AREA UPDATE REQUEST message and control plane CIoT EPS optimization is not used by the MME, the MME shall re-establish the radio and S1 bearers for all active EPS bearer contexts. If the "active" flag is set in the TRACKING AREA UPDATE REQUEST message and control plane CIoT EPS optimization is used by the MME, the MME shall re-establish the radio and S1 bearers for all active EPS bearer contexts associated with PDN connections established without Control plane only indication.

If the "signalling active" flag is set in the TRACKING AREA UPDATE REQUEST message and control plane CIoT EPS optimization is used by the MME, the MME shall not immediately release the NAS signalling connection after the completion of the tracking area updating procedure.

If the "active" flag is not set in the TRACKING AREA UPDATE REQUEST message and control plane CIoT EPS optimization is not used by the MME, the MME may also re-establish the radio and S1 bearers for all active EPS bearer contexts due to downlink pending data or downlink pending signalling, except for the case when the TRACKING AREA UPDATE REQUEST message includes the UE request type IE and the Request type is set to "NAS signalling connection release". If the "active" flag is not set in the TRACKING AREA UPDATE REQUEST message and control plane CIoT EPS optimization is used by the MME, the MME may also re-establish the radio and S1 bearers for all active EPS bearer contexts associated with PDN connections established without Control plane only indication due to downlink pending data or downlink pending signalling, except for the case when the TRACKING AREA UPDATE REQUEST message includes the UE request type IE and the Request type is set to "NAS signalling connection release".

If the MME supports NB-S1 mode, non-IP or Ethernet PDN type, inter-system change with 5GS, UAS services or the network wants to enforce the use of DNS over (D)TLS (see 3GPP  S  33.501  [24]), then the MME shall support the extended protocol configuration options IE.

NOTE  7:  Support of DNS over (D)TLS is based on the informative requirements as specified in 3GPP  S  33.401  [19] and it is implemented based on the operator requirement.

If the MME supports the extended protocol configuration options IE and the UE indicated support of the extended protocol configuration options IE, then the MME shall set the ePCO bit to "extended protocol configuration options supported" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message.

If the UE indicates support for restriction on use of enhanced coverage in the TRACKING AREA UPDATE REQUEST message, and the network decides to restrict the use of enhanced coverage for the UE, then the MME shall set the RestrictEC bit to "Use of enhanced coverage is restricted" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message.

The MME may indicate the header compression configuration status IE in the TRACKING AREA UPDATE ACCEPT message for each established EPS bearer context using control plane CIoT EPS optimisation.

If the UE has indicated support for the control plane data back-off timer, and the MME decides to activate the congestion control for transport of user data via the control plane, then the MME shall include the T3448 value IE in the TRACKING AREA UPDATE ACCEPT message.

If the UE indicates support for dual connectivity with NR in the TRACKING AREA UPDATE REQUEST message, and the MME decides to restrict the use of dual connectivity with NR for the UE, then the MME shall set the RestrictDCNR bit to "Use of dual connectivity with NR is restricted" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message.

If the UE indicates support for N1 mode in the TRACKING AREA UPDATE REQUEST message and the MME supports inter-system interworking with 5GS, the MME may set the IWK N26 bit to either:

-  "interworking without N26 interface not supported" if the MME supports N26 interface; or

-  "interworking without N26 interface supported" if the MME does not support N26 interface

in the EPS network feature support IE in the TRACKING AREA UPDATE ACCEPT message.

If the MME determines the UE   's N1 mode capability for 3GPP access changes from " N1 mode not supported " to " N1 mode supported " and the network decides to enable the transfer of a PDN connection not supporting interworking to 5GS from S1 mode to N1 mode, the MME may upon completion of the tracking area updating procedure initiate an EPS bearer context deactivation procedure to deactivate the default EPS bearer context of the PDN connection by including ESM cause #39 "reactivation requested" in the DEACTIVATE EPS BEARER CONTEXT REQUEST message (see clause 6.4.4.2).

If due to operator policies unsecured redirection to a GERAN cell is not allowed in the current PLMN, the MME shall set the redir-policy bit to "Unsecured redirection to GERAN not allowed" in the Network policy IE of the TRACKING AREA UPDATE ACCEPT message.

If the UE has indicated support for service gap control, a service gap time value is available in the EMM context, the MME may include the T3447 value IE set to the service gap time value in the TRACKING AREA UPDATE ACCEPT message.

If the network supports signalling for a maximum number of 15 EPS bearer contexts and the UE indicated support of signalling for a maximum number of 15 EPS bearer contexts in the TRACKING AREA UPDATE REQUEST message, then the MME shall set the 15 bearers bit to "Signalling for a maximum number of 15 EPS bearer contexts supported" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message.

If the UE indicates support of the NAS signalling connection release in the TRACKING AREA UPDATE REQUEST message and the network decides to accept the NAS signalling connection release, then the MME shall set the NAS signalling connection release bit to "NAS signalling connection release supported" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message.

If the UE indicates support of the paging indication for voice services in the TRACKING AREA UPDATE REQUEST message and the network decides to accept the paging indication for voice services, then the MME shall set the paging indication for voice services bit to "paging indication for voice services supported" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message. If the UE receives the TRACKING AREA UPDATE ACCEPT message with the paging indication for voice services bit set to "paging indication for voice services supported", the UE NAS layer informs the lower layers that paging indication for voice services is supported. Otherwise, the UE NAS layer informs the lower layers that paging indication for voice services is not supported.

If the UE indicates support of the reject paging request in the TRACKING AREA UPDATE REQUEST message and the network decides to accept the reject paging request, then the MME shall set the reject paging request bit to "reject paging request supported" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message.

If the UE indicates support of the paging restriction in the TRACKING AREA UPDATE REQUEST message, and the MME sets:

-  the reject paging request bit to "reject paging request supported";

-  the NAS signalling connection release bit to "NAS signalling connection release supported"; or

-  both of them;

in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message, and the network decides to accept the paging restriction, then the MME shall set the paging restriction bit to "paging restriction supported" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message.

If the UE indicates support of the paging timing collision control in the TRACKING AREA UPDATE REQUEST message and the network decides to accept the paging timing collision control, then the MME shall set the paging timing collision control bit to "paging timing collision control supported" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message.

If the UE requests ciphering keys for ciphered broadcast assistance data in the TRACKING AREA UPDATE REQUEST message and the MME has valid ciphering key data applicable to the UE   's subscription, then the MME shall include the ciphering key data in the Ciphering key data IE of the TRACKING AREA UPDATE ACCEPT message.

If the MUSIM UE does not include the Paging restriction IE in the TRACKING AREA UPDATE REQUEST message, the MME shall delete any stored paging restriction for the UE and stop restricting paging.

If the MUSIM UE has included a Requested IMSI offset IE in the TRACKING AREA UPDATE REQUEST message with the EPS update type IE not indicating "periodic updating" and if the MME supports paging timing collision control, the MME shall include the Negotiated IMSI offset IE and assign a new GUTI in the TRACKING AREA UPDATE ACCEPT message, and the MME shall set the IMSI offset value to:

-  A value that is different than what the UE has provided, if the MME has a different value; or

-  A value that is same as what the UE has provided, if the MME does not have a different value;

and the MME shall calculate an alternative IMSI value using the IMSI offset value and store it in the UE context as specified in 3GPP  S  23.401  [10]. The alternative IMSI value is used for deriving the paging occasion as specified in 3GPP  S  36.304  [21].

If the MUSIM UE has not included a Requested IMSI offset IE in the TRACKING AREA UPDATE REQUEST message with the EPS update type IE not indicating "periodic updating" and the MME has stored an alternative IMSI value for that UE, the MME shall erase the alternative IMSI value and assign a new GUTI in the TRACKING AREA UPDATE ACCEPT message.

If the MUSIM UE  requests the release of the NAS signalling connection, by setting Request type to "NAS signalling connection release" in the UE request type IE in the TRACKING AREA UPDATE REQUEST message, and the MME supports the NAS signalling connection release, the MME shall initiate the release of the NAS signalling connection after the completion of the tracking area updating procedure. If the UE requests restriction of paging by including the Paging restriction IE in the TRACKING AREA UPDATE REQUEST message and the MME supports the paging restriction, the MME:

-  if accepts the paging restriction, shall include the EPS additional request result IE in the TRACKING AREA UPDATE ACCEPT message and set the Paging restriction decision to "paging restriction is accepted". The MME shall store the paging restriction of the UE and enforce these restrictions in the paging procedure as described in clause  5.6.2; or

-  if rejects the paging restriction, shall include the EPS additional request result IE in the TRACKING AREA UPDATE ACCEPT message and set the Paging restriction decision to "paging restriction is rejected", and shall discard the received paging restriction. The MME shall delete any stored paging restriction for the UE and stop restricting paging.

Upon receiving a TRACKING AREA UPDATE ACCEPT message, the UE shall stop timer T3430, reset the service request attempt counter, tracking area updating attempt counter, enter state EMM-REGISTERED and set the EPS update status to EU1 UPDATED. If the message contains a GUTI, the UE shall use this GUTI as new temporary identity for EPS services and shall store the new GUTI. If no GUTI was included by the MME in the TRACKING AREA UPDATE ACCEPT message, the old GUTI shall be used. If the UE receives a new TAI list in the TRACKING AREA UPDATE ACCEPT message, the UE shall consider the new TAI list as valid and the old TAI list as invalid; otherwise, the UE shall consider the old TAI list as valid.

If the UE receives the TRACKING AREA UPDATE ACCEPT message from a PLMN for which a PLMN-specific attempt counter or PLMN-specific PS-attempt counter is maintained (see clause  5.3.7b), then the UE shall reset these counters. If the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", then the UE shall reset this counter.

If the TRACKING AREA UPDATE ACCEPT message contains the T3412 extended value IE, then the UE shall use the T3412 extended value IE as periodic tracking area update timer (T3412). If the TRACKING AREA UPDATE ACCEPT contains T3412 value IE, but not T3412 extended value IE, then the UE shall use value in T3412 value IE as periodic tracking area update timer (T3412). If neither T3412 value IE nor T3412 extended value IE is included, the UE shall use the value currently stored, e.g. from a prior ATTACH ACCEPT or TRACKING AREA UPDATE ACCEPT message.

If the TRACKING AREA UPDATE ACCEPT message contains the T3324 value IE, then the UE shall use the timer value for T3324 as specified in 3GPP  S  24.008  [13], clause  4.7.2.8.

If the UE had initiated the tracking area updating procedure in EMM-IDLE mode to perform an inter-system change from A/Gb mode or Iu mode to S1 mode and the nonceUE was included in the TRACKING AREA UPDATE REQUEST message, the UE shall delete the nonceUE upon receipt of the TRACKING AREA UPDATE ACCEPT message.

If an EPS bearer context status IE is included in the TRACKING AREA UPDATE ACCEPT message, the UE shall deactivate all those EPS bearers contexts locally (without peer-to-peer signalling between the UE and the MME) which are active in the UE, but are indicated by the MME as being inactive. If a default EPS bearer context is marked as inactive in the EPS bearer context status IE included in the TRACKING AREA UPDATE ACCEPT message, and this default bearer is not associated with the last remaining PDN connection in the UE, the UE shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the MME. If only the PDN connection for emergency bearer services remains established, the UE shall consider itself attached for emergency bearer services only. If the default bearer is associated with the last remaining PDN connection of the UE in the MME, and EMM-REGISTERED without PDN connection is supported by the UE and the MME, the UE shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the UE. If the default EPS bearer context of a PDN connection established as a user-plane resource of an MA PDU session as specified in clause  5.3 of 3GPP  S  24.193  [61] is deactivated locally and the MA PDU session does not have user plane resources established on non-3GPP access in N1 mode, the UE shall perform a local release of the MA PDU session.

If an EPS bearer context status IE is included in the TRACKING AREA UPDATE ACCEPT message, the UE may choose to ignore all those EPS bearers which are indicated by the MME as being active but are inactive at the UE.

If a Negotiated IMSI offset IE is included in the TRACKING AREA UPDATE ACCEPT message, the MUSIM UE shall forward the IMSI offset value to lower layers. If a Negotiated IMSI offset IE is not included in the TRACKING AREA UPDATE ACCEPT message and the EPS update type IE included in the TRACKING AREA UPDATE REQUEST message does not indicate "periodic updating", the MUSIM UE shall indicate to lower layers to erase any IMSI offset value, if available.

The MME may also include a list of equivalent PLMNs in the TRACKING AREA UPDATE ACCEPT message. Each entry in the list contains a PLMN code (MCC+MNC). The UE shall store the list as provided by the network, and if there is no PDN connection for emergency bearer services or PDN connection for RLOS established, the UE shall remove from the list any PLMN code that is already in the list of "forbidden PLMNs" or in the list of "forbidden PLMNs for GPRS service". If the UE is not attached for emergency bearer services and there is a PDN connection for emergency bearer services established, the UE shall remove from the list of equivalent PLMNs any PLMN code present in the list of forbidden PLMNs or in the list of "forbidden PLMNs for GPRS service" when the PDN connection for emergency bearer services is released. In addition, the UE shall add to the stored list the PLMN code of the registered PLMN that sent the list. The UE shall replace the stored list on each receipt of the TRACKING AREA UPDATE ACCEPT message. If the TRACKING AREA UPDATE ACCEPT message does not contain a list, then the UE shall delete the stored list.

If the UE is neither attached for emergency bearer services nor attached for access to RLOS, and if the PLMN identity of the registered PLMN is a member of the list of "forbidden PLMNs" or the list of "forbidden PLMNs for GPRS service", any such PLMN identity shall be deleted from the corresponding list(s).

The network may also indicate in the EPS update result IE in the TRACKING AREA UPDATE ACCEPT message that ISR is active. If the UE is attached for emergency bearer services, the network shall indicate in the EPS update result IE in the TRACKING AREA UPDATE ACCEPT message that ISR is not activated. If the TRACKING AREA UPDATE ACCEPT message contains:

i)  no indication that ISR is activated, the UE shall set the TIN to "GUTI" and shall stop the periodic routing area update timer T3312 or T3323, if running;

ii)  an indication that ISR is activated, then:

-  if the UE is required to perform routing area updating for IMS voice termination as specified in 3GPP  S  24.008  [13], annex  P.5, the UE shall set the TIN to "GUTI" and shall stop the periodic routing area update timer T3312 or T3323, if running;

-  if the UE had initiated the tracking area updating procedure due to a change in UE network capability or change in DRX parameters, the UE shall set the TIN to "GUTI" and shall stop the periodic routing area update timer T3312 or T3323, if running;

-  if the UE had initiated the tracking area updating procedure due to a change in the UE   's usage setting or the voice domain preference for E-UTRAN, the UE shall set the TIN to "GUTI" and shall stop the periodic routing area update timer T3312 or T3323, if running; or

-  the UE shall regard a previously assigned P-TMSI and RAI as valid and registered with the network. If the TIN currently indicates "P-TMSI" and the periodic routing area update timer T3312 is running or is deactivated, the UE shall set the TIN to "RAT-related TMSI". If the TIN currently indicates "P-TMSI" and the periodic routing area update timer T3312 has already expired, the UE shall set the TIN to "GUTI".

The network informs the UE about the support of specific features, such as IMS voice over PS session, location services (EPC-LCS, CS-LCS), emergency bearer services, or CIoT EPS optimizations, in the EPS network feature support information element. In a UE with IMS voice over PS capability, the IMS voice over PS session indicator and the emergency bearer services indicator shall be provided to the upper layers. The upper layers take the IMS voice over PS session indicator into account as specified in 3GPP  S  23.221  [8A], clause  7.2a and clause  7.2b, when selecting the access domain for voice sessions or calls. When initiating an emergency call, the upper layers also take both the IMS voice over PS session indicator and the emergency bearer services indicator into account for the access domain selection. When the UE determines via the IMS voice over PS session indicator that the network does not support IMS voice over PS sessions in S1 mode, then the UE shall not locally release any persistent EPS bearer context. When the UE determines via the emergency bearer services indicator that the network does not support emergency bearer services in S1 mode, then the UE shall not locally release any emergency EPS bearer context if there is a radio bearer associated with that context. In a UE with LCS capability, location services indicators (EPC-LCS, CS-LCS) shall be provided to the upper layers. When MO-LR procedure is triggered by the UE   's application, those indicators are taken into account as specified in 3GPP  S  24.171  [13C].

If the MME received the list of TAIs from the satellite E-UTRAN as described in 3GPP  S  23.401  [10], and determines that any but not all TAIs in the received list of TAIs is forbidden for roaming or for regional provision of service as per operator   's choice, the MME shall include the TAI(s) in:

a)  the Forbidden TAI(s) for the list of "forbidden tracking areas for roaming" IE;

b)  the Forbidden TAI(s) for the list of "forbidden tracking areas for regional provision of service" IE; or

c)  both;

in the TRACKING AREA UPDATE ACCEPT message.

NOTE  8:  "Forbidden tracking areas for roaming" corresponds to cause values #13 and #15, and "forbidden tracking areas for regional provision of service" corresponds cause value #12.

If the RestrictDCNR bit is set to "Use of dual connectivity with NR is restricted" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message, the UE shall provide the indication that dual connectivity with NR is restricted to the upper layers.

The UE supporting N1 mode shall operate in the mode for inter-system interworking with 5GS as follows:

-  if the IWK N26 bit in the EPS network feature support IE is set to "interworking without N26 interface not supported", the UE shall operate in single-registration mode;

-  if the IWK N26 bit in the EPS network feature support IE is set to "interworking without N26 interface supported" and the UE supports dual-registration mode, the UE may operate in dual-registration mode; or

NOTE  9:  The registration mode used by the UE is implementation dependent.

-  if the IWK N26 bit in the EPS network feature support IE is set to "interworking without N26 interface supported" and the UE only supports single-registration mode, the UE shall operate in single-registration mode.

The UE shall treat the interworking without N26 interface indicator as valid in the entire PLMN and equivalent PLMNs. The interworking procedures required for coordination between 5GMM and EMM without N26 interface are specified in 3GPP  S  24.501  [54].

If the redir-policy bit is set to "Unsecured redirection to GERAN not allowed" in the Network policy IE of the TRACKING AREA UPDATE ACCEPT message, the UE shall set the network policy on unsecured redirection to GERAN for the current PLMN to "Unsecured redirection to GERAN not allowed" and indicate to the lower layers that unsecured redirection to a GERAN cell is not allowed. If the redir-policy bit is set to "Unsecured redirection to GERAN allowed" or if the Network policy IE is not included in the TRACKING AREA UPDATE ACCEPT message, the UE shall set the network policy on unsecured redirection to GERAN for the current PLMN to "Unsecured redirection to GERAN allowed" and indicate to the lower layers that unsecured redirection to a GERAN cell is allowed. The UE shall set the network policy on unsecured redirection to GERAN to "Unsecured redirection to GERAN not allowed" and indicate this to the lower layers when any of the following events occurs:

-  the UE initiates an EPS attach or tracking area updating procedure in a PLMN different from the PLMN where the UE performed the last successful EPS attach or tracking area updating procedure;

-  the UE is switched on; or

-  the UICC containing the USIM is removed.

If the UE has initiated the tracking area updating procedure due to manual CSG selection and receives a TRACKING AREA UPDATE ACCEPT message, and the UE sent the TRACKING AREA UPDATE REQUEST message in a CSG cell, the UE shall check if the CSG ID and associated PLMN identity of the cell where the UE has sent the TRACKING AREA UPDATE REQUEST message are contained in the Allowed CSG list. If not, the UE shall add that CSG ID and associated PLMN identity to the Allowed CSG list and the UE may add the HNB Name (if provided by lower layers) to the Allowed CSG list if the HNB Name is present in neither the Operator CSG list nor the Allowed CSG list.

If the TRACKING AREA UPDATE ACCEPT message contained a GUTI, the UE shall return a TRACKING AREA UPDATE COMPLETE message to the MME to acknowledge the received GUTI or the received Negotiated IMSI offset IE. If the UE has a negotiated IMSI offset value stored at the lower layers and the TRACKING AREA UPDATE ACCEPT message does not contain the Negotiated IMSI offset IE, the UE shall return a TRACKING AREA UPDATE COMPLETE message to the MME, and the MME shall erase the stored alternative IMSI value for the UE upon receiving the TRACKING AREA UPDATE COMPLETE message.

If the UE which was previously successfully attached for EPS and non-EPS services receives the TRACKING AREA UPDATE ACCEPT message with EPS update result IE indicating "combined TA/LA updated" or "combined TA/LA updated and ISR activated" as the response of the TRACKING AREA UPDATE REQUEST message with EPS update type IE indicating "periodic updating", the UE shall behave as follows:

-  If the TRACKING AREA UPDATE ACCEPT message contains an IMSI, the UE is not allocated any TMSI, and shall delete any old TMSI accordingly.

-  If the TRACKING AREA UPDATE ACCEPT message contains a TMSI, the UE shall use this TMSI as new temporary identity. The UE shall delete its old TMSI and shall store the new TMSI. In this case, a TRACKING AREA UPDATE COMPLETE message is returned to the network to confirm the received TMSI.

-  If neither a TMSI nor an IMSI has been included by the network in the TRACKING AREA UPDATE ACCEPT message, the old TMSI, if any is available, shall be kept.

If the header compression configuration status is included in the TRACKING AREA UPDATE ACCEPT message, the UE shall stop using header compression and decompression for those EPS bearers using Control plane CIoT EPS optimisation for which the MME indicated that the header compression configuration is not used.

If the T3448 value IE is present in the received TRACKING AREA UPDATE ACCEPT message, the UE shall:

-  stop timer T3448 if it is running; and

-  start timer T3448 with the value provided in the T3448 value IE.

If the UE is using EPS services with control plane CIoT EPS optimization, the T3448 value IE is present in the TRACKING AREA UPDATE ACCEPT message and the value indicates that this timer is either zero or deactivated, the UE shall consider this case as an abnormal case and proceed as if the T3448 value IE is not present.

If the UE in EMM-IDLE mode initiated the tracking area updating procedure and the TRACKING AREA UPDATE ACCEPT message does not include the T3448 value IE and if timer T3448 is running, then the UE shall stop timer T3448.

If the UE has indicated "service gap control supported" in the TRACKING AREA UPDATE REQUEST message and:

-  the TRACKING AREA UPDATE ACCEPT message contains the T3447 value IE, then the UE shall store the new T3447 value, erase any previous stored T3447 value if exists and use the new T3447 value with the T3447 timer next time it is started; or

-  the TRACKING AREA UPDATE ACCEPT message does not contain the T3447 value IE, then the UE shall erase any previous stored T3447 value if exists and stop the T3447 timer if running.

Upon receiving a TRACKING AREA UPDATE COMPLETE message, the MME shall stop timer T3450 and change to state EMM-REGISTERED. The GUTI, the Negotiated IMSI offset, or both, if sent in the TRACKING AREA UPDATE ACCEPT message, shall be considered as valid.

NOTE  10:  Upon receiving a TRACKING AREA UPDATE COMPLETE message, if a new TMSI was included in the TRACKING AREA UPDATE ACCEPT message, the MME sends an SGsAP-TMSI-REALLOCATION-COMPLETE message as specified in 3GPP  S  29.118  [16A].

For inter-system change from A/Gb mode to S1 mode or Iu mode to S1 mode in EMM-IDLE mode, if the UE has included an eKSI in the NAS Key Set Identifier IE indicating a current EPS security context in the TRACKING AREA UPDATE REQUEST message by which the TRACKING AREA UPDATE REQUEST message is integrity protected, the MME shall take one of the following actions:

-  if the MME retrieves the current EPS security context as indicated by the eKSI and GUTI sent by the UE, the MME shall integrity check the TRACKING AREA UPDATE REQUEST message using the current EPS security context and integrity protect the TRACKING AREA UPDATE ACCEPT message using the current EPS security context;

-  if the MME cannot retrieve the current EPS security context as indicated by the eKSI and GUTI sent by the UE, and if the UE has included a valid GPRS ciphering key sequence number, the MME shall create a new mapped EPS security context as specified in 3GPP  S  33.401  [19], and then perform a security mode control procedure to indicate the use of the new mapped EPS security context to the UE (see clause  5.4.3.2); or

-  if the UE has not included an Additional GUTI IE, the MME may treat the TRACKING AREA UPDATE REQUEST message as in the previous item, i.e. as if it cannot retrieve the current EPS security context.

NOTE  11:  The handling described above at failure to retrieve the current EPS security context or if no Additional GUTI IE was provided does not preclude the option for the MME to perform an EPS authentication procedure and create a new native EPS security context.

For inter-system change from A/Gb mode to S1 mode or Iu mode to S1 mode in EMM-IDLE mode, if the UE has not included a valid eKSI in the NAS Key Set Identifier IE and has included a valid GPRS ciphering key sequence number in the TRACKING AREA UPDATE REQUEST message, the MME shall create a new mapped EPS security context as specified in 3GPP  S  33.401  [19], and then perform a security mode control procedure to indicate the use of the new mapped EPS security context to the UE (see clause  5.4.3.2).

NOTE  12:  This does not preclude the option for the MME to perform an EPS authentication procedure and create a new native EPS security context.

For inter-system change from N1 mode to S1 mode in EMM-IDLE mode, if the UE has included an eKSI in the NAS Key Set Identifier IE indicating a 5G NAS security context in the TRACKING AREA UPDATE REQUEST message by which the TRACKING AREA UPDATE REQUEST message is integrity protected, the MME shall take actions as specified in clause  4.4.2.3.

For inter-system change from A/Gb mode to S1 mode or Iu mode to S1 mode in EMM-CONNECTED mode, the MME shall integrity check TRACKING AREA UPDATE REQUEST message using the current K   'ASME as derived when triggering the handover to E-UTRAN (see clause  4.4.2.2). The MME shall verify the received UE security capabilities in the TRACKING AREA UPDATE REQUEST message. The MME shall then take one of the following actions:

-  if the TRACKING AREA UPDATE REQUEST does not contain a valid KSIASME in the Non-current native NAS key set identifier IE, the MME shall remove the non-current native EPS security context, if any, for any GUTI for this UE. The MME shall then integrity protect and cipher the TRACKING AREA UPDATE ACCEPT message using the security context based on K   'ASME and take the mapped EPS security context into use; or

-  if the TRACKING AREA UPDATE REQUEST contains a valid KSIASME in the Non-current native NAS key set identifier IE, the MME may initiate a security mode control procedure to take the corresponding native EPS security context into use.

For inter-system change from N1 mode to S1 mode in EMM-CONNECTED mode, the MME shall integrity check TRACKING AREA UPDATE REQUEST message using the current K   'ASME as derived when triggering the handover to E-UTRAN (see clause  4.4.2.2). The MME shall verify the received UE security capabilities in the TRACKING AREA UPDATE REQUEST message. The MME shall then take one of the following actions:

-  if the TRACKING AREA UPDATE REQUEST does not contain a valid KSIASME in the Non-current native NAS key set identifier IE, the MME shall remove the non-current native EPS security context, if any, for any GUTI for this UE. The MME shall then integrity protect and cipher the TRACKING AREA UPDATE ACCEPT message using the security context based on K   'ASME and take the mapped EPS security context into use; or

-  if the TRACKING AREA UPDATE REQUEST contains a valid KSIASME in the Non-current native NAS key set identifier IE, the MME may initiate a security mode control procedure to take the corresponding native EPS security context into use.

In WB-S1 mode, if the UE has set the RACS bit to "RACS supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message, the MME may include a UE radio capability ID IE or a UE radio capability ID deletion indication IE in the TRACKING AREA UPDATE ACCEPT message. In this case the MME shall enter state EMM-COMMON-PROCEDURE-INITIATED as described in clause  5.4.1.

In WB-S1 mode, if the UE has set the RACS bit to "RACS supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message and the TRACKING AREA UPDATE ACCEPT message includes:

-  a UE radio capability ID deletion indication IE set to "Network-assigned UE radio capability IDs deletion requested", the UE shall:

a)  delete any network-assigned UE radio capability IDs associated with the registered PLMN stored at the UE;

b)  send a TRACKING AREA UPDATE COMPLETE message to the network to acknowledge the received UE radio capability ID deletion indication IE; and

c)  after the completion of the ongoing tracking area updating procedure, initiate a tracking area updating procedure as specified in clause  5.5.3 over the existing NAS signalling connection except if there is a pending service request procedure as response to paging for CS fallback; and

-  a UE radio capability ID IE, the UE shall:

a)  store the UE radio capability ID as specified in annex  C; and

b)  send a TRACKING AREA UPDATE COMPLETE message to the network to acknowledge the received UE radio capability ID IE.

If the UE receives the Forbidden TAI(s) for the list of "forbidden tracking areas for roaming" IE in the TRACKING ARE UPDATE ACCEPT message and the TAI(s) included in the IE is not part of the list of "forbidden tracking areas for roaming", the UE shall store the TAI(s) included in the IE into the list of "forbidden tracking areas for roaming" and remove the TAI(s) from the stored TAI list if present.

If the UE receives the Forbidden TAI(s) for the list of "forbidden tracking areas for regional provision of service" IE in the TRACKING AREA UPDATE ACCEPT message and the TAI(s) included in the IE is not part of the list of "forbidden tracking areas for regional provision of service", the UE shall store the TAI(s) included in the IE into the list of "forbidden tracking areas for regional provision of service" and remove the TAI(s) from the stored TAI list if present.

5.5.3.2.4A  Tracking area updating successful for EPS services and not accepted for SMS services

Apart from the actions on the tracking area updating attempt counter, the description for tracking area update for EPS services as specified in clause  5.5.3.2.4 shall be followed. In addition, the following description for tracking area updating for SMS services applies.

In NB-S1 mode, if the UE requested "SMS only" in the Additional update type IE and supports NB-S1 mode only, the MME decides to accept the tracking area update request for EPS services only and:

-  the location update for non-EPS services is not accepted by the VLR as specified in 3GPP  S  29.118  [16A]; or

-  the MME decides to not accept the tracking area update request for "SMS only",

the MME shall set the EPS update result IE to "EPS only", shall not indicate "SMS only" in the Additional update result IE in the TRACKING AREA UPDATE ACCEPT message and shall include an appropriate SMS services status value.

The UE receiving the TRACKING AREA UPDATE ACCEPT message takes one of the following actions depending on the value included in the SMS services status IE:

"SMS services not available"

  The UE shall stop timer T3430 if still running, shall reset the tracking area updating attempt counter, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE. The USIM shall be considered as invalid for SMS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in clause  5.3.7a.

"SMS services not available in this PLMN"

  The UE shall stop timer T3430 if still running, shall reset the tracking area updating attempt counter, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE.

  The UE may provide a notification to the user or the upper layers that the SMS services are not available.

  The UE shall not attempt normal attach or tracking area updating procedures indicating "SMS only" with current PLMN until switching off the UE or the UICC containing the USIM is removed. Additionally, the UE may perform a PLMN selection according to 3GPP  S  23.122  [6].

"Network failure"

  The UE shall stop timer T3430 if still running. The tracking area updating attempt counter shall be incremented, unless it was already set to 5.

  If the tracking area updating attempt counter is less than 5:

-  the UE shall start timer T3411, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE. When timer T3411 expires the normal tracking area updating procedure for EPS services and "SMS only" or the combined tracking area updating procedure for EPS services and "SMS only" is triggered.

  If the tracking area updating attempt counter is equal to 5:

-  the UE shall start timer T3402, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE. When timer T3402 expires the normal tracking area updating procedure for EPS services and "SMS only" or the combined tracking area updating procedure for EPS services and "SMS only" is triggered.

"Congestion"

  The UE shall stop the timer T3430 if still running. The tracking area updating attempt counter shall be set to  5. The UE shall start the timer T3402, shall set the EPS update status to EU1 UPDATED, and shall enter state EMM-REGISTERED.NORMAL-SERVICE. When timer T3402 expires the normal tracking area updating procedure for EPS services and "SMS only" or the combined tracking area updating procedure for EPS services and "SMS only" is triggered.

Other values are considered as abnormal cases. The tracking area updating procedure shall be considered as failed for SMS services. The behaviour of the UE in those cases is specified in clause  5.5.3.2.6A.

5.5.3.2.5  Normal and periodic tracking area updating procedure not accepted by the network

If the tracking area updating cannot be accepted by the network, the MME sends a TRACKING AREA UPDATE REJECT message to the UE including an appropriate EMM cause value.

If a tracking area update request from a UE with a LIPA PDN connection is not accepted due to the reasons specified in clause  5.5.3.2.4, the MME shall send the TRACKING AREA UPDATE REJECT message with EMM cause value #10 "Implicitly detached".

If the tracking area update request is rejected due to general NAS level mobility management congestion control, the network shall set the EMM cause value to #22 "congestion" and assign a value for back-off timer T3346.

In NB-S1 mode, if the tracking area update request is rejected due to operator determined barring (see 3GPP  S  29.272  [16C]), the network shall set the EMM cause value to #22 "congestion" and assign a value for back-off timer T3346.

If the tracking area request is rejected due to service gap control as specified in clause  5.3.17 i.e. the T3447 timer is running, the network shall set the EMM cause value to #22 "congestion" and may assign a back-off timer T3346 with the remaining time of the running T3447 timer.

If the tracking area update request is rejected due to incompatibility between the CIoT EPS optimizations supported by the UE and what the network supports and the network sets the EMM cause value to #15 "no suitable cells in tracking area", the network may additionally include the Extended EMM cause IE with value "requested EPS optimization not supported".

NOTE  1:  How the UE uses the Extended EMM cause IE with value "requested EPS optimization not supported" is implementation specific. The UE still behaves according to the EMM cause value #15.

Based on operator policy, if the tracking area update request is rejected due to core network redirection for CIoT optimizations, the network shall set the EMM cause value to #31 "Redirection to 5GCN required".

NOTE  2:  The network can take into account the UE   's N1 mode capability, the 5GS CIoT network behaviour supported by the UE or the 5GS CIoT network behaviour supported by the 5GCN to determine the rejection with the EMM cause value #31 "Redirection to 5GCN required".

If the UE initiated the tracking area updating procedure due to inter-system change from N1 mode to S1 mode, and the MME does not support N26 interface, the MME shall send a TRACKING AREA UPDATE REJECT message with EMM cause value #9 "UE identity cannot be derived by the network".

When the UE performs inter-system change from N1 mode to S1 mode, if the MME is informed that verification of the integrity protection of the TRACKING AREA UPDATE REQUEST message has failed in the AMF, then:

a)  If the MME can retrieve the current EPS security context as indicated by the eKSI and GUTI sent by the UE, the MME shall proceed as specified in clause  5.5.3.2.4;

b)  if the MME cannot retrieve the current EPS security context as indicated by the eKSI and GUTI sent by the UE, or the eKSI or GUTI was not sent by the UE, the MME may initiate the identification procedure by sending the IDENTITY REQUEST message with the "Type of identity" of the Identity type IE set to "IMSI" before taking actions as specified in clause  4.4.4.3; or

c)  If the MME needs to reject the tracking area updating procedure, the MME shall send a TRACKING AREA UPDATE REJECT message with EMM cause value #9 "UE identity cannot be derived by the network".

In NB-S1 mode or WB-S1 mode via satellite E-UTRAN access, if the tracking area updating request is from a UE via a satellite E-UTRA cell and the network using the User Location Information provided by the eNodeB (see 3GPP  S  36.413  [23]), is able to determine that the UE is in a location where the network is not allowed to operate, the network shall set the EMM cause value in the TRACKING AREA UPDATE REJECT message to #78 "PLMN not allowed to operate at the present UE location".

Upon receiving the TRACKING AREA UPDATE REJECT message, if the message is integrity protected or contains a reject cause other than EMM cause value #25, the UE shall stop timer T3430 and stop any transmission of user data.

If the TRACKING AREA UPDATE REJECT message with EMM cause #25 was received without integrity protection, then the UE shall discard the message.

Regardless of the EMM cause value received in the TRACKING AREA UPDATE REJECT message,

-  if the UE receives the Forbidden TAI(s) for the list of "forbidden tracking areas for roaming" IE in the TRACKING AREA UPDATE REJECT message, the UE shall store the TAI(s) included in the IE, if not already stored, into the list of "forbidden tracking areas for roaming" and remove the TAI(s) from the stored TAI list if present; and

-  if the UE receives the Forbidden TAI(s) for the list of "forbidden tracking areas for regional provision of service" IE in the TRACKING AREA UPDATE REJECT message, the UE shall store the TAI(s) included in the IE, if not already stored, into the list of "forbidden tracking areas for regional provision of service" and remove the TAI(s) from the stored TAI list if present.

Furthermore. the UE shall take the following actions depending on the EMM cause value received in the TRACKING AREA UPDATE REJECT message.

#3  (Illegal UE);

#6  (Illegal ME); or

#8  (EPS services and non-EPS services not allowed);

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall consider the USIM as invalid for EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in clause  5.3.7a. The UE shall delete the list of equivalent PLMNs and shall enter the state EMM-DEREGISTERED.NO-IMSI. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.

  If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number and the MM parameters update status, TMSI, LAI and ciphering key sequence number as specified in 3GPP  S  24.008  [13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value. The USIM shall be considered as invalid also for non-EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in clause  5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.

  For the EMM cause value #3 or #6, if the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP  S  24.501  [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.

  For the EMM cause value #8, if the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.

NOTE  3:  The possibility to configure a UE so that the radio transceiver for a specific radio access technology is not active, although it is implemented in the UE, is out of scope of the present specification.

#7  (EPS services not allowed);

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall consider the USIM as invalid for EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in clause  5.3.7a. The UE shall enter the state EMM-DEREGISTERED. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.

  If the EPS update type is "periodic updating", a UE operating in CS/PS mode 1 or CS/PS mode 2 of operation, which is IMSI attached for non-EPS services, is still IMSI attached for non-EPS services. The UE operating in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED, shall attempt to select GERAN or UTRAN radio access technology and shall proceed with appropriate MM specific procedure according to the MM service state. The UE shall not reselect EUTRAN radio access technology until switching off or the UICC containing the USIM is removed.

  If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP  S  24.008  [13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value.

  If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP  S  24.501  [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.

#9  (UE identity cannot be derived by the network);

  The UE shall set the EPS update status to EU2 NOT UPDATED (and shall store it according to clause  5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE.

  If the rejected request was not for initiating a PDN connection for emergency bearer services, the UE shall subsequently, automatically initiate the attach procedure.

NOTE  4:  User interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.

  If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP  S  24.008  [13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value.

  If the UE is operating in the single-registration mode, the UE shall handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP  S  24.501  [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.

#10  (Implicitly detached);

  If the EPS update type is "periodic updating", a UE in CS/PS mode 1 or CS/PS mode 2 of operation is IMSI detached for both EPS services and non-EPS services.

  The UE shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE. The UE shall delete any mapped EPS security context or partial native EPS security context. If the rejected request was not for initiating a PDN connection for emergency bearer services, the UE shall then perform a new attach procedure.

NOTE  5:  User interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.

  If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM state as specified in 3GPP  S  24.008  [13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value.

  If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM state as specified in 3GPP  S  24.501  [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.

#11  (PLMN not allowed); or

#35  (Requested service option not authorized in this PLMN);

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall reset the tracking area updating attempt counter, delete the list of equivalent PLMNs and enter the state EMM-DEREGISTERED.PLMN-SEARCH.

  The UE shall store the PLMN identity in the "forbidden PLMN list" and if the UE is configured to use timer T3245 (see 3GPP  S  24.368  [15A] or 3GPP  S  31.102  [17]) then the UE shall start timer T3245 and proceed as described in clause  5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.

  The UE shall perform a PLMN selection according to 3GPP  S  23.122  [6].

  If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and routing area updating attempt counter and the MM parameters update status, TMSI, LAI, ciphering key sequence number and the location update attempt counter as specified in 3GPP  S  24.008  [13] for the case when the normal routing area updating procedure is rejected with the GMM cause value #11 and no RR connection exists.

  For the EMM cause value #11, if the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list, ngKSI and registration attempt counter as specified in 3GPP  S  24.501  [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.

  For the EMM cause value #35, if the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. In addition, the UE shall reset the registration attempt counter.

#12  (Tracking area not allowed);

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE.

  The UE shall store the current TAI in the list of "forbidden tracking areas for regional provision of service". If the TRACKING AREA UPDATE REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of "forbidden tracking areas for regional provision of service" for non-integrity protected NAS reject message.

  If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and routing area updating attempt counter as specified in 3GPP  S  24.008  [13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value.

  If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list, ngKSI and registration attempt counter as specified in 3GPP  S  24.501  [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.

#13  (Roaming not allowed in this tracking area);

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3) and shall delete the list of equivalent PLMNs. The UE shall reset the tracking area updating attempt counter and shall change to state EMM-REGISTERED.PLMN-SEARCH.

  The UE shall store the current TAI in the list of "forbidden tracking areas for roaming" and shall remove the current TAI from the stored TAI list if present. If the TRACKING AREA UPDATE REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of "forbidden tracking areas for roaming" for non-integrity protected NAS reject message.

  If the UE is registered in N1 mode and operating in dual-registration mode, the PLMN that the UE chooses to register in is specified in 3GPP  S  24.501  [54] clause  4.8.3. Otherwise the UE shall perform a PLMN selection according to 3GPP  S  23.122  [6].

  If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP  S  24.008  [13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value.

  If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, and registration attempt counter as specified in 3GPP  S  24.501  [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.

#14  (EPS services not allowed in this PLMN);

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3). Furthermore, the UE shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-DEREGISTERED.PLMN-SEARCH.

  The UE shall store the PLMN identity in the "forbidden PLMNs for GPRS service" list and if the UE is configured to use timer T3245 (see 3GPP  S  24.368  [15A] or 3GPP  S  31.102  [17]) then the UE shall start timer T3245 and proceed as described in clause  5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific PS-attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.

  If the EPS update type is "TA updating", or the EPS update type is "periodic updating" and the UE is in PS mode 1 or PS mode 2 of operation, the UE shall perform a PLMN selection according to 3GPP  S  23.122  [6]. In this case, the UE supporting S1 mode only shall delete the list of equivalent PLMNs before performing the procedure.

  If the EPS update type is "periodic updating", a UE operating in CS/PS mode 1 or CS/PS mode 2 of operation, which is IMSI attached for non-EPS services, is still IMSI attached for non-EPS services and shall proceed as follows:

-  a UE operating in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED;

-  a UE operating in CS/PS mode 1 of operation and supporting A/Gb mode or Iu mode may select GERAN or UTRAN radio access technology and proceed with the appropriate MM specific procedure according to the MM service state. In this case, the UE shall disable the E-UTRA capability (see clause  4.5);

-  a UE operating in CS/PS mode 1 of operation and supporting A/Gb mode or Iu mode may perform a PLMN selection according to 3GPP  S  23.122  [6];

-  a UE operating in CS/PS mode 1 of operation and supporting S1 mode only, or operating in CS/PS mode 2 of operation shall delete the list of equivalent PLMNs and shall perform a PLMN selection according to 3GPP  S  23.122  [6].

  If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and routing area updating attempt counter as specified in 3GPP  S  24.008  [13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value.

  If the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. In addition, the UE shall reset the registration attempt counter.

#15  (No suitable cells in tracking area);

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3). The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-REGISTERED.LIMITED-SERVICE.

  The UE shall store the current TAI in the list of "forbidden tracking areas for roaming". If the TRACKING AREA UPDATE REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of "forbidden tracking areas for roaming" for non-integrity protected NAS reject message. Additionally, the UE shall remove the current TAI from the stored TAI list if present and:

-  if the UE is in WB-S1 mode and the Extended EMM cause IE with value "E-UTRAN not allowed" is included in the TRACKING AREA UPDATE REJECT message, the UE supports "E-UTRA Disabling for EMM cause #15", and the "E-UTRA Disabling Allowed for EMM cause #15" parameter as specified in 3GPP  S  24.368  [15A] or 3GPP  S  31.102  [17] is present and set to enabled; then the UE shall disable the E-UTRA capability as specified in clause  4.5 and search for a suitable cell in another location area or 5GS tracking area;

-  if the UE is in NB-S1 mode and the Extended EMM cause IE with value "NB-IoT not allowed" is included in the TRACKING AREA UPDATE REJECT message, then the UE may disable the NB-IoT capability as specified in clause  4.9 and search for a suitable cell in E-UTRAN radio access technology;

-  otherwise, the UE shall search for a suitable cell in another tracking area or in another location area according to 3GPP  S  36.304  [21].

  If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP  S  24.008  [13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value.

  If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, and registration attempt counter as specified in 3GPP  S  24.501  [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.

#22  (Congestion);

  If the T3346 value IE is present in the TRACKING AREA UPDATE REJECT message and the value indicates that this timer is neither zero nor deactivated, the UE shall proceed as described below, otherwise it shall be considered as an abnormal case and the behaviour of the UE for this case is specified in clause  5.5.3.2.6.

  The UE shall abort the tracking area updating procedure, reset the tracking area updating attempt counter and set the EPS update status to EU2 NOT UPDATED. If the rejected request was not for initiating a PDN connection for emergency bearer services, the UE shall change to state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.

  The UE shall stop timer T3346 if it is running.

  If the TRACKING AREA UPDATE REJECT message is integrity protected, the UE shall start timer with the value provided in the T3346 value IE.

  If the TRACKING AREA UPDATE REJECT message is not integrity protected, the UE shall start timer T3346 with a random value from the default range specified in 3GPP  S  24.008  [13].

  The UE stays in the current serving cell and applies the normal cell reselection process. The tracking area updating procedure is started, if still necessary, when timer T3346 expires or is stopped.

  If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP  S  24.008  [13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value.

  If the tracking area updating procedure was initiated for and MO MMTEL voice or MO MMTEL video call is started, then a notification that the request was not accepted due to network congestion shall be provided to upper layers.

NOTE  6:  This can result in the upper layers requesting establishment of the originating voice call on an alternative manner e.g. requesting establishment of a CS voice call (see 3GPP  S  24.173  [13E]).

  If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status and registration attempt counter as specified in 3GPP  S  24.501  [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.

#25  (Not authorized for this CSG);

  EMM cause #25 is only applicable when received from a CSG cell. EMM cause #25 received from a non-CSG cell is considered as an abnormal case and the behaviour of the UE is specified in clause  5.5.3.2.6.

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and store it according to clause  5.1.3.3). The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-REGISTERED.LIMITED-SERVICE.

  If the CSG ID and associated PLMN identity of the cell where the UE has sent the TRACKING AREA UPDATE REQUEST message are contained in the Allowed CSG list, the UE shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.

  If the CSG ID and associated PLMN identity of the cell where the UE has sent the TRACKING AREA UPDATE REQUEST message are contained in the Operator CSG list, the UE shall apply the procedures defined in 3GPP  S  23.122  [6] clause  3.1A.

  The UE shall search for a suitable cell according to 3GPP  S  36.304  [21].

  If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP  S  24.008  [13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value.

  If the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-REGISTERED and set the 5GS update status to 5U3 ROAMING NOT ALLOWED and reset the registration attempt counter.

#31  (Redirection to 5GCN required);

  EMM cause #31 received by a UE that has not indicated support for CIoT optimizations or not indicated support for N1 mode is considered as an abnormal case and the behaviour of the UE is specified in clause  5.5.3.2.6.

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3). The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-REGISTERED.LIMITED-SERVICE.

  The UE shall enable N1 mode capability for 3GPP access if it was disabled and disable the E-UTRA capability (see clause  4.5).

  If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, and registration attempt counter as specified in 3GPP  S  24.501  [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.

#40  (No EPS bearer context activated);

  The UE shall deactivate all the EPS bearer contexts locally, if any, and shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE. If the rejected request was not for initiating a PDN connection for emergency bearer services, the UE shall perform a new attach procedure.

NOTE  7:  User interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.

  If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM state as specified in 3GPP  S  24.008  [13] for the case when the normal routing area updating procedure is rejected with the GMM cause value #10 "Implicitly detached".

  If the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED.

#42  (Severe network failure);

  The UE shall set the EPS update status to EU2 NOT UPDATED, and shall delete any GUTI, last visited registered TAI, TAI list, eKSI, and list of equivalent PLMNs, and set the tracking area update counter to 5. The UE shall start an implementation specific timer, setting its value to 2 times the value of T as defined in 3GPP  S  23.122  [6]. While this timer is running, the UE shall not consider the PLMN + RAT combination that provided this reject cause as a candidate for PLMN selection. The UE then enters state EMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP  S  23.122  [6].

  If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition set the GMM state to GMM-DEREGISTERED, GPRS update status to GU2 NOT UPDATED, and shall delete the P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number.

  If the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U2 NOT UPDATED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.

#78  (PLMN not allowed to operate at the present UE location).

  This cause value received from a non-satellite E-UTRA cell is considered as an abnormal case and the behaviour of the UE is specified in clause  5.5.3.2.6.

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. Additionally, the UE shall reset the registration attempt counter and shall enter state EMM-DEREGISTERED.PLMN-SEARCH and perform a PLMN selection according to 3GPP  S  23.122  [6].

  If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, and registration attempt counter as specified in 3GPP  S  24.501  [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.

Editor   's note:  [IoT_SAT_ARCH_EPS, CR#3620]. It is FFS how to prevent the UE from making repeated attempts at selecting the same satellite access PLMN if there are no other available PLMNs at UE   's location.

Other values are considered as abnormal cases. The specification of the UE behaviour in those cases is described in clause  5.5.3.2.6.

5.5.3.2.5A  Tracking area updating procedure for initiating a PDN connection for emergency bearer services not accepted by the network

If the tracking area updating request for initiating a PDN connection for emergency bearer services cannot be accepted by the network, the UE shall perform the procedures as described in clause  5.5.3.2.5. Then if the UE is in the same selected PLMN where the last tracking area updating request was attempted, the UE shall:

a)  inform the upper layers of the failure of the procedure; or

NOTE  1:  This can result in the upper layers establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP  S  24.229  [13D] can result in the emergency call being attempted to another IP-CAN.

b)  detach locally, if not detached already, attempt EPS attach for emergency bearer services.

If the tracking area updating request for initiating a PDN connection for emergency bearer services fails due to abnormal case a) in clause  5.5.3.2.6, the UE shall perform the actions as described in clause  5.5.3.2.6 and inform the upper layers of the failure to access the network.

NOTE  2:  This can result in the upper layers establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP  S  24.229  [13D] can result in the emergency call being attempted to another IP-CAN.

If the tracking area updating request for initiating a PDN connection for emergency bearer services fails due to abnormal cases b), c) or d) in clause  5.5.3.2.6, the UE shall perform the procedures as described in clause  5.5.3.2.6. Then if the UE is in the same selected PLMN where the last tracking area updating request was attempted, the UE shall:

a)  inform the upper layers of the failure of the procedure; or

NOTE  3:  This can result in the upper layers establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP  S  24.229  [13D] can result in the emergency call being attempted to another IP-CAN.

b)  detach locally, if not detached already, attempt EPS attach for emergency bearer services.

5.5.3.2.5B  Tracking area updating for access to RLOS not accepted by the network

If the tracking area updating request for access to RLOS cannot be accepted by the network, the UE shall perform the procedures as described in clause  5.5.3.2.5 along with the following conditions:

a)  if the action for the reject involves searching for a suitable cell in E-UTRAN radio access technology, the UE shall proceed with the action and shall attempt to perform a tracking area updating procedure or an attach procedure for access to RLOS in the new tracking area, if found, depending on the EMM state.

b)  if the action for the reject involves attempting to select GERAN or UTRAN radio access technology or disabling the E-UTRAN capability, the UE shall skip the action for as long as access to RLOS is still needed.

NOTE:  How long the UE attempts to access RLOS is up to UE implementation.

Then if

a)  the UE is in the same selected PLMN where the last tracking area updating procedure was attempted and rejected;

b)  the tracking area updating procedure was rejected with an EMM cause value other than #9, #10 and #40; and

c)  timer T3346 is not running,

the UE shall:

a)  detach locally, if not detached already, perform a PLMN selection according to 3GPP  S  23.122  [6] to attempt EPS attach for access to RLOS via another PLMN.

If the tracking area updating request for access to RLOS fails due to abnormal case a) in clause  5.5.3.2.6, the UE shall perform the actions as described in clause  5.5.3.2.6 and inform the upper layers of the failure to access the network.

If the tracking area updating request for access to RLOS fails due to abnormal cases b), c) or d) in clause  5.5.3.2.6, the UE shall perform the procedures as described in clause  5.5.3.2.6 with the exception that the UE shall skip actions that involve attempting to select GERAN or UTRAN radio access technology and actions that involve disabling of the E-UTRA capability, for as long as access to RLOS is still needed. Then if the UE is in the same selected PLMN where the last tracking area updating request was attempted, the UE shall:

a)  detach locally, if not detached already, perform a PLMN selection according to 3GPP  S  23.122  [6] to attempt EPS attach for access to RLOS via another PLMN.

5.5.3.2.6  Abnormal cases in the UE

The following abnormal cases can be identified:

a)  Access barred because of access class barring, EAB, ACDC or NAS signalling connection establishment rejected by the network without "Extended wait time" received from lower layers

  In WB-S1 mode, if the tracking area updating procedure is started in response to a paging request from the network, access class barring, EAB or ACDC is not applicable.

  In NB-S1 mode, if the tracking area updating procedure is started in response to a paging request from the network, access barring is not applicable.

  In WB-S1 mode, if access is barred for "originating signalling" (see 3GPP  S  36.331  [22]), the tracking area updating procedure shall not be started. The UE stays in the current serving cell and applies the normal cell reselection process. The tracking area updating procedure is started as soon as possible and if still necessary, e.g. when access for "originating signalling" is granted on the current cell or when the UE moves to a cell where access for "originating signalling" is granted.

  In NB-S1 mode, if access is barred for "originating signalling" (see 3GPP  S  36.331  [22]), the tracking area updating procedure shall not be started. The UE stays in the current serving cell and applies the normal cell reselection process. Further UE behaviour is implementation specific, e.g. the tracking area updating procedure is started again after an implementation dependent time.

  In NB-S1 mode, if access is barred for "originating signalling" (see 3GPP  S  36.331  [22]), a request for an exceptional event is received from the upper layers, then the tracking area updating procedure shall be started.

NOTE  1:  In NB-S1 mode, the EMM layer cannot receive the access barring alleviation indication from the lower layers (see 3GPP  S  36.331  [22]).

  If access is barred because of access class barring for "originating signalling" (see 3GPP  S  36.331  [22]) and if:

-  one of the MO MMTEL voice call is started, MO MMTEL video call is started or MO SMSoIP is started conditions is satisfied;

-  the upper layers request to send a mobile originated SMS over NAS or SMS over S102; or

-  the upper layers request user plane radio resources, ACDC is applicable to the request and the UE supports ACDC.

  then the tracking area updating procedure shall be started according to clause  5.5.3.2.2. The call type used shall be per annex  D of this document.

NOTE  2:  If more than one of MO MMTEL voice call is started, MO MMTEL video call is started or MO SMSoIP is started conditions are satisfied, it is left to UE implementation to determine the call type based on Annex  D of this document.

  If access is barred for a certain ACDC category (see 3GPP  S  36.331  [22]), and if the upper layers request user plane radio resources for a higher ACDC category and the UE supports ACDC, then the tracking area updating procedure shall be started according to clause  5.5.3.2.2.

  If an access request for an uncategorized application is barred due to ACDC (see 3GPP  S  36.331  [22]), and if the upper layers request user plane radio resources for a certain ACDC category and the UE supports ACDC, then the tracking area updating procedure shall be started according to clause  5.5.3.2.2.

  If the trigger for the tracking area updating procedure is the response to a paging request from the network and the NAS signalling connection establishment is rejected by the network, the tracking area updating procedure shall not be started. The UE stays in the current serving cell and applies normal cell reselection process. The tracking area updating procedure may be started if it is still necessary when access for "terminating calls" is granted or because of a cell change.

aa)  Lower layer failure to establish the RRC connection and:

-  the UE is in its HPLMN or in an EHPLMN (if the EHPLMN list is present);

-  the tracking area updating request is not for initiating a PDN connection for emergency bearer services;

 -  the UE does not have a PDN connection for for emergency bearer services;

-  the UE supports being configured with CustomLLFailureRetry as specified in 3GPP  S  24.368  [15A]); and

-  CustomLLFailureRetry leaf is present as specified in 3GPP  S  24.368  [15A]);

  The UE shall abort the tracking area updating procedure, set the EPS update status to EU2 NOT UPDATED and wait for a UE implementation specific timer which shall be set to MinRetryTimer or MaxRetryTimer as specified in 3GPP  S  24.368  [15A]. The UE shall not set the UE implementation specific timer to MinRetryTimer for more than MaxMinRetry consecutive attempts as specified in 3GPP  S  24.368  [15A]. After the expiration of the UE implementation specific timer, the UE shall restart the tracking area updating procedure, if still needed.

b)  Lower layer failure not covered in case aa) or release of the NAS signalling connection without "Extended wait time" and without "Extended wait time CP data" received from lower layers before the TRACKING AREA UPDATE ACCEPT or TRACKING AREA UPDATE REJECT message is received

  The tracking area updating procedure shall be aborted, and the UE shall proceed as described below.

c)  T3430 timeout

  The UE shall abort the procedure. The NAS signalling connection, if any, shall be released locally.

NOTE  3:  The NAS signalling connection can also be released if the UE deems that the network has failed the authentication check as specified in clause  5.4.2.7.

  The UE shall proceed as described below.

d)  TRACKING AREA UPDATE REJECT, other causes than those treated in clause  5.5.3.2.5, and cases of EMM cause values #22, #25, #31 and #78, if considered as abnormal cases according to clause  5.5.3.2.5

  If the tracking area updating request is not for initiating a PDN connection for emergency bearer services, upon reception of the EMM causes #95, #96, #97, #99 and #111 the UE should set the tracking area updating attempt counter to 5.

  The UE shall proceed as described below.

e)  Change of cell into a new tracking area

  If a cell change into a new tracking area occurs before the tracking area updating procedure is completed, the tracking area updating procedure shall be aborted and re-initiated immediately. The UE shall set the EPS update status to EU2 NOT UPDATED.

  The UE shall proceed as described below.

f)  Tracking area updating and detach procedure collision

  EPS detach containing detach type "re-attach required" or "re-attach not required":

  If the UE receives a DETACH REQUEST message before the tracking area updating procedure has been completed, the tracking area updating procedure shall be aborted and the detach procedure shall be progressed. If the DETACH REQUEST message contains detach type "re-attach not required" and EMM cause #2 "IMSI unknown in HSS", the UE will follow the procedure as described below for the detach type "IMSI detach".

  EPS detach containing detach type "IMSI detach":

  If the UE receives a DETACH REQUEST message before the tracking area updating procedure has been completed, the DETACH REQUEST message shall be ignored and tracking area updating procedure shall be progressed.

  The UE shall proceed as described below.

g)  Tracking area updating and GUTI reallocation procedure collision

  If the UE receives a GUTI REALLOCATION COMMAND message before the tracking area updating procedure has been completed, this message shall be ignored and the tracking area updating procedure shall be progressed.

h)  Transmission failure of TRACKING AREA UPDATE REQUEST message indication from lower layers

  The tracking area updating procedure shall be aborted and re-initiated immediately. The UE shall set the EPS update status to EU2 NOT UPDATED.

i)  Transmission failure of TRACKING AREA UPDATE COMPLETE message indication with TAI change from lower layers

  If the current TAI is not in the TAI list, the tracking area updating procedure shall be aborted and re-initiated immediately. The UE shall set the EPS update status to EU2 NOT UPDATED.

  If the current TAI is still part of the TAI list, it is up to the UE implementation how to re-run the ongoing procedure.

j)  Transmission failure of TRACKING AREA UPDATE COMPLETE message indication without TAI change from lower layers

  It is up to the UE implementation how to re-run the ongoing procedure.

k)  "Extended wait time" from the lower layers

  If the TRACKING AREA UPDATE REQUEST message contained the low priority indicator set to "MS is configured for NAS signalling low priority", the UE shall start timer T3346 with the "Extended wait time" value and reset the tracking area updating attempt counter.

  If the TRACKING AREA UPDATE REQUEST message did not contain the low priority indicator set to "MS is configured for NAS signalling low priority", the UE is operating in NB-S1 mode and the UE is not a UE configured to use AC11        15 in selected PLMN, then the UE shall start timer T3346 with the "Extended wait time" value and reset the tracking area updating attempt counter.

  In other cases the UE shall ignore the "Extended wait time".

  The UE shall abort the tracking area updating procedure, stay in the current serving cell, set the EPS update status to EU2 NOT UPDATED, change the state to EMM-REGISTERED.ATTEMPTING-TO-UPDATE and apply the normal cell reselection process.

  If the UE had used eDRX before initiating tracking area updating procedure, then the UE shall continue to use the eDRX with the extended DRX parameters IE received during the last attach or tracking area updating procedure.

  The UE shall proceed as described below.

ka)  "Extended wait time CP data" from the lower layers

  If the UE is operating in NB-S1 mode and supports the timer T3448, the UE shall start the timer T3448 with the "Extended wait time CP data" value. If the UE is operating in NB-S1 mode and does not support the timer T3448, the UE shall start the timer T3346 with the "Extended wait time CP data" value and reset the tracking area updating attempt counter.

  In other cases the UE shall ignore the "Extended wait time CP data".

  The UE shall abort the tracking area updating procedure, stay in the current serving cell, set the EPS update status to EU2 NOT UPDATED, change the state to EMM-REGISTERED.ATTEMPTING-TO-UPDATE and apply the normal cell reselection process.

  If the UE had used eDRX before initiating tracking area updating procedure, then the UE shall continue to use the eDRX with the extended DRX parameters IE received during the last attach or tracking area updating procedure.

  The UE shall proceed as described below.

l)  Timer T3346 is running

  The UE shall not start the tracking area updating procedure unless:

-  the UE is in EMM-CONNECTED mode;

-  the UE received a paging;

-  the UE is a UE configured to use AC11        15 in selected PLMN;

-  the UE has a PDN connection for emergency bearer services established or is establishing a PDN connection for emergency bearer services;

-  the UE is requested by the upper layer for a CS fallback for emergency call or a 1xCS fallback for emergency call;

-  the UE in NB-S1 mode is requested by the upper layer to transmit user data related to an exceptional event and

i)  the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP  S  24.368  [15A] or the USIM file EFNASCONFIG in 3GPP  S  31.102  [17]); and

ii)  timer T3346 was not started when NAS signalling connection was established with RRC establishment cause set to "MO exception data";

-  the UE has a PDN connection established without the NAS signalling low priority indication or is establishing a PDN connection without the NAS signalling low priority indication, the timer T3402 and the timer T3411 are not running and the timer T3346 was started due to rejection of a NAS request message (e.g. ATTACH REQUEST, TRACKING AREA UPDATE REQUEST or EXTENDED SERVICE REQUEST) which contained the low priority indicator set to "MS is configured for NAS signalling low priority"; or

-  the MUSIM UE needs to request an IMSI offset value as specified in clause  5.5.3.2.2.

  The UE stays in the current serving cell and applies the normal cell reselection process.

NOTE  4:  It is considered an abnormal case if the UE needs to initiate a tracking area updating procedure while timer T3346 is running independent on whether timer T3346 was started due to an abnormal case or a non successful case.

  If the TAI of the current serving cell is not included in the TAI list or the TIN indicates "P-TMSI", the UE shall set the EPS update status to EU2 NOT UPDATED and change to state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.

  If the tracking area updating procedure needs to be initiated for an MO MMTEL voice call or an MO MMTEL video call is started, then a notification that the procedure was not initiated due to network congestion shall be provided to upper layers.

NOTE  5:  This can result in the upper layers requesting establishment of the originating voice call on an alternative manner e.g. requesting establishment of a CS voice call (see 3GPP  S  24.173  [13E]).

  The UE shall proceed as described below.

la)  Timer T3448 is running

  The UE shall not start the tracking area updating procedure with the "signalling active" flag set, unless:

-  the UE is a UE configured to use AC11        15 in selected PLMN;

-  the UE which is only using EPS services with control plane CIoT EPS optimization received a paging; or

-  the UE in NB-S1 mode is requested by the upper layer to transmit user data related to an exceptional event and the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP  S  24.368  [15A] or the USIM file EFNASCONFIG in 3GPP  S  31.102  [17]).

  The UE stays in the current serving cell and applies the normal cell reselection process.

  The UE shall proceed as described below.

m)  Mobile originated detach required

  Detach due to removal of USIM or due to switch off:

  The tracking area updating procedure shall be aborted, and the UE initiated detach procedure shall be performed.

  Detach not due to removal of USIM and not due to switch off:

  The UE initiated detach procedure shall be initiated after successful completion of the tracking area updating procedure.

o)  Timer T3447 is running

  The UE shall not start the tracking area updating procedure with the "signalling active" flag set or the "active" flag set, unless:

-  the UE received a paging;

-  the UE is a UE configured to use AC11        15 in selected PLMN;

-  the UE has a PDN connection for emergency bearer services established or is establishing a PDN connection for emergency bearer services; or

-  the MUSIM UE needs to request an IMSI offset value as specified in clause  5.5.3.2.2.

  The UE stays in the current serving cell and applies the normal cell reselection process. The tracking area update request procedure is started, if still necessary, when timer T3447 expires.

p)  Tracking area updating and paging procedure collision

  If the UE receives a CS SERVICE NOTIFICATION message before the tracking area updating procedure has been completed, the UE shall progress the tracking area updating procedure and respond to the CS SERVICE NOTIFICATION upon successful completion of the tracking area updating procedure.

For the cases b, c, d, e, f with detach type "re-attach required" or "re-attach not required" with EMM cause other than #2 "IMSI unknown in HSS", k and ka, the UE shall stop any ongoing transmission of user data.

For the cases b, c, d, k, ka, l and la, the UE shall proceed as follows:

  Timer T3430 shall be stopped if still running.

  For the cases b, c, d, la k when the "Extended wait time" is ignored, and ka when the "Extended wait time CP data" is ignored, if the tracking area updating request is not for initiating a PDN connection for emergency bearer services, the tracking area updating attempt counter shall be incremented, unless it was already set to 5.

  If the tracking area updating attempt counter is less than 5, the TAI of the current serving cell is included in the TAI list, the EPS update status is equal to EU1 UPDATED, the TIN does not indicate "P-TMSI" and the tracking area updating procedure is performed not due to an inter-system change from N1 mode to S1 mode and the tracking area updating procedure is not performed due to cases g, m, n, za, zc in clause 5.5.3.2.2:

  the UE shall keep the EPS update status to EU1 UPDATED and enter state EMM-REGISTERED.NORMAL-SERVICE. The UE shall start timer T3411.

  If in addition the TRACKING AREA UPDATE REQUEST indicated "periodic updating" or if tracking area updating procedure was initiated to recover NAS signalling connection due to "RRC Connection failure" from the lower layers, none of the other reasons for initiating the tracking area updating procedure listed in clause  5.5.3.2.2 was applicable, and the TRACKING AREA UPDATE REQUEST message did not include T3324 value IE, T3412 extended value IE or Extended DRX parameters IE, the timer T3411 may be stopped when the UE enters EMM-CONNECTED mode.

  If timer T3411 expires the tracking area updating procedure is triggered again.

  If the tracking area updating attempt counter is less than 5, and the TAI of the current serving cell is not included in the TAI list or the EPS update status is different to EU1 UPDATED or the TIN indicates "P-TMSI" or the tracking area updating procedure is performed due to an inter-system change from N1 mode to S1 mode or if the tracking area updating procedure is performed due to cases g, m, n, za, zc in clause 5.5.3.2.2:

-  for the cases k and l, the tracking area updating procedure is started, if still necessary, when timer T3346 expires or is stopped.

-  for the case ka, if timer T3346 is started, the tracking area updating procedure is started, if still necessary, when timer T3346 expires or is stopped.

-  for the case ka, if timer T3448 is started and the "signalling active" flag is set in the TRACKING AREA UPDATE REQUEST message, the tracking area updating procedure is started, if still necessary, when timer T3448 expires or is stopped.

-  for the case la, if the "signalling active" flag is set in the TRACKING AREA UPDATE REQUEST message, the tracking area updating procedure is started, if still necessary, when timer T3448 expires or is stopped.

-  for the cases b, c, d, k when the "Extended wait time" is ignored, and ka when the "Extended wait time CP data" is ignored, if the tracking area updating request is not for initiating a PDN connection for emergency bearer services, the UE shall start timer T3411, shall set the EPS update status to EU2 NOT UPDATED and change to state EMM-REGISTERED.ATTEMPTING-TO-UPDATE. When timer T3411 expires the tracking area updating procedure is triggered again.

  If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GPRS update status as specified in 3GPP  S  24.008  [13] for the abnormal case when a normal or periodic routing area updating procedure fails and the routing area updating attempt counter is less than 5 and the GPRS update status is different from GU1 UPDATED.

  If the UE is operating in single-registration mode, the UE shall in addition handle the 5GS update status as specified in 3GPP  S  24.501  [54] for the abnormal cases when a registration procedure for mobility and periodic registration fails and the registration attempt counter is less than 5 and the 5GS update status is different from 5U1 UPDATED.

  If the tracking area updating attempt counter is equal to 5:

-  the UE shall start timer T3402, shall set the EPS update status to EU2 NOT UPDATED;

-  the UE shall delete the list of equivalent PLMNs and shall change to state EMM-REGISTERED.ATTEMPTING-TO-UPDATE or optionally to EMM-REGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP  S  23.122  [6]; and

-  if A/Gb mode, Iu mode or N1 mode is supported by the UE:

-  if A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GPRS update status as specified in 3GPP  S  24.008  [13] for the abnormal case when a normal or periodic routing area updating procedure fails and the routing area updating attempt counter is equal to 5;

-  if the UE is operating in single-registration mode, the UE shall in addition handle the 5GS update status as specified in 3GPP  S  24.501  [54] for the abnormal case when a registration procedure for mobility or periodic registration update performed over 3GPP access fails and the registration attempt counter is equal to 5; and

-  if the UE does not change to state EMM-REGISTERED.PLMN-SEARCH, the UE shall

-  attempt to select GERAN, UTRAN or NG-RAN radio access technology. Additionally, if the UE selects GERAN or UTRAN radio access technology, the UE may disable the E-UTRA capability as specified in clause  4.5. If No E-UTRA Disabling In 5GS is enabled at the UE (see 3GPP  S  24.368  [50] or 3GPP  S  31.102  [17]) and the UE selects NG-RAN radio access technology, it shall not disable the E-UTRA capability; otherwise, the UE may disable the E-UTRA capability as specified in clause  4.5.

NOTE  6:  Whether the UE requests RRC to treat the active E-UTRA cell as barred (see 3GPP  S  36.304  [21]) is left to the UE implementation.

  If a GERAN or UTRAN cell is selected:

-  a UE in PS mode 1 or PS mode 2 of operation shall proceed with appropriate GMM specific procedures;

-  a UE in CS/PS mode 1 or CS/PS mode 2 of operation shall proceed with appropriate MM or GMM specific procedures.

  If an NG-RAN cell is selected, the UE shall proceed with appropriate 5GMM specific procedures.

5.5.3.2.6A  Abnormal cases in the UE, SMS services not accepted

The UE shall proceed as follows:

1)  if the tracking area update was successful for EPS services only and the TRACKING AREA UPDATE ACCEPT message contained a value included in the SMS services status IE not treated in clause  5.5.3.2.4A, the UE shall proceed as follows:

a)  The UE shall stop timer T3430 if still running. The tracking area updating attempt counter shall be incremented, unless it was already set to 5;

b)  If the tracking area updating attempt counter is less than 5:

-  the UE shall start timer T3411, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE. When timer T3411 expires the normal tracking area updating procedure for EPS services and "SMS only" or the combined tracking area updating procedure for EPS services and "SMS only" is triggered;

c)  If the tracking area updating attempt counter is equal to 5:

-  the UE shall start timer T3402, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE. When timer T3402 expires the normal tracking area updating procedure for EPS services and "SMS only" or the combined tracking area updating procedure for EPS services and "SMS only" is triggered; and

2)  otherwise, the abnormal cases specified in clause  5.5.3.2.6 apply.

5.5.3.2.7  Abnormal cases on the network side

The following abnormal cases can be identified:

a)  If a lower layer failure occurs before the message TRACKING AREA UPDATE COMPLETE has been received from the UE and a GUTI has been assigned, the network shall abort the procedure, enter EMM-IDLE mode and shall consider both, the old and new GUTI as valid until the old GUTI can be considered as invalid by the network (see clause  5.4.1.4). During this period the network may use the identification procedure followed by a GUTI reallocation procedure if the old GUTI is used by the UE in a subsequent message.

  The network may page with IMSI if paging with old and new S-TMSI fails. Paging with IMSI causes the UE to re-attach as described in clause  5.6.2.2.2.

Additionally, if the TRACKING AREA UPDATE ACCEPT message includes:

1)  a different negotiated IMSI offset value assigned to a UE that previously had another negotiated IMSI offset value assigned;

2)  no negotiated IMSI offset value assigned to a UE that previously had negotiated IMSI offset value assigned; or

3)  a negotiated IMSI offset value assigned to a UE that previously had no negotiated IMSI offset value assigned;

  for case 1) the network shall use two alternative IMSI values and for case 2) and 3) the network shall use one alternative IMSI value and the IMSI value for paging the UE until one of the two (alternative) IMSI values can be considered as invalid by the network.

NOTE  1:  As the network assigns a new GUTI when the alternative IMSI value is changed or deleted (see clause 5.5.3.2.4), the network can consider the alternative IMSI value associated with the old GUTI as invalid if the UE responds to the paging with the new GUTI.

b)  Protocol error

  If the TRACKING AREA UPDATE REQUEST message has been received with a protocol error, the network shall return a TRACKING AREA UPDATE REJECT message with one of the following EMM cause values:

  #96:  invalid mandatory information element error;

  #99:  information element non-existent or not implemented;

  #100:  conditional IE error; or

  #111:  protocol error, unspecified.

c)  T3450 time-out

  On the first expiry of the timer, the network shall retransmit the TRACKING AREA UPDATE ACCEPT message and shall reset and restart timer T3450. The retransmission is performed four times, i.e. on the fifth expiry of timer T3450, the tracking area updating procedure is aborted. Both, the old and the new GUTI shall be considered as valid until the old GUTI can be considered as invalid by the network (see clause  5.4.1.4). During this period the network acts as described for case  a above.

d)  TRACKING AREA UPDATE REQUEST received after the TRACKING AREA UPDATE ACCEPT message has been sent and before the TRACKING AREA UPDATE COMPLETE message is received

-  If one or more of the information elements in the TRACKING AREA UPDATE REQUEST message differ from the ones received within the previous TRACKING AREA UPDATE REQUEST message, the previously initiated tracking area updating procedure shall be aborted if the TRACKING AREA UPDATE COMPLETE message has not been received and the new tracking area updating procedure shall be progressed; or

-  If the information elements do not differ for cases other than inter-system change from N1 mode to S1 mode in EMM-IDLE mode with the UE operating in the single-registration mode, then the TRACKING AREA UPDATE ACCEPT message shall be resent and the timer T3450 shall be restarted if a TRACKING AREA UPDATE COMPLETE message is expected. If the information elements do not differ for the case of inter-system change from N1 mode to S1 mode in EMM-IDLE mode with the UE operating in the single-registration mode, the MME should forward the new TRACKING AREA UPDATE REQUEST message which contains the same information elements as the previous TRACKING AREA UPDATE REQUEST message to the source AMF to run the integrity check, obtain the latest mapped EPS security context (to be used to protect any future NAS message sent to the UE) and continue with the new tracking area updating procedure. In these cases, the retransmission counter related to T3450 is not incremented.

NOTE  2:  Instead of forwarding the new TRACKING AREA UPDATE REQUEST message which contains the same information elements to the source AMF, the MME can decide to initiate an authentication procedure followed by a security mode control procedure to take the new partial native EPS security context into use if the new partial native EPS security context is taken into use successfully, then resend the same TRACKING AREA UPDATE ACCEPT message protected using this new EPS security context.

e)  More than one TRACKING AREA UPDATE REQUEST received and no TRACKING AREA UPDATE ACCEPT or TRACKING AREA UPDATE REJECT message has been sent

-  If one or more of the information elements in the TRACKING AREA UPDATE REQUEST message differs from the ones received within the previous TRACKING AREA UPDATE REQUEST message, the previously initiated tracking area updating procedure shall be aborted and the new tracking area updating procedure shall be progressed;

-  if the information elements do not differ for cases other than inter-system change from N1 mode to S1 mode in EMM-IDLE mode with the UE operating in the single-registration mode, then the network shall continue with the previous tracking area updating procedure and shall not treat any further this TRACKING AREA UPDATE REQUEST message. If the information elements do not differ for the case of inter-system change from N1 mode to S1 mode in EMM-IDLE mode with the UE operating in the single-registration mode, the MME should forward the new TRACKING AREA UPDATE REQUEST message which contains the same information elements as the previous TRACKING AREA UPDATE REQUEST message to the source AMF to run the integrity check, obtain the latest mapped EPS security context (to be used to protect any future NAS message sent to the UE) and continue with the previous tracking area updating procedure.

NOTE  3:  Instead of forwarding the new TRACKING AREA UPDATE REQUEST message which contains the same information elements to the source AMF, the MME can decide to initiate an authentication procedure followed by a security mode control procedure to take the new partial native EPS security context into use and, if the new partial native EPS security context is taken into use successfully, use this new EPS security context to protect any future NAS message sent to the UE.

f)  Lower layers indication of non-delivered NAS PDU due to handover

  If the TRACKING AREA UPDATE ACCEPT message or TRACKING AREA UPDATE REJECT message could not be delivered due to an intra MME handover and the TAI of the target cell and the TAI of the source cell are the same, then upon successful completion of the intra MME handover the MME shall retransmit the TRACKING AREA UPDATE ACCEPT message or TRACKING AREA UPDATE REJECT message. If a failure of the handover procedure is reported by the lower layer and the S1 signalling connection exists, the MME shall retransmit the TRACKING AREA UPDATE ACCEPT message or TRACKING AREA UPDATE REJECT message.

g)  DETACH REQUEST message received before the TRACKING AREA UPDATE ACCEPT message is sent or before the TRACKING AREA UPDATE COMPLETE message (in case of GUTI and/or TMSI was allocated) is received.

  Detach containing cause "switch off":

  The network shall abort the signalling for the tracking area updating procedure towards the UE and shall progress the detach procedure as described in clause  5.5.2.2.

NOTE  4:  Internally in the network, before processing the detach request, the MME can perform the necessary signalling procedures for the tracking area updating procedure before progressing the detach procedure.

  Detach containing other causes than "switch off":

  The network shall proceed with the tracking area updating procedure and shall progress the detach procedure after successful completion of the tracking area updating procedure.

h)  If the TRACKING AREA UPDATE REQUEST message with EPS update type IE indicating "periodic updating" is received by the new MME which does not have the EMM context data related to the subscription, the new MME may send the TRACKING AREA UPDATE REJECT message with EMM cause value #10 "Implicitly detached"

5.5.3.3  Combined tracking area updating procedure

5.5.3.3.1  General

Within a combined tracking area updating procedure the messages TRACKING AREA UPDATE ACCEPT and TRACKING AREA UPDATE COMPLETE carry information for the tracking area updating and the location area updating.

The combined tracking area updating procedure follows the normal tracking area updating procedure described in clause  5.5.3.2 with exception of clause  5.5.3.2.4A and clause  5.5.3.2.6A.

5.5.3.3.2  Combined tracking area updating procedure initiation

The UE operating in CS/PS mode 1 or CS/PS mode 2, in state EMM-REGISTERED, shall initiate the combined tracking area updating procedure:

a)  when the UE that is attached for both EPS and non-EPS services detects that the current TAI is not in the list of tracking areas that the UE previously registered in the MME, unless the UE is configured for "AttachWithIMSI" as specified in 3GPP  S  24.368  [15A] or 3GPP  S  31.102  [17] and is entering a tracking area in a new PLMN that is neither the registered PLMN nor in the list of equivalent PLMNs;

b)  when the UE that is attached for EPS services wants to perform an attach for non-EPS services. In this case the EPS update type IE shall be set to "combined TA/LA updating with IMSI attach";

c)  when the UE performs an intersystem change from A/Gb mode to S1 mode and the EPS services were previously suspended in A/Gb mode;

d)  when the UE performs an intersystem change from A/Gb or Iu mode to S1 mode, and the UE previously either performed a combined GPRS attach procedure, an IMSI attach procedure, a location area updating procedure or a combined routing area updating procedure, in A/Gb or Iu mode, or moved to A/Gb or Iu mode from S1 mode through an SRVCC handover or moved to Iu mode from S1 mode through an vSRVCC handover. In this case the EPS update type IE shall be set to "combined TA/LA updating with IMSI attach";

e)  when the UE enters EMM-REGISTERED.NORMAL-SERVICE and the UE   's TIN indicates "P-TMSI";

f)  when the UE receives an indication from the lower layers that the RRC connection was released with cause "load balancing TAU required";

g)  when the UE deactivated EPS bearer context(s) locally while in EMM-REGISTERED, because it was not able or not allowed to establish a NAS signalling connection, and then returns to EMM-REGISTERED.NORMAL-SERVICE and no EXTENDED SERVICE REQUEST message, CONTROL PLANE SERVICE REQUEST message or DETACH REQUEST message is pending to be sent by the UE;

h)  when the UE changes any one of the UE network capability information, the MS network capability information or the N1 UE network capability information;

i)  when the UE changes the UE specific DRX parameter;

j)  when the UE receives an indication of "RRC Connection failure" from the lower layers and has no signalling or user uplink data pending (i.e. when the lower layer requests NAS signalling connection recovery);

k)  when due to manual CSG selection the UE has selected a CSG cell whose CSG identity and associated PLMN identity are not included in the UE   's Allowed CSG list or in the UE   's Operator CSG list;

l)  when the UE reselects an E-UTRAN cell while it was in GPRS READY state or PMM-CONNECTED mode;

m)  when the UE supports SRVCC to GERAN or UTRAN or supports vSRVCC to UTRAN, and changes the mobile station classmark 2 or the supported codecs, or the UE supports SRVCC to GERAN and changes the mobile station classmark 3;

n)  when the UE changes the radio capability for GERAN or cdma2000   xae or both;

o)  when the UE   's usage setting or the voice domain preference for E-UTRAN change in the UE;

p)  when the UE activates mobility management for IMS voice termination as specified in 3GPP  S  24.008  [13], annex  P.2, and the TIN indicates "RAT-related TMSI";

q)  when the UE performs an intersystem change from A/Gb mode to S1 mode and the TIN indicates "RAT-related TMSI", but the UE is required to perform tracking area updating for IMS voice termination as specified in 3GPP  S  24.008  [13], annex  P.4;

r)  upon reception of a paging indication, if the UE is in state EMM-REGISTERED.ATTEMPTING-TO-UPDATE and the paging indication uses S-TMSI or it uses IMSI with domain indicator set to       xb3CS      xb3;

NOTE  1:  As an implementation option, the MUSIM UE is allowed to not respond to paging based on the information available in the paging message, e.g. voice service indication.

s)  when the UE needs to update the network with EPS bearer context status due to local de-activation of EPS bearer context(s) as specified in clause  6.5.1.4A;

t)  when the UE performs an intersystem change from A/Gb or Iu mode to S1 mode, and the UE has previously performed the MM connection establishment for CS fallback emergency calls (see 3GPP  S  24.008  [13],  clause  4.5.1.5a) without performing a location area updating procedure or combined routing area updating procedure while camping on a location area which is different from the stored location area. In this case, the EPS update type IE shall be set to "combined TA/LA updating with IMSI attach";

u)  when the UE performs an intersystem change from A/Gb or Iu mode to S1 mode, and the MM update status is U2 NOT UPDATED. In this case the EPS update type IE shall be set to "combined TA/LA updating with IMSI attach";

v)  when the UE needs to request the use of PSM or needs to stop the use of PSM;

w)  when the UE needs to request the use of eDRX or needs to stop the use of eDRX;

x)  when a change in the eDRX usage conditions at the UE requires different extended DRX parameters;

y)  when a change in the PSM usage conditions at the UE requires a different timer T3412 value or different timer T3324 value;

NOTE  2:  A change in the PSM or eDRX usage conditions at the UE can include e.g. a change in the UE configuration, a change in requirements from upper layers or the battery running low at the UE.

z)  when the CIoT EPS optimizations the UE needs to use, change in the UE;

za)  when the Default_DCN_ID value changes, as specified in 3GPP  S  24.368  [15A] or in USIM file NASCONFIG as specified in 3GPP  S  31.102  [17];

NOTE  3:  The tracking area updating procedure is initiated after deleting the DCN-ID list as specified in annex  C.

zb)  when the UE performs inter-system change from N1 mode to S1 mode in EMM-IDLE mode, the UE operates in single-registration mode, and conditions specified in 3GPP  S  24.501  [54] apply;

zc)  when the UE in EMM-IDLE mode changes the radio capability for E-UTRAN;

zd)  when the UE performs inter-system change from N1 mode to S1 mode in EMM-CONNECTED mode;

ze)  when the UE in EMM-IDLE mode changes the radio capability for NG-RAN;

zf)  in WB-S1 mode, when the applicable UE radio capability ID for the current UE radio configuration changes due to a reselection to a new PLMN or a revocation of the network-assigned UE radio capability IDs by the serving PLMN; or

zg)  when the UE needs to use the WUS assistance, stop to use the WUS assistance, or change the conditions for using the WUS assistance.

For case c, if the TIN indicates "RAT-related TMSI" and the EPS services were not resumed before returning to S1 mode, the UE shall set the TIN to "P-TMSI" before initiating the combined tracking area updating procedure.

For cases n, zc, ze and zf, the UE shall include a UE radio capability information update needed IE in the TRACKING AREA UPDATE REQUEST message.

If the UE is in the EMM-CONNECTED mode and the UE changes the radio capability for E-UTRAN or for NG-RAN, the UE may locally release the established NAS signalling connection and enter the EMM-IDLE mode. Then, the UE shall initiate the combined tracking area updating procedure including a UE radio capability information update needed IE in the TRACKING AREA UPDATE REQUEST message.

For case l, if the TIN indicates "RAT-related TMSI", the UE shall set the TIN to "P-TMSI" before initiating the combined tracking area updating procedure.

For case r, the "active" flag in the EPS update type IE shall be set to 1. If the paging is received for CS fallback, the UE shall send the EXTENDED SERVICE REQUEST message to the MME by using the existing NAS signalling connection after the completion of the tracking area updating procedure. If the TRACKING AREA UPDATE ACCEPT message includes a UE radio capability ID deletion indication IE set to "Network-assigned UE radio capability IDs deletion requested", the UE shall proceed with sending the EXTENDED SERVICE REQUEST message. To initiate a combined tracking area updating procedure the UE sends the message TRACKING AREA UPDATE REQUEST to the network, starts timer T3430 and changes to state EMM-TRACKING-AREA-UPDATING-INITIATED. The value of the EPS update type IE in the message shall indicate "combined TA/LA updating" unless explicitly specified otherwise.

If the UE initiates the combined tracking area updating procedure for EPS services and "SMS only", the UE shall indicate "SMS only" in the additional update type IE.

The UE shall include the TMSI status IE if no valid TMSI is available. Furthermore, if the UE has stored a valid location area identification, the UE shall include it in the Old location area identification IE in the TRACKING AREA UPDATE REQUEST message.

If the UE has stored a valid TMSI, the UE shall include the TMSI based NRI container IE in the TRACKING AREA UPDATE REQUEST message.

The UE shall include the EPS bearer context status IE in TRACKING AREA UPDATE REQUEST message:

a)  for the case g;

b)  for the case s;

c)  for the case zb;

d)  if the UE has established PDN connection(s) of "non IP" or Ethernet PDN type; and

e)  if the UE:

1)  locally deactivated at least one dedicated EPS bearer context upon an inter-system mobility from WB-S1 mode to NB-S1 mode in EMM-IDLE mode;

2)  locally deactivated at least one dedicated EPS bearer context upon an inter-system change from WB-N1 mode to NB-S1 mode in EMM-IDLE mode for the UE operating in single-registration mode (see clause  6.4.2.1); or

3)  locally deactivated at least one default EPS bearer context upon an inter-system change from N1 mode to NB-S1 mode in EMM-IDLE mode for the UE operating in single-registration mode (see clause  6.5.0).

In WB-S1 mode, if the UE supports RACS the UE shall set the RACS bit to "RACS supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.

For cases n, zc and ze, in WB-S1 mode, if the UE supports RACS and the UE has an applicable UE radio capability ID for the new UE radio configuration in the selected PLMN, the UE shall set the URCIDA bit to "UE radio capability ID available" in the UE radio capability ID availability IE of the TRACKING AREA UPDATE REQUEST message.

For all cases except cases n, zc and ze, in WB-S1 mode, if the UE has an applicable UE radio capability ID for the current UE radio configuration in the selected PLMN, the UE shall set the URCIDA bit to "UE radio capability ID available" in the UE radio capability ID availability IE of the TRACKING AREA UPDATE REQUEST message.

5.5.3.3.3  EMM common procedure initiation

  During the combined tracking area updating procedure, the MME may initiate EMM common procedures, e.g. the EMM authentication and security mode control procedures. For restrictions applicable after handover or inter-system handover to S1 mode see clause  5.5.3.2.3.

5.5.3.3.4  Combined tracking area updating procedure accepted by the network

5.5.3.3.4.1  General

Depending on the value of the EPS update result IE received in the TRACKING AREA UPDATE ACCEPT message, the following different cases can be distinguished:

1)  The EPS update result IE value indicates "combined TA/LA updated": Tracking and location area updating is successful for EPS and non-EPS services, or for EPS services and "SMS only";

2)  The EPS update result IE value indicates "TA updated": Tracking area updating is successful, but location area updating for non-EPS services or "SMS only" is not successful.

A TRACKING AREA UPDATE COMPLETE message shall be returned to the network if the TRACKING AREA UPDATE ACCEPT message contains a GUTI or a TMSI or both.

5.5.3.3.4.2  Combined tracking area updating successful

The description for normal tracking area update as specified in clause  5.5.3.2.4 shall be followed. In addition, the following description for location area updating applies.

The TMSI reallocation may be part of the combined tracking area updating procedure. The TMSI allocated is then included in the TRACKING AREA UPDATE ACCEPT message together with the location area identification (LAI). In this case the MME shall change to state EMM-COMMON-PROCEDURE-INITIATED and shall start the timer T3450 as described in clause  5.4.1. The LAI may be included in the TRACKING AREA UPDATE ACCEPT message without TMSI. If the MME does not indicate "SMS only" in the TRACKING AREA UPDATE ACCEPT message, subject to operator policies the MME should allocate a TAI list that does not span more than one location area.

For a shared network in CS domain, the MME indicates the selected PLMN for CS domain in the LAI to the UE as specified in 3GPP  S  23.272  [9].

The UE, receiving a TRACKING AREA UPDATE ACCEPT message, stores the received location area identification, resets the location update attempt counter, sets the update status to U1 UPDATED and enters MM state MM IDLE.

If the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services" events (see clause  5.3.7b), then the UE shall reset this counter.

If the LAI contained in the TRACKING AREA UPDATE ACCEPT message is a member of the list of "forbidden location areas for regional provision of service" or the list of "forbidden location areas for roaming" then such entry shall be deleted.

If the PLMN identity for the CS domain which is provided as part of the LAI contained in the TRACKING AREA UPDATE ACCEPT message differs from the PLMN identity provided as part of the GUTI, the MME shall include the PLMN identity for the CS domain in the list of equivalent PLMNs in the TRACKING AREA UPDATE ACCEPT message.

If the UE requested "SMS only" in the Additional update type IE, or if the UE requested a combined tracking area updating for EPS and non-EPS services, but the network decides to accept the tracking area update request for EPS services and "SMS only", the network shall indicate "SMS only" in the Additional update result IE. In addition, if the SMS services are provided via SMS in MME, the network shall, in the TRACKING AREA UPDATE ACCEPT message, provide a non-broadcast LAI and may indicate in the EPS update result IE that ISR is activated. If a TMSI has to be allocated, then the network shall also provide a TMSI which cannot cause any ambiguity with assigned TMSI values.

If the TRACKING AREA UPDATE ACCEPT message includes the Additional update result IE with value "SMS only", a UE operating in CS/PS mode 2 and a UE operating in CS/PS mode 1 with "IMS voice available" shall not attempt to use CS fallback for mobile originating services.

As an implementation option, if the TRACKING AREA UPDATE ACCEPT message does not include the Additional update result IE with value "SMS only" and the UE is not configured for NAS signalling low priority then the UE may stop timer T3246 if running.

If the TRACKING AREA UPDATE ACCEPT message includes the Additional update result IE with value "CS Fallback not preferred", this indicates to a UE operating in CS/PS mode 2 and a UE operating in CS/PS mode 1 with "IMS voice available" that it is attached for EPS and non-EPS services and that it can use CS fallback.

How to handle the old TMSI stored in the UE depends on the mobile identity included in the TRACKING AREA UPDATE ACCEPT message.

-  If the TRACKING AREA UPDATE ACCEPT message contains an IMSI, the UE is not allocated any TMSI, and shall delete any old TMSI accordingly.

-  If the TRACKING AREA UPDATE ACCEPT message contains a TMSI, the UE shall use this TMSI as new temporary identity. The UE shall delete its old TMSI and shall store the new TMSI. In this case, a TRACKING AREA UPDATE COMPLETE message is returned to the network to confirm the received TMSI.

-  If neither a TMSI nor an IMSI has been included by the network in the TRACKING AREA UPDATE ACCEPT message, the old TMSI, if any is available, shall be kept.

NOTE  1:  It is possible for UEs compliant with earlier versions of this specification to send a TRACKING AREA UPDATE COMPLETE message even if TMSI reallocation is not part of the combined tracking area updating procedure.

If the TRACKING AREA UPDATE ACCEPT message includes the Additional update result IE with value "SMS only" or "CS Fallback not preferred", a UE operating in CS/PS mode 1 with "IMS voice not available" shall attempt to select GERAN or UTRAN radio access technology and disable the E-UTRA capability (see clause  4.5).

The network receiving a TRACKING AREA UPDATE COMPLETE message stops timer T3450, changes to state EMM-REGISTERED.

NOTE  2:  Upon receiving a TRACKING AREA UPDATE COMPLETE message, if a new TMSI was included in the TRACKING AREA UPDATE ACCEPT message, the MME sends an SGsAP-TMSI-REALLOCATION-COMPLETE message as specified in 3GPP  S  29.118  [16A].

Unless the MME supporting N26 is in a deployment where it, after intersystem change from N1 mode to S1 mode, has an IMEI or an IMEISV for the UE, then after the UE performs intersystem change from N1 mode to S1 mode, if:

-  the network supports SRVCC for IMS emergency sessions (see 3GPP  S  23.216  [8]);

-  the UE has an emergency PDN connection;

-  the UE has set the SRVCC to GERAN/UTRAN capability bit in the MS network capability IE to "SRVCC from UTRAN HSPA or E-UTRAN to GERAN/UTRAN supported; and

-  the MME has neither an IMEI nor an IMEISV for the UE;

NOTE  3:  The AMF can receive an IMEI from the UE and pass it to the MME during the intersystem change if the UE is emergency registered and the UE doesn   't have a valid USIM or the UE   's IMSI remains unauthenticated.

then the MME shall initiate the identification procedure (see clause  5.4.4) or the security mode control procedure (see clause  5.4.3) with the UE.

5.5.3.3.4.3  Combined tracking area updating successful for EPS services only

Apart from the actions on the tracking area updating attempt counter, the description for tracking area for EPS services as specified in clause  5.5.3.2.4 shall be followed. In addition, the following description for location updating for non-EPS services applies.

If, due to emergency services fallback (see 3GPP  S  23.502  [59], clause  4.13.4), there is a request for emergency services pending and the emergency bearer services indicator in the EPS network feature support IE indicates "emergency bearer services in S1 mode not supported", then the UE shall skip the requirements defined below in the present clause for the receipt of a TRACKING AREA UPDATE ACCEPT message including an EMM cause value, attempt to select GERAN or UTRAN radio access technology, select a setup message as defined in clause  5.3.7, proceed with appropriate MM specific procedures, and send the setup message.

The UE receiving the TRACKING AREA UPDATE ACCEPT message takes one of the following actions depending on the EMM cause value:

#2  (IMSI unknown in HSS)

  The UE shall stop T3430 if still running and shall reset the tracking area updating attempt counter. The UE shall set the update status to U3 ROAMING NOT ALLOWED and shall delete any TMSI, LAI and ciphering key sequence number. The UE shall enter state EMM-REGISTERED.NORMAL-SERVICE. The new MM state is MM IDLE. The USIM shall be considered as invalid for non-EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described clause  5.3.7a. If the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.

  If, due to emergency services fallback (see 3GPP  S  23.502  [59]), there is a request for CS fallback call pending (see clause  5.3.7), the UE shall attempt to select GERAN or UTRAN radio access technology and attempt emergency call setup.

  A UE operating in CS/PS mode 1 of operation with "IMS voice not available" and without a persistent EPS bearer context shall disable the E-UTRA capability (see clause  4.5).

  A UE operating in CS/PS mode 1 of operation with "IMS voice not available" and with a persistent EPS bearer context shall, after the radio bearer associated with the persistent EPS bearer context has been released, disable the E-UTRA capability (see clause  4.5).

#16  (MSC temporarily not reachable); or

#17  (Network failure)

  The UE shall stop timer T3430 if still running, and shall enter state MM IDLE. The tracking area updating attempt counter shall be incremented, unless it was already set to 5.

  If the tracking area updating attempt counter is less than 5:

-  the UE shall start timer T3411, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. When timer T3411 expires the combined tracking area updating procedure indicating "combined TA/LA updating with IMSI attach" is triggered again.

  If the tracking area updating attempt counter is equal to 5:

-  a UE operating in CS/PS mode 2 of operation and a UE operating in CS/PS mode 1 of operation with "IMS voice available" shall start timer T3402, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. When timer T3402 expires the combined tracking area updating procedure indicating "combined TA/LA updating with IMSI attach" is triggered again;

-  a UE operating in CS/PS mode 1 of operation with "IMS voice not available" without a persistent EPS bearer context shall attempt to select GERAN or UTRAN radio access technology and proceed with appropriate MM or GMM specific procedures and disable the E-UTRA capability (see clause  4.5);

-  a UE operating in CS/PS mode 1 of operation with "IMS voice not available" and with a persistent EPS bearer context shall start timer T3402, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. When timer T3402 expires the combined tracking area updating procedure indicating "combined TA/LA updating with IMSI attach" is triggered again. When the radio bearer associated with the persistent EPS bearer context has been released and the UE is registered for EPS services only, operating in CS/PS mode 1 of operation with "IMS voice not available", then the UE shall stop timer T3402, if already running, attempt to select GERAN or UTRAN radio access technology and proceed with appropriate MM or GMM specific procedures and disable the E-UTRA capability (see clause  4.5).

#18  (CS domain not available)

  The UE shall stop timer T3430 if still running, shall reset the tracking area updating attempt counter, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE.

  The UE shall enter state MM IDLE and shall set the update status to U2 NOT UPDATED.

  A UE in CS/PS mode 1 of operation with "IMS voice not available" without a persistent EPS bearer context shall attempt to select GERAN or UTRAN radio access technology rather than E-UTRAN for the registered PLMN or equivalent PLMN and disable the E-UTRA capability (see clause  4.5).

  A UE in CS/PS mode 1 of operation with "IMS voice not available" and with a persistent EPS bearer context shall, after the radio bearer associated with the persistent EPS bearer context has been released, attempt to select GERAN or UTRAN radio access technology rather than E-UTRAN for the registered PLMN or equivalent PLMN and disable the E-UTRA capability (see clause  4.5).

  A UE in CS/PS mode 2 of operation and a UE operating in CS/PS mode 1 of operation with "IMS voice available" may provide a notification to the user or the upper layers that the CS domain is not available.

  The UE shall not attempt combined attach or combined tracking area updating procedure with current PLMN until switching off the UE or the UICC containing the USIM is removed.

#22  (Congestion)

  The UE shall stop timer T3430 if still running. The tracking area updating attempt counter shall be set to 5. The UE shall start timer T3402, shall set the EPS update status to EU1 UPDATED, shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM, shall enter state MM IDLE.

Other EMM cause values and the case that no EMM cause IE was received are considered as abnormal cases. The combined tracking area updating procedure shall be considered as failed for non-EPS services. The behaviour of the UE in those cases is specified in clause  5.5.3.3.6.

5.5.3.3.5  Combined tracking area updating procedure not accepted by the network

If the combined tracking area updating cannot be accepted by the network, the MME shall send a TRACKING AREA UPDATE REJECT message to the UE including an appropriate EMM cause value.

If the MME locally deactivates EPS bearer contexts for the UE (see clause  5.5.3.2.4) and no active EPS bearer contexts remain for the UE, the MME shall send the TRACKING AREA UPDATE REJECT message including the EMM cause value #10 "implicitly detached".

If the tracking area update request is rejected due to general NAS level mobility management congestion control, the network shall set the EMM cause value to #22 "congestion" and assign a back-off timer T3346.

If the UE initiated the tracking area updating procedure due to inter-system change from N1 mode to S1 mode, and the MME does not support N26 interface, the MME shall send a TRACKING AREA UPDATE REJECT message with EMM cause value #9 "UE identity cannot be derived by the network".

When the UE performs inter-system change from N1 mode to S1 mode, if the MME is informed that verification of the integrity protection of the TRACKING AREA UPDATE REQUEST message has failed in the AMF, then:

a)  If the MME can retrieve the current EPS security context as indicated by the eKSI and GUTI sent by the UE, the MME shall proceed as specified in clause  5.5.3.2.4;

b)  if the MME cannot retrieve the current EPS security context as indicated by the eKSI and GUTI sent by the UE, or the eKSI or GUTI was not sent by the UE, the MME may initiate the identification procedure by sending the IDENTITY REQUEST message with the "Type of identity" of the Identity type IE set to "IMSI" before taking actions as specified in clause  4.4.4.3; or

c)  If the MME needs to reject the tracking area updating procedure, the MME shall send a TRACKING AREA UPDATE REJECT message with EMM cause value #9 "UE identity cannot be derived by the network".

If the tracking area request is rejected due to service gap control as specified in clause  5.3.17 i.e. the T3447 timer is running, the network shall set the EMM cause value to #22 "congestion" and may assign a back-off timer T3346 with the remaining time of the running T3447 timer.

Based on operator policy, if the tracking area update request is rejected due to core network redirection for CIoT optimizations, the network shall set the EMM cause value to #31 "Redirection to 5GCN required".

NOTE  1:  The network can take into account the UE   's N1 mode capability, the 5GS CIoT network behaviour supported by the UE or the 5GS CIoT network behaviour supported by the 5GCN to determine the rejection with the EMM cause value #31 "Redirection to 5GCN required".

Upon receiving the TRACKING AREA UPDATE REJECT message, if the message is integrity protected or contains a reject cause other than EMM cause value #25, the UE shall stop timer T3430, stop any transmission of user data and enter state MM IDLE.

If the TRACKING AREA UPDATE REJECT message with EMM cause #25 was received without integrity protection, then the UE shall discard the message.

The UE shall take the following actions depending on the EMM cause value received in the TRACKING AREA UPDATE REJECT message.

#3  (Illegal UE);

#6  (Illegal ME); or

#8  (EPS services and non-EPS services not allowed);

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI List and eKSI.

  The UE shall consider the USIM as invalid for EPS and non-EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in clause  5.3.7a. Additionally, the UE shall delete the list of equivalent PLMNs and shall enter the state EMM-DEREGISTERED.NO-IMSI. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", then the UE shall set this counter to UE implementation-specific maximum value. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.

  If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the MM parameters update status, TMSI, LAI and ciphering key sequence number, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP  S  24.008  [13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.

  For the EMM cause value #3 or #6, if the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP  S  24.501  [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.

  For the EMM cause value #8, if the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.#7  (EPS services not allowed);

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI List and eKSI. The UE shall consider then USIM as invalid for EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in clause  5.3.7a. The UE shall enter the state EMM-DEREGISTERED. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.

  A UE in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services.

  A UE in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED, shall attempt to select GERAN or UTRAN radio access technology and proceed with appropriate MM specific procedure according to the MM service state. The UE shall not reselect E-UTRAN radio access technology until switching off or the UICC containing the USIM is removed.

  If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP  S  24.008  [13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.

  If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP  S  24.501  [54] for the case when the registration procedure performed over 3GPP access and for mobility and periodic registration update indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.

#9  (UE identity cannot be derived by the network);

  The UE shall set the EPS update status to EU2 NOT UPDATED (and shall store it according to clause  5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI List and eKSI. The UE shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE.

  If there is a CS fallback emergency call pending or CS fallback call pending, or a paging for CS fallback, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures; otherwise, if there is a CS fallback emergency call or CS fallback call pending, the EMM sublayer shall indicate the abort of the EMM procedure to the MM sublayer.

  If there is a 1xCS fallback emergency call pending or 1xCS fallback call pending, or a paging for 1xCS fallback, the UE shall select cdma2000   xae 1x radio access technology. The UE then proceeds with appropriate cdma2000   xae 1x CS procedures.

  If there is a 1xCS fallback emergency call pending or 1xCS fallback call pending, or a paging for 1xCS fallback, and the UE has dual Rx/Tx configuration and supports enhanced 1xCS fallback, the UE shall perform a new attach procedure.

  If there is no CS fallback emergency call pending, CS fallback call pending, 1xCS fallback emergency call pending, 1xCS fallback call pending, paging for CS fallback, or paging for 1xCS fallback and the rejected request was not for initiating a PDN connection for emergency bearer services, the UE shall subsequently, automatically initiate the attach procedure.

NOTE  2:  User interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.

  If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP  S  24.008  [13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.

  A UE in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services.

  A UE in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED.

  If the UE is operating in the single-registration mode, the UE shall handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP  S  24.501  [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.

#10  (Implicitly detached);

  A UE in CS/PS mode 1 or CS/PS mode 2 of operation is IMSI detached for both EPS services and non-EPS services.

  The UE shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE. The UE shall delete any mapped EPS security context or partial native EPS security context.

  If there is a CS fallback emergency call pending or CS fallback call pending, or a paging for CS fallback, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures; otherwise, if there is a CS fallback emergency call or CS fallback call pending, the EMM sublayer shall indicate the abort of the EMM procedure to the MM sublayer.

  If there is a 1xCS fallback emergency call pending or 1xCS fallback call pending, or a paging for 1xCS fallback, the UE shall select cdma2000   xae 1x radio access technology. The UE then proceeds with appropriate cdma2000   xae 1x CS procedures.

  If there is a 1xCS fallback emergency call pending or 1xCS fallback call pending, or a paging for 1xCS fallback, and the UE has dual Rx/Tx configuration and supports enhanced 1xCS fallback, the UE shall perform a new attach procedure.

  If there is no CS fallback emergency call pending, CS fallback call pending, 1xCS fallback emergency call pending, 1xCS fallback call pending, paging for CS fallback, or paging for 1xCS fallback and the rejected request was not for initiating a PDN connection for emergency bearer services, the UE shall then perform a new attach procedure.

NOTE  3:  User interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.

  If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM state as specified in 3GPP  S  24.008  [13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.

  A UE in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED.

  If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM state as specified in 3GPP  S  24.501  [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.

#11  (PLMN not allowed); or

#35  (Requested service option not authorized in this PLMN);

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI List and eKSI, and reset the tracking area updating attempt counter. The UE shall delete the list of equivalent PLMNs and enter the state EMM-DEREGISTERED.PLMN-SEARCH.

  The UE shall store the PLMN identity in the "forbidden PLMN list" and if the UE is configured to use timer T3245 (see 3GPP  S  24.368  [15A] or 3GPP  S  31.102  [17]) then the UE shall start timer T3245 and proceed as described in clause  5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.

  The UE shall then perform a PLMN selection according to 3GPP  S  23.122  [6].

  If A/Gb mode or Iu mode is supported by the UE, the UE shall handle and the MM parameters update status, TMSI, LAI, ciphering key sequence number and the location update attempt counter, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and routing area updating attempt counter as specified in 3GPP  S  24.008  [13] for the case when the combined routing area updating procedure is rejected with the GMM cause value #11 and no RR connection exists.

  For the EMM cause value #11, if the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list, ngKSI and registration attempt counter as specified in 3GPP  S  24.501  [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.

  For the EMM cause value #35, if the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. In addition, the UE shall reset the registration attempt counter.

#12  (Tracking area not allowed);

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI List and eKSI. The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE.

  The UE shall store the current TAI in the list of "forbidden tracking areas for regional provision of service". If the TRACKING AREA UPDATE REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of "forbidden tracking areas for regional provision of service" for non-integrity protected NAS reject message.

  If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and the location update attempt counter, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and routing area updating attempt counter as specified in 3GPP  S  24.008  [13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.

  If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list, ngKSI and registration attempt counter as specified in 3GPP  S  24.501  [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.

#13  (Roaming not allowed in this tracking area);

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3) and shall delete the list of equivalent PLMNs. The UE shall reset the tracking area updating attempt counter and shall change to state EMM-REGISTERED.PLMN-SEARCH.

  The UE shall store the current TAI in the list of "forbidden tracking areas for roaming" and shall remove the current TAI from the stored TAI list if present. If the TRACKING AREA UPDATE REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of "forbidden tracking areas for roaming" for non-integrity protected NAS reject message.

  If the UE is registered in N1 mode and operating in dual-registration mode, the PLMN that the UE chooses to register in is specified in 3GPP  S  24.501  [54] clause  4.8.3. Otherwise the UE shall perform a PLMN selection according to 3GPP  S  23.122  [6].

  The UE shall indicate the Update type IE "combined TA/LA updating with IMSI attach" when performing the tracking area updating procedure following the PLMN selection.

  If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the MM parameters update status and the location update attempt counter, and the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP  S  24.008  [13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.

  If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, and registration attempt counter as specified in 3GPP  S  24.501  [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.

#14  (EPS services not allowed in this PLMN);

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3). Furthermore, the UE shall delete any GUTI, last visited registered TAI, TAI List and eKSI. The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-DEREGISTERED.PLMN-SEARCH.

  The UE shall store the PLMN identity in the "forbidden PLMNs for GPRS service" list and if the UE is configured to use timer T3245 (see 3GPP  S  24.368  [15A] or 3GPP  S  31.102  [17]) then the UE shall start timer T3245 and proceed as described in clause  5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific PS-attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.

  The UE operating in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services.

  The UE operating in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED.

  A UE operating in CS/PS mode 1 of operation and supporting A/Gb mode or Iu mode may select GERAN or UTRAN radio access technology and proceed with the appropriate MM specific procedure according to the MM service state. In this case, the UE shall disable the E-UTRA capability (see clause  4.5).

  A UE operating in CS/PS mode 1 of operation and supporting A/Gb mode or Iu mode may perform a PLMN selection according to 3GPP  S  23.122  [6].

  A UE operating in CS/PS mode 1 of operation and supporting S1 mode only, or operating in CS/PS mode 2 of operation shall delete the list of equivalent PLMNs and shall perform a PLMN selection according to 3GPP  S  23.122  [6].

  If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and routing area updating attempt counter as specified in 3GPP  S  24.008  [13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.

  If the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI. In addition, the UE shall reset the registration attempt counter.

#15  (No suitable cells in tracking area);

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3). The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-REGISTERED.LIMITED-SERVICE.

  The UE shall store the current TAI in the list of "forbidden tracking areas for roaming". If the TRACKING AREA UPDATE REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of "forbidden tracking areas for roaming" for non-integrity protected NAS reject message. Additionally, the UE shall remove the current TAI from the stored TAI list if present and:

-  if the UE is in WB-S1 mode and the Extended EMM cause IE with value "E-UTRAN not allowed" is included in the TRACKING AREA UPDATE REJECT message, the UE supports "E-UTRA Disabling for EMM cause #15", and the "E-UTRA Disabling Allowed for EMM cause #15" parameter as specified in 3GPP  S  24.368  [15A] or 3GPP  S  31.102  [17] is present and set to enabled; then the UE shall disable the E-UTRA capability as specified in clause  4.5 and search for a suitable cell in another location area or 5GS tracking area;

-  if the UE is in NB-S1 mode and the Extended EMM cause IE with value "NB-IoT not allowed" is included in the TRACKING AREA UPDATE REJECT message, then the UE may disable the NB-IoT capability as specified in clause  4.9 and search for a suitable cell in E-UTRAN radio access technology;

-  otherwise, the UE shall search for a suitable cell in another tracking area or in another location area according to 3GPP  S  36.304  [21].

  The UE shall indicate the Update type IE "combined TA/LA updating with IMSI attach" when performing the tracking area updating procedure.

  If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the MM parameters update status and the location update attempt counter, and the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP  S  24.008  [13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.

  If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, and registration attempt counter as specified in 3GPP  S  24.501  [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.

#22  (Congestion);

  If the T3346 value IE is present in the TRACKING AREA UPDATE REJECT message and the value indicates that this timer is neither zero nor deactivated, the UE shall proceed as described below, otherwise it shall be considered as an abnormal case and the behaviour of the UE for this case is specified in clause  5.5.3.3.6.

  The UE shall abort the tracking area updating procedure, reset the tracking area updating attempt counter and set the EPS update status to EU2 NOT UPDATED. If the rejected request was not for initiating a PDN connection for emergency bearer services, the UE shall change to state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.

  The UE shall stop timer T3346 if it is running.

  If the TRACKING AREA UPDATE REJECT message is integrity protected, the UE shall start timer with the value provided in the T3346 value IE.

  If the TRACKING AREA UPDATE REJECT message is not integrity protected, the UE shall start timer T3346 with a random value from the default range specified in 3GPP  S  24.008  [13].

  The UE stays in the current serving cell and applies the normal cell reselection process. The tracking area updating procedure is started, if still necessary, when timer T3346 expires or is stopped.

  If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP  S  24.008  [13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.

  If the tracking area updating procedure was initiated for an MO MMTEL voice call or an MO MMTEL video call is started, then a notification that the request was not accepted due to network congestion shall be provided to upper layers.

NOTE  4:  This can result in the upper layers requesting establishment of the originating voice call on an alternative manner e.g. requesting establishment of a CS voice call (see 3GPP  S  24.173  [13E]).

  If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status and registration attempt counter as specified in 3GPP  S  24.501  [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.

#25  (Not authorized for this CSG);

  EMM cause #25 is only applicable when received from a CSG cell. EMM cause #25 received from a non-CSG cell is considered as an abnormal case and the behaviour of the UE is specified in clause  5.5.3.3.6.

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and store it according to clause  5.1.3.3). The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-REGISTERED.LIMITED-SERVICE.

  If the CSG ID and associated PLMN identity of the cell where the UE has sent the TRACKING AREA UPDATE REQUEST message are contained in the Allowed CSG list, the UE shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.

  If the CSG ID and associated PLMN identity of the cell where the UE has sent the TRACKING AREA UPDATE REQUEST message are contained in the Operator CSG list, the UE shall apply the procedures defined in 3GPP  S  23.122  [6] clause  3.1A.

  The UE shall search for a suitable cell according to 3GPP  S  36.304  [21].

  The UE shall indicate the Update type IE "combined TA/LA updating with IMSI attach" when performing the tracking area updating procedure.

  If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the MM parameters update status and the location update attempt counter, and the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP  S  24.008  [13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.

  If the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-REGISTERED and set the 5GS update status to 5U3 ROAMING NOT ALLOWED and reset the registration attempt counter.

#31  (Redirection to 5GCN required);

  EMM cause #31 received by a UE that has not indicated support for CIoT optimizations or not indicated support for N1 mode is considered as an abnormal case and the behaviour of the UE is specified in clause  5.5.3.3.6.

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3). The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-REGISTERED.LIMITED-SERVICE.

  The UE shall enable N1 mode capability for 3GPP access if it was disabled and disable the E-UTRA capability (see clause  4.5).

  If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, and registration attempt counter as specified in 3GPP  S  24.501  [54] for the case when the registration procedure for mobility and periodic registration update performed over 3GPP access and indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.

#40  (No EPS bearer context activated);

  The UE shall deactivate all the EPS bearer contexts locally, if any, and shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE.

  If there is a CS fallback emergency call pending or CS fallback call pending, or a paging for CS fallback, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures; otherwise, if there is a CS fallback emergency call or CS fallback call pending, the EMM sublayer shall indicate the abort of the EMM procedure to the MM sublayer.

  If there is a 1xCS fallback emergency call pending or 1xCS fallback call pending, or a paging for 1xCS fallback, the UE shall select cdma2000   xae 1x radio access technology. The UE then proceeds with appropriate cdma2000   xae 1x CS procedures.

  If there is a 1xCS fallback emergency call pending or 1xCS fallback call pending, or a paging for 1xCS fallback, and the UE has dual Rx/Tx configuration and supports enhanced 1xCS fallback, the UE shall perform a new attach procedure.

  If there is no CS fallback emergency call pending, CS fallback call pending, 1xCS fallback emergency call pending, 1xCS fallback call pending, paging for CS fallback, or paging for 1xCS fallback and the rejected fallback request was not for initiating a PDN connection for emergency bearer services, the UE shall perform a new attach procedure.

NOTE  5:  User interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.

  If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM state as specified in 3GPP  S  24.008  [13] for the case when the combined routing area updating procedure is rejected with the GMM cause value #10 "Implicitly detached".

  A UE in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services.

  A UE in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED.

  If the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED.

#42  (Severe network failure);

  The UE shall set the EPS update status to EU2 NOT UPDATED, and shall delete any GUTI, last visited registered TAI, TAI list, eKSI, and list of equivalent PLMNs, and set the tracking area updating attempt counter to 5. The UE shall start an implementation specific timer, setting its value to 2 times the value of T as defined in 3GPP  S  23.122  [6]. While this timer is running, the UE shall not consider the PLMN + RAT combination that provided this reject cause as a candidate for PLMN selection. The UE then enters state EMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP  S  23.122  [6].

  If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition set the GMM state to GMM-DEREGISTERED, GPRS update status to GU2 NOT UPDATED, MM update status to U2 NOT UPDATED, and shall delete the P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number, LAI, TMSI and ciphering key sequence number.

  If the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U2 NOT UPDATED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.

Other values are considered as abnormal cases. The behaviour of the UE in those cases is specified in clause  5.5.3.3.6.

5.5.3.3.6  Abnormal cases in the UE

The UE shall proceed as follows:

1)  if the UE requested the combined tracking area update for EPS services and "SMS only" and the TRACKING AREA UPDATE ACCEPT message indicates a combined tracking area updating procedure successful for EPS and non-EPS services, the UE shall behave as if the combined tracking area updating procedure was successful for EPS services and "SMS only";

NOTE:  In this case the UE can ignore the CS SERVICE NOTIFICATION message or the Paging with CN domain indicator set to "CS", as specified in clause  5.6.2.3.2.

2)  if the combined tracking area update was successful for EPS services only and the TRACKING AREA UPDATE ACCEPT message contained an EMM cause value not treated in clause  5.5.3.3.4.3 or the EMM Cause IE is not included in the message, the UE shall proceed as follows:

a)  The UE shall stop timer T3430 if still running, and shall enter state MM IDLE. The tracking area updating attempt counter shall be incremented, unless it was already set to 5;

b)  If the tracking area updating attempt counter is less than 5:

-  the UE shall start timer T3411, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. When timer T3411 expires the combined tracking area updating procedure indicating "combined TA/LA updating with IMSI attach" is triggered again;

c)  If the tracking area updating attempt counter is equal to 5:

-  a UE operating in CS/PS mode 2 of operation and a UE operating in CS/PS mode 1 of operation with "IMS voice available" shall start timer T3402, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. When timer T3402 expires the combined tracking area updating procedure indicating "combined TA/LA updating with IMSI attach" is triggered again; and

-  a UE operating in CS/PS mode 1 of operation with "IMS voice not available" shall attempt to select GERAN, UTRAN or NG-RAN radio access technology, proceed with appropriate MM, GMM or 5GMM specific procedures and disable the E-UTRA capability (see clause  4.5); and

d)  If there is a CS fallback emergency call or CS fallback call pending, or a paging for CS fallback, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures; otherwise, if there is a CS fallback emergency call or CS fallback call pending, the EMM sublayer shall indicate the abort of the EMM procedure to the MM sublayer; and

3)  otherwise, the abnormal cases specified in clause  5.5.3.2.6 apply with the following modification.

  If the tracking area updating attempt counter is incremented according to clause  5.5.3.2.6 the next actions depend on the value of the tracking area updating attempt counter.

-  If the tracking area updating attempt counter is less than 5, the UE shall set the update status to U2 NOT UPDATED, but shall not delete any LAI, TMSI, ciphering key sequence number and list of equivalent PLMNs and additionally if the tracking area updating procedure was performed due to cases h, m, n, z, zc in clause 5.5.3.3.2 the update status shall be changed to EU2; or

-  if the tracking area updating attempt counter is equal to 5, the UE shall delete any LAI, TMSI and ciphering key sequence number and set the update status to U2 NOT UPDATED.

  If there is a CS fallback emergency call pending or CS fallback call pending, or a paging for CS fallback, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures; otherwise if there is a CS fallback emergency call or CS fallback call pending, the EMM sublayer shall indicate the abort of the EMM procedure to the MM sublayer.

5.5.3.3.7  Abnormal cases on the network side

The abnormal cases specified in clause  5.5.3.2.7 apply.

5.5.4  eCall inactivity procedure

The eCall inactivity procedure is applicable only to a UE configured for eCall only mode as specified in 3GPP  S  31.102  [17]. The procedure shall be started when:

-  the UE is in any EMM-REGISTERED substate except substates EMM-REGISTERED.PLMN-SEARCH or EMM-REGISTERED.NO-CELL-AVAILABLE;

-  the UE is in EMM-IDLE mode; and

-  one of the following conditions applies:

1)  timer T3444 expires or is found to have already expired and timer T3445 is not running;

2)  timer T3445 expires or is found to have already expired and timer T3444 is not running; or

3)  timers T3444 and T3445 expire or are found to have already expired.

The UE shall then perform the following actions:

-  stop other running timers (e.g. T3411, T3412);

-  if the UE is currently registered to EPS services only, perform a detach procedure for EPS services only;

-  if the UE is currently registered for both EPS services and non-EPS services, perform a combined detach procedure for EPS services and non-EPS services;

-  delete any GUTI, TAI list, last visited registered TAI, list of equivalent PLMNs, and eKSI; and

-  enter EMM-DEREGISTERED.eCALL-INACTIVE state.

5.5.5  Tracking area update request message (for N1 mode only)

The tracking area updating procedure is used to construct a TRACKING AREA UPDATE REQUEST message for the inter-system change from S1 mode to N1 mode for further security verification by the MME.

The TRACKING AREA UPDATE REQUEST message is created by EMM by request of 5GMM which further includes the message in the REGISTRATION REQUEST message as described in 3GPP  S  24.501  [54].

The TRACKING AREA UPDATE REQUEST message shall contain only mandatory information elements.

The UE shall set the EPS update type IE in the TRACKING AREA UPDATE REQUEST message to "TA updating".

The UE shall include the eKSI (either KSIASME or KSISGSN) in the NAS Key Set Identifier IE in the TRACKING AREA UPDATE REQUEST message. The UE shall integrity protect the TRACKING AREA UPDATE REQUEST message with the current EPS security context and increase the uplink NAS COUNT by one. The UE shall set associated GUTI in the Old GUTI IE.

When the UE is in EMM-REGISTERED.NO-CELL-AVAILABLE substate and needs to construct the TRACKING AREA UPDATE REQUEST message for inter-system change from S1 mode to N1 mode, the UE shall consider that the tracking area updating procedure is not initiated and the UE shall remain in EMM-REGISTERED.NO-CELL-AVAILABLE state.

5.5.6  Attach request message (for N1 mode only)

The attach procedure is used to construct an ATTACH REQUEST message for a UE performing a registration procedure for initial registration when

a)  the UE:

1)  previously was registered in S1 mode before entering state EMM-DEREGISTERED; and

2)  has received an "interworking without N26 interface not supported" indication from the network; and

b)  EPS security context and a valid 4G-GUTI are available.

The ATTACH REQUEST message is created by EMM by request of 5GMM which further includes the message in the REGISTRATION REQUEST message as described in 3GPP  S  24.501  [54].

The ATTACH REQUEST message shall contain only mandatory information elements.

The UE shall set the EPS attach type IE in the ATTACH REQUEST message to "EPS attach".

The UE shall include the eKSI (KSIASME) in the NAS Key Set Identifier IE in the ATTACH REQUEST message. The UE shall integrity protect the ATTACH REQUEST message with the current EPS security context and increase the uplink NAS COUNT by one.

The UE shall set associated GUTI in the EPS mobile identity IE.

The UE shall set the UE network capability IE according to its capabilities.

The UE shall include an ESM DUMMY MESSAGE in the ESM message container IE.

5.6  EMM connection management procedures (S1 mode only)

5.6.1  Service request procedure

5.6.1.1  General

The purpose of the service request procedure is to transfer the EMM mode from EMM-IDLE to EMM-CONNECTED mode. If the UE is not using EPS services with control plane CIoT EPS optimization, this procedure is used to establish the radio and S1 bearers when user data or signalling is to be sent. If the UE is using EPS services with control plane CIoT EPS optimization, this procedure can be used for UE initiated transfer of user data via the control plane. Another purpose of this procedure is to invoke MO/MT CS fallback or 1xCS fallback procedures.

This procedure is used when:

-  the network has downlink signalling pending;

-  the UE has uplink signalling pending;

-  the UE or the network has user data pending and the UE is in EMM-IDLE mode;

-  the UE is in EMM-CONNECTED mode and has a NAS signalling connection only; the UE is using EPS services with control plane CIoT EPS optimization, and it has user data pending which is to be transferred via user plane radio bearers;

-  the UE in EMM-IDLE or EMM-CONNECTED mode has requested to perform mobile originating/terminating CS fallback or 1xCS fallback;

-  the network has downlink cdma2000   xae signalling pending;

-  the UE has uplink cdma2000   xae signalling pending;

-  the UE has to request resources for ProSe direct discovery or Prose direct communication;

-  the UE has to request resources for V2X communication over PC5;

-  the UE that is MUSIM UE and in EMM-IDLE mode requests the network to remove the paging restriction; or

-  to indicate to the network that the MUSIM UE requests the release of the NAS signalling connection or reject paging.

The service request procedure is initiated by the UE, however, for the downlink transfer of signalling, cdma2000   xae signalling or user data in EMM-IDLE mode, the trigger is given by the network by means of the paging procedure (see clause  5.6.2).

The UE shall invoke the service request procedure when:

a)  the UE in EMM-IDLE mode receives a paging request using S-TMSI with CN domain indicator set to "PS" from the network;

NOTE:  As an implementation option, the MUSIM UE is allowed to not respond to paging based on the information available in the paging message, e.g. voice service indication.

b)  the UE, in EMM-IDLE mode, has pending user data to be sent;

c)  the UE, in EMM-IDLE mode, has uplink signalling pending;

d)  the UE in EMM-IDLE or EMM-CONNECTED mode is configured to use CS fallback and has a mobile originating CS fallback request from the upper layer;

e)  the UE in EMM-IDLE mode is configured to use CS fallback and receives a paging request with CN domain indicator set to "CS", or the UE in EMM-CONNECTED mode is configured to use CS fallback and receives a CS SERVICE NOTIFICATION message;

f)  the UE in EMM-IDLE or EMM-CONNECTED mode is configured to use 1xCS fallback and has a mobile originating 1xCS fallback request from the upper layer;

g)  the UE in EMM-CONNECTED mode is configured to use 1xCS fallback and accepts cdma2000   xae signalling messages containing a 1xCS paging request received over E-UTRAN;

h)  the UE, in EMM-IDLE mode, has uplink cdma2000   xae signalling pending to be transmitted over E-UTRAN;

i)  the UE, in EMM-IDLE or EMM-CONNECTED mode, is configured to use 1xCS fallback, accepts cdma2000   xae signalling messages containing a 1xCS paging request received over cdma2000   xae 1xRTT, and the network supports dual Rx CSFB or provide CS fallback registration parameters (see 3GPP  S  36.331  [22]);

j)  the UE, in EMM-IDLE or EMM-CONNECTED mode, has uplink cdma2000   xae signalling pending to be transmitted over cdma2000   xae 1xRTT, and the network supports dual Rx CSFB or provide CS fallback registration parameters (see 3GPP  S  36.331  [22]);

k)  the UE performs an inter-system change from S101 mode to S1 mode and has user data pending;

l)  the UE in EMM-IDLE mode has to request resources for ProSe direct discovery or Prose direct communication (see 3GPP  S  36.331  [22]);

m)  the UE, in EMM-CONNECTED mode and has a NAS signalling connection only, is using EPS services with control plane CIoT EPS optimization and has pending user data to be sent via user plane radio bearers;

n)  the UE in EMM-IDLE mode has to request resources for V2X communication over PC5 (see 3GPP  S  23.285  [47]);

o)  the network supports the paging restriction and the UE that is MUSIM UE and in EMM-IDLE mode is requesting the network to remove the paging restriction;

p)  the network supports the NAS signalling connection release and the MUSIM UE in EMM-CONNECTED mode requests the network to release the NAS signalling connection and, if the network supports the paging restriction, optionally includes paging restriction; or

q)  the network supports the reject paging request and the MUSIM UE, in EMM-IDLE mode when responding to paging rejects the paging request from the network, requests the network to release the NAS signalling connection and, if the network supports the paging restriction, optionally includes paging restriction.

If one of the above criteria to invoke the service request procedure is fulfilled, then the service request procedure may only be initiated by the UE when the following conditions are fulfilled:

-  its EPS update status is EU1 UPDATED, and the current TAI of the current serving cell is included in the TAI list; and

-  no EMM specific procedure is ongoing.

The MUSIM UE shall not initiate service request procedure for requesting the network to release the NAS signalling connection if the UE is attached for emergency bearer services or if the UE has a PDN connection for emergency bearer services established. To enable the emergency call back, the UE shall not initiate service request procedure for requesting the network to release the NAS signalling connection for a UE implementation-specific duration of time after the completion of the emergency bearer services.



NOTE  1:  AS indications (indications from lower layers) are results of procedures triggered by MME in service request procedure. Triggered procedures could be e.g. RRC connection reconfiguration procedure (see 3GPP  S  36.331  [22]) and inter system PS handover to GERAN or UTRAN procedure as a result of CSFB procedure (see 3GPP  S  23.272  [9]).

NOTE  2:  For 1xCS fallback, the UE sends the EXTENDED SERVICE REQUEST message and starts timer T3417. The procedure is considered completed upon receiving indication of system change from AS.



Figure 5.6.1.1.1: Service request procedure (part 1)



NOTE  1:  Security protected NAS message: this could be e.g. a SECURITY MODE COMMAND, SERVICE ACCEPT, or ESM DATA TRANSPORT message.

NOTE  2:  AS indications (indications from lower layers) are results of procedures triggered by MME in service request procedure. Triggered procedures could be e.g. an RRC connection release procedure or RRC connection reconfiguration procedure (see 3GPP  S  36.331  [22]).



Figure 5.6.1.1.2: Service request procedure (part 2)

A service request attempt counter is used to limit the number of service request attempts and no response from the network. The service request attempt counter shall be incremented as specified in clause  5.6.1.6.

The service request attempt counter shall be reset when:

-  a normal or periodic tracking area updating or a combined tracking area updating procedure is successfully completed;

-  a service request procedure in order to obtain packet services is successfully completed;

-  a service request procedure is rejected as specified in clause  5.6.1.5 or clause  5.3.7b; or

-  the UE moves to EMM-DEREGISTERED state.

5.6.1.2  Service request procedure initiation

5.6.1.2.1  UE is not using EPS services with control plane CIoT EPS optimization

For cases a, b, c, h, k, l and o in clause  5.6.1.1:

-  if the UE is not configured for NAS signalling low priority, the UE initiates the service request procedure by sending a SERVICE REQUEST message to the MME;

-  if the UE is configured for NAS signalling low priority, and the last received ATTACH ACCEPT message or TRACKING AREA UPDATE ACCEPT message from the network indicated that the network supports use of EXTENDED SERVICE REQUEST for packet services, the UE shall send an EXTENDED SERVICE REQUEST message with service type set to "packet services via S1"; or

NOTE:  A UE configured for dual priority is configured for NAS signalling low priority indicator.

-  if the UE is configured for NAS signalling low priority and the last received ATTACH ACCEPT message or TRACKING AREA UPDATE ACCEPT message from the network did not indicate that the network supports use of EXTENDED SERVICE REQUEST for packet services, the UE shall instead send a SERVICE REQUEST message.

For cases a, b, c, h, k, l, and o in clause  5.6.1.1, after sending the SERVICE REQUEST message or the EXTENDED SERVICE REQUEST message with service type set to "packet services via S1", the UE shall start T3417 and enter the state EMM-SERVICE-REQUEST-INITIATED.

For case d in clause  5.6.1.1, the UE shall send an EXTENDED SERVICE REQUEST message, start T3417ext and enter the state EMM-SERVICE-REQUEST-INITIATED.

For case e in clause  5.6.1.1:

-  if the UE is in EMM-IDLE mode, the UE shall send an EXTENDED SERVICE REQUEST message, start T3417ext-mt and enter the state EMM-SERVICE-REQUEST-INITIATED;

-  if the UE is in EMM-CONNECTED mode and if the UE accepts the paging, the UE shall send an EXTENDED SERVICE REQUEST message with the CSFB response IE indicating "CS fallback accepted by the UE", start T3417ext-mt and enter the state EMM-SERVICE-REQUEST-INITIATED; or

-  if the UE is in EMM-CONNECTED mode and if the UE rejects the paging, the UE shall send an EXTENDED SERVICE REQUEST message with the CSFB response IE indicating "CS fallback rejected by the UE" and enter the state EMM-REGISTERED.NORMAL-SERVICE. The network shall not initiate CS fallback procedures.

For cases f, g, i and j in clause  5.6.1.1, the UE shall send an EXTENDED SERVICE REQUEST message, start T3417 and enter the state EMM-SERVICE-REQUEST-INITIATED.

For case o in clause  5.6.1.1, the UE may send an EXTENDED SERVICE REQUEST message with Service type set to "packet services via S1" and Request type set to "NAS signalling connection release" in the UE request type IE to remove the paging restriction and request the release of the NAS signalling connection at the same time. The UE shall start T3417 and enter the state EMM-SERVICE-REQUEST-INITIATED. The UE shall not include the Paging restriction IE in the EXTENDED SERVICE REQUEST message.

For cases p and q in clause  5.6.1.1, the UE shall send an EXTENDED SERVICE REQUEST message,

1)  for case p in clause  5.6.1.1, set Request type to "NAS signalling connection release" in the UE request type IE and Service type to "packet services via S1"; or

2)  for case q in clause  5.6.1.1, set Request type to "Rejection of paging" in the UE request type IE and,

a)  if the UE needs to reject PS paging, the UE shall set Service type to "packet services via S1"; or

b)  if the UE needs to reject CS paging, the UE shall set Service type to "mobile terminating CS fallback or 1xCS fallback" and the CSFB response IE to "CS fallback rejected by the UE"; and

start T3417, enter the state EMM-SERVICE-REQUEST-INITIATED and may include its paging restriction preference in the Paging restriction IE in the EXTENDED SERVICE REQUEST message.

5.6.1.2.2  UE is using EPS services with control plane CIoT EPS optimization

The UE shall send a CONTROL PLANE SERVICE REQUEST message, start T3417 and enter the state EMM-SERVICE-REQUEST-INITIATED.

For case a in clause  5.6.1.1, the Control plane service type of the CONTROL PLANE SERVICE REQUEST message shall indicate "mobile terminating request". The UE may include the ESM DATA TRANSPORT message. The UE shall not include any ESM message other than ESM DATA TRANSPORT message.

For case b in clause  5.6.1.1,

-  if the UE has pending IP, non-IP or Ethernet user data that is to be sent via the control plane radio bearers, the Control plane service type of the CONTROL PLANE SERVICE REQUEST message shall indicate "mobile originating request". The UE shall include an ESM DATA TRANSPORT message in the ESM message container IE. If the UE supports the CP-EDT (see 3GPP  S  36.300  [20]), the UE shall provide the CONTROL PLANE SERVICE REQUEST message in the NAS request to the lower layer to establish a RRC connection as specified in clause  5.3.1.1.

For cases b and m in clause  5.6.1.1,

-  if the UE has pending IP, non-IP or Ethernet user data that is to be sent via the user plane radio bearers, the UE shall set the Control plane service type of the CONTROL PLANE SERVICE REQUEST message to "mobile originating request" and the "active" flag in the Control plane service type IE to 1. The UE shall not include any ESM message container or NAS message container IE in the CONTROL PLANE SERVICE REQUEST message.

For case c in clause  5.6.1.1, the UE shall set the Control plane service type of the CONTROL PLANE SERVICE REQUEST message to "mobile originating request". If the CONTROL PLANE SERVICE REQUEST message is:

-  for sending SMS, the UE shall include the SMS message in the NAS message container IE and shall not include any ESM message container IE in the CONTROL PLANE SERVICE REQUEST message; and

-  for sending signalling different from SMS, the UE shall not include any ESM message container or NAS message container IE in the CONTROL PLANE SERVICE REQUEST message.

For cases p and q in clause  5.6.1.1, the UE shall send the CONTROL PLANE SERVICE REQUEST message,

-  for case p in clause  5.6.1.1 set Request type to "NAS signalling connection release" in the UE request type IE and Control plane service type IE to "mobile originating request"; or

-  for case q in clause  5.6.1.1 set Request type to "Rejection of paging" in the UE request type IE and Control plane service type IE to "mobile terminating request"; and

start T3417 and enter the state EMM-SERVICE-REQUEST-INITIATED. Further, the UE may include its paging restriction preference in the Paging restriction IE in the CONTROL PLANE SERVICE REQUEST message and shall not include any ESM message container or NAS message container IE in the CONTROL PLANE SERVICE REQUEST message.

For case o in clause  5.6.1.1, the Control plane service type of the CONTROL PLANE SERVICE REQUEST message shall indicate "mobile originating request". The UE shall not include the Paging restriction IE in the CONTROL PLANE SERVICE REQUEST message. The UE may include the UE request type IE and set Request type to "NAS signalling connection release" to remove the paging restriction and request the release of the NAS signalling connection at the same time. If the UE requests the release of the NAS signalling connection, the UE shall not include any ESM message container or NAS message container IE in the CONTROL PLANE SERVICE REQUEST message.

5.6.1.3  EMM common procedure initiation

Upon receipt of the SERVICE REQUEST, EXTENDED SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST message, the MME may initiate the EMM common procedures, e.g. the authentication procedure and security mode control procedure.

5.6.1.4  Service request procedure accepted by the network

5.6.1.4.1  UE is not using EPS services with control plane CIoT EPS optimization

If EMM-REGISTERED without PDN connection is supported by the UE and the MME and the MME has no active EPS bearer contexts for the UE, for cases a, b, c and o in clause  5.6.1.1, upon receipt of the SERVICE REQUEST message or the EXTENDED SERVICE REQUEST message for packet services, after completion of the EMM common procedures according to clause  5.6.1.3, if any, the MME shall send a SERVICE ACCEPT message.

If EMM-REGISTERED without PDN connection is supported by the UE and the MME and the UE has no active EPS bearer contexts, for cases a, b, c and o in clause  5.6.1.1, the UE shall treat the receipt of a SERVICE ACCEPT message as successful completion of the procedure. Otherwise, for cases a, b, c, h, k, l and o in clause  5.6.1.1, the UE shall treat the indication from the lower layers that the user plane radio bearer is set up as successful completion of the procedure. The UE shall reset the service request attempt counter, stop the timer T3417 and enter the state EMM-REGISTERED.

If the service type information element in the EXTENDED SERVICE REQUEST message indicates "mobile terminating CS fallback or 1xCS fallback" and the CSFB response IE, if included, indicates "CS fallback accepted by the UE", or if the service type information element in the EXTENDED SERVICE REQUEST message indicates "mobile originating CS fallback or 1xCS fallback" or "mobile originating CS fallback emergency call or 1xCS fallback emergency call", the network initiates CS fallback or 1xCS fallback procedures.

If the EPS bearer context status IE is included in the EXTENDED SERVICE REQUEST message, the network shall deactivate all those EPS bearer contexts locally (without peer-to-peer signalling between the network and the UE) which are active on the network side but are indicated by the UE as being inactive. If a default EPS bearer context is marked as inactive in the EPS bearer context status IE included in the EXTENDED SERVICE REQUEST message, and this default bearer is not associated with the last remaining PDN connection of the UE in the MME, the MME shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the UE. If the default bearer is associated with the last remaining PDN connection of the UE in the MME, and EMM-REGISTERED without PDN connection is supported by the UE and the MME, the MME shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the UE. If the default EPS bearer context of a PDN connection established as a user-plane resource of an MA PDU session as specified in clause  5.3 of 3GPP  S  24.193  [61] is deactivated locally and the MA PDU session does not have user plane resources established on non-3GPP access in N1 mode, the network shall perform a local release of the MA PDU session.

If the SERVICE REQUEST message or the EXTENDED SERVICE REQUEST message for packet services, was sent in a CSG cell and the CSG subscription has expired or was removed for a UE, but the UE has a PDN connection for emergency bearer services established, the network shall accept the SERVICE REQUEST message or the EXTENDED SERVICE REQUEST message for packet services and deactivate all non-emergency EPS bearers locally. The emergency EPS bearers shall not be deactivated.

For cases d in clause  5.6.1.1, and for case e in clause  5.6.1.1 when the CSFB response was set to "CS fallback accepted by the UE", the UE shall treat the indication from the lower layers that the inter-system change from S1 mode to A/Gb or Iu mode is completed as successful completion of the procedure. The EMM sublayer in the UE shall indicate to the MM sublayer that the CS fallback procedure has succeeded. The UE shall stop the timer T3417ext or T3417ext-mt, respectively, and enter the state EMM-REGISTERED.NO-CELL-AVAILABLE.

If the service request procedure was initiated in EMM-IDLE mode and an EXTENDED SERVICE REQUEST message was sent in a CSG cell and the CSG subscription has expired or was removed for the UE, the network need not perform CSG access control if the service type information element indicates "mobile originating CS fallback emergency call or 1xCS fallback emergency call".

For cases f and g in clause  5.6.1.1:

-  if the UE receives the indication from the lower layers that the signalling connection is released with the redirection indication to cdma2000   xae 1x access network or the indication from the lower layers that a change to cdma2000   xae 1x access network for 1xCS fallback has started (see 3GPP  S  36.331  [22]), the UE shall consider the service request procedure successfully completed, stop timer T3417 and enter the state EMM-REGISTERED.NO-CELL-AVAILABLE;

-  if the UE receives the dual Rx/Tx redirection indication from the lower layers (see 3GPP  S  36.331  [22]), the UE shall select cdma2000   xae 1x access network for 1xCS fallback, consider the service request procedure successfully completed, stop timer T3417 and enter the state EMM-REGISTERED.NORMAL-SERVICE; and

-  if the UE receives a cdma2000   xae signalling message indicating 1xCS fallback rejection by cdma2000   xae 1x access network, the UE shall abort the service request procedure, stop timer T3417 and enter the state EMM-REGISTERED.NORMAL-SERVICE.

For cases i and j in clause  5.6.1.1, if the UE receives the indication from the lower layers that the signalling connection is released, the UE shall consider the service request procedure successfully completed, stop timer T3417 and enter the state EMM-REGISTERED.NO-CELL-AVAILABLE.

For cases o, p and q in clause  5.6.1.1, when the MUSIM UE in the EXTENDED SERVICE REQUEST message sets the Request type to "NAS signalling connection release" or to "Rejection of paging" in the UE request type IE, the UE shall treat the receipt of SERVICE ACCEPT message as the successful completion of the procedure and the UE shall reset the service request attempt counter, stop timer T3417 and enter the state EMM-REGISTERED.

If the SERVICE REQUEST message or an EXTENDED SERVICE REQUEST message for packet services was used, the UE shall locally deactivate the EPS bearer contexts that do not have a user plane radio bearer established upon successful completion of the service request procedure, except for the case when the MUSIM UE in the EXTENDED SERVICE REQUEST message sets the Request type to "NAS signalling connection release" or to "Rejection of paging" in the UE request type IE.

If the EXTENDED SERVICE REQUEST message is for CS fallback or 1xCS fallback and radio bearer establishment takes place during the procedure, the UE shall locally deactivate the EPS bearer contexts that do not have a user plane radio bearer established upon receiving a lower layer indication of radio bearer establishment. The UE does not perform local deactivation of EPS bearer contexts upon receiving an indication of inter-system change from lower layers.

If the EXTENDED SERVICE REQUEST message is for CS fallback or 1xCS fallback and radio bearer establishment does not take place during the procedure, the UE does not perform local deactivation of the EPS bearer context. The UE does not perform local deactivation of EPS bearer contexts upon receiving an indication of inter-system change from lower layers.

If a service request is received from a UE with a LIPA PDN connection, and if:

-  a GW Transport Layer Address IE value identifying a L-GW is provided by the lower layer together with the service request, and the P-GW address included in the EPS bearer context of the LIPA PDN connection is different from the provided GW Transport Layer Address IE value (see 3GPP  S  36.413  [23]); or

-  no GW Transport Layer Address is provided together with the service request by the lower layer;

then the MME shall locally deactivate all EPS bearer contexts associated with any LIPA PDN connection. Furthermore, if no active EPS bearer contexts remain for the UE, the MME shall not accept the service request as specified in clause  5.6.1.5.

If a service request is received from a UE with a SIPTO at the local network PDN connection, and if the PDN connection is a:

1)  SIPTO at the local network PDN connection with stand-alone GW, and if:

-  a LHN-ID value is provided by the lower layer together with the service request, and the LHN-ID value stored in the EPS bearer context of the SIPTO at the local network PDN connection is different from the provided LHN-ID value (see 3GPP  S  36.413  [23]); or

-  no LHN-ID value is provided together with the service request by the lower layer; or

2)  SIPTO at the local network PDN connection with collocated L-GW, and if:

-  a SIPTO L-GW Transport Layer Address IE value identifying a L-GW is provided by the lower layer together with the service request, and the P-GW address included in the EPS bearer context of the SIPTO at the local network PDN connection is different from the provided SIPTO L-GW Transport Layer Address IE value (see 3GPP  S  36.413  [23]); or

-  no SIPTO L-GW Transport Layer Address is provided together with the service request by the lower layer;

then, the MME takes one of the following actions:

-  if all the remaining PDN connections are SIPTO at the local network PDN connections, the MME shall not accept the service request as specified in clause  5.6.1.5; and

-  if a PDN connection remains that is not SIPTO at the local network PDN connection and the network decides to set up the S1 and radio bearers, the MME shall upon completion of the setup of the S1 bearers initiate an EPS bearer context deactivation procedure with ESM cause  #39 "reactivation requested" for the default EPS bearer context of each SIPTO at the local network PDN connection (see clause  6.4.4.2).

NOTE:  For some cases of CS fallback or 1x CS fallback the network can decide not to set up any S1 and radio bearers.

Upon receipt of the SERVICE REQUEST message, the MME shall delete any stored paging restriction for the UE and stop restricting paging.

If the MUSIM UE does not include the Paging restriction IE in the EXTENDED SERVICE REQUEST message, the MME shall delete any stored paging restriction for the UE and stop restricting paging.

For cases p and q in clause  5.6.1.1 when the MUSIM UE sets the Request type to "NAS signalling connection release" or to "Rejection of paging" in the UE request type IE in the EXTENDED SERVICE REQUEST message and if the UE requests restriction of paging by including the Paging restriction IE, the MME:

-  if accepts the paging restriction, shall include the EPS additional request result IE in the SERVICE ACCEPT message and set the Paging restriction decision to "paging restriction is accepted". The MME shall store the paging restriction of the UE and enforce these restrictions in the paging procedure as described in clause  5.6.2; or

-  if rejects the paging restriction, shall include the EPS additional request result IE in the SERVICE ACCEPT message and set the Paging restriction decision to "paging restriction is rejected", and shall discard the received paging restriction. The MME shall delete any stored paging restriction for the UE and stop restricting paging; and

-  shall initiate the release of the NAS signalling connection after the completion of the service request procedure.

When the E-UTRAN fails to establish radio bearers for one or more EPS bearer contexts, then the MME shall locally deactivate the EPS bearer contexts corresponding to the failed radio bearers based on the lower layer indication from the EUTRAN, without notifying the UE.

If the UE is not using EPS services with control plane CIoT EPS optimization, the network shall consider the service request procedure successfully completed in the following cases:

-  when it receives an indication from the lower layer that the user plane is setup, if radio bearer establishment is required;

-  otherwise when it receives an indication from the lower layer that the UE has been redirected to the other RAT (GERAN or UTRAN in CS fallback, or cdma2000   xae 1x access network for 1xCS fallback).

5.6.1.4.2  UE is using EPS services with control plane CIoT EPS optimization

For case a in clause  5.6.1.1, upon receipt of the CONTROL PLANE SERVICE REQUEST message with Control plane service type indicating "mobile terminating request", after completion of the EMM common procedures according to clause  5.6.1.3:

1)  if the MME needs to perform an EPS bearer context status synchronization

-  for an EPS bearer context associated with Control plane only indication; or

-  for an EPS bearer context not associated with Control plane only indication, there is no downlink user data pending to be delivered via the user plane, and the UE did not set the "active" flag in the Control plane service type IE to 1; or

2)  if the control plane data back-off time for the UE is stored in MME and the MME decides to deactivate congestion control for transport of user data via the control plane,

then the MME shall send a SERVICE ACCEPT message.

Furthermore the MME may:

1)  initiate the transport of user data via the control plane procedure or any other NAS signalling procedure;

2)  if supported by the UE and required by the network, initiate the setup of the user plane radio bearer(s); or

3)  send a NAS signalling message not related to an EMM common procedure to the UE if downlink signalling is pending.

For case b in clause  5.6.1.1, upon receipt of the CONTROL PLANE SERVICE REQUEST message with Control plane service type indicating "mobile originating request", after completion of the EMM common procedures according to clause  5.6.1.3, if any, if the MME needs to perform an EPS bearer context status synchronization

-  for an EPS bearer context associated with Control plane only indication; or

-  for an EPS bearer context not associated with Control plane only indication, there is no downlink user data pending to be delivered via the user plane, and the UE did not set the "active" flag in the Control plane service type IE to 1,

then the MME shall send a SERVICE ACCEPT message.

Furthermore, the MME may:

1)  initiate release of the NAS signalling connection upon receipt of an indication from the ESM layer (see clause  6.6.4.2), unless the MME has additional downlink user data or signalling pending;

2)  initiate the setup of the user plane radio bearer(s), if downlink user data is pending to be delivered via the user plane or the UE has set the "active" flag in the Control plane service type IE to 1;

3)  send an ESM DATA TRANSPORT message to the UE, if downlink user data is pending to be delivered via the control plane;

4)  send a NAS signalling message not related to an EMM common procedure to the UE if downlink signalling is pending; or

5)  send a SERVICE ACCEPT message to complete the service request procedure, if no NAS security mode control procedure was initiated, the MME did not send a SERVICE ACCEPT message as specified above to perform an EPS bearer context status synchronization, and the MME did not initiate any of the procedures specified in item 1 to 4 above.

NOTE  1:  The MME can initiate the setup of the user plane radio bearer(s) if the MME decides to activate the congestion control for transport of user data via the control plane.

For case m in clause  5.6.1.1, upon receipt of the CONTROL PLANE SERVICE REQUEST message with Control plane service type indicating "mobile originating request" and the "active" flag in the Control plane service type IE set to 1:

1)  if the MME accepts the request, the MME shall initiate the setup of the user plane radio bearer(s) for all active EPS bearer contexts of SGi PDN connections that are established without control plane only indication.

2)  if the MME does not accept the request, the MME shall send a SERVICE ACCEPT message to complete the service request procedure.

NOTE  2:  The MME takes into account the maximum number of user plane radio bearers supported by the UE, in addition to local policies and the UE   's preferred CIoT network behaviour when deciding whether to accept the request to establish user plane bearer(s) as described in clause  5.3.15. If the MME accepts the request, all SGi PDN connections are considered as established without Control plane only indication.

NOTE  3:  In this release of the specification, a UE in NB-S1 mode can support a maximum of 2 user plane radio bearers (see clause  6.5.0).

For case c in clause  5.6.1.1, upon receipt of the CONTROL PLANE SERVICE REQUEST message with Control plane service type indicating "mobile originating request" and without an ESM message container IE, after completion of the EMM common procedures according to clause  5.6.1.3, if any, the MME proceeds as follows:

If the MME needs to perform an EPS bearer context status synchronization

-  for an EPS bearer context associated with Control plane only indication; or

-  for an EPS bearer context not associated with Control plane only indication, and there is no downlink user data pending to be delivered via the user plane,

then the MME shall send a SERVICE ACCEPT message.

Furthermore, the MME may:

1)  initiate the setup of the user plane radio bearer(s), if downlink user data is pending to be delivered via the user plane;

2)  send an ESM DATA TRANSPORT message to the UE, if downlink user data is pending to be delivered via the control plane;

3)  send a NAS signalling message not related to an EMM common procedure to the UE, if downlink signalling is pending; or

4)  send a SERVICE ACCEPT message to complete the service request procedure, if no NAS security mode control procedure was initiated, the MME did not send a SERVICE ACCEPT message as specified above to perform an EPS bearer context status synchronization, and the MME did not initiate any of the procedures specified in item 1 to 3 above.

If the MUSIM UE does not include the Paging restriction IE in the CONTROL PLANE SERVICE REQUEST message, the MME shall delete any stored paging restriction for the UE and stop restricting paging.

For cases p and q in clause  5.6.1.1 when the MUSIM UE sets the Request type to "NAS signalling connection release" or to "Rejection of paging" in the UE request type IE in the CONTROL PLANE SERVICE REQUEST message and if the UE requests restriction of paging by including the Paging restriction IE, the MME:

-  if accepts the paging restriction, shall include the EPS additional request result IE in the SERVICE ACCEPT message and set the Paging restriction decision to "paging restriction is accepted". The MME shall store the paging restriction of the UE, enforce these restrictions in the paging procedure as described in clause  5.6.2; or

-  if rejects the paging restriction, shall include the EPS additional request result IE in the SERVICE ACCEPT message and set the Paging restriction decision to "paging restriction is rejected", and shall discard the received paging restriction. The MME shall delete any stored paging restriction for the UE and stop restricting paging; and

-  shall initiate the release of the NAS signalling connection after the completion of the service request procedure.

In NB-S1 mode, for cases a, b, c and m in clause  5.6.1.1, if the MME needs to initiate the setup of user plane radio bearer(s), the MME shall check if the UE can support the establishment of additional user plane radio bearer based on the multiple DRB support indicated by UE in the UE network capability IE.

For cases a, b and c in clause 5.6.1.1, if the EPS bearer context status IE is included in the CONTROL PLANE SERVICE REQUEST message, the network shall deactivate all those EPS bearer contexts locally (without peer-to-peer signalling between the network and the UE) which are active on the network side but are indicated by the UE as being inactive. If a default EPS bearer context is marked as inactive in the EPS bearer context status IE included in the CONTROL PLANE SERVICE REQUEST message, and this default bearer is not associated with the last PDN connection of the UE in the MME, the MME shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the UE. If the default bearer is associated with the last remaining PDN connection of the UE in the MME, and EMM-REGISTERED without PDN connection is supported by the UE and the MME, the MME shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the UE.

If the EPS bearer context status IE is included in the CONTROL PLANE SERVICE REQUEST and the MME decides to respond with a SERVICE ACCEPT message, the MME shall include an EPS bearer context status IE, indicating which EPS bearer contexts are active in the MME, except for the case when no EPS bearer context exists on the network side.

If the MME needs to initiate an EPS bearer context status synchronization, the MME may include an EPS bearer context status IE in the SERVICE ACCEPT message also if no EPS bearer context status IE was included in the CONTROL PLANE SERVICE REQUEST message.

If the MME sends a SERVICE ACCEPT message upon receipt of the CONTROL PLANE SERVICE REQUEST message piggybacked with the ESM DATA TRANSPORT message:

-  if the Release assistance indication IE is set to "No further uplink and no further downlink data transmission subsequent to the uplink data transmission is expected" in the message;

-  if the UE has indicated support for the control plane data back-off timer; and

-  if the MME decides to activate the congestion control for transport of user data via the control plane,

then the MME shall include the T3448 value IE in the SERVICE ACCEPT message.

If the MME sends a SERVICE ACCEPT message and decides to deactivate congestion control for transport of user data via the control plane then the MME shall delete the stored control plane data back-off time for the UE and the MME shall not include timer T3448 value IE in SERVICE ACCEPT message.

For cases a, b, c and m in clause 5.6.1.1, if the EPS bearer context status IE is included in the CONTROL PLANE SERVICE REQUEST message or the MME needs to initiate an EPS bearer context status synchronization, the MME shall consider the service request procedure successfully completed when it sends the SERVICE ACCEPT message. If the EPS bearer context status IE is not included in the CONTROL PLANE SERVICE REQUEST message and the MME does not need to initiate an EPS bearer context status synchronization, the MME shall consider the service request procedure successfully completed in the following cases:

-  when it successfully completes a NAS security mode control procedure;

-  when it receives an indication from the lower layer that the user plane is setup, if radio bearer establishment is required;

-  upon receipt of the CONTROL PLANE SERVICE REQUEST message and completion of the EMM common procedures, if any, if the CONTROL PLANE SERVICE REQUEST message was successfully integrity checked and the ESM message container or NAS message container in the CONTROL PLANE SERVICE REQUEST message, if applicable, was successfully deciphered, radio bearer establishment is not required, and the MME has downlink user data or signalling not related to an EMM common procedure pending; and

-  with the transmission of a SERVICE ACCEPT message or with the decision to initiate release of the NAS signalling connection, if the CONTROL PLANE SERVICE REQUEST message was successfully integrity checked and the ESM message container or NAS message container in the CONTROL PLANE SERVICE REQUEST message, if applicable, was successfully deciphered, radio bearer establishment is not required, and the MME does not have any downlink user data or signalling pending.

If the MME considers the service request procedure successfully completed the MME shall:

1)  forward the contents of the ESM message container IE, if any, to the ESM layer; and

2)  forward the contents of the NAS message container IE, if any.

For cases a, b and c in clause  5.6.1.1, the UE shall treat the receipt of any of the following as successful completion of the procedure:

-  a SECURITY MODE COMMAND message;

-  a security protected EMM message different from a SERVICE REJECT message and not related to an EMM common procedure;

-  a security protected ESM message; and

-  receipt of the indication from the lower layers that the user plane radio bearers are set up.

Upon successful completion of the procedure, the UE shall reset the service request attempt counter, stop the timer T3417 and enter the state EMM-REGISTERED.

NOTE  4:  The security protected EMM message can be e.g. a SERVICE ACCEPT message and the ESM message an ESM DATA TRANSPORT message.

For case m in clause  5.6.1.1, the UE shall treat the indication from the lower layers that the user plane radio bearers are set up as successful completion of the procedure. The UE shall treat the receipt of a SERVICE ACCEPT message as completion of the procedure without the establishment of the user plane radio bearers. For both cases, the UE shall reset the service request attempt counter, stop the timer T3417 and enter the state EMM-REGISTERED.

For case b in clause  5.6.1.1, the UE shall also treat the indication from the lower layers that the RRC connection has been released as successful completion of the procedure. The UE shall reset the service request attempt counter, stop the timer T3417 and enter the state EMM-REGISTERED.

For cases a, c and m in clause  5.6.1.1, the UE shall treat the indication from the lower layers that the RRC connection has been released as an abnormal case and shall follow the procedure described in clause  5.6.1.6, item b.

For cases p and q in clause  5.6.1.1, when the MUSIM UE in the CONTROL PLANE SERVICE REQUEST message sets the Request type to "NAS signalling connection release" or to "Rejection of paging" in the UE request type IE, the UE shall treat the receipt of SERVICE ACCEPT message as the successful completion of the procedure and the UE shall reset the service request attempt counter, stop timer T3417, enter the state EMM-REGISTERED and not deactivate EPS bearer contexts locally.

For case o in clause  5.6.1.1, the UE shall treat the receipt of SERVICE ACCEPT message as the successful completion of the procedure. The UE shall reset the service request attempt counter, stop timer T3417 and enter the state EMM-REGISTERED.

For cases a, b and c in clause 5.6.1.1,

-  if the MME needs to initiate an EPS bearer context status synchronization, the UE can receive a SERVICE ACCEPT message even after it received a SECURITY MODE COMMAND message or an indication from the lower layers that the user plane radio bearers are set up and determined successful completion of the service request procedure. Upon receipt of the SECURITY MODE COMMAND message or an indication from the lower layers that the user plane radio bearers are set up, the UE shall start timer T3449. If the UE receives a security protected ESM message or a security protected EMM message not related to an EMM common procedure, the UE shall stop the timer T3449. If the UE receives a SERVICE ACCEPT message while the timer T3449 is running, the UE shall treat the SERVICE ACCEPT message and stop the timer T3449. If the UE is not in state EMM-SERVICE-REQUEST-INITIATED and timer T3449 is not running, the receipt of the SERVICE ACCEPT message is considered as protocol error and the UE shall return EMM STATUS message as specified in clause 7.4; otherwise the UE shall treat the SERVICE ACCEPT message; and

-  if the UE treats the SERVICE ACCEPT message and an EPS bearer context status IE is included in the message, the UE shall deactivate all those EPS bearers contexts locally (without peer-to-peer signalling between the UE and the MME) which are active in the UE, but are indicated by the MME as being inactive. If a default EPS bearer context is marked as inactive in the EPS bearer context status IE included in the SERVICE ACCEPT message, and this default bearer is not associated with the last remaining PDN connection in the UE, the UE shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the MME. If the default bearer is associated with the last remaining PDN connection of the UE in the MME, and EMM-REGISTERED without PDN connection is supported by the UE and the MME, the UE shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the MME.

If the T3448 value IE is present in the received SERVICE ACCEPT message, the UE shall:

-  stop timer T3448 if it is running;

-  consider the transport of user data via the control plane as successful; and

-  start timer T3448 with the value provided in the T3448 value IE.

If the UE is using EPS services with control plane CIoT EPS optimization, the T3448 value IE is present in the SERVICE ACCEPT message and the value indicates that this timer is either zero or deactivated, the UE shall consider this case as an abnormal case and proceed as if the T3448 value IE is not present.

If the UE in EMM-IDLE mode initiated the service request procedure by sending a CONTROL PLANE SERVICE REQUEST message and the SERVICE ACCEPT message does not include the T3448 value IE and if timer T3448 is running, then the UE shall stop timer T3448.

5.6.1.5  Service request procedure not accepted by the network

If the service request cannot be accepted, the network shall return a SERVICE REJECT message to the UE including an appropriate EMM cause value.

NOTE  1:  A service request can only be rejected before the network has initiated any procedure which will be interpreted by the UE as successful completion of the service request procedure (see clauses  5.6.1.4.1 and 5.6.1.4.2) and which will trigger a transition from state EMM-SERVICE-REQUEST-INITIATED to EMM-REGISTERED on the UE side.

Based on local policies or configurations in the MME, if the MME determines to change the periodic tracking area update timer (T3412), or if the MME determines to change the PSM usage or the value of timer T3324 in the UE for which PSM is allowed by the MME, the MME may return a SERVICE REJECT with the cause #10 "implicitly detached" to the UE.

Based on operator policy, if the service request procedure is rejected due to core network redirection for CIoT optimizations, the network shall set the EMM cause value to #31 "Redirection to 5GCN required".

NOTE  2:  The network can take into account the UE   's N1 mode capability, the 5GS CIoT network behaviour supported by the UE or the 5GS CIoT network behaviour supported by the 5GCN to determine the rejection with the EMM cause value #31 "Redirection to 5GCN required".

The MME may be configured to perform MME-based access control for mobile originating CS fallback calls for a certain area A by rejecting related service request with EMM cause #39 "CS service temporarily not available".

NOTE  3:  Dependent on implementation and operator configuration the area A can be configured with the granularity of an MME area, tracking area or eNodeB service area.

The MME may further be configured for a certain area A   ' to exempt service requests for mobile originating CS fallback calls from this MME-based access control, if:

-  the service request is initiated in EMM-IDLE mode; and

-  the UE indicated support of eNodeB-based access control for mobile originating CS fallback calls during an attach or tracking area updating procedure.

NOTE  4:  The operator can use this second option when the eNodeBs in area A   ' are supporting the eNodeB-based access control for CS fallback calls. The area A   ' can be part of area A or the whole area A. It is the responsibility of the operator to coordinate the activation of MME-based access control and eNodeB-based access control for mobile originating CS fallback calls.

When the EMM cause value is #39 "CS service temporarily not available", the MME shall include a value for timer T3442 in the SERVICE REJECT message. If a mobile terminating CS fallback call is aborted by the network during call establishment as specified in 3GPP  S  29.118  [16A], the MME shall include the EMM cause value #39 "CS service temporarily not available" and set the value of timer T3442 to zero.

If a service request from a UE with only LIPA PDN connections is not accepted due to the reasons specified in clause  5.6.1.4, depending on the service request received, the MME shall include the following EMM cause value in the SERVICE REJECT message:

-  if the service request received is not due to CS fallback or 1xCS fallback, EMM cause value #10 "implicitly detached"; or

-  if the service request received is due to CS fallback or 1xCS fallback, EMM cause value #40 "no EPS bearer context activated".

If a service request from a UE with only remaining SIPTO at the local network PDN connections is not accepted due to the reasons specified in clause  5.6.1.4, depending on the service request received, the MME shall:

-  if the service request received is due to CS fallback or 1xCS fallback, include the EMM cause value #40 "no EPS bearer context activated" in the SERVICE REJECT message; or

-  if the service request received is not due to CS fallback or 1xCS fallback, abort the service request procedure and send a DETACH REQUEST message to the UE with detach type "re-attach required" (see clause  5.5.2.3.1).

If the service request for mobile originated services is rejected due to general NAS level mobility management congestion control, the network shall set the EMM cause value to #22 "congestion" and assign a value for back-off timer T3346.

In NB-S1 mode, if the service request for mobile originated services is rejected due to operator determined barring (see 3GPP  S  29.272  [16C]), the network shall set the EMM cause value to #22 "congestion" and assign a value for back-off timer T3346.

If the service request for mobile originated services is rejected due to service gap control as specified in clause  5.3.17 i.e. the T3447 timer is running, the network shall set the EMM cause value to #22 "congestion" and may assign a back-off timer T3346 with the remaining time of the running T3447 timer.

If the MME sends a SERVICE REJECT message upon receipt of the CONTROL PLANE SERVICE REQUEST message piggybacked with the ESM DATA TRANSPORT message:

-  if the Release assistance indication IE is not set to "No further uplink and no further downlink data transmission subsequent to the uplink data transmission is expected" in the message;

-  if the UE has indicated a support for the control plane data back-off timer; and

-  if the MME decides to activate the congestion control for transport of user data via the control plane,

then the MME shall set the EMM cause value to #22 "congestion" and assign a value for control plane data back-off timer T3448.

In NB-S1 mode or WB-S1 mode via satellite E-UTRAN access, if the service request is from a UE via a satellite E-UTRA cell and the network using the User Location Information provided by the eNodeB (see 3GPP  S  36.413  [23]), is able to determine that the UE is in a location where the network is not allowed to operate, the network shall set the EMM cause value in the SERVICE REJECT message to #78 "PLMN not allowed to operate at the present UE location".

On receipt of the SERVICE REJECT message, if the UE is in state EMM-SERVICE-REQUEST-INITIATED and the message is integrity protected or contains a reject cause other than EMM cause value #25, the UE shall reset the service request attempt counter, stop timer T3417, T3417ext or T3417ext-mt, if running.

If the SERVICE REJECT message with EMM cause #25 was received without integrity protection, then the UE shall discard the message.

Regardless of the EMM cause value received in the SERVICE REJECT message,

-  if the UE receives the Forbidden TAI(s) for the list of "forbidden tracking areas for roaming" IE in the SERVICE REJECT message, the UE shall store the TAI(s) included in the IE, if not already stored, into the list of "forbidden tracking areas for roaming" and remove the TAI(s) from the stored TAI list if present; and

-  if the UE receives the Forbidden TAI(s) for the list of "forbidden tracking areas for regional provision of service" IE in the SERVICE REJECT message, the UE shall store the TAI(s) included in the IE, if not already stored, into the list of "forbidden tracking areas for regional provision of service" and remove the TAI(s) from the stored TAI list if present.

Furthermore, the UE shall take the following actions depending on the received EMM cause value in the SERVICE REJECT message.

#3  (Illegal UE);

#6  (Illegal ME); or

#8  (EPS services and non-EPS services not allowed);

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall consider the USIM as invalid for EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in clause  5.3.7a. Additionally, the UE shall delete the list of equivalent PLMNs and shall enter the state EMM-DEREGISTERED.NO-IMSI. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.

  If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number and the MM parameters update status, TMSI, LAI and ciphering key sequence number as specified in 3GPP  S  24.008  [13] for the case when the service request procedure is rejected with the GMM cause with the same value. The USIM shall be considered as invalid also for non-EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in clause  5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.

NOTE  5:  The possibility to configure a UE so that the radio transceiver for a specific radio access technology is not active, although it is implemented in the UE, is out of scope of the present specification.

  For the EMM cause value #3 or #6, if the UE is operating in single-registration mode, the UE shall handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP  S  24.501  [54] for the case when the service request procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.

  For the EMM cause value #8, if the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.

#7  (EPS services not allowed);

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall consider the USIM as invalid for EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in clause  5.3.7a. The UE shall enter the state EMM-DEREGISTERED. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.

  A UE operating in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services.

  A UE operating in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED, shall attempt to select GERAN or UTRAN radio access technology and proceed with appropriate MM specific procedure according to the MM service state. The UE shall not reselect E-UTRAN radio access technology until switching off or the UICC containing the USIM is removed.

  If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP  S  24.008  [13] for the case when the service request procedure is rejected with the GMM cause with the same value.

  If the UE is operating in single-registration mode, the UE shall handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP  S  24.501  [54] for the case when the service request procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.

#9  (UE identity cannot be derived by the network);

  The UE shall set the EPS update status to EU2 NOT UPDATED (and shall store it according to clause  5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE.

  If the service request was initiated for CS fallback and a CS fallback cancellation request was not received, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer.

  If the service request was initiated for 1xCS fallback, the UE shall select cdma2000   xae 1x radio access technology. The UE then proceeds with appropriate cdma2000   xae 1x CS procedures.

  If the service request was initiated for 1xCS fallback and the UE has dual Rx/Tx configuration and supports enhanced 1xCS fallback, the UE shall perform a new attach procedure.

  If the service request was initiated for any reason other than CS fallback, 1x CS fallback or initiating a PDN connection for emergency bearer services, the UE shall perform a new attach procedure.

NOTE  6:  User interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.

  If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP  S  24.008  [13] for the case when the service request procedure is rejected with the GMM cause with the same value.

  A UE operating in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services.

  A UE operating in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED.

  If the UE is operating in single-registration mode, the UE shall handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP  S  24.501  [54] for the case when the service request procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.

#10  (Implicitly detached);

  A UE in CS/PS mode 1 or CS/PS mode 2 of operation is IMSI detached for both EPS services and non-EPS services.

  The UE shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE. The UE shall delete any mapped EPS security context or partial native EPS security context.

  If the service request was initiated for CS fallback and a CS fallback cancellation request was not received, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer.

  If the service request was initiated for 1xCS fallback, the UE shall select cdma2000   xae 1x radio access technology. The UE then proceeds with appropriate cdma2000   xae 1x CS procedures.

  If the service request was initiated for 1xCS fallback and the UE has dual Rx/Tx configuration and supports enhanced 1xCS fallback, the UE shall perform a new attach procedure.

  If the service request was initiated for any reason other than CS fallback, 1x CS fallback or initiating a PDN connection for emergency bearer services, the UE shall perform a new attach procedure.

NOTE  7:  User interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.

  If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM state as specified in 3GPP  S  24.008  [13] for the case when the service request procedure is rejected with the GMM cause with the same value.

  A UE operating in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED.

  If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM state as specified in 3GPP  S  24.501  [54] for the case when the service request procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.

#11  (PLMN not allowed); or

#35  (Requested service option not authorized in this PLMN);

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall delete the list of equivalent PLMNs and shall enter the state EMM-DEREGISTERED.PLMN-SEARCH.

  The UE shall store the PLMN identity in the "forbidden PLMN list" and if the UE is configured to use timer T3245 (see 3GPP  S  24.368  [15A] or 3GPP  S  31.102  [17]) then the UE shall start timer T3245 and proceed as described in clause  5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.

  The UE shall perform a PLMN selection according to 3GPP  S  23.122  [6].

  If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number and the MM parameters update status, TMSI, LAI, ciphering key sequence number and the location update attempt counter as specified in 3GPP  S  24.008  [13] for the case when the service request procedure is rejected with the GMM cause value #11.

  For the EMM cause value #11, if the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP  S  24.501  [54] for the case when the service request procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.

  For the EMM cause value #35, if the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U3 ROAMING NOT ALLOWED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.

#12  (Tracking area not allowed);

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE.

  The UE shall store the current TAI in the list of "forbidden tracking areas for regional provision of service". If the SERVICE REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of "forbidden tracking areas for regional provision of service" for non-integrity protected NAS reject message.

  If the UE initiated service request for mobile originated CS fallback and a CS fallback cancellation request was not received, then the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer.

  If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP  S  24.008  [13] for the case when the service request procedure is rejected with the GMM cause with the same value.

  If the UE is operating in single-registration mode, the UE shall in addition handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and the location update attempt counter, and the 5GMM parameters 5GMM state, 5GS update status, 5G-GUTI, last visited registered TAI, TAI list and ngKSI as specified in 3GPP  S  24.501  [54] for the case when the service request procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.

#13  (Roaming not allowed in this tracking area);

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3). The UE shall enter the state EMM-REGISTERED.PLMN-SEARCH.

  The UE shall store the current TAI in the list of "forbidden tracking areas for roaming" and remove the current TAI from the stored TAI list if present. If the SERVICE REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of "forbidden tracking areas for roaming" for non-integrity protected NAS reject message.

  The UE shall perform a PLMN selection according to 3GPP  S  23.122  [6].

  If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and the location update attempt counter, and the GMM parameters GMM state and GPRS update status as specified in 3GPP  S  24.008  [13] for the case when the service request procedure is rejected with the GMM cause with the same value.

  If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status as specified in 3GPP  S  24.501  [54] for the case when the service request procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.

#15  (No suitable cells in tracking area);

  The UE shall enter the state EMM-REGISTERED.LIMITED-SERVICE.

  The UE shall store the current TAI in the list of "forbidden tracking areas for roaming" and remove the current TAI from the stored TAI list if present. If the SERVICE REJECT message is not integrity protected, the UE shall memorize the current TAI was stored in the list of "forbidden tracking areas for roaming" for non-integrity protected NAS reject message.

  If the UE initiated service request for mobile originated CS fallback and a CS fallback cancellation request was not received, then the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer.

  If the service request was not initiated for mobile originated CS fallback, the UE shall search for a suitable cell in another tracking area or in another location area according to 3GPP  S  36.304  [21].

  If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and the location update attempt counter, and the GMM parameters GMM state and GPRS update status as specified in 3GPP  S  24.008  [13] for the case when the service request procedure is rejected with the GMM cause with the same value.

  If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters 5GMM state, 5GS update status as specified in 3GPP  S  24.501  [54] for the case when the service request procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.

#18  (CS domain not available);

  If the request was related to CS fallback, the UE shall send an indication to the MM sublayer and shall not attempt CS fallback until combined tracking area updating procedure has been successfully completed. The UE shall enter the state EMM-REGISTERED.NORMAL-SERVICE.

  The UE shall set the update status to U2 NOT UPDATED.

  If the UE is in CS/PS mode 1 of operation with "IMS voice not available" and the request was related to CS fallback, the UE shall attempt to select GERAN or UTRAN radio access technology and disable the E-UTRA capability (see clause 4.5).

  If the UE is in CS/PS mode 1 or CS/PS mode 2 mode of operation, the UE may provide a notification to the user or the upper layers that the CS domain is not available.

  If the request was related to 1xCS fallback, the UE shall cancel upper layer actions related to 1xCS fallback and enter the state EMM-REGISTERED.NORMAL-SERVICE.

#22  (Congestion);

  If the T3346 value IE is present in the SERVICE REJECT message and the value indicates that this timer is neither zero nor deactivated, the UE shall proceed as described below, otherwise it shall be considered as an abnormal case and the behaviour of the UE for this case is specified in clause  5.6.1.6.

  If the rejected request was not for initiating a PDN connection for emergency bearer services, the UE shall abort the service request procedure and enter state EMM-REGISTERED, and stop timer T3417, T3417ext or T3417ext-mt if still running.

  The UE shall stop timer T3346 if it is running.

  If the SERVICE REJECT message is integrity protected, the UE shall start timer T3346 with the value provided in the T3346 value IE.

  If the SERVICE REJECT message is not integrity protected, the UE shall start timer T3346 with a random value from the default range specified in 3GPP  S  24.008  [13].

  If the service request was initiated for CS fallback and a CS fallback cancellation request was not received, the UE in CS/PS mode 1 of operation shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer.

NOTE  8:  If the UE disables the E-UTRA capability, then subsequent mobile terminating calls could fail.

  If the service request was initiated for CS fallback for emergency call and a CS fallback cancellation request was not received, the UE may attempt to select GERAN or UTRAN radio access technology. It then proceeds with appropriate MM and CC specific procedures. The EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer.

  If the service request was initiated for 1xCS fallback, the UE shall select cdma2000   xae 1x radio access technology. The UE then proceeds with appropriate cdma2000   xae 1x CS procedures.

  If the service request was initiated for 1xCS fallback for emergency call, the UE may select cdma2000   xae 1x radio access technology. The UE then proceeds with appropriate cdma2000   xae 1x CS procedures.

  If the service request was initiated in EMM-CONNECTED mode with Control plane service type "mobile originating request" and with the "active" flag set to 1, the UE shall abort the procedure.

  If the service request procedure was initiated for an MO MMTEL voice call or an MO MMTEL video call is started, a notification that the service request was not accepted due to congestion shall be provided to the upper layers.

NOTE  9:  This can result in the upper layers requesting establishment of the originating voice call on an alternative manner e.g. requesting establishment of a CS voice call (see 3GPP  S  24.173  [13E]).

  For all other cases the UE stays in the current serving cell and applies normal cell reselection process. The service request procedure is started, if still necessary, when timer T3346 expires or is stopped.

  If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state and GPRS update status as specified in 3GPP  S  24.008  [13] for the case when the service request procedure is rejected with the GMM cause with the same value.

  If the UE is using EPS services with control plane CIoT EPS optimization and if the T3448 value IE is present in the SERVICE REJECT message and the value indicates that this timer is neither zero nor deactivated, the UE shall:

-  stop timer T3448 if it is running;

-  consider the transport of user data via the control plane as unsuccessful; and

-  start timer T3448:

-  with the value provided in the T3448 value IE if the SERVICE REJECT message is integrity protected; or

-  with a random value from the default range specified in table  10.2.1 if the SERVICE REJECT message is not integrity protected.

  If the UE is using EPS services with control plane CIoT EPS optimization and if the T3448 value IE is present in the SERVICE REJECT message and the value indicates that this timer is either zero or deactivated, the UE shall ignore the T3448 value IE and-  stop timer T3448 if it is running; and

-  consider the transport of user data via the control plane as unsuccessful.

  If the UE is using EPS services with control plane CIoT EPS optimization and if the T3448 value IE is not present in the SERVICE REJECT message, it shall be considered as an abnormal case and the behaviour of UE for this case is specified in clause  5.6.1.6.

  If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters, 5GMM state and 5GS update status as specified in 3GPP  S  24.501  [54] for the case when the service request procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.

#25  (Not authorized for this CSG);

  EMM cause #25 is only applicable when received from a CSG cell. EMM cause #25 received from a non-CSG cell is considered as an abnormal case and the behaviour of the UE is specified in clause  5.6.1.6.

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and store it according to clause  5.1.3.3). The UE shall enter the state EMM-REGISTERED.LIMITED-SERVICE.

  If the CSG ID and associated PLMN identity of the cell where the UE has initiated the service request procedure are contained in the Allowed CSG list, the UE shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.

  If the CSG ID and associated PLMN identity of the cell where the UE has initiated the service request procedure are contained in the Operator CSG list, the UE shall apply the procedures defined in 3GPP  S  23.122  [6] clause  3.1A.

  The UE shall search for a suitable cell according to 3GPP  S  36.304  [21].

  If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state and GPRS update status as specified in 3GPP  S  24.008  [13] for the case when the service request procedure is rejected with the GMM cause with the same value.

  If the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-REGISTERED and set the 5GS update status to 5U3 ROAMING NOT ALLOWED.

#31  (Redirection to 5GCN required);

  EMM cause #31 received by a UE that has not indicated support for CIoT optimizations is considered as an abnormal case and the behaviour of the UE is specified in clause  5.6.1.6.

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3). The UE shall reset the service request attempt counter and shall enter the state EMM-REGISTERED.LIMITED-SERVICE.

  The UE shall enable N1 mode capability for 3GPP access if it was disabled and disable the E-UTRA capability (see clause  4.5).

  If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters, 5GMM state, and 5GS update status as specified in 3GPP  S  24.501  [54] for the case when the service request procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.

#39  (CS service temporarily not available);

  If the T3442 value received in the SERVICE REJECT message is not zero, the UE shall start timer T3442 and enter the state EMM-REGISTERED.NORMAL-SERVICE. If the T3442 value received in the SERVICE REJECT message is zero, the UE shall not start timer T3442.

  The UE shall not try to send an EXTENDED SERVICE REQUEST message for mobile originating CS fallback to the network, except for mobile originating CS fallback for emergency calls, until timer T3442 expires or the UE sends a TRACKING AREA UPDATE REQUEST message.  

#40  (No EPS bearer context activated);

  The UE shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE. The UE shall delete any mapped EPS security context or partial native EPS security context.

  If the service request was initiated for CS fallback and a CS fallback cancellation request was not received, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer.

  If the service request was initiated for 1xCS fallback, the UE shall select cdma2000   xae 1x radio access technology. The UE then proceeds with appropriate cdma2000   xae 1x CS procedures.

  If the service request was initiated for 1xCS fallback and the UE has dual Rx/Tx configuration and supports enhanced 1xCS fallback, the UE shall perform a new attach procedure.

  If the service request was initiated for any reason other than CS fallback, 1x CS fallback or initiating a PDN connection for emergency bearer services, the UE shall perform a new attach procedure.

NOTE  10:  User interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.

  If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM state as specified in 3GPP  S  24.008  [13] for the case when the service request procedure is rejected with the GMM cause value #10 "Implicitly detached".

  A UE operating in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services in the network.

  A UE operating in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED.

  If the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED.

#42  (Severe network failure);

  The UE shall set the EPS update status to EU2 NOT UPDATED, and shall delete any GUTI, last visited registered TAI, TAI list, eKSI, and list of equivalent PLMNs. The UE shall start an implementation specific timer, setting its value to 2 times the value of T as defined in 3GPP  S  23.122  [6]. While this timer is running, the UE shall not consider the PLMN + RAT combination that provided this reject cause as a candidate for PLMN selection. The UE then enters state EMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP  S  23.122  [6].

  If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition set the GMM state to GMM-DEREGISTERED, GPRS update status to GU2 NOT UPDATED, MM update status to U2 NOT UPDATED and shall delete the P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number, LAI, TMSI and ciphering key sequence number.

  If the UE is operating in single-registration mode, the UE shall in addition set the 5GMM state to 5GMM-DEREGISTERED, 5GS update status to 5U2 NOT UPDATED, and shall delete any 5G-GUTI, last visited registered TAI, TAI list and ngKSI.

#78  (PLMN not allowed to operate at the present UE location).

  This cause value received from a non-satellite E-UTRA cell is considered as an abnormal case and the behaviour of the UE is specified in clause  5.5.6.1.6.

  The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to clause  5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. Additionally, the UE shall reset the registration attempt counter and shall enter state EMM-DEREGISTERED.PLMN-SEARCH and perform a PLMN selection according to 3GPP  S  23.122  [6].

  If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters, 5GMM state, and 5GS update status as specified in 3GPP  S  24.501  [54] for the case when the service request procedure performed over 3GPP access is rejected with the 5GMM cause with the same value.

Editor   's note:  [IoT_SAT_ARCH_EPS, CR#3620]. It is FFS how to prevent the UE from making repeated attempts at selecting the same satellite access PLMN if there are no other available PLMNs at UE   's location.

Other values are considered as abnormal cases. The specification of the UE behaviour in those cases is described in clause  5.6.1.6.

5.6.1.5A  Service request procedure for initiating a PDN connection for emergency bearer services not accepted by the network

If the service request for initiating a PDN connection for emergency bearer services cannot be accepted by the network, the UE shall perform the procedures as described in clause  5.6.1.5. Then if the UE is in the same selected PLMN where the last service request was attempted, the UE shall:

a)  inform the upper layers of the failure of the procedure; or

NOTE  1:  This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP  S  24.229  [13D] can result in the emergency call being attempted to another IP-CAN.

b)  detach locally, if not detached already, attempt EPS attach for emergency bearer services.

If the service request for initiating a PDN connection for emergency bearer services fails due to abnormal case a) in clause  5.6.1.6, the UE shall perform the actions as described in clause  5.6.1.6 and inform the upper layers of the failure to access the network.

NOTE  2:  This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP  S  24.229  [13D] can result in the emergency call being attempted to another IP-CAN.

If the service request for initiating a PDN connection for emergency bearer services fails due to abnormal cases b), c) or  e) in clause  5.6.1.6, the UE shall perform the procedures as described in clause  5.6.1.6. Then if the UE is in the same selected PLMN where the last service request was attempted, the UE shall:

a)  inform the upper layers of the failure of the procedure; or

NOTE  3:  This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP  S  24.229  [13D] can result in the emergency call being attempted to another IP-CAN.

b)  detach locally, if not detached already, attempt EPS attach for emergency bearer services.

5.6.1.5B  Service request procedure for UE attached for access to RLOS not accepted by the network

If the service request for UE attached for access to RLOS cannot be accepted by the network, the UE shall perform the procedures as described in clause  5.6.1.5.

Then if:

a)  the UE is in the same selected PLMN where the last service request was attempted and rejected;

b)  the service request procedure was rejected with an EMM cause value other than #9, #10 and #40; and

c)  timer T3346 is not running,

the UE shall:

a)  detach locally, if not detached already, and perform a PLMN selection according to 3GPP  S  23.122  [6] to attempt EPS attach for access to RLOS via another PLMN.

If the service request for UE attached for access to RLOS fails due to abnormal cases a), b), c) or  e) in clause  5.6.1.6, the UE shall perform the procedures as described in clause  5.6.1.6. Then if the UE is in the same selected PLMN where the last service request was attempted, the UE shall:

a)  detach locally, if not detached already, and perform a PLMN selection according to 3GPP  S  23.122  [6] to attempt EPS attach for access to RLOS via another PLMN.

5.6.1.6  Abnormal cases in the UE

The following abnormal cases can be identified:

a)  Access barred because of access class barring, EAB, ACDC or NAS signalling connection establishment rejected by the network without "Extended wait time" received from lower layers

  In WB-S1 mode, if the service request procedure is started in response to a paging request from the network, access class barring, EAB or ACDC is not applicable.

  In NB-S1 mode, if the service request procedure is started in response to a paging request from the network, access barring is not applicable.

  If the trigger for the service request procedure is the response to a paging request from the network and the NAS signalling connection establishment is rejected by the network, the service request procedure shall not be started. The UE stays in the current serving cell and applies normal cell reselection process. During an implementation dependent time period, the service request procedure may be started when access for "terminating calls" is granted or upon a cell change.

  If the service request was initiated for CS fallback and the access is barred for "mobile originating CS fallback" (see 3GPP  S  36.331  [22]) and the lower layer indicates "the barring is due to CSFB specific access barring information", the service request procedure shall not be started. The UE stays in the current serving cell and applies normal cell reselection process. The service request procedure may be started if it is still necessary, i.e. when access for "mobile originating CS fallback" is granted or because of a cell change.

  If the service request was initiated for CS fallback and a CS fallback cancellation request was not received and the access is barred for "mobile originating CS fallback" (see 3GPP  S  36.331  [22]) and the lower layer does not indicate "the barring is due to CSFB specific access barring information", the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer.

  If the service request was initiated for 1xCS fallback and the access is barred for "originating calls" (see 3GPP  S  36.331  [22]), the UE shall select cdma2000   xae 1x radio access technology. The UE then proceeds with appropriate cdma2000   xae 1x CS procedures.

  If the lower layer indicated the access was barred because of access class barring for "originating calls" (see 3GPP  S  36.331  [22]) and if:

-  the service request is initiated due to a request from upper layers for user plane radio resources, and the MO MMTEL voice call is started, the MO MMTEL video call is started or the MO SMSoIP is started;

-  the service request is initiated due to a mobile originated SMS over NAS or SMS over S102; or

-  the service request is initiated due to a request from upper layers for user plane radio resources, ACDC is applicable to the request and the UE supports ACDC.

  then the service request procedure shall be started. The call type used shall be per annex  D of this document.

NOTE  1:  If more than one of MO MMTEL voice call is started, MO MMTEL video call is started or MO SMSoIP is started conditions are satisfied, it is left to UE implementation to determine the call type based on annex  D of this document.

  If access is barred for a certain ACDC category (see 3GPP  S  36.331  [22]), and if the upper layers request user plane radio resources for a higher ACDC category and the UE supports ACDC, then the service request procedure shall be started.

  If an access request for an uncategorized application is barred due to ACDC (see 3GPP  S  36.331  [22]), and if the upper layers request user plane radio resources for a certain ACDC category and the UE supports ACDC, then the service request procedure shall be started.

  Otherwise:

-  In WB-S1 mode, if access is barred for "originating calls" (see 3GPP  S  36.331  [22]), the service request procedure shall not be started. The UE stays in the current serving cell and applies normal cell reselection process. The service request procedure may be started if it is still necessary when access for "originating calls" is granted or because of a cell change.

-  In NB-S1 mode, if access is barred for "originating calls" (see 3GPP  S  36.331  [22]), the service request procedure shall not be started. The UE stays in the current serving cell and applies normal cell reselection process. Further UE behaviour is implementation specific, e.g. the service request procedure is started again after an implementation dependent time; or

  In NB-S1 mode, if access is barred for "originating calls" (see 3GPP  S  36.331  [22]), and a request for an exceptional event is received from the upper layers, then the service request procedure shall be started.

NOTE  2:  In NB-S1 mode, the EMM layer cannot receive the access barring alleviation indication from the lower layers (see 3GPP  S  36.331  [22]).

b)  Lower layer failure or release of the NAS signalling connection without "Extended wait time", without "Extended wait time CP data", and without redirection indication received from lower layers before the service request procedure is completed (see clause  5.6.1.4) or before SERVICE REJECT message is received

  If the service request was initiated for CS fallback and a CS fallback cancellation request was not received, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer, and the UE shall also set the EPS update status to EU2 NOT UPDATED and enter the state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.

  If the service request was initiated for CS fallback and a CS fallback cancellation request was received, the UE shall set the EPS update status to EU2 NOT UPDATED and enter the state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.

  If the service request was initiated for 1xCS fallback, the UE shall either:

-  attempt to select cdma2000   xae 1x radio access technology and proceed with appropriate cdma2000   xae 1x CS procedures. If the UE fails to select cdma2000   xae 1x radio access technology, the UE shall set the EPS update status to EU2 NOT UPDATED and enter the state EMM-REGISTERED.ATTEMPTING-TO-UPDATE; or

-  set the EPS update status to EU2 NOT UPDATED and enter the state EMM-REGISTERED.ATTEMPTING-TO-UPDATE, and perform cell selection according to 3GPP  S  36.304  [21].

  If the service request was not initiated for CS fallback or 1xCS fallback, the UE shall enter state EMM-REGISTERED.

  The UE shall abort the service request procedure, stop timer T3417, T3417ext or T3417ext-mt and locally release any resources allocated for the service request procedure. For case o) in clause  5.6.1.1 the UE may retry the service request procedure a certain number of times (maximum re-attempts 5).

c)  T3417 expired

  The UE shall enter the state EMM-REGISTERED.

  If the UE triggered the service request procedure in EMM-IDLE mode in order to obtain packet services, then the EMM sublayer shall increment the service request attempt counter, abort the procedure and release locally any resources allocated for the service request procedure. The service request counter shall not be incremented, if:

-  the service request procedure is initiated to establish a PDN connection for emergency bearer services;

-  the UE has a PDN connection for emergency bearer services established;

-  the UE is a UE configured to use AC11        15 in selected PLMN;

-  the service request is initiated in response to paging from the network; or

-  the UE in NB-S1 mode is requested by the upper layer to transmit user data related to an exceptional event and the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP  S  24.368  [15A] or the USIM file EFNASCONFIG in 3GPP  S  31.102  [17]).

  If the service request attempt counter is greater than or equal to 5, the UE shall start timer T3325 (see 3GPP  S  24.008  [13]). Additionally if the service request was initiated for an "originating MMTEL voice" call type or an "originating MMTEL video" call type, a notification that the service request was not accepted and that timer T3325 is running shall be provided to the upper layers.

NOTE  3:  This can result in the upper layers requesting establishment of a CS voice call (if not already attempted in the CS domain), or other implementation specific mechanisms (see 3GPP  S  24.173  [13E]).

  The UE shall not attempt service request until expiry of timer T3325 unless:

-  the service request is initiated in response to paging from the network;

-  the UE is a UE configured to use AC11        15 in selected PLMN;

-  the service request is initiated to establish a PDN connection for emergency bearer services;

-  the UE has a PDN connection for emergency bearer services established;

-  the UE is registered in a new PLMN; or

-  the UE in NB-S1 mode is requested by the upper layer to transmit user data related to an exceptional event and the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP  S  24.368  [15A] or the USIM file EFNASCONFIG in 3GPP  S  31.102  [17]).

  If the service request for "originating MMTEL voice" call type was triggered while T3325 is running, a notification that the service request was not accepted and that timer T3325 is running shall be provided to the upper layers.

NOTE  4:  This can result in the upper layers requesting establishment of a CS voice call (if not already attempted in the CS domain), or other implementation specific mechanisms (see 3GPP  S  24.173  [13E]).

NOTE  5:  The NAS signalling connection can also be released if the UE deems that the network has failed the authentication check as specified in clause  5.4.2.7.

  If the UE triggered the service request procedure in order to obtain services other than packet services from EMM-IDLE mode, then the EMM sublayer shall abort the procedure and release locally any resources allocated for the service request procedure.

  If the UE triggered the service request procedure in EMM-CONNECTED mode, the EMM sublayer shall abort the procedure and consider the service request procedure with "active" flag set or the 1xCS fallback procedure as failed. The UE shall stay in EMM-CONNECTED mode.

d)  T3417ext or T3417ext-mt expired

  If a CS fallback cancellation request was not received, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer, and the UE shall also set the EPS update status to EU2 NOT UPDATED and enter the state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.

  If a CS fallback cancellation request was received the UE shall set the EPS update status to EU2 NOT UPDATED and enter the state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.

e)  SERVICE REJECT received, other EMM cause values than those treated in clause  5.6.1.5, and cases of EMM cause values #22, #25, #31 and #78 if considered as abnormal cases according to clause  5.6.1.5.

  If the service request was initiated for CS fallback and a CS fallback cancellation request was not received, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer, and the UE shall also set the EPS update status to EU2 NOT UPDATED and enter the state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.

  If the service request was initiated for CS fallback and a CS fallback cancellation request was received, the UE shall set the EPS update status to EU2 NOT UPDATED and enter the state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.

  If the service request was initiated for 1xCS fallback, the UE shall select cdma2000   xae 1x radio access technology. The UE then proceeds with appropriate cdma2000   xae 1x CS procedures.

  If the service request was initiated for 1xCS fallback and the UE has dual Rx/Tx configuration and supports enhanced 1xCS fallback, then upon entering EMM-IDLE mode the UE shall perform tracking area updating procedure.

  If the service request was not initiated for CS fallback or 1xCS fallback, the UE shall enter state EMM-REGISTERED.

  The UE shall abort the service request procedure, stop timer T3417, T3417ext or T3417ext-mt and locally release any resources allocated for the service request procedure.

f)  Tracking area updating procedure is triggered

  The UE shall abort the service request procedure, stop timer T3417, T3417ext or T3417ext-mt if running and perform the tracking area updating procedure. The "active" flag or "signalling active" flag shall be set in the TRACKING AREA UPDATE REQUEST message as specified in clause  5.5.3.2.2. If the service request was initiated for CS fallback or 1xCS fallback, and the CS fallback cancellation request was not received, the UE shall send the EXTENDED SERVICE REQUEST message to the MME by using the existing NAS signalling connection after the completion of the tracking area updating procedure. If the TRACKING AREA UPDATE ACCEPT message includes a UE radio capability ID deletion indication IE set to "Network-assigned UE radio capability IDs deletion requested", the UE shall not initiate a new tracking area update procedure, but shall proceed with sending the EXTENDED SERVICE REQUEST message by using the existing NAS signalling connection after the completion of the tracking area updating procedure.

g)  Switch off

  If the UE is in state EMM-SERVICE-REQUEST-INITIATED at switch off, the detach procedure shall be performed.

h)  Detach procedure collision

  EPS detach containing detach type "re-attach required":

  If the UE receives a DETACH REQUEST message from the network in state EMM-SERVICE-REQUEST-INITIATED, the UE shall take the following actions:

-  If the service request was initiated for CS fallback, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM, CC and GMM specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer;

-  If the service request was initiated for 1xCS fallback, the UE shall attempt to select cdma2000   xae 1x radio access technology. The UE then proceeds with appropriate cdma2000   xae 1x CS procedures; or

-  If the service request was not initiated for CS fallback or 1xCS fallback, the detach procedure shall be progressed and the service request procedure shall be aborted.

  EPS detach containing detach type "re-attach not required":

  If the UE receives a DETACH REQUEST message from the network in state EMM-SERVICE-REQUEST-INITIATED, the UE shall take the following actions:

-  If the DETACH REQUEST message contains an EMM cause other than #2 "IMSI unknown in HSS" or no EMM cause IE, the detach procedure shall be progressed and the service request procedure shall be aborted. Additionally, if the service request was initiated for CS fallback or 1xCS fallback, but not for CS fallback for emergency call or 1xCS fallback for emergency call, the EMM sublayer shall indicate to the MM sublayer or the cdma2000   xae upper layers that the CS fallback or 1xCS fallback procedure has failed; or

  If the DETACH REQUEST message contains EMM cause #2 "IMSI unknown in HSS", the UE will follow the procedure as described below for the detach type "IMSI detach".

  EPS detach containing detach type "IMSI detach":

  If the UE receives a DETACH REQUEST message from the network in state EMM-SERVICE-REQUEST-INITIATED, the UE shall take the following actions:

-  if the service request was initiated for SMS over NAS or CS fallback, but not for CS fallback for emergency call, the UE shall abort the service request procedure and progress the detach procedure; or

-  otherwise the UE shall progress both procedures.

i)  Transmission failure of SERVICE REQUEST, CONTROL PLANE SERVICE REQUEST or EXTENDED SERVICE REQUEST message indication with TAI change from lower layers

  If the current TAI is not in the TAI list, the service request procedure shall be aborted to perform the tracking area updating procedure. The "active" flag or "signalling active" flag shall be set in the TRACKING AREA UPDATE REQUEST message as specified in clause  5.5.3.2.2. If the service request was initiated for CS fallback or 1xCS fallback, and the CS fallback cancellation request was not received, the UE shall send the EXTENDED SERVICE REQUEST message to the MME by using the existing NAS signalling connection after the completion of the tracking area updating procedure.

  If the current TAI is still part of the TAI list, the UE shall restart the service request procedure unless the service request procedure is initiated for case p) or q) in clause  5.6.1.1. For case p) and q) in clause  5.6.1.1 the UE shall abort the service request procedure, enter state EMM-REGISTERED, stop timer T3417, and locally release the NAS signalling connection and any resources allocated for the service request procedure.

j)  Transmission failure of SERVICE REQUEST, CONTROL PLANE SERVICE REQUEST or EXTENDED SERVICE REQUEST message indication without TAI change from lower layers

  The UE shall restart the service request procedure unless the service request procedure is initiated for case p) or q) in clause  5.6.1.1. For case p) and q) in clause  5.6.1.1 the UE shall abort the service request procedure, enter state EMM-REGISTERED, stop timer T3417, and locally release the NAS signalling connection and any resources allocated for the service request procedure.

k)  Default or dedicated bearer set up failure

  If the lower layers indicate a failure to set up a radio bearer, the UE shall locally deactivate the EPS bearer as described in clause  6.4.4.6.

l)  "Extended wait time" from the lower layers

  The UE shall abort the service request procedure, enter state EMM-REGISTERED, and stop timer T3417, T3417ext or T3417ext-mt if still running.

  If the EXTENDED SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST message contained the low priority indicator set to "MS is configured for NAS signalling low priority", the UE shall start timer T3346 with the "Extended wait time" value.

  If the SERVICE REQUEST message was sent by a UE configured for NAS signalling low priority, the UE shall start timer T3346 with the "Extended wait time" value.

  If the EXTENDED SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST message did not contain the low priority indicator set to "MS is configured for NAS signalling low priority" or if the SERVICE REQUEST message was sent by a UE not configured for NAS signalling low priority, the UE is operating in NB-S1 mode and the UE is not a UE configured to use AC11        15 in selected PLMN, then the UE shall start timer T3346 with the "Extended wait time" value.

  In other cases the UE shall ignore the "Extended wait time".

  The UE stays in the current serving cell and applies normal cell reselection process. The service request procedure is started, if still necessary, when timer T3346 expires or is stopped.

  If the service request was initiated for CS fallback and a CS fallback cancellation request was not received, the UE in CS/PS mode 1 of operation shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer.

NOTE  5:  If the UE disables the E-UTRA capability, then subsequent mobile terminating calls could fail.

  If the service request was initiated for CS fallback for emergency call and a CS fallback cancellation request was not received, the UE may attempt to select GERAN or UTRAN radio access technology. It then proceeds with appropriate MM and CC specific procedures. The EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer.

  If the service request was initiated for 1xCS fallback, the UE shall select cdma2000   xae 1x radio access technology. The UE then proceeds with appropriate cdma2000   xae 1x CS procedures.

  If the service request was initiated for 1xCS fallback for emergency call, the UE may select cdma2000   xae 1x radio access technology. The UE then proceeds with appropriate cdma2000   xae 1x CS procedures.

  If the service request was initiated due to a request from the SMS entity to send an SMS and timer T3246 is not running, the UE, if operating in CS/PS mode 1 of operation, may select GERAN or UTRAN radio access technology. It then proceeds with the appropriate MM procedure.

NOTE  6:  If the UE disables the E-UTRA capability, then subsequent mobile terminating calls could fail.

la)  "Extended wait time CP data" from the lower layers

  The UE shall abort the service request procedure for transfer of user data via the control plane, enter state EMM-REGISTERED, and stop timer T3417 if still running.

  If the UE is operating in NB-S1 mode and supports the timer T3448, the UE shall start the timer T3448 with the "Extended wait time CP data" value. If the UE is operating in NB-S1 mode and does not support the timer T3448, the UE shall start the timer T3346 with the "Extended wait time CP data" value.

  In other cases the UE shall ignore the "Extended wait time CP data".

  The UE stays in the current serving cell and applies normal cell reselection process. The service request procedure for transfer of user data via the control plane is started, if still necessary, when the timer T3448 expires or is stopped.

m)  Timer T3346 is running

  The UE shall not start the service request procedure unless:

-  the UE receives a paging;

-  the UE is a UE configured to use AC11        15 in selected PLMN;

-  the UE has a PDN connection for emergency bearer services established or is establishing a PDN connection for emergency bearer services;

-  the UE is requested by the upper layer for a CS fallback for emergency call or a 1xCS fallback for emergency call;

-  the UE has a PDN connection established without the NAS signalling low priority indication or is establishing a PDN connection without the NAS signalling low priority indication and if the timer T3346 was started due to rejection of a NAS request message (e.g. ATTACH REQUEST, TRACKING AREA UPDATE REQUEST, EXTENDED SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST) which contained the low priority indicator set to "MS is configured for NAS signalling low priority";

-  the UE in NB-S1 mode is requested by the upper layer to transmit user data related to an exceptional event and:

-  the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the  NAS configuration MO in 3GPP  S  24.368  [15A] or the USIM file EFNASCONFIG in 3GPP  S  31.102  [17]); and

-  timer T3346 was not started when NAS signalling connection was established with RRC establishment cause set to "MO exception data"; or

-  the MUSIM UE is in EMM-CONNECTED mode and requests the network to release the NAS signalling connection (see case p in clause  5.6.1.1).

  If the UE is in EMM-IDLE mode, the UE stays in the current serving cell and applies normal cell reselection process. The service request procedure is started, if still necessary, when timer T3346 expires or is stopped.

  Upon upper layer   's request for a mobile originated CS fallback which is not for emergency call, the UE in CS/PS mode 1 of operation shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer.

NOTE  7:  If the UE disables the E-UTRA capability, then subsequent mobile terminating calls could fail.

  Upon upper layer   's request for a CS fallback for emergency call, the UE may select GERAN or UTRAN radio access technology. It then proceeds with appropriate MM and CC specific procedures. The EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer.

  Upon a request from the SMS entity to send an SMS and timer T3246 is not running, the UE, if operating in CS/PS mode 1 of operation, may select GERAN or UTRAN radio access technology. It then proceeds with the appropriate MM procedure.

NOTE  8:  If the UE disables the E-UTRA capability, then subsequent mobile terminating calls could fail.

  Upon upper layer   's request for a mobile originated 1x CS fallback which is not for emergency call, the UE shall select cdma2000   xae 1x radio access technology. The UE then proceeds with appropriate cdma2000   xae 1x CS call procedures.

  Upon upper layer   's request for a 1xCS fallback for emergency call, the UE may select cdma2000   xae 1x radio access technology. The UE then proceeds with appropriate cdma2000   xae 1x CS call procedures.

  If the service request procedure was triggered for an MO MMTEL voice call is started, a notification that the service request procedure was not initiated due to congestion shall be provided to the upper layers.

NOTE  9:  This can result in the upper layers requesting establishment of the originating voice call on an alternative manner e.g. requesting establishment of a CS voice call (see 3GPP  S  24.173  [13E]).

n)  Failure to find a suitable GERAN or UTRAN cell, after release of the NAS signalling connection without "Extended wait time" and with redirection indication received from lower layers when the service request was initiated for CS fallback

  The EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer, and the UE shall also set the EPS update status to EU2 NOT UPDATED and enter the state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.

  The UE shall abort the service request procedure, stop timer T3417ext or T3417ext-mt and locally release any resources allocated for the service request procedure.

o)  Timer T3448 is running

  The UE in EMM-IDLE mode shall not initiate the service request procedure for transport of user data via the control plane unless:

-  the UE is a UE configured to use AC11        15 in selected PLMN;

-  the UE which is only using EPS services with control plane CIoT EPS optimization received a paging; or

-  the UE in NB-S1 mode is requested by the upper layer to transmit user data related to an exceptional event and the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP  S  24.368  [15A] or the USIM file EFNASCONFIG in 3GPP  S  31.102  [17]).

  The UE stays in the current serving cell and applies the normal cell reselection process.

p)  Timer T3447 is running

  The UE shall not start any service request procedure unless:

-  the UE receives a paging;

-  the UE is a UE configured to use AC11        15 in selected PLMN;

-  the UE has a PDN connection for emergency bearer services established or is establishing a PDN connection for emergency bearer services; or

-  the MUSIM UE is in EMM-CONNECTED mode and requests the network to release the NAS signalling connection (see case p in clause  5.6.1.1).

  The UE stays in the current serving cell and applies the normal cell reselection process. The service request procedure is started, if still necessary, when timer T3447 expires.

5.6.1.7  Abnormal cases on the network side

The following abnormal cases can be identified:

a)  Lower layer failure

  If a lower layer failure occurs before a SERVICE REJECT message has been sent to the UE or the service request procedure has been completed by the network, the network enters/stays in EMM-IDLE.

b)  Protocol error

  If the SERVICE REQUEST, EXTENDED SERVICE REQUEST or the CONTROL PLANE SERVICE REQUEST message is received with a protocol error, the network shall return a SERVICE REJECT message with one of the following EMM cause values:

#96:  invalid mandatory information;

#99:  information element non-existent or not implemented;

#100:  conditional IE error; or

#111:  protocol error, unspecified.

  The network stays in the current EMM mode.

c)  More than one SERVICE REQUEST, EXTENDED SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST received before the procedure has been completed (i.e., before SERVICE REJECT message has been sent or service request procedure has been completed)

-  If one or more of the information elements in the SERVICE REQUEST message, CONTROL PLANE SERVICE REQUEST or EXTENDED SERVICE REQUEST for packet services differs from the ones received within the previous SERVICE REQUEST, CONTROL PLANE SERVICE REQUEST or EXTENDED SERVICE REQUEST message for packet services, the previously initiated service request procedure shall be aborted and the new service request procedure shall be progressed;

NOTE:  The network actions are implementation dependent for the case that more than one EXTENDED SERVICE REQUEST messages for CS fallback or 1xCS fallback are received and their information elements differ.

-  If the information elements do not differ, then the network shall continue with the previous service request procedure and shall not treat any further this SERVICE REQUEST, EXTENDED SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST message.

d)  ATTACH REQUEST received before a SERVICE REJECT message has been sent or the service request procedure has been completed

  If an ATTACH REQUEST message is received and the service request procedure has not been completed or a SERVICE REJECT message has not been sent, the network may initiate the EMM common procedures, e.g. the EMM authentication procedure. The network may e.g. after a successful EMM authentication procedure execution, abort the service request procedure, delete the EMM context, EPS bearer contexts, if any, and progress the new ATTACH REQUEST.

e)  TRACKING AREA UPDATE REQUEST message received before the service request procedure has been completed or a SERVICE REJECT message has been sent

  If a TRACKING AREA UPDATE REQUEST message is received and the service request procedure has not been completed or a SERVICE REJECT message has not been sent, the network may initiate the EMM common procedures, e.g. the EMM authentication procedure. The network may e.g. after a successful EMM authentication procedure execution, abort the service request procedure and progress the tracking area updating procedure.

f)  Default or dedicated bearer set up failure

  If the lower layers indicate a failure to set up a radio or S1 bearer, the MME shall locally deactivate the EPS bearer as described in clause  6.4.4.6.

5.6.2  Paging procedure

5.6.2.1  General

The paging procedure is used by the network to request the establishment or resumption of a NAS signalling connection to the UE. Another purpose of the paging procedure is to prompt the UE to reattach if necessary as a result of a network failure. If the UE is not attached when it receives a paging for EPS services, the UE shall ignore the paging.

Additionally, the network can use the paging procedure to initiate the mobile terminating CS fallback procedure or SMS or user data transfer via the MME.

5.6.2.2  Paging for EPS services

5.6.2.2.1  Paging for EPS services through E-UTRAN using S-TMSI

5.6.2.2.1.1  General

The network shall initiate the paging procedure for EPS services using S-TMSI with CN domain indicator set to "PS" when:

-  NAS signalling messages, cdma2000   xae signalling messages or user data is pending to be sent to the UE;

-  no NAS signalling connection exists (see example in figure  5.6.2.2.1.1); and

-  there is no paging restriction applied in the network for that paging.

If the network has downlink user data pending for a UE, the MME has stored paging restriction of the UE and the Paging restriction type in the stored paging restriction is set to:

a)  "All paging is restricted", the network should not initiate the paging procedure for EPS services using S-TMSI with CN domain indicator set to "PS" for the UE;

b)  "All paging is restricted except for voice service", the network should initiate the paging procedure for EPS services using S-TMSI with CN domain indicator set to "PS" for the UE only when:

1)  the pending downlink user data for the UE is considered as voice service related by the network;

c)  "All paging is restricted except for specified PDN connection(s)", the network should initiate the paging procedure for EPS services using S-TMSI with CN domain indicator set to "PS" for the UE only when:

1)  for PDN connection(s) that paging is not restricted based on the stored paging restriction, the network has downlink user data pending; or

d)  "All paging is restricted except for voice service and specified PDN connection(s)", the network should initiate the paging procedure for EPS services using S-TMSI with CN domain indicator set to "PS" for the UE only when:

1)  the pending downlink user data for the UE is considered as voice service related by the network; or

2)  for PDN connection(s) that paging is not restricted based on the stored paging restriction, the network has downlink user data pending.

If the network has downlink signalling pending for a UE and the MME has stored paging restriction of the UE and the Paging restriction type in the stored paging restriction is set to:

a)  "All paging is restricted", the network should not initiate the paging procedure for EPS services using S-TMSI with CN domain indicator set to "PS" for the UE;

b)  "All paging is restricted except for voice service", the network should initiate the paging procedure for EPS services using S-TMSI with CN domain indicator set to "PS" for the UE only when:

1)  the pending downlink signalling for the UE is EMM signalling or ESM signalling of the PDN connection of voice service;

c)  "All paging is restricted except for specified PDN connection(s)", the network should initiate the paging procedure for EPS services using S-TMSI with CN domain indicator set to "PS" for the UE only when:

1)  the pending downlink signalling for the UE is EMM signalling; or

2)  for PDN connection(s) that paging is not restricted based on the stored paging restriction, the network has downlink ESM signalling pending; or

d)  "All paging is restricted except for voice service and specified PDN connection(s)", the network should initiate the paging procedure for EPS services using S-TMSI with CN domain indicator set to "PS" for the UE only when:

1)  the pending downlink signalling for the UE is EMM signalling or ESM signalling of the PDN connection of voice service; or

2)  for PDN connection(s) that paging is not restricted based on the stored paging restriction, the network has downlink ESM signalling pending.

NOTE  1:  If the network pages the UE due to downlink signalling pending, the network initiates the release of the NAS signalling connection after network-requested procedure is completed.

For the UE using eDRX, the network initiates the paging procedure when NAS signalling messages, cdma2000   xae signalling messages or user data is pending to be sent to the UE within the paging time window. If NAS signalling messages, cdma2000   xae signalling messages or user data is pending to be sent to the UE outside the paging time window and the eDRX value that the network provides to the UE in the Extended DRX parameters IE during the last attach procedure or the last tracking area updating procedure is not all zeros (i.e. the E-UTRAN eDRX cycle length duration is higher than 5.12 seconds), the network initiates the paging procedure at T time ahead of the beginning of the next paging time window.

NOTE  2:  T time is a short time period based on implementation. The operator can take possible imperfections in the synchronization between the CN and the UE into account when choosing T time.



Figure 5.6.2.2.1.1: Paging procedure using S-TMSI

To initiate the procedure the EMM entity in the network requests the lower layer to start paging (see 3GPP  S  36.300  [20], 3GPP  S  36.413  [23]) and shall start the timer:

-  T3415 for this paging procedure, if the network accepted to use eDRX for the UE and the UE does not have a PDN connection for emergency bearer services.

-  Otherwise, T3413 for this paging procedure.

If the network detects that the pending user data to be sent to the UE is related to the voice service as specified in 3GPP  S  23.401  [7] and the network decides to initiate the paging procedure based on the stored paging restriction information, if any, the EMM entity in the network should request the lower layer to include the Voice Service Indication in the Paging message when the UE and the network support the paging indication for voice services.

If the network starts timer T3415, the network shall set timer T3415 to a value smaller than the value of timer T3-RESPONSE (see 3GPP  S  29.274  [16D] for further details on timer T3-RESPONSE).

The EMM entity may provide the lower layer with a list of CSG IDs, including the CSG IDs of both the expired and the not expired subscriptions. If there is a PDN connection for emergency bearer services established, the EMM entity in the network shall not provide the list of CSG IDs to the lower layer.

If the negotiated UE paging probability information is available in the EMM context of the UE, the EMM entity shall provide the lower layer with the negotiated UE paging probability information (see 3GPP  S  36.300  [20], 3GPP  S  36.413  [23]).

Upon reception of a paging indication, if control plane CIoT EPS optimization is not used by the UE, the UE shall stop the timer T3346, if running, and shall initiate:

-  a service request procedure to respond to the paging (see 3GPP  S  23.401  [10] and 3GPP  S  36.413  [23]); or

-  a tracking area updating procedure as specified in clauses  5.5.3.2.2 and 5.5.3.3.2.

and additionally if the UE is in the EMM-IDLE mode with suspend indication, resume the suspended NAS signalling connection to the MME as specified in clause  5.3.1.3.

Upon reception of a paging indication, if control plane CIoT EPS optimization is used by the UE, the UE shall stop the timer T3346, if running, and shall additionally:

-  initiate a service request procedure as specified in clause  5.6.1.2.2 if the UE is in the EMM-IDLE mode without suspend indication;

-  initiate a tracking area updating procedure as specified in clauses  5.5.3.2.2; or

-  proceed the behaviour as specified in clause  5.3.1.3 if the UE is in the EMM-IDLE mode with suspend indication.

NOTE  3:  If the UE is in the EMM-IDLE mode without suspend indication and has an uplink user data to be sent to the network using control plane CIoT EPS optimization when receiving the paging indication, the UE can piggyback the uplink user data during the service request procedure initiated to respond to the paging, as specified in clause  5.6.1.2.2.

Upon reception of a paging indication, if the network supports the reject paging request and the MUSIM UE decides not to accept the paging, the UE may initiate a service request procedure to reject the paging as specified in clause  5.6.1.1.

NOTE  4:  As an implementation option, the MUSIM UE is allowed to not respond to paging based on the information available in the paging message, e.g. voice service indication.

If the paging for EPS services was received during an ongoing UE-initiated EMM specific procedure or service request procedure, then the UE shall ignore the paging. The network shall proceed with the EMM specific procedure or the service request procedure, and stop the timer for the paging procedure (i.e. either timer T3413 or timer T3415). If the network receives an ATTACH REQUEST message when the paging procedure is ongoing, it should be considered as an abnormal case, and the behaviour of the network for this case is specified in clause  5.6.2.2.1.2.

The network shall stop the timer for the paging procedure (i.e. either timer T3413 or timer T3415) when an integrity-protected response is received from the UE and successfully integrity checked by the network or when the EMM entity in the MME receives an indication from the lower layer that it has received the S1-AP UE context resume request message as specified in 3GPP  S  36.413  [23]. If the response received is not integrity protected, or the integrity check is unsuccessful, the timer for the paging procedure (i.e. either timer T3413 or timer T3415) shall be kept running unless:

-  the UE has a PDN connection for emergency bearer services; or

-  the response received is a TRACKING AREA UPDATE REQUEST message and the security mode control procedure or authentication procedure performed during tracking area updating procedure has completed successfully.

Upon expiry of timer T3413, the network may reinitiate paging.

If the network, while waiting for a response to the paging sent without paging priority, receives downlink signalling or downlink data associated with priority EPS bearers, the network shall stop the timer for the paging procedure (i.e. either timer T3413 or timer T3415), and then initiate the paging procedure with paging priority.

Upon expiry of timer T3415, the network shall abort the paging procedure and shall proceed as specified in 3GPP  S  23.401  [10].

5.6.2.2.1.2  Abnormal cases on the network side

The following abnormal case can be identified:

a)  ATTACH REQUEST message received when paging procedure is ongoing.

  If an integrity-protected ATTACH REQUEST message is received from the UE and successfully integrity checked by the network, the network shall abort the paging procedure. If the ATTACH REQUEST message received is not integrity protected, or the integrity check is unsuccessful, the paging procedure shall be progressed. The paging procedure shall be aborted when the EPS authentication procedure performed during attach procedure is completed successfully.

5.6.2.2.1.3  Abnormal cases in the UE

The following abnormal case can be identified:

a)  The paging indication received for a UE that is attached for access to RLOS

A UE attached for access to RLOS shall ignore the paging indication from the network.

b)  The paging indication received when UE-initiated EMM specific procedure or service request procedure is ongoing.

  The UE shall ignore the paging indication from the network.

5.6.2.2.2  Paging for EPS services through E-UTRAN using IMSI

Paging for EPS services using IMSI is an abnormal procedure used for error recovery in the network.

The network may initiate paging for EPS services using IMSI with CN domain indicator set to "PS" if the S-TMSI is not available due to a network failure (see example in figure  5.6.2.2.2.1).



Figure 5.6.2.2.2.1: Paging procedure using IMSI

In S1 mode, to initiate the procedure the EMM entity in the network requests the lower layer to start paging. If the TAI list is not available due to a network failure, the network may perform the paging within all tracking areas served by the MME (see 3GPP  S  36.331  [22] and 3GPP  S  36.413  [23]).

When a UE receives a paging for EPS services using IMSI from the network before a UE initiated EMM specific procedure has been completed, then the UE shall abort the EMM specific procedure and proceed according to the description in this clause.

Upon reception of a paging for EPS services using IMSI, the UE shall stop timer T3346, if it is running, locally deactivate any EPS bearer context(s), if any, and locally detach from EPS. Additionally the UE shall delete the following parameters: last visited registered TAI, TAI list, GUTI and KSIASME. The UE shall set the EPS update status to EU2 NOT UPDATED and change the state to EMM-DEREGISTERED. The UE shall stop all timers T3396 that are running.

If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, and GPRS ciphering key sequence number as specified in 3GPP  S  24.008  [13] for the case when a paging for GPRS services using IMSI is received.

After performing the local detach, the UE shall then perform an attach procedure as described in clause  5.5.1.2. If the UE is operating in CS/PS mode 1 or CS/PS mode 2 of operation, then the UE shall perform a combined attach procedure as described in clause  5.5.1.3. For this attach procedure and its reattempts, if any, the MS shall ignore the contents of the list of "forbidden tracking areas for roaming", as well as the list of "forbidden tracking areas for regional provision of service".

NOTE  1:  In some cases, user interaction can be required, thus the UE cannot activate the dedicated bearer context(s), if any, automatically.

NOTE  2:  The UE does not respond to the paging except with the ATTACH REQUEST message, hence timers T3413 and T3415 in the network are not used when paging with IMSI.

5.6.2.3  Paging for CS fallback to A/Gb or Iu mode

5.6.2.3.1  General

The network may initiate the paging procedure for CS fallback when the UE is IMSI attached for non-EPS services (see example in figure  5.6.2.3.1.1).

The network should not initiate the paging procedure for CS fallback for a UE if the MME has stored paging restriction of the UE and the Paging restriction type in the stored paging restriction preferences is set to:

a)  "All paging is restricted"; or

b)  "All paging is restricted except for specified PDN connection(s)".



Figure 5.6.2.3.1.1: Paging procedure for CS fallback to A/Gb or Iu mode

To initiate the procedure when no NAS signalling connection exists and no paging restriction applied in the network for that paging, the EMM entity in the network requests the lower layer to start paging (see 3GPP  S  36.300  [20], 3GPP  S  36.413  [23]). The EMM entity may provide the lower layer with a list of CSG IDs, including the CSG IDs of both the expired and the not expired subscriptions. If there is a PDN connection for emergency bearer services established, the EMM entity in the network shall not provide the list of CSG IDs to the lower layer. The paging message includes a UE Paging Identity set to either the UE   's S-TMSI or the UE   's IMSI, and a CN domain indicator set to "CS" in order to indicate that this is paging for CS fallback.

NOTE:  The timers T3413 and T3415 are not started in the network when the paging procedure is initiated for CS fallback.

To notify the UE about an incoming mobile terminating CS service excluding SMS over SGs when a NAS signalling connection exists, the EMM entity in the network shall send a CS SERVICE NOTIFICATION message. This message may also include CS service related parameters (e.g. Calling Line Identification, SS or LCS related parameters).

Upon reception of a paging indication, a UE that is IMSI attached for non-EPS services shall initiate a service request procedure or combined tracking area updating procedure as specified in clause  5.5.3.3.2. If the paging is received in EMM-IDLE mode, the UE shall respond immediately.

Upon reception of a paging indication, if the network supports the reject paging request feature and the MUSIM UE decides not to accept the paging the UE may initiate a service request procedure to reject the paging as specified in clause  5.6.1.1.

If the paging is received as a CS SERVICE NOTIFICATION message in EMM-CONNECTED mode, the UE may request upper layers input i.e. to accept or reject CS fallback before responding with an EXTENDED SERVICE REQUEST. The response is indicated in the CSFB response information element in the EXTENDED SERVICE REQUEST message in both EMM-IDLE and EMM-CONNECTED modes.

5.6.2.3.2  Abnormal cases in the UE

A UE that requested "SMS only" in the combined attach procedure or combined tracking area updating procedure may ignore the CS SERVICE NOTIFICATION message or the paging indication with the CN domain indicator set to "CS".

5.6.2.3.3  Abnormal cases on the network side

The following abnormal case can be identified:

a)  Void

b)  ATTACH REQUEST message received when paging procedure is ongoing.

  If an integrity-protected ATTACH REQUEST message is received from the UE and successfully integrity checked by the network, the network shall abort the paging procedure. If the ATTACH REQUEST message received is not integrity protected, or the integrity check is unsuccessful, the paging procedure shall be progressed. The paging procedure shall be aborted when the EPS authentication procedure performed during attach procedure is completed successfully.

c)  TRACKING AREA UPDATE REQUEST message received in response to a CS SERVICE NOTIFICATION message

  If the network receives a TRACKING AREA UPDATE REQUEST message in response to a CS SERVICE NOTIFICATION message, the network shall progress the tracking area updating procedure.

NOTE:  After completion of the tracking area updating procedure the UE can accept or reject the CS fallback by sending an EXTENDED SERVICE REQUEST message.

d)  DETACH REQUEST message received in response to a CS SERVICE NOTIFICATION message

  If the network receives a DETACH REQUEST message with detach type "IMSI detach" or "combined EPS/IMSI detach" in response to a CS SERVICE NOTIFICATION message, the network shall progress the detach procedure.

5.6.2.4  Paging for SMS

The network shall initiate the paging procedure when it receives an incoming mobile terminating SMS to the UE if

the UE is:

1)  IMSI attached for non-EPS services or for "SMS only"; or

2)  attached for EPS services with CIoT EPS optimization and the UE has requested "SMS only" and the UE is in NB-S1 mode,

-  no NAS signalling connection exists.

-  there is no paging restriction applied in the network.

For the UE using eDRX, the network initiates the paging procedure when an incoming mobile terminating SMS is received within the paging time window. If an incoming mobile terminating SMS is received outside the paging time window and the eDRX value that the network provides to the UE in the Extended DRX parameters IE during the last attach procedure or the last tracking area updating procedure is not all zeros (i.e. the E-UTRAN eDRX cycle length duration is higher than 5.12 seconds), the network initiates the paging procedure at T time ahead of the beginning of the next paging time window.

NOTE:  T time is a short time period based on implementation. The operator can take possible imperfections in the synchronization between the CN and the UE into account when choosing T time.

To initiate the procedure for SMS when no NAS signalling connection exists, the EMM entity in the network requests the lower layer to start paging (see 3GPP  S  36.413  [23]). The paging message shall include a CN domain indicator set to "PS". If the paging message includes a UE Paging Identity set to the UE   's S-TMSI, the paging procedure is performed according to clause  5.6.2.2.1. If the paging message includes a UE Paging Identity set to the UE   's IMSI, the paging procedure is performed according to clause  5.6.2.2.2. The MME shall not start timers T3413 and T3415 for this procedure.

If the negotiated UE paging probability information is available in the EMM context of the UE, the EMM entity shall provide the lower layer with the negotiated UE paging probability information (see 3GPP  S  36.300  [20], 3GPP  S  36.413  [23]).

5.6.3  Transport of NAS messages procedure

5.6.3.1  General

The purpose of the transport of NAS messages procedure is to carry SMS messages in an encapsulated form between the MME and the UE. The procedure may be initiated by the UE or the network and can only be used when the UE is attached for EPS services and non-EPS services or for EPS services and "SMS only", and the UE is in EMM-CONNECTED mode.

NOTE  1:  If the UE is in EMM-IDLE mode and is using EPS services with control plane CIoT EPS optimization, the UE transports the first SMS message by encapsulating it in the NAS message container IE in the Control Plane Service Request message.

NOTE  2:  When the UE is using EPS services with control plane CIoT EPS optimization, the network can initiate downlink transport of NAS messages procedure even if the UE does not have any PDN connections established.

5.6.3.2  UE initiated transport of NAS messages

Upon request from the SMS entity to send an SMS message, the EMM entity in the UE initiates the procedure by sending an UPLINK NAS TRANSPORT message including the SMS message in the NAS message container IE.

NOTE:  When the UE is using for EPS services with control plane CIoT EPS optimization, the UE can initiate uplink transport of NAS messages procedure even if the UE does not any PDN connections established.

5.6.3.3  Network initiated transport of NAS messages

The network initiates the procedure by sending a DOWNLINK NAS TRANSPORT message. When receiving the DOWNLINK NAS TRANSPORT message, the EMM entity in the UE shall forward the contents of the NAS message container IE to the SMS entity.

NOTE:  When the UE is using for EPS services with control plane CIoT EPS optimization, the network can initiate downlink transport of NAS messages procedure even if the UE does not any PDN connections established.

5.6.3.4  Abnormal cases in the UE

The following abnormal case can be identified:

a)  Timer T3346 is running

  The UE shall not send an UPLINK NAS TRANSPORT message unless:

-  the UE is a UE configured to use AC11        15 in selected PLMN;

-  the UE has a PDN connection for emergency bearer services established; or

-  the UE is configured for dual priority and has a PDN connection established without low access priority but the timer T3346 was started in response to NAS signalling request with low access priority.

-  The UPLINK NAS TRANSPORT message can be sent, if still necessary, when timer T3346 expires or is stopped.

b)  Timer T3447 is running

  The UE shall not send an UPLINK NAS TRANSPORT message when the UE is in EMM-CONNECTED mode after the UE attached without PDN connection, unless:

-  the UE is a UE configured to use AC11        15 in the selected PLMN; or

-  a network initiated signalling message has been received.

  The UPLINK NAS TRANSPORT message can be sent, if still necessary, when timer T3447 expires.

5.6.3.5  Abnormal cases on the network side

The following abnormal case can be identified:

a)  Lower layer indication of non-delivered NAS PDU

  If the DOWNLINK NAS TRANSPORT message is not delivered for any reason, the MME may discard the message.

5.6.4  Generic transport of NAS messages procedure

5.6.4.1  General

The purpose of the generic transport of NAS messages procedure is to carry protocol messages from various applications (e.g., an LCS application to send an LPP message or a location service message) in an encapsulated form between the MME and the UE. The procedure may be initiated by the UE or the network and can only be used when the UE is attached for EPS services and is in EMM-CONNECTED mode.

5.6.4.2  UE initiated generic transport of NAS messages

Upon request from an application to send a message encapsulated in the generic transport of NAS message, the EMM entity in the UE initiates the procedure by sending an UPLINK GENERIC NAS TRANSPORT message including the corresponding message in the generic message container IE. The application may also request additional information to be included in the UPLINK GENERIC NAS TRANSPORT message in the Additional information IE. The content, coding and interpretation of this information element are dependent on the particular application.

The UE shall indicate the application protocol using the generic transport in the corresponding generic message container type. When receiving the UPLINK GENERIC NAS TRANSPORT message, the EMM entity in the MME shall provide the contents of the generic message container IE and the generic message container type IE to the corresponding application. If included, the EMM entity in the MME shall also provide the contents of the Additional information IE.

5.6.4.3  Network initiated transport of NAS messages

Upon request from an application to send a message encapsulated in the generic transport of NAS message, the EMM entity in the MME initiates the procedure by sending a DOWNLINK GENERIC NAS TRANSPORT message including the corresponding message in the generic message container IE. The application may also request additional information to be included in the DOWNLINK GENERIC NAS TRANSPORT message in the Additional information IE. The content, coding and interpretation of this information element are dependent on the particular application.

The MME shall indicate the application protocol using the generic transport in the corresponding generic message container type. When receiving the DOWNLINK GENERIC NAS TRANSPORT message, the EMM entity in the UE shall provide the contents of the generic message container IE and the generic message container type IE to the corresponding application. If included, the EMM entity in the UE shall also provide the contents of the Additional information IE.

5.6.4.4  Abnormal cases in the UE

The following abnormal case can be identified:

a)  Timer T3346 is running

  The UE shall not send an UPLINK GENERIC NAS TRANSPORT message unless:

  the UE is a UE configured to use AC11        15 in selected PLMN;

-  the UE has a PDN connection for emergency bearer services established; or

  the UE is configured for dual priority and has a PDN connection established without low access priority but the timer T3346 was started in response to NAS signalling request with low access priority.

The UPLINK GENERIC NAS TRANSPORT message can be sent, if still necessary, when timer T3346 expires or is stopped.

b)  Timer T3447 is running

  The UE shall not send an UPLINK GENERIC NAS TRANSPORT message when the UE is in EMM-CONNECTED mode, unless:

-  the UE is a UE configured to use AC11        15 in the selected PLMN;

-  the UE has a PDN connection for emergency bearer services established; or

-  a network initiated signalling message has been received.

The UPLINK GENERIC NAS TRANSPORT message can be sent, if still necessary, when timer T3447 expires.

5.6.4.5  Abnormal cases on the network side

The following abnormal case can be identified:

a)  Lower layer indication of non-delivered NAS PDU

  If the DOWNLINK GENERIC NAS TRANSPORT message is not delivered for any reason, the MME may discard the message.

5.7  Reception of an EMM STATUS message by an EMM entity

The purpose of the sending of the EMM STATUS message is to report at any time certain error conditions detected upon receipt of EMM protocol data. The EMM STATUS message can be sent by both the MME and the UE (see example in figure  5.7.1).

On receipt of an EMM STATUS message no state transition and no specific action shall be taken as seen from the radio interface, i.e. local actions are possible. The local actions to be taken by the MME or the UE on receipt of an EMM STATUS message are implementation dependent.



Figure 5.7.1: EMM status procedure

6  Elementary procedures for EPS session management

6.1  Overview

6.1.1  General

This clause describes the procedures used for EPS session management (ESM) at the radio interface (reference point "LTE-Uu").

The main function of the ESM sublayer is to support the EPS bearer context handling in the UE and in the MME.

The ESM comprises procedures for:

-  the activation, deactivation and modification of EPS bearer contexts;

-  the request for resources (IP connectivity to a PDN or dedicated bearer resources) by the UE; and

-  the transport of user data via the control plane between the UE and the MME.

Each EPS bearer context represents an EPS bearer between the UE and a PDN. EPS bearer contexts can remain activated even if the radio and S1 bearers constituting the corresponding EPS bearers between UE and MME are temporarily released.

An EPS bearer context can be either a default bearer context or a dedicated bearer context.

A default EPS bearer context is activated when the UE requests a connection to a PDN.

Generally, ESM procedures can be performed only if an EMM context has been established between the UE and the MME, and the secure exchange of NAS messages has been initiated by the MME by use of the EMM procedures described in clause  5. The first default EPS bearer context, however, can be activated during the EPS attach procedure (see clause  4.2). Once the UE is successfully attached, and the first default EPS bearer context has been activated during or after the attach procedure, the UE can request the MME to set up connections to additional PDNs. For each additional connection, the MME will activate a separate default EPS bearer context. A default EPS bearer context remains activated throughout the lifetime of the connection to the PDN.

A dedicated EPS bearer context is always linked to a default EPS bearer context and represents additional EPS bearer resources between the UE and the PDN. The network can initiate the activation of dedicated EPS bearer contexts together with the activation of the default EPS bearer context or at any time later, as long as the default EPS bearer context remains activated. However, the network shall not initiate a dedicated bearer context activation procedure for established PDN connection(s) of "non IP" PDN type.

Default and dedicated EPS bearer contexts can be modified. Dedicated EPS bearer contexts can be released without affecting the default EPS bearer context. When the default EPS bearer context is released, then all dedicated EPS bearer contexts linked to it are released too.

The UE can request the network to allocate, modify or release EPS bearer resources. The network can fulfil such a request from the UE by activating a new dedicated EPS bearer context, modifying an EPS bearer context or deactivating an EPS bearer context.

6.1.2  Types of ESM procedures

Two types of ESM procedures can be distinguished:

1)  Procedures related to EPS bearer contexts:

  These procedures are initiated by the network and are used for the manipulation of EPS bearer contexts:

-  default EPS bearer context activation;

-  dedicated EPS bearer context activation;

-  EPS bearer context modification;

-  EPS bearer context deactivation.

  This procedure is initiated by the network or by the UE and is used for the transport of user data via the control plane:

-  transport of user data via the control plane procedure.

2)  Transaction related procedures:

  These procedures are initiated by the UE to request for resources, i.e. a new PDN connection or dedicated bearer resources, or to release these resources:

-  PDN connectivity procedure;

-  PDN disconnect procedure;

-  bearer resource allocation procedure;

-  bearer resource modification procedure.

  This procedure is initiated by the ProSe UE-to-network relay and is used for the manipulation of EPS bearer contexts:

-  remote UE report.

  When combined with the attach procedure, the PDN connectivity procedure can trigger the network to execute the following transaction related procedure:

-  ESM information request procedure.

  When combined with the attach procedure, if EMM-REGISTERED without PDN connection is supported by the UE and the network and no PDN connectivity procedure is initiated during the attach procedure, the UE or the network executes the following transaction related procedure:

-  ESM dummy message procedure.

A successful transaction related procedure initiated by the UE triggers the network to execute one of the procedures related to EPS bearer contexts. The UE treats the start of the procedure related to the EPS bearer context as completion of the transaction related procedure.

During procedures related to EPS bearer contexts, the MME and the UE shall not initiate the transport of user data via the control plane procedure until the ongoing procedure is completed.

NOTE  1:  The UE determination of the completion of the transport of user data via the control plane procedure is left to the implementation.

NOTE  2:  NAS signalling prioritization with respect to the transport of user data via the control plane cannot be guaranteed in the downlink direction in this version of the specification.

Except for the remote UE report procedure and ESM information request procedure, during transaction related procedures, the MME and the UE shall not initiate the transport of user data via the control plane procedure until the ongoing procedure is completed.

The following ESM procedures can be related to an EPS bearer context or to a procedure transaction:

-  ESM status procedure;

-  notification procedure.

6.1.3  ESM sublayer states

6.1.3.1  General

In this clause the possible states of EPS bearer contexts in the UE and on the network side are described. Each EPS bearer context is associated with an individual state.

6.1.3.2  ESM sublayer states in the UE

6.1.3.2.1  BEARER CONTEXT INACTIVE

No EPS bearer context exists.

6.1.3.2.2  BEARER CONTEXT ACTIVE

The EPS bearer context is active in the UE.



Figure 6.1.3.2.2.1: The ESM sublayer states for EPS bearer context handling in the UE (overview)

6.1.3.2.3  PROCEDURE TRANSACTION INACTIVE

No procedure transaction exists.

6.1.3.2.4  PROCEDURE TRANSACTION PENDING

The UE has initiated a procedure transaction towards the network.





Figure 6.1.3.2.4.1: The procedure transaction states in the UE (overview)

6.1.3.3  ESM sublayer states in the MME

6.1.3.3.1  BEARER CONTEXT INACTIVE

No EPS bearer context exists.

6.1.3.3.2  BEARER CONTEXT ACTIVE PENDING

The network has initiated an EPS bearer context activation towards the UE.

6.1.3.3.3  BEARER CONTEXT ACTIVE

The EPS bearer context is active in the network.

6.1.3.3.4  BEARER CONTEXT INACTIVE PENDING

The network has initiated an EPS bearer context deactivation towards the UE.

6.1.3.3.5  BEARER CONTEXT MODIFY PENDING

The network has initiated an EPS bearer context modification towards the UE.



Figure 6.1.3.3.5.1: The ESM sublayer states for EPS bearer context handling in the network (overview)

6.1.3.3.6  PROCEDURE TRANSACTION INACTIVE

No procedure transaction exists.

6.1.3.3.7  PROCEDURE TRANSACTION PENDING

The network has initiated a procedure transaction towards the UE.





Figure 6.1.3.3.7.1: The procedure transaction states in the network (overview)

6.1.4  Coordination between ESM and SM

For inter-system change from S1 mode to A/Gb mode or Iu mode, SM uses the following parameters from each active EPS bearer context:

-  EPS bearer identity to map to NSAPI;

NOTE  1:  If the UE and the MME support signalling for a maximum number of 15 EPS bearer contexts, any active EPS bearer contexts using EPS bearer identity 1 to 4 are not mapped but deactivated locally before inter-system change to A/Gb mode or Iu mode.

-  linked EPS bearer identity (if available) to map to linked TI;

-  PDN address and APN of the default EPS bearer context to map to PDP address and APN of the default PDP context;

-  TFT of the default EPS bearer context, if any, to map to the TFT of the default PDP context;

-  TFTs of the dedicated EPS bearer contexts to map to TFTs of the secondary PDP contexts; and

-  GERAN/UTRAN parameters as provided by the MME while on E-UTRAN access, i.e. R99 QoS, LLC SAPI, radio priority, packet flow identifier, transaction identifier and BCM (if available). If the MME also provided an Extended EPS QoS IE, then the bit rates signalled with this IE are also applicable to the R99 QoS.

NOTE  2:  Some networks not supporting mobility from S1 mode to A/Gb mode or Iu mode or both do not provide the UE with the GERAN/UTRAN parameters. However, for this case there is no need for the UE to perform mapping to GERAN/UTRAN parameters (i.e. the PDP contexts cannot be transferred to A/Gb mode or Iu mode).

The MME performs the mapping from EPS to R99 QoS parameters according to 3GPP  S  23.401  [10], annex  E.

At inter-system change from S1 mode to A/Gb mode, SM shall not activate the PDP context(s) if SM does not have the following parameters from the active EPS bearer context(s):

-  LLC SAPI;

-  radio priority;

-  transaction identifier; and

-  R99 QoS.

At inter-system change from S1 mode to Iu mode, SM shall not activate the PDP context(s) if SM does not have the following parameter from the active EPS bearer context(s):

-  transaction identifier; and

-  R99 QoS.

For inter-system change from A/Gb mode or Iu mode to S1 mode, ESM uses the following parameters from each active PDP context:

-  NSAPI to map to EPS bearer identity;

-  NSAPI of the default PDP context to map to linked EPS bearer identity;

-  PDP address and APN of the default PDP context to map to PDN address and APN of the default EPS bearer context;

-  TFT of the default PDP context, if any, to map to the TFT of the default EPS bearer context; and

-  TFTs of the secondary PDP contexts to map to the TFTs of the dedicated EPS bearer contexts.

The MME and the UE perform the mapping from R99 to EPS QoS parameters according to 3GPP  S  23.401  [10], annex  E. In particular the MME derives the APN-AMBR for the corresponding PDN connection from the MBR of the R99 subscribed QoS profile and the UE maps the MBR of its default PDP context to the APN-AMBR of the corresponding PDN connection.

6.1.4A  Coordination between ESM and 5GSM

See clause  6.1.4 in 3GPP  S  24.501  [54].

6.1.5  Coordination between ESM and EMM for supporting ISR

The UE with its TIN set as "RATrelated TMSI" for which ISR is activated shall change its TIN to "GUTI" to locally deactivate ISR and stop the periodic routing area update timer T3312 or T3323, if running:

-  upon modification of any EPS bearer context which was activated before the ISR is activated in the UE;

-  at the time when the UE changes from S1 mode to A/Gb mode or Iu mode not due to PS handover procedure (see 3GPP  S  24.008  [13]), if any EPS bearer context activated after the ISR was activated in the UE exists; or

-  upon deactivation of the last non-emergency EPS bearer context in the UE, if the UE has only a PDN connection for emergency bearer services remaining.

ISR remains activated on the network side in the above cases.

6.2  IP address allocation

6.2.1  General

The UE can configure an IPv4 address during the establishment of a default EPS bearer context. The UE can obtain an IPv4 address or an IPv6 prefix or both via an IETF-based IP address allocation mechanism once the default bearer is established.

The following IETF-based IP address/prefix allocation methods are specified for EPS (the corresponding procedures are specified in 3GPP  S  29.061  [16]):

a)  /64 IPv6 default prefix allocation via IPv6 stateless address autoconfiguration. Optionally, allocation of additional IPv6 prefix(es) with length /64 or shorter via stateful DHCPv6 Prefix Delegation (see IETF  RFC  3633  [24A]);

b)  IPv4 address allocation and IPv4 parameter configuration via DHCPv4;

c)  IPv6 parameter configuration via stateless DHCPv6.

NOTE:  From the perspective of the UE, the procedure used to allocate a static IP address via NAS signalling is the same as the procedure used to allocate a dynamic IP address specified in clause  6.2.2.

Upon deactivation of the default bearer of a PDN connection, the UE shall locally release any IPv4 address or IPv6 prefix allocated to the UE for the corresponding PDN connection.

6.2.2  IP address allocation via NAS signalling

The UE shall set the PDN type IE in the PDN CONNECTIVITY REQUEST message, based on its IP stack configuration if it requests IP connectivity (e.g. the per APN settings specified in 3GPP  S  23.401  [10]) as follows:

a)-  A UE, which is IPv6 and IPv4 capable and

-  has not been allocated an IP address for this APN, shall set the PDN type IE to IPv4v6.

-  has been allocated an IPv4 address for this APN and received the ESM cause #52 "single address bearers only allowed", and is requesting an IPv6 address, shall set the PDN type IE to IPv6.

-  has been allocated an IPv6 address for this APN and received the ESM cause #52 "single address bearers only allowed", and is requesting an IPv4 address, shall set the PDN type IE to IPv4.

b)  A UE, which is only IPv4 capable, shall set the PDN type IE to IPv4.

c)  A UE, which is only IPv6 capable, shall set the PDN type IE to IPv6.

d)  When the IP version capability of the UE is unknown in the UE (as in the case when the MT and TE are separated and the capability of the TE is not known in the MT), the UE shall set the PDN type IE to IPv4v6.

If the UE wants to use DHCPv4 for IPv4 address assignment, it shall indicate that to the network within the Protocol Configuration Options IE in the PDN CONNECTIVITY REQUEST.

If the UE wants to get PDN connectivity for non-IP, the UE shall set the PDN type IE in the PDN CONNECTIVITY REQUEST message to "non IP". If the UE wants to get PDN connectivity for Ethernet, the UE shall set the PDN type IE in the PDN CONNECTIVITY REQUEST message to "Ethernet".

On receipt of the PDN CONNECTIVITY REQUEST message sent by the UE, the network when allocating an IP address shall take into account the PDN type IE, the operator policies of the home and visited network, and the user   's subscription data and:

-  if the UE requests for PDN type IPv4v6, but the subscription is limited to IPv4 only or IPv6 only for the requested APN, the network shall override the PDN type requested by the UE to be limited to a single address PDN type (IPv4 or IPv6). In the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message sent to the UE, the network shall set the PDN type value to either "IPv4" or "IPv6" and the ESM cause value to #50 "PDN type IPv4 only allowed", or #51 "PDN type IPv6 only allowed", respectively. The UE shall not subsequently initiate another UE requested PDN connectivity procedure to the same APN to obtain a PDN type different from the one allowed by the network until:

a)  the UE is registered to a new PLMN;

b)  void;

c)  the UE is switched off; or

d)  the USIM is removed.

NOTE  1:  Request to send another PDN CONNECTIVITY REQUEST message with a specific PDN type has to come from upper layers.

-  if the UE requests PDN type IPv4v6, but the PDN GW configuration dictates the use of IPv4 addressing only or IPv6 addressing only for this APN, the network shall override the PDN type requested by the UE to limit it to a single address PDN type (IPv4 or IPv6). In the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message sent to the UE, the network shall set the PDN type value to either "IPv4" or "IPv6" and the ESM cause value to #50 "PDN type IPv4 only allowed", or #51 "PDN type IPv6 only allowed", respectively. The UE shall not subsequently initiate another UE requested PDN connectivity procedure to the same APN to obtain a PDN type different from the one allowed by the network until:

a)  the UE is registered to a new PLMN;

b)  void;

c)  the UE is switched off; or

d)  the USIM is removed.

NOTE  2:  Request to send another PDN CONNECTIVITY REQUEST message with a specific PDN type has to come from upper layers.

-  if the UE requests PDN type IPv4v6, but the operator uses single addressing per bearer, e.g. due to interworking with nodes of earlier releases, the network shall override the PDN type requested by the UE to a single IP version only. In the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message sent to the UE, the network shall set the PDN type value to either "IPv4" or "IPv6" and the ESM cause value to #52 "single address bearers only allowed". The UE should subsequently request another PDN connection for the other IP version using the UE requested PDN connectivity procedure to the same APN with a single address PDN type (IPv4 or IPv6) other than the one already activated;

NOTE  3:  If the MT and TE are separated, the UE might not be able to use ESM cause #52 "single address bearers only allowed" as a trigger for activating a second single-IP-stack EPS bearer context.

-  if the network sets the PDN type to IPv4 or IPv4v6, the network shall include an IPv4 address in the PDN address information. In this case, if the IPv4 address is to be configured using DHCPv4, the network shall set the IPv4 address to 0.0.0.0; and

-  if the network sets the PDN type to IPv6 or IPv4v6, the network shall include the interface identifier that the UE shall use for the link local address in the PDN address information.

The network shall include the PDN type and the PDN address information within the PDN address IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message sent to the UE.

6.2A  IP header compression

The UE and the MME may support robust header compression (ROHC) framework (see IETF  RFC  5795  [37]) for IP header compression if control plane CIoT EPS optimization is supported for PDN connections of IP PDN type. If IP header compression for control plane CIoT EPS optimization is supported, the ROHC profiles defined in 3GPP  S  36.323  [38] may be supported. The ROHC configuration is negotiated and established during the UE requested PDN connectivity procedure as specified in clause  6.5.1. Both the UE and the MME indicate whether IP header compression for control plane CIoT EPS optimization is supported during attach and tracking area updating procedures (see clauses  5.5.1 and 5.5.3). The ROHC configuration can be re-negotiated by using the UE requested bearer resource modification procedure or the EPS bearer context modification procedure as specified in clauses  6.4.3 and 6.5.4.

6.3  General on elementary ESM procedures

6.3.1  Services provided by lower layers

Unless explicitly stated otherwise, the procedures described in the following clauses can only be executed whilst a NAS signalling exists between the UE and the MME.

6.3.2  Principles of address handling for ESM procedures

Transaction related procedures use the procedure transaction identity as address parameter in the ESM message header. When the UE or the network initiates a transaction related procedure, it shall include a valid procedure transaction identity value in the message header and set the EPS bearer identity to "no EPS bearer identity assigned". When the ProSe UE-to-network relay initiates the transaction related procedure remote UE report, it shall include a valid procedure transaction identity value in the message header and set the EPS bearer identity to a valid EPS bearer identity value.

If the response message is again a transaction related message, e.g. a PDN CONNECTIVITY REJECT, PDN DISCONNECT REJECT, BEARER RESOURCE ALLOCATION REJECT, BEARER RESOURCE MODIFICATION REJECT, ESM INFORMATION REQUEST message or ESM DUMMY MESSAGE from the network or an ESM INFORMATION RESPONSE message or ESM DUMMY MESSAGE from the UE, the sending entity shall include the procedure transaction identity value received with the request message and set the EPS bearer identity to "no EPS bearer identity assigned" (see examples in figures  6.3.2.1,  6.3.2.1a and  6.3.2.2). If the response message is the transaction related message REMOTE UE REPORT RESPONSE message from the network, the network shall include the procedure transaction identity value received with the request message and set the EPS bearer identity to the EPS bearer identity value received from the ProSe UE-to-network relay (see example in figure  6.3.2.2a).

If an ESM DUMMY MESSAGE is sent in response to a received ESM DUMMY MESSAGE, the sending entity shall include the received procedure transaction identity value in the message header and set the EPS bearer identity to "no EPS bearer identity assigned".



Figure  6.3.2.1: Transaction related procedure initiated by the UE and rejected by the network



Figure  6.3.2.1a: Transaction related procedure initiated by the UE and responded by a network initiated transaction related request



Figure  6.3.2.2: Transaction related procedure initiated by the network



Figure  6.3.2.2a: Transaction related procedure initiated by the UE

EPS bearer context related procedures use the EPS bearer identity as address parameter in the ESM message header. When the network initiates an EPS bearer context related procedure, it shall include a valid EPS bearer identity value in the message header. The procedure transaction identity value shall be set as follows:

-  If the EPS bearer context related procedure was triggered by the receipt of a transaction related request message from the UE, the network shall include the procedure transaction identity value received with the transaction related request message in the message header of the EPS bearer context related request message (see example in figure  6.3.2.3).

-  If the procedure was triggered network-internally, the network shall set the procedure transaction identity value in the message header of the EPS bearer context related request message to "no procedure transaction identity assigned" (see example in figure  6.3.2.4).

-  If the procedure was triggered by the transport of user data via the control plane, the network shall set the procedure transaction identity value in the message header of the EPS bearer context related request message to "no procedure transaction identity assigned" (see example in figure  6.3.2.5).

In the response message of the EPS bearer context related procedure, the UE shall include the EPS bearer identity value received from the network and set the procedure transaction identity value to "no procedure transaction identity assigned".

When the UE initiates an EPS bearer context related procedure and the procedure was triggered by the transport of user data via the control plane, it shall include a valid EPS bearer identity value and set the procedure transaction identity value to "no procedure transaction identity assigned" in the message header (see example in figure  6.3.2.6).



Figure  6.3.2.3: EPS bearer context related procedure triggered by a transaction related request



Figure  6.3.2.4: EPS bearer context related procedure triggered network-internally



Figure  6.3.2.5: EPS bearer context related procedure triggered by network for the transport of user data via the control plane



Figure  6.3.2.6: EPS bearer context related procedure triggered by UE for the transport of user data via the control plane

6.3.3  Abnormal cases in the UE

The following abnormal case can be identified:

a)  ESM uplink message transmission failure indication by lower layers

  Unless the procedure descriptions in clause  6.6 specify a different behaviour, the following applies:

  If lower layers indicate a TAI change, but the current TAI is not in the TAI list, the ESM procedure shall be aborted and re-initiated after successfully performing a tracking area updating procedure.

  If lower layers indicate a TAI change, but the current TAI is still part of the TAI list, it is up to the UE implementation how the ESM procedure is re-initiated.

  If lower layers indicate the TAI has not changed, it is up to the UE implementation how the ESM procedure is re-initiated.

NOTE  1:  The ESM procedure can typically be re-initiated using a retransmission mechanism of the uplink message (the one that has previously failed to be transmitted) with new sequence number and message authentication code information thus avoiding to restart the whole procedure.

The case a) above does not apply to the ESM INFORMATION RESPONSE message.

NOTE  2:  The ESM INFORMATION RESPONSE message cannot be subjected to a transmission failure by lower layers due to handover as no handover message can be accepted by the UE prior to reception of the ATTACH ACCEPT message (see 3GPP  S  36.331  [22]).

b)  Transmission failure of the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message indication from EMM sublayer when the UE received any ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST messages during the attach procedure

  It is up to the UE implementation how the dedicated EPS bearer context activation procedure is re-initiated.

NOTE  3:  The ESM procedure can typically be re-initiated using a retransmission mechanism of the ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message or ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message with new sequence number and message authentication code information thus avoiding to restart the whole procedure.

6.3.4  Abnormal cases in the network

The following abnormal case can be identified:

a)  Lower layer indication of non-delivered NAS PDU due to handover

  Unless the procedure descriptions in clause  6.4, 6.5 or 6.6 specify a different behaviour, the following applies:

  If the downlink ESM NAS message could not be delivered due to an intra MME handover and the target TA is included in the TAI list, then upon successful completion of the intra MME handover the MME shall retransmit the ESM message. If a failure of the handover procedure is reported by the lower layer and the S1 signalling connection exists, the MME shall retransmit the downlink ESM NAS message.

b)  Lower layer indication of non-delivered NAS PDU due to inter-eNodeB connected mode mobility when the transport of user data via the control plane is used

  If the downlink ESM NAS message could not be delivered due to inter-eNodeB connected mode mobility and the MME is not changed, then upon successful completion of inter-eNodeB connected mode mobility the MME shall retransmit the ESM message. If a failure of inter-eNodeB connected mode mobility is reported by the lower layer and the S1 signalling connection exists, the MME shall retransmit the downlink ESM NAS message.

NOTE:  If the downlink ESM NAS message could not be delivered due to inter-eNodeB connected mode mobility and the MME is changed, the retransmission of downlink ESM NAS message is not supported.

6.3.5  Handling of APN based congestion control

The network may detect and start performing the APN based congestion control when one or more APN congestion criteria as specified in 3GPP  S  23.401  [10] are met. The network may store an APN congestion back-off time on a per UE and congested APN basis. If the UE does not provide an APN for a non-emergency PDN connection, then the MME uses the APN which is used in PDN GW selection procedure as congested APN. When APN based congestion control is active, the network may reject session management requests except the modification of bearer resources requests from UEs or disconnect existing PDN connections with ESM cause value #26 "insufficient resources".

In the UE, EPS session management timers T3396 for APN based congestion control are started and stopped on a per APN basis. The APN associated with T3396 is the APN provided by the UE when the PDN connection is established. If no APN is included in the PDN CONNECTIVITY REQUEST or, when applicable, in the ESM INFORMATION RESPONSE message, then T3396 is associated with no APN. For this purpose the UE shall memorize the APN provided to the network during the PDN connection establishment. The timer T3396 associated with no APN will never be started due to any ESM procedure related to an emergency PDN connection. If the timer T3396 associated with no APN is running or is deactivated, it does not affect the ability of the UE to request an emergency PDN connection.

If timer T3396 is running or is deactivated, the UE is allowed to indicate change of the 3GPP PS data off UE status, initiate PDN disconnection procedure, initiate bearer resource modification procedure to release of bearer resources for the respective APN, and if the UE is a UE configured to use AC11        15 in selected PLMN, then the UE is allowed to initiate an attach procedure or any EPS session management procedure for the respective APN.

6.3.5A  Handling of group specific session management congestion control

The network may detect and start performing the group specific session management congestion control when one or more group congestion criteria as specified in 3GPP  S  23.401  [10] are met. When group specific session management congestion control is active, the mechanism for APN based congestion control as specified in clause  6.3.5 shall be followed.

6.3.6  Handling of network rejection not due to APN based congestion control

The network may include a back-off timer value in an EPS session management reject message to regulate the time interval at which the UE may retry the same procedure. For ESM cause values other than #26 "insufficient resources", the network may also include the re-attempt indicator to indicate whether the UE is allowed to re-attempt the corresponding session management procedure for the same APN in A/Gb or Iu mode or N1 mode after inter-system change.

NOTE  1:  If the network includes this back-off timer value, then the UE is blocked from sending another ESM request for the same procedure for the same PLMN and APN combination for the specified duration. Therefore, the operator needs to exercise caution in determining the use of this timer value.

NOTE  2:  If the re-attempt indicator is not provided by the network, a UE registered in its HPLMN or in an EHPLMN (if the EHPLMN list is present) can use the configured SM_RetryAtRATChange value specified in the NAS configuration MO or in the USIM NASCONFIG file to derive the re-attempt indicator as specified in clauses  6.5.1.4.3, 6.5.3.4.3, and 6.5.4.4.3.

If re-attempt in A/Gb or Iu mode or N1 mode is allowed, the UE shall consider the back-off timer to be applicable only to the EPS session management in S1 mode for the rejected EPS session management procedure and the given PLMN and APN combination. If re-attempt in A/Gb and Iu mode and N1 mode is not allowed, the UE shall consider the back-off timer to be applicable to all three NAS protocols, i.e. applicable to the EPS session management in S1 mode for the rejected EPS session management procedure, to the GPRS session management in A/Gb and Iu mode for the corresponding session management procedure and the given PLMN and APN combination and to the 5GS session management in N1 mode for the corresponding session management procedure and the given PLMN and APN combination.

NOTE  3:  In the present clause the terms APN and DNN are referring to the same parameter.

The APN of the PLMN and APN combination associated with the back-off timer is the APN provided by the UE when the PDN connection is established. If no APN is included in the PDN CONNECTIVITY REQUEST or, when applicable, in the ESM INFORMATION RESPONSE message, then the back-off timer is associated with the combination of the PLMN and no APN. For this purpose the UE shall memorize the APN provided to the network during the PDN connection establishment. The back-off timer associated with the combination of a PLMN with no APN will never be started due to any ESM procedure related to an emergency PDN connection. If the back-off timer associated with the combination of a PLMN with no APN is running, it does not affect the ability of the UE to request an emergency PDN connection.

The network may additionally indicate in the re-attempt indicator that a command to back-off is applicable not only for the PLMN in which the UE received the EPS session management reject message, but for each PLMN included in the equivalent PLMN list at the time when the EPS session management reject message was received.

If the back-off timer is running or is deactivated for a given PLMN and APN combination, and the UE is a UE configured to use AC11        15 in selected PLMN, then the UE is allowed to initiate an attach procedure or any EPS session management procedure for this PLMN and APN combination.

6.3.7  Handling of WLAN offload control

In networks that support offloading of traffic to WLAN, as specified in 3GPP  S  36.331  [22], a permission to offload is determined for the UE and the PDN connection in accordance with 3GPP  S  23.401  [10] clause  4.3.23.

6.3.8  Handling of serving PLMN rate control

Serving PLMN rate control enables the serving PLMN to protect its MME and the signalling radio bearers in the E-UTRAN from load generated by NAS messages with user data over control plane. The MME can inform the UE of any local serving PLMN rate control during the default EPS bearer context activation procedure (see clause  6.4.1). If the serving PLMN rate control is enabled, the MME shall start the serving PLMN rate control for the PDN connection when the first NAS message with user data over control plane is received over the PDN connection. The UE shall limit the rate at which it generates uplink NAS messages with user data over control plane to comply with the serving PLMN policy provided by the network. The indicated rate in a NAS procedure applies to the PDN connection the NAS procedure corresponds to, and the indicated rate is valid until the PDN connection is released.

Serving PLMN rate control is applicable for PDN connections established for control plane CIoT EPS optimization only.

Any serving PLMN rate control information provided by the network to the UE is only applicable for the PLMN which provided this information. This serving PLMN rate control information shall be discarded when the UE successfully registers to another PLMN.

NOTE:  The serving PLMN can discard or delay NAS messages including user data over control plane that exceed the limit provided for serving PLMN rate control.

6.3.9  Handling of APN rate control

APN rate control controls the maximum number of uplink user data messages including uplink exception data reporting sent by the UE in a time interval for the APN in accordance with 3GPP  S  23.401  [10]. The UE shall limit the rate at which it generates uplink user data messages to comply with the APN rate control policy. The NAS shall provide the indicated rates to upper layers for enforcement. The indicated rates in a NAS procedure applies to the APN the NAS procedure corresponds to, and the indicated rates are valid until a new value is indicated or the last PDN connection using this APN is released.

If the UE supports APN rate control, the UE shall provide the support indication of APN rate control and additional APN rate control for exception data reporting to the network. If the UE indicates support of additional APN rate control for exception data reporting, the network may provide the APN rate control parameters for exception data to the UE. If the UE does not indicate support of additional APN rate control for exception data reporting, the network shall not provide the APN rate control parameters for exception data to the UE.

If an allowed indication of additional exception reports is provided with the APN rate control parameters and:

-  the additional APN rate control parameters for exception data is provided and the limit for additional rate for exception data reporting is not reached; or

-  the additional APN rate control parameters for exception data is not provided,

the UE is allowed to send uplink exception reports even if the limit for the APN rate control has been reached.

NOTE  1:  The HPLMN can discard or delay user data that exceeds the limit provided for APN rate control.

Upon inter-system change from S1 mode to N1 mode, the UE shall store the current APN rate control status for each APN associated with PDN connection(s) to be transferred from S1 mode to N1 mode as specified in 3GPP  S  23.501  [58].

NOTE  2:  How long the UE stores the current APN rate control status is implementation specific.

Upon inter-system change from N1 mode to S1 mode, the UE shall use the stored APN rate control status, if any, to comply with the APN rate control policy for an APN as specified in 3GPP  S  23.501  [58] if:

a)  there is at least one PDN connection associated with this APN was transferred from N1 mode to S1 mode; and

b)  the validity period of the stored APN rate control status has not expired.

After inter-system change from S1 mode to N1 mode, if all the PDU sessions associated with the same APN that was used in S1 mode are released, the UE shall delete the stored APN rate control status for this APN.

6.3.10  Handling of 3GPP PS data off

A UE, which supports 3GPP PS data off (see 3GPP  S  23.401  [10]), can be configured with up to two lists of 3GPP PS data off exempt services as specified in 3GPP  S  24.368  [15A] or in the EF3GPPPSDATAOFF USIM file as specified in 3GPP  S  31.102  [17]:

-  a list of 3GPP PS data off exempt services to be used in the HPLMN or EHPLMN (if the EHPLMN list is present); and

-  a list of 3GPP PS data off exempt services to be used in the VPLMN.

If only the list of 3GPP PS data off exempt services to be used in the HPLMN or EHPLMN (if the EHPLMN list is present) is configured at the UE, this list shall be also used in the VPLMN.

If the UE supports 3GPP PS data off, the UE shall provide the 3GPP PS data off UE status in the protocol configuration options IE during attach, UE-requested PDN connectivity, and UE-requested bearer resource modification procedure (see clause  5.5.1, 6.5.1, and 6.5.4).

NOTE  1:  The sending of the 3GPP PS data off UE status to the network happens also when the user activates or deactivates 3GPP PS data off while connected via WLAN access only, and then handover to 3GPP access occur.

The network informs the UE about the support of 3GPP PS data off during the activation of the default bearer of a PDN connection (see clause  6.4.1). If 3GPP PS data off support is not indicated in the protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, the UE shall not indicate any change of 3GPP PS data off UE status for the PDN connection established by the default EPS bearer context activation procedure; otherwise the UE shall indicate change of the 3GPP PS data off UE status for the PDN connection by using the UE-requested bearer resource modification procedure as specified in clause  6.5.4. If the network does not provide indication of support of 3GPP PS data off during default EPS bearer context activation procedure of the PDN connection, the UE behaviour for non-exempt service requests from the network is implementation dependent.

When the 3GPP PS data off UE status is "activated":

a)  the UE does not send uplink IP packets except:

-  for those services indicated in the list of 3GPP PS data off exempt services to be used in the HPLMN or EHPLMN (if the EHPLMN list is present) as specified in 3GPP  S  24.368  [15A] when the UE is in its HPLMN or EHPLMN (if the EHPLMN list is present);

-  for those services indicated in the list of 3GPP PS data off exempt services to be used in the HPLMN or EHPLMN (if the EHPLMN list is present) when the UE is in the VPLMN, if only the list of 3GPP PS data off exempt services to be used in the HPLMN or EHPLMN (if the EHPLMN list is present) is configured to the UE as specified in 3GPP  S  24.368  [15A];

-  for those services indicated in the list of 3GPP PS data off exempt services to be used in the VPLMN when the UE is in the VPLMN, if the list of 3GPP PS data off exempt services to be used in the VPLMN is configured to the UE as specified in 3GPP  S  24.368  [15A];

-  for those services indicated in the EF3GPPPSDATAOFF USIM file as specified in 3GPP  S  31.102  [17];

-  any uplink traffic due to procedures specified in 3GPP  S  24.229  [13D]; and

-  any uplink traffic due to procedures specified in 3GPP  S  24.623  [50]; and

b)  the UE does not send uplink non-IP or Ethernet user data packets.

Otherwise the UE sends uplink user data packets without restriction.

NOTE  2:  If the UE supports 3GPP PS data off, uplink IP packets are filtered as specified in 3GPP  S  24.229  [13D] in L.3.1.5.

6.3.11  Handling of Reliable Data Service

If the UE supports Reliable Data Service (see 3GPP  S  24.250  [51]), the UE may request data transfer using Reliable Data Service for a PDN connection in the extended protocol configuration options IE during attach and UE-requested PDN connectivity procedures (see clause  5.5.1 and 6.5.1).

The Reliable Data Service may only be used with PDN connections for which the "Control plane only" indicator is set or with PDN connections using the control plane CIoT EPS optimization when the MME does not move such PDN connections to the user plane.

The SCEF or P-GW shall inform the UE about the acceptance of UE   's request for Reliable Data Service usage during the activation of the default bearer of a PDN connection (see clause  6.4.1) in the extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message.

If the SCEF or P-GW accepts the use of Reliable Data Service to transfer data for the specified PDN connection, the UE shall use this PDN connection exclusively for data transfer using Reliable Data Service; otherwise the UE shall not use this PDN connection for data transfer using Reliable Data Service.

6.3.12  Handling of Ethernet PDN type

A UE may support the Ethernet PDN type. A network may support the Ethernet PDN type.

6.3.13  Handling of Uncrewed aerial vehicle identification, authentication, and authorization

6.3.13.1  General

An EPS can support uncrewed aerial vehicle identification, authentication, and authorization (see 3GPP  S  23.256  [60]).

Before accessing EPS for UAS services, the UE supporting UAS services must have an assigned CAA-level UAV ID.

6.3.13.2  Authentication and authorization of UAV

The UE supporting UAS services may request a PDN connection for USS communication during attach and UE-requested PDN connectivity procedures (see clause  5.5.1 and 6.5.1). In the request of the PDN connection for USS communication, the UE provides CAA-level UAV ID to the network via the protocol configuration options and the network may decide to perform UUAA-SM procedure. If provided by the upper layers, a UE supporting UAS services may provide to the network the USS address via the protocol configuration options during attach and UE-requested PDN connectivity procedures so that the network may use the information to discover the USS.

After successful UUAA-SM procedure, the network may initiate the re-authentication or re-authorization procedure for the UE supporting UAS services as a part of network-initiated EPS bearer context modification procedure. If UUAA-SM fails during the re-authentication or a re-authorization procedure, or if the revocation of UUAA is initiated by the network, then the associated PDN connection for USS communication is released.

6.3.13.3  Authorization of C2 communication

The network supports C2 communication authorization for pairing of UAV and UAV-C. The pairing of UAV and UAV-C needs to be authorized by USS successfully before the user plane connectivity for C2 communication is enabled. The UE supporting UAS services may provide the network with an identification information of UAV-C to pair with, if available, via the protocol configuration options as follows:

-  If the UE uses a common PDN connectivity for both USS communication and C2 communication with a UAV-C, the C2 communication with the UAV-C can be authorized using UUAA-SM procedure during the PDN connectivity procedure or during the bearer resource modification procedure. If the pairing of UAV and UAV-C is revoked, the network shall disable C2 communication for the PDN connection.

NOTE:  The network can disable C2 communication for the PDN connection e.g., by removing the packet filter(s) allocated for C2 communication during EPS bearer context modification procedure as specified in clause  6.4.3 or by deactivating the EPS bearer context for C2 communication during EPS bearer context deactivation procedure as specified in clause  6.4.4.

-  If the UE uses separate PDN connectivity for, respectively, USS communication and C2 communication with a UAV-C, the C2 communication with the UAV-C is authorized using UUAA-SM during the PDN connectivity procedure. If the pairing of UAV and UAV-C is revoked, the PDN connectivity or C2 communication shall be released by the network.

6.3.13.4  Authorization of UAV flight

The network supports USS authorization of UAV flight. The authorization of UAV flight can be performed using UUAA-SM procedure during the PDN connectivity procedure or during the bearer resource modification procedure. The UE supporting UAS services may provide flight authorization information to the network via the protocol configuration options if the authorization information is already available in the UE.

6.4  Network initiated ESM procedures

6.4.1  Default EPS bearer context activation procedure

6.4.1.1  General

The purpose of the default bearer context activation procedure is to establish a default EPS bearer context between the UE and the EPC. The default EPS bearer context activation procedure is initiated by the network as a response to the PDN CONNECTIVITY REQUEST message from the UE. The default bearer context activation procedure can be part of the attach procedure, and if the attach procedure fails, the UE shall consider that the default bearer activation has implicitly failed. The default EPS bearer context does not have any TFT assigned during the activation procedure. This corresponds to using a match-all packet filter. The network may at anytime after the establishment of this bearer assign a TFT to the default EPS bearer and may subsequently modify the TFT or the packet filters of this default bearer.

6.4.1.2  Default EPS bearer context activation initiated by the network

The MME shall initiate the default bearer context activation procedure by sending an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message and enter the state BEARER CONTEXT ACTIVE PENDING (see example in figure  6.4.1.2.1). When the default bearer is activated as part of the attach procedure, the MME shall send the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message together with ATTACH ACCEPT and shall not start the timer T3485. When the default bearer is activated as the response to a stand-alone PDN CONNECTIVITY REQUEST message apart from the attach procedure, the MME shall send the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message alone, and start the timer T3485.

The MME shall assign and include an EPS bearer identity in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message selecting a value as specified by clause  9.3.2. The MME shall retrieve the PTI from the PDN CONNECTIVITY REQUEST message and include it in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message. Both the network identifier part and the operator identifier part shall be included in the Access Point Name IE.



Figure 6.4.1.2.1: Default EPS bearer context activation procedure

6.4.1.3  Default EPS bearer context activation accepted by the UE

Upon receipt of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, if the UE provided an APN for the establishment of the PDN connection, the UE shall stop timer T3396 if it is running for the APN provided by the UE. If the UE did not provide an APN for the establishment of the PDN connection and the request type was different from "emergency" and from "handover of emergency bearer services", the UE shall stop the timer T3396 associated with no APN if it is running. If the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message was received in response to a request for an emergency PDN connection, the UE shall not stop the timer T3396 associated with no APN if it is running. For any case, the UE shall then send an ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message and enter the state BEARER CONTEXT ACTIVE. When the default bearer is activated as part of the attach procedure, the UE shall send the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message together with ATTACH COMPLETE message. When the default bearer is activated as the response to the stand-alone PDN CONNECTIVITY REQUEST message, the UE shall send the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message alone.

If a WLAN offload indication information element is included in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, the UE shall store the WLAN offload acceptability values for this PDN connection and use the E-UTRAN offload acceptability value to determine whether this PDN connection is offloadable to WLAN or not.

The UE checks the PTI in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message to identify the UE requested PDN connectivity procedure to which the default bearer context activation is related (see clause  6.5.1).

If the UE receives a serving PLMN rate control IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, the UE shall store the serving PLMN rate control IE value and use the stored serving PLMN rate control value as the maximum allowed limit of uplink User data container IEs included in ESM DATA TRANSPORT messages for the corresponding PDN connection in accordance with 3GPP  S  23.401  [10].

If the UE receives an APN rate control parameters container in the protocol configuration options IE or extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, the UE shall store the APN rate control parameters value and use the stored APN rate control parameters value as the maximum allowed limit of uplink user data related to the APN indicated in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message in accordance with 3GPP  S  23.401  [10]. If the UE has a previously stored APN rate control parameters value for this APN, the UE shall replace the stored APN rate control parameters value for this APN with the received APN rate control parameters value.

If the UE receives an additional APN rate control parameters for exception data container in the protocol configuration options IE or extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, the UE shall store the additional APN rate control parameters for exception data value and use the stored additional APN rate control parameters for exception data value as the maximum allowed limit of uplink exception data related to the APN indicated in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message in accordance with 3GPP  S  23.401  [10]. If the UE has a previously stored additional APN rate control parameters for exception data value for this APN, the UE shall replace the stored additional APN rate control parameters for exception data value for this APN with the received additional APN rate control parameters for exception data value.

If the UE receives a small data rate control parameters container in the protocol configuration options IE or the extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, the UE shall store the small data rate control parameters value and use the stored small data rate control parameters value as the maximum allowed limit of uplink user data for the corresponding PDU session that becomes transferred after inter-system change from S1 mode to N1 mode in accordance with 3GPP  S  23.501  [58].

If the UE receives an additional small data rate control parameters for exception data container in the protocol configuration options IE or the extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, the UE shall store the additional small data rate control parameters for exception data value and use the stored additional small data rate control parameters for exception data value as the maximum allowed limit of uplink exception data for the corresponding PDU session that becomes transferred after inter-system change from S1 mode to N1 mode in accordance with 3GPP  S  23.501  [58].

If the UE receives non-IP Link MTU parameter, Ethernet Frame Payload MTU parameter, IPv4 Link MTU parameter, or Unstructured Link MTU parameter of the protocol configuration options IE or of the extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, the UE shall pass the received Non-IP Link MTU size, Ethernet Frame Payload MTU size, or IPv4 Link MTU size, or Unstructured Link MTU size to the upper layer.

NOTE  1:  The Non-IP Link MTU and the IPv4 Link MTU size correspond to the maximum length of user data that can be sent either in the user data container in the ESM DATA TRANSPORT message or via S1-U interface.

NOTE  2:  The Ethernet frame payload MTU size corresponds to the maximum length of a payload of an Ethernet frame that can be sent either in the user data container in the ESM DATA TRANSPORT message or via S1-U interface.

NOTE  3:  A PDN connection of non-IP PDN type can be transferred to a PDU session of "Unstructured" PDU session type, thus the UE can request the unstructured link MTU parameter in the default EPS bearer context activation procedure. The unstructured link MTU size correspond to the maximum length of user data packet that can be sent either via the control plane or via N3 interface for a PDU session of the "Unstructured" PDU session type as specified in 3GPP  S  24.501  [54].

If the UE receives the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message containing the Uplink data not allowed parameter in the extended protocol configuration options IE, then the UE shall not send any uplink user data over EPS bearer context(s) of the corresponding PDN connection.

Upon receiving the DNS server security information, the UE shall pass it to the upper layer. The UE shall use this information to send the DNS over (D)TLS (See 3GPP  S  33.501  [24]).

NOTE  4:  Support of DNS over (D)TLS is based on the informative requirements as specified in 3GPP  S  33.501  [24].

If the UE supports provisioning of ECS configuration information to the EEC in the UE, then upon receiving:

-  at least one of ECS IPv4 address(es), ECS IPv6 address(es), ECS FQDN(s);

-  at least one associated ECSP identifier; and

-  optionally spatial validity conditions associated with the ECS address

in the Extended protocol configuration options IE of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, the UE shall pass them to the upper layers.

NOTE  5:  The IP address(es) and/or FQDN(s) are associated with the ECSP identifier and replace previously provided ECS configuration information associated with the same ECSP identifier, if any.Upon receipt of the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message, the MME shall enter the state BEARER CONTEXT ACTIVE and stop the timer T3485, if the timer is running. If the PDN CONNECTIVITY REQUEST message included a low priority indicator set to "MS is configured for NAS signalling low priority", the MME shall store the NAS signalling low priority indication within the default EPS bearer context.

6.4.1.4  Default EPS bearer context activation not accepted by the UE

If the default EPS bearer context activation is part of the attach procedure, the ESM sublayer shall notify the EMM sublayer of an ESM failure. If EMM-REGISTERED without PDN connection is supported by the UE and the MME, the ESM sublayer shall additionally provide an ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT message to the EMM sublayer.

If the default EPS bearer context activation is not part of the attach procedure, the UE shall send an ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT message and enter the state BEARER CONTEXT INACTIVE.

The ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT message contains an ESM cause that typically indicates one of the following cause values:

#26:  insufficient resources;

#31:  request rejected, unspecified; or

#95        111:  protocol errors.

Upon receipt of the ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT message, the MME shall enter the state BEARER CONTEXT INACTIVE and stop the timer T3485, if the timer is running.

6.4.1.5  Abnormal cases in the UE

The following abnormal cases can be identified:

a)  Default EPS bearer context activation request for an already activated default EPS bearer context:

  If the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message with an EPS bearer identity identical to the EPS bearer identity of an already activated default EPS bearer context, the UE shall locally deactivate the existing default EPS bearer context and all the associated dedicated EPS bearer contexts, if any, and proceed with the requested default EPS bearer context activation.

b)  Default EPS bearer context activation request for an already activated dedicated EPS bearer context:

  If the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message with an EPS bearer identity identical to the EPS bearer identity of an already activated dedicated EPS bearer context, the UE shall locally deactivate the existing dedicated EPS bearer context and proceed with the requested default EPS bearer context activation.

6.4.1.6  Abnormal cases on the network side

The following abnormal cases can be identified:

a)  Expiry of timer T3485:

  On the first expiry of the timer T3485, the MME shall resend the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST and shall reset and restart timer T3485. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3485, the MME shall release possibly allocated resources for this activation and shall abort the procedure.

b)  Lower layer indicates that the HeNB rejected the establishment of the default bearer (see 3GPP  S  36.413  [23]) for a LIPA PDN connection or SIPTO at the local network PDN connection due to a triggered handover:

  The MME shall enter the state BEARER CONTEXT INACTIVE, stop timer T3485 and reject the PDN connectivity request procedure including the ESM cause value #34 "service option temporarily out of order" in the PDN CONNECTIVITY REJECT message. The MME shall release possibly allocated resources for this activation.

6.4.2  Dedicated EPS bearer context activation procedure

6.4.2.1  General

The purpose of the dedicated EPS bearer context activation procedure is to establish an EPS bearer context with specific QoS and TFT between the UE and the EPC.

In WB-S1 mode, the dedicated EPS bearer context activation procedure is initiated by the network, but may be requested by the UE by means of the UE requested bearer resource allocation procedure (see clause  6.5.3) or the UE requested bearer resource modification procedure (see clause  6.5.4). The dedicated bearer context activation procedure can be part of the attach procedure or be initiated together with the default EPS bearer context activation procedure when the UE initiated stand-alone PDN connectivity procedure. If the attach procedure or the default EPS bearer context activation procedure fails, the UE shall consider that the dedicated bearer activation has implicitly failed. The network may initiate the dedicated EPS bearer context activation procedure together with the completion of the service request procedure.

In NB-S1 mode, the dedicated EPS bearer contexts activation procedure is not used.

Upon an inter-system mobility from WB-S1 mode to NB-S1 mode in EMM-IDLE mode, if the UE has at least one dedicated EPS bearer context in ESM state BEARER CONTEXT ACTIVE, the UE shall locally deactivate any such dedicated EPS bearer context and shall include the EPS bearer context status IE in TRACKING AREA UPDATE REQUEST message.

Upon an inter-system change from WB-N1 mode to NB-S1 mode in EMM-IDLE mode for the UE operating in single-registration mode, the UE shall set each mapped dedicated EPS bearer context, if any, to ESM state BEARER CONTEXT INACTIVE and shall then include the EPS bearer context status IE in the TRACKING AREA UPDATE REQUEST message.

NOTE:  3GPP  S  23.060  [74]  clause  9.3 specifies that a packet filter applicable for the downlink direction is not mandatory in a TFT.

6.4.2.2  Dedicated EPS bearer context activation initiated by the network

In WB-S1 mode, the MME shall initiate the dedicated bearer context activation procedure by sending an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, start the timer T3485, and enter the state BEARER CONTEXT ACTIVE PENDING (see example in figure  6.4.2.2.1).

The MME allocates the EPS bearer identity selecting a value as specified by clause  9.3.2, and includes it in the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message. The MME shall include the EPS bearer identity of the associated default bearer as the linked EPS bearer identity in the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message. If this procedure was initiated by a UE requested bearer resource allocation procedure or a UE requested bearer resource modification procedure, the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST shall contain the procedure transaction identity (PTI) value received by the MME in the BEARER RESOURCE ALLOCATION REQUEST or BEARER RESOURCE MODIFICATION REQUEST respectively.



Figure 6.4.2.2.1: Dedicated EPS bearer context activation procedure

6.4.2.3  Dedicated EPS bearer context activation accepted by the UE

Upon receipt of the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, if the UE provided an APN for the establishment of the PDN connection, the UE shall stop timer T3396, if it is running for the APN provided by the UE. If the UE did not provide an APN for the establishment of the PDN connection and the request type was different from "emergency" and from "handover of emergency bearer services", the UE shall stop the timer T3396 associated with no APN if it is running. If the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message was received for an emergency PDN connection, the UE shall not stop the timer T3396 associated with no APN if it is running. For any case, the UE shall then check the received TFT before taking it into use, send an ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message and enter the state BEARER CONTEXT ACTIVE. The ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message shall include the EPS bearer identity.

The linked EPS bearer identity included in the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message indicates to the UE to which default bearer, IP address and PDN the dedicated bearer is linked.

If the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message contains a PTI value other than "no procedure transaction identity assigned" and "reserved" (see 3GPP  S  24.007  [12]), the UE uses the PTI to identify the UE requested bearer resource allocation procedure or the UE requested bearer resource modification procedure to which the dedicated bearer context activation is related.

If the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message contains a PTI value other than "no procedure transaction identity assigned" and "reserved" (see 3GPP  S  24.007  [12]) and the PTI is associated to a UE requested bearer resource allocation procedure or a UE requested bearer resource modification procedure, the UE shall release the traffic flow aggregate description associated to the PTI value provided.

The UE shall use the received TFT to apply mapping of uplink traffic flows to the radio bearer.

The UE shall treat any packet filter without explicit direction as being bi-directional.

If the UE receives an APN rate control parameters container in the protocol configuration options IE or extended protocol configuration options IE in the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, the UE shall store the APN rate control parameters value and use the stored APN rate control parameters value as the maximum allowed limit of uplink user data related to the corresponding APN in accordance with 3GPP  S  23.401  [10]. If the UE has a previously stored APN rate control parameters value for this APN, the UE shall replace the stored APN rate control parameters value for this APN with the received APN rate control parameters value.

If the UE receives an additional APN rate control parameters for exception data container in the protocol configuration options IE or extended protocol configuration options IE in the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, the UE shall store the additional APN rate control parameters for exception data value and use the stored additional APN rate control parameters for exception data value as the maximum allowed limit of uplink exception data related to the corresponding APN in accordance with 3GPP  S  23.401  [10]. If the UE has a previously stored additional APN rate control parameters for exception data value for this APN, the UE shall replace the stored additional APN rate control parameters for exception data value for this APN with the received additional APN rate control parameters for exception data value.

If the UE receives a small data rate control parameters container in the protocol configuration options IE or the extended protocol configuration options IE in the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, the UE shall store the small data rate control parameters value and use the stored small data rate control parameters value as the maximum allowed limit of uplink user data for the corresponding PDU session that becomes transferred after inter-system change from S1 mode to N1 mode in accordance with 3GPP  S  23.501  [58]. If the UE has a previously stored small data rate control parameters value for this PDU session, the UE shall replace the stored small data rate control parameters value for this PDU Session with the received small data rate control parameters value.

If the UE receives an additional small data rate control parameters for exception data container in the protocol configuration options IE or the extended protocol configuration options IE in the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, the UE shall store the additional small data rate control parameters for exception data value and use the stored additional small data rate control parameters for exception data value as the maximum allowed limit of uplink exception data for the corresponding PDU session that becomes transferred after inter-system change from S1 mode to N1 mode in accordance with 3GPP  S  23.501  [58]. If the UE has a previously stored additional small data rate control parameters for exception data value for this PDU session, the UE shall replace the stored additional small data rate control parameters for exception data value for this PDU session with the received additional small data rate control parameters for exception data value.

If the UE receives QoS rule(s) of the 5GS QoS flow(s), which corresponds to the dedicated EPS bearer being activated, in the protocol configuration options IE or the extended protocol configuration options IE of the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, the UE stores the QoS rule(s) for use during inter-system change from S1 mode to N1 mode.

Upon receipt of the ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message, the MME shall stop the timerT3485 and enter the state BEARER CONTEXT ACTIVE.

6.4.2.4  Dedicated EPS bearer context activation not accepted by the UE

Upon receipt of the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, the UE may reject the request from the MME by sending an ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message. The message shall include the EPS bearer identity and an ESM cause value indicating the reason for rejecting the dedicated EPS bearer context activation request.

The ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message contains an ESM cause that typically indicates one of the following ESM cause values:

#26:  insufficient resources;

#31:  request rejected, unspecified;

#41:  semantic error in the TFT operation;

#42:  syntactical error in the TFT operation;

#43:  invalid EPS bearer identity;

#44:  semantic error(s) in packet filter(s);

#45:  syntactical error(s) in packet filter(s); or

#95        111:  protocol errors.

The UE shall check the TFT in the request message for different types of TFT IE errors as follows:

a)  Semantic errors in TFT operations:

1)  When the TFT operation is an operation other than "Create a new TFT"

  The UE shall reject the activation request with ESM cause #41 "semantic error in the TFT operation".

b)  Syntactical errors in TFT operations:

1)  When the TFT operation = "Create a new TFT" and the packet filter list in the TFT IE is empty.

2)  When there are other types of syntactical errors in the coding of the TFT IE, such as a mismatch between the number of packet filters subfield, and the number of packet filters in the packet filter list.

  The UE shall reject the activation request with ESM cause #42 "syntactical error in the TFT operation".

c)  Semantic errors in packet filters:

1)  When a packet filter consists of conflicting packet filter components which would render the packet filter ineffective, i.e. no IP packet will ever fit this packet filter. How the UE determines a semantic error in a packet filter is outside the scope of the present document.

2)  When the resulting TFT does not contain any packet filter which applicable for the uplink direction.

  The UE shall reject the activation request with ESM cause #44 "semantic errors in packet filter(s)".

d)  Syntactical errors in packet filters:

1)  When the TFT operation = "Create a new TFT" and two or more packet filters in the resultant TFT would have identical packet filter identifiers.

2)  When the TFT operation = "Create a new TFT" and two or more packet filters in all TFTs associated with this PDN connection would have identical packet filter precedence values.

3)  When there are other types of syntactical errors in the coding of packet filters, such as the use of a reserved value for a packet filter component identifier.

  In case  2, if the old packet filters do not belong to the default EPS bearer context, the UE shall not diagnose an error, shall further process the new activation request and, if it was processed successfully, shall delete the old packet filters which have identical filter precedence values. Furthermore, by means of explicit peer-to-peer signalling between the network and the UE, the UE shall perform a UE requested bearer resource modification procedure to delete the packet filters in the network corresponding to the packet filters it has deleted on the UE side.

  In case  2, if one or more old packet filters belong to the default EPS bearer context, the UE shall release the relevant PDN connection. If the relevant PDN connection is the last one that the UE has and EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the UE shall detach and re-attach to the network.

  In cases  1 and  3 the UE shall reject the activation request with ESM cause #45 "syntactical errors in packet filter(s)".

Upon receipt of the ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message in state BEARER CONTEXT ACTIVE PENDING, the MME shall stop the timer T3485, enter the state BEARER CONTEXT INACTIVE and abort the dedicated EPS bearer context activation procedure. The MME also requests the lower layer to release the radio resources that were established during the dedicated EPS bearer context activation procedure.

6.4.2.5  Abnormal cases in the UE

The following abnormal cases can be identified:

a)  Dedicated EPS bearer context activation request for an already activated default EPS bearer context:

  If the UE receives an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message with an EPS bearer identity identical to the EPS bearer identity of an already activated default EPS bearer context, the UE shall locally deactivate the existing default EPS bearer context and all the associated dedicated EPS bearer contexts, if any, and proceed with the requested dedicated EPS bearer context activation.

b)  Dedicated EPS bearer context activation request for an already activated dedicated EPS bearer context

  If the UE receives an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message with an EPS bearer identity identical to the EPS bearer identity of an already activated dedicated EPS bearer context, the UE shall locally deactivate the existing dedicated EPS bearer context and proceed with the requested dedicated EPS bearer context activation.

c)  No default EPS bearer context with linked EPS bearer identity activated

  If the linked EPS bearer identity included in the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message does not match the EPS bearer identity of any activated default EPS bearer context, the UE shall reply with an ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message with ESM cause #43 "invalid EPS bearer identity".

d)  Dedicated EPS bearer context activation request when the PLMN   's maximum number of EPS bearer contexts in S1 mode is reached at the UE:

  If the PLMN   's maximum number of EPS bearer contexts in S1 mode is reached at the UE and the UE receives an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, the UE shall clear the determination representing the PLMN   's maximum number of EPS bearer contexts in S1 mode and proceed with the dedicated EPS bearer context activation procedure.

6.4.2.6  Abnormal cases on the network side

The following abnormal cases can be identified:

a)  Expiry of timer T3485:

  On the first expiry of the timer T3485, the MME shall resend the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST and shall reset and restart timer T3485. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3485, the MME shall abort the procedure, release any resources allocated for this activation and enter the state BEARER CONTEXT INACTIVE.

b)  Collision of UE requested PDN disconnect procedure and dedicated EPS bearer context activation procedure:

  When the MME receives a PDN DISCONNECT REQUEST message during the dedicated EPS bearer context activation procedure, and the EPS bearer to be activated belongs to the PDN connection the UE wants to disconnect, the MME shall terminate the dedicated bearer context activation procedure locally, release any resources related to this procedure and proceed with the PDN disconnect procedure.

6.4.3  EPS bearer context modification procedure

6.4.3.1  General

The purpose of the EPS bearer context modification procedure is to modify an EPS bearer context with a specific QoS and TFT, or re-negotiate header compression configuration associated to an EPS bearer context. The EPS bearer context modification procedure is initiated by the network, but it may also be initiated as part of the UE requested bearer resource allocation procedure or the UE requested bearer resource modification procedure.

The network may also initiate the EPS bearer context modification procedure to update the Measurement Assistance Information. See clause  4.4 of 3GPP  S  24.193  [61].

The network may also initiate the EPS bearer context modification procedure to update the APN-AMBR of the UE, for instance after an inter-system handover. See 3GPP  S  23.401  [10] annex  E.

The MME may also initiate the EPS bearer context modification procedure to update the WLAN offload indication to the UE, for instance after the MME received an updated WLAN offload indication of a PDN Connection from HSS. See 3GPP  S  23.401  [10] clause  4.3.23.

The MME may also initiate the EPS bearer context modification procedure to update information required for inter-system change from S1 mode to N1 mode (e.g. session-AMBR, QoS rule(s)). See 3GPP  S  24.501  [54].

The network may initiate the EPS bearer context modification procedure together with the completion of the service request procedure.

The network may initiate the EPS bearer context modification procedure to initiate the procedure for the UUAA-SM for the UAS services.

6.4.3.2  EPS bearer context modification initiated by the network

The MME shall initiate the EPS bearer context modification procedure by sending a MODIFY EPS BEARER CONTEXT REQUEST message to the UE, starting the timer T3486, and entering the state BEARER CONTEXT MODIFY PENDING (see example in figure  6.4.3.2.1).

The MME shall include an EPS bearer identity that identifies the EPS bearer context to be modified in the MODIFY EPS BEARER CONTEXT REQUEST message.

If this procedure was initiated by a UE requested bearer resource allocation procedure or a UE requested bearer resource modification procedure, the MODIFY EPS BEARER CONTEXT REQUEST shall contain the procedure transaction identity (PTI) value received by the MME in the BEARER RESOURCE ALLOCATION REQUEST or BEARER RESOURCE MODIFICATION REQUEST respectively.

If the UE indicated "Control plane CIoT EPS optimization supported" and "Header compression for control plane CIoT EPS optimization supported" in the UE network capability IE in the latest ATTACH REQUEST message or the TRACKING AREA UPDATE REQUEST message, and the MME supports Control plane CIoT EPS optimization and Header compression for control plane CIoT EPS optimization, the MME may include the Header compression configuration IE in the MODIFY EPS BEARER CONTEXT REQUEST message to re-negotiate header compression configuration associated to an EPS bearer context.



Figure 6.4.3.2.1: EPS bearer context modification procedure

6.4.3.3  EPS bearer context modification accepted by the UE

Upon receipt of the MODIFY EPS BEARER CONTEXT REQUEST message, if the UE provided an APN for the establishment of the PDN connection, the UE shall stop timer T3396, if it is running for the APN provided by the UE. If the UE did not provide an APN for the establishment of the PDN connection and the request type was different from "emergency" and from "handover of emergency bearer services", the UE shall stop the timer T3396 associated with no APN if it is running. If the MODIFY EPS BEARER CONTEXT REQUEST message was received for an emergency PDN connection, the UE shall not stop the timer T3396 associated with no APN if it is running. For any case, the UE shall then check the received TFT before taking it into use and send a MODIFY EPS BEARER CONTEXT ACCEPT message to the MME.

If the MODIFY EPS BEARER CONTEXT REQUEST message contains a PTI value other than "no procedure transaction identity assigned" and "reserved" (see 3GPP  S  24.007  [12]), the UE uses the PTI to identify the UE requested bearer resource allocation procedure or the UE requested bearer resource modification procedure to which the EPS bearer context modification is related (see clause  6.5.3 and clause  6.5.4).

If the MODIFY EPS BEARER CONTEXT REQUEST message contains a PTI value other than "no procedure transaction identity assigned" and "reserved" (see 3GPP  S  24.007  [12]) and the PTI is associated to a UE requested bearer resource allocation procedure or a UE requested bearer resource modification procedure, the UE shall release the traffic flow aggregate description associated to the PTI value provided.

If the EPS bearer context that is modified is a GBR bearer and the MODIFY EPS BEARER CONTEXT REQUEST message does not contain the Guaranteed Bit Rate (GBR) and the Maximum Bit Rate (MBR) values for uplink and downlink, the UE shall continue to use the previously received values for the Guaranteed Bit Rate (GBR) and the Maximum Bit Rate (MBR) for the corresponding bearer.

The UE shall use the received TFT to apply mapping of uplink traffic flows to the radio bearer if the TFT contains packet filters for the uplink direction.

If a WLAN offload indication information element is included in the MODIFY EPS BEARER CONTEXT REQUEST message, the UE shall store the WLAN offload acceptability values for this PDN connection and use the E-UTRAN offload acceptability value to determine whether this PDN connection is offloadable to WLAN or not.

If the UE receives an APN rate control parameters container in the protocol configuration options IE or extended protocol configuration options IE in the MODIFY EPS BEARER CONTEXT REQUEST message, the UE shall store the APN rate control parameters value and use the stored APN rate control parameters value as the maximum allowed limit of uplink user data related to the corresponding APN in accordance with 3GPP  S  23.401  [10]. If the UE has a previously stored APN rate control parameters value for this APN, the UE shall replace the stored APN rate control parameters value for this APN with the received APN rate control parameters value.

If the UE receives an additional APN rate control parameters for exception data container in the protocol configuration options IE or extended protocol configuration options IE in the MODIFY EPS BEARER CONTEXT REQUEST message, the UE shall store the additional APN rate control parameters for exception data value and use the stored additional APN rate control parameters for exception data value as the maximum allowed limit of uplink exception data related to the corresponding APN in accordance with 3GPP  S  23.401  [10]. If the UE has a previously stored additional APN rate control parameters for exception data value for this APN, the UE shall replace the stored additional APN rate control parameters for exception data value for this APN with the received additional APN rate control parameters for exception data value.

If the UE receives a small data rate control parameters container in the protocol configuration options IE or the extended protocol configuration options IE in the MODIFY EPS BEARER CONTEXT REQUEST message, the UE shall store the small data rate control parameters value and use the stored small data rate control parameters value as the maximum allowed limit of uplink user data for the corresponding PDU session that becomes transferred after inter-system change from S1 mode to N1 mode in accordance with 3GPP  S  23.501  [58]. If the UE has a previously stored small data rate control parameters value for this PDU session, the UE shall replace the stored small data rate control parameters value for this PDU Session with the received small data rate control parameters value.

If the UE receives an additional small data rate control parameters for exception data container in the protocol configuration options IE or the extended protocol configuration options IE in the MODIFY EPS BEARER CONTEXT REQUEST message, the UE shall store the additional small data rate control parameters for exception data value and use the stored additional small data rate control parameters for exception data value as the maximum allowed limit of uplink exception data for the corresponding PDU session that becomes transferred after inter-system change from S1 mode to N1 mode in accordance with 3GPP  S  23.501  [58]. If the UE has a previously stored additional small data rate control parameters for exception data value for this PDU session, the UE shall replace the stored additional small data rate control parameters for exception data value for this PDU session with the received additional small data rate control parameters for exception data value.

Upon receipt of the MODIFY EPS BEARER CONTEXT REQUEST message with a session-AMBR and QoS rule(s) in the protocol configuration options IE or the extended protocol configuration options IE, the UE stores the session-AMBR and QoS rule(s) for use during inter-system change from S1 mode to N1 mode.

If the UE receives the MODIFY EPS BEARER CONTEXT REQUEST message containing the Uplink data allowed parameter in the extended protocol configuration options IE, then the UE may start transmitting uplink user data over EPS bearer context(s) of the corresponding PDN connection. The MODIFY EPS BEARER CONTEXT REQUEST message as a part of authorization procedure for the C2 communication, can include an extended protocol configuration options IE containing the service-level-AA container with the length of two octets. The service-level-AA container with the length of two octets:

a)  contains the service-level-AA response with the C2AR field set to the C2 authorization result informed by the UAS NF;

b)  can contain the service-level-AA payload parameter set to the C2 authorization payload and the service-level-AA payload type parameter set to "C2 authorization payload"; and

c)  can contain the service-level device ID with the value set to a new CAA-level UAV ID.

NOTE  1:  The C2 authorization payload in the service-level-AA payload can include the C2 pairing information and the C2 session security information.

Upon receipt of the MODIFY EPS BEARER CONTEXT REQUEST message, if the service-level-AA container with the length of two octets is included in the extended protocol configuration options IE, the UE shall forward the contents of the service-level-AA container with the length of two octets to the upper layers.

If the EPS bearer context being modified is associated with a PDN connection for UAS services, the MODIFY EPS BEARER CONTEXT REQUEST message includes the extended protocol configuration options IE containing the service-level-AA container with the length of two octets containing the service-level-AA response parameter with the SLAR field set to "Service level authentication and authorization was successful", the UE supporting UAS services:

a)  shall consider the UUAA procedure as successfully completed and provide the service-level-AA response to the upper layers;

b)  if the service-level-AA container with the length of two octets contains the service-level device ID parameter carrying a CAA-level UAV ID, shall provide the CAA-level UAV ID to the upper layers; and

c)  if the service-level-AA container with the length of two octets contains the service-level-AA payload type parameter with the value "UUAA payload" and the service-level-AA payload parameter carrying the UUAA payload, shall provide the UUAA payload to the upper layers.

If the EPS bearer context being modified is associated with a PDN connection for UAS services, the MODIFY EPS BEARER CONTEXT REQUEST message includes the extended protocol configuration options IE containing the service-level-AA container with the length of two octets which, then the UE supporting UAS services shall provide the service-level-AA payload to the upper layers.

Upon reception of a service-level-AA payload from the upper layers, the UE supporting UAS services shall include the extended protocol configuration options IE in the MODIFY EPS BEARER CONTEXT ACCEPT message. In the extended protocol configuration options IE, the UE shall include the service-level-AA container with the length of two octets. In the service-level-AA container with the length of two octets, the UE shall:

a)  include the service-level-AA payload parameter set to the service-level-AA payload received from the upper layers; and

b)  set the service-level-AA payload type parameter to the type of the service-level-AA payload.

The MODIFY EPS BEARER CONTEXT REQUEST message may include an extended protocol configuration options IE containing the ATSSS response with the length of two octets PCO parameter. If the UE receives an ATSSS response with the length of two octets PCO parameter in the extended protocol configuration options IE of the MODIFY EPS BEARER CONTEXT REQUEST message, the PDN connection associated with the EPS bearer context is established as a user-plane resource of an MA PDU session and the Measurement assistance information indicator is set to "Measurement assistance information length field and the measurement assistance information field included", the UE shall replace the stored Measurement assistance information with the received Measurement assistance information.

If the UE supports provisioning of ECS configuration information to the EEC in the UE, then upon receiving:

-  at least one of ECS IPv4 address(es), ECS IPv6 address(es), ECS FQDN(s);

-  at least one associated ECSP identifier; and

-  optionally spatial validity conditions associated with the ECS address

in the Extended protocol configuration options IE of the MODIFY EPS BEARER CONTEXT REQUEST message, the UE shall pass them to the upper layers.

NOTE  2:  The IP address(es) and/or FQDN(s) are associated with the ECSP identifier and replace previously provided ECS configuration information associated with the same ECSP identifier, if any.

Upon receipt of the MODIFY EPS BEARER CONTEXT ACCEPT message, the MME shall stop the timer T3486 and enter the state BEARER CONTEXT ACTIVE.

6.4.3.4  EPS bearer context modification not accepted by the UE

Upon receipt of the MODIFY EPS BEARER CONTEXT REQUEST message, the UE may reject the request from the MME by sending a MODIFY EPS BEARER CONTEXT REJECT message to the MME. The message shall include the EPS bearer identity and an ESM cause value indicating the reason for rejecting the EPS bearer context modification request.

The MODIFY EPS BEARER CONTEXT REJECT message contains an ESM cause that typically indicates one of the following ESM cause values:

#26:  insufficient resources;

#41:  semantic error in the TFT operation;

#42:  syntactical error in the TFT operation;

#43:  invalid EPS bearer identity;

#44:  semantic error(s) in packet filter(s);

#45:  syntactical error(s) in packet filter(s); or

#95        111:  protocol errors.

The UE shall check the TFT in the request message for different types of TFT IE errors as follows:

a)  Semantic errors in TFT operations:

1)  TFT operation = "Create a new TFT" when there is already an existing TFT for the EPS bearer context.

2)  When the TFT operation is an operation other than "Create a new TFT", the EPS bearer context being modified is the default EPS bearer content and there is no TFT for the default EPS bearer context.

3)  TFT operation = "Delete packet filters from existing TFT" when it would render the TFT empty.

4)  TFT operation = "Delete existing TFT" for a dedicated EPS bearer context.

  In case 4 the UE shall reject the modification request with ESM cause #41 "semantic error in the TFT operation".

  In the other cases the UE shall not diagnose an error and perform the following actions to resolve the inconsistency:

  In case 1 the UE shall further process the new activation request to create a new TFT and, if it was processed successfully, delete the old TFT.

  In case 2 the UE shall:

-  process the new request and if the TFT operation is "Delete existing TFT" or "Delete packet filters from existing TFT", and if no error according to items b, c, and d was detected, consider the TFT as successfully deleted;

-  process the new request as an activation request, if the TFT operation is "Add packet filters in existing TFT" or "Replace packet filters in existing TFT".

  In case 3, if the packet filters belong to a dedicated EPS bearer context, the UE shall process the new deletion request and, if no error according to items b, c, and d was detected, the UE shall reject the modification request with ESM cause #41 "semantic error in the TFT operation".

  In case 3, if the packet filters belong to the default EPS bearer context, the UE shall process the new deletion request and if no error according to items b, c, and d was detected then delete the existing TFT, this corresponds to using match-all packet filter for the default EPS bearer context.

b)  Syntactical errors in TFT operations:

1)  When the TFT operation = "Create a new TFT", "Add packet filters in existing TFT", "Replace packet filters in existing TFT" or "Delete packet filters from existing TFT" and the packet filter list in the TFT IE is empty.

2)  TFT operation = "Delete existing TFT" or "No TFT operation" with a non-empty packet filter list in the TFT IE.

3)  TFT operation = "Replace packet filters in existing TFT" when the packet filter to be replaced does not exist in the original TFT.

4)  TFT operation = "Delete packet filters from existing TFT" when the packet filter to be deleted does not exist in the original TFT.

5)  Void.

6)  When there are other types of syntactical errors in the coding of the TFT IE, such as a mismatch between the number of packet filters subfield, and the number of packet filters in the packet filter list.

  In case 3 the UE shall not diagnose an error, further process the replace request and, if no error according to items c and d was detected, include the packet filters received to the existing TFT.

  In case 4 the UE shall not diagnose an error, further process the deletion request and, if no error according to items c and d was detected, consider the respective packet filter as successfully deleted.

  Otherwise the UE shall reject the modification request with ESM cause #42 "syntactical error in the TFT operation".

c)  Semantic errors in packet filters:

1)  When a packet filter consists of conflicting packet filter components which would render the packet filter ineffective, i.e. no IP packet will ever fit this packet filter. How the UE determines a semantic error in a packet filter is outside the scope of the present document.

2)  When the resulting TFT, which is assigned to a dedicated EPS bearer context, does not contain any packet filter applicable for the uplink direction among the packet filters created on request from the network.

  The UE shall reject the modification request with ESM cause #44 "semantic errors in packet filter(s)".

d)  Syntactical errors in packet filters:

1)  When the TFT operation = "Create a new TFT", "Add packet filters to existing TFT", or "Replace packet filters in existing TFT" and two or more packet filters in the resultant TFT would have identical packet filter identifiers.

2)  When the TFT operation = "Create a new TFT", "Add packet filters to existing TFT" or "Replace packet filters in existing TFT", and two or more packet filters among all TFTs associated with this PDN connection would have identical packet filter precedence values.

3)  When there are other types of syntactical errors in the coding of packet filters, such as the use of a reserved value for a packet filter component identifier.

  In case 1, if two or more packet filters with identical packet filter identifiers are contained in the new request, the UE shall reject the modification request with ESM cause #45 "syntactical errors in packet filter(s)". Otherwise, the UE shall not diagnose an error, further process the new request and, if it was processed successfully, delete the old packet filters which have the identical packet filter identifiers.

  In case 2, if the old packet filters do not belong to the default EPS bearer context, the UE shall not diagnose an error, shall further process the new request and, if it was processed successfully, shall delete the old packet filters which have identical filter precedence values. Furthermore, the UE shall perform a UE requested bearer resource modification procedure to delete the packet filters in the network corresponding to the packet filters it has deleted on the UE side.

  In case 2, if one or more old packet filters belong to the default EPS bearer context, the UE shall release the relevant PDN connection. If the relevant PDN connection is the last one that the UE has and EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the UE shall detach and re-attach to the network.

  Otherwise the UE shall reject the modification request with ESM cause #45 "syntactical errors in packet filter(s)".

Upon receipt of the MODIFY EPS BEARER CONTEXT REJECT message with ESM cause value other than #43 "invalid EPS bearer identity" in state BEARER CONTEXT MODIFY PENDING, the MME shall stop the timer T3486, enter the state BEARER CONTEXT ACTIVE and abort the EPS bearer context modification procedure. If the network receives the MODIFY EPS BEARER CONTEXT REJECT message with ESM cause #43 "invalid EPS bearer identity", the MME locally deactivates the EPS bearer context(s) without peer-to-peer ESM signalling. When the MME detects that after the failed EPS bearer context modification there is a misalignment between the EPS bearer configuration and the EPS bearer context configuration or between the QoS on NAS and AS level, the MME should initiate the necessary procedures to achieve a re-alignment.

6.4.3.5  Abnormal cases in the UE

Apart from the case described in clause  6.3.3, the following abnormal cases can be identified:

a)  Collision of UE requested bearer resource modification procedure and EPS bearer context modification procedure:

  If the UE receives a MODIFY EPS BEARER CONTEXT REQUEST message during the UE requested bearer resource modification procedure, the Procedure transaction identity IE of the MODIFY EPS BEARER CONTEXT REQUEST message is set to "No procedure transaction identity assigned" and the EPS bearer indicated in the MODIFY EPS BEARER CONTEXT REQUEST message is the EPS bearer that the UE had requested to modify, the UE shall abort internally the UE requested bearer resource modification procedure, enter the state BEARER CONTEXT ACTIVE and proceed with the EPS bearer context modification procedure.

6.4.3.6  Abnormal cases on the network side

The following abnormal cases can be identified:

a)  Expiry of timer T3486:

  On the first expiry of the timer T3486, the MME shall resend the MODIFY EPS BEARER CONTEXT REQUEST and shall reset and restart timer T3486. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3486, the MME shall abort the procedure and enter the state BEARER CONTEXT ACTIVE.

  The MME may continue to use the previous configuration of the EPS bearer context or initiate an EPS bearer context deactivation procedure.

b)  Collision of UE requested PDN disconnect procedure and EPS bearer context modification:

  When the MME receives a PDN DISCONNECT REQUEST message during an EPS bearer context modification procedure, and the EPS bearer to be modified belongs to the PDN connection the UE wants to disconnect, the MME shall terminate the EPS bearer context modification procedure locally, release any resources related to this procedure and proceed with the PDN disconnect procedure.

c)  Collision of UE requested bearer resource modification procedure and EPS bearer context modification procedure:

  If the MME receives a BEARER RESOURCE MODIFICATION REQUEST message during the EPS bearer context modification procedure and the EPS bearer indicated in the BEARER RESOURCE MODIFICATION REQUEST message is the EPS bearer that the network had requested to modify, the network shall ignore the BEARER RESOURCE MODIFICATION REQUEST message received in the state BEATER CONTEXT MODIFY PENDING. The network shall proceed with the EPS bearer modification procedure as if no BEARER RESOURCE MODIFICATION REQUEST message was received from the UE.

6.4.4  EPS bearer context deactivation procedure

6.4.4.1  General

The purpose of the EPS bearer context deactivation procedure is to deactivate an EPS bearer context or disconnect from a PDN by deactivating all EPS bearer contexts to the PDN. The EPS bearer context deactivation procedure is initiated by the network, and it may be triggered by the UE by means of the UE requested bearer resource modification procedure or UE requested PDN disconnect procedure.

In the case of EPS bearer context deactivation with reactivation requested for a PDN connection, if no NAS signalling connection exists, the MME follows the procedures for re-establishing the NAS signalling connection and deactivating the EPS bearer contexts to the PDN with reactivation requested, as specified in 3GPP  S  23.401  [10] clauses  5.4.4.1 and  5.10.3 and 3GPP  S  23.380  [33] clause  5.4.2.1.

If a UE is receiving emergency bearer services from a CSG cell, and the CSG subscription expires or is removed, the MME shall deactivate all non-emergency EPS bearers if any. The MME shall not deactivate the emergency EPS bearers.

If a detach is requested by the HSS for a UE that has bearers for emergency services, the MME shall send a DEACTIVATE EPS BEARER CONTEXT REQUEST message to the UE for all bearers that are not allocated for emergency services.

6.4.4.2  EPS bearer context deactivation initiated by the network

If a NAS signalling connection exists when the MME initiates the EPS bearer context deactivation procedure, the MME shall initiate the EPS bearer context deactivation procedure by sending a DEACTIVATE EPS BEARER CONTEXT REQUEST message to the UE, start the timer T3495, and enter the state BEARER CONTEXT INACTIVE PENDING (see example in figure  6.4.4.2.1). The DEACTIVATE EPS BEARER CONTEXT REQUEST message contains an ESM cause typically indicating one of the following:

#8:  operator determined barring;

#26:  insufficient resources;

#29:  user authentication or authorization failed;

#36:  regular deactivation;

#38:  network failure;

#39:  reactivation requested;

#112:  APN restriction value incompatible with active EPS bearer context; or

#113:  Multiple accesses to a PDN connection not allowed.

If the deactivation is triggered by a UE initiated bearer resource modification procedure or UE requested PDN disconnect procedure, the DEACTIVATE EPS BEARER CONTEXT REQUEST message shall contain the procedure transaction identity (PTI) value received by the MME in the BEARER RESOURCE MODIFICATION REQUEST or PDN DISCONNECT REQUEST respectively.

When the MME wants to deactivate all EPS bearer contexts of a PDN connection and thus disconnect the UE from the PDN, the MME shall include the EPS bearer identity of the default bearer associated to the PDN in the DEACTIVATE EPS BEARER CONTEXT REQUEST message. In this case, the MME shall not include the WLAN offload indication in the DEACTIVATE EPS BEARER CONTEXT REQUEST message, and if the UE receives the WLAN offload indication, the UE shall ignore the indication.

NOTE  1:  If the DEACTIVATE EPS BEARER CONTEXT REQUEST message contains the UAS services not allowed indication in the extended protocol configuration options IE, then the ESM cause value #29 "user authentication or authorization failed" is included in the DEACTIVATE EPS BEARER CONTEXT REQUEST message.

If no NAS signalling connection exists when the MME initiates the EPS bearer context deactivation, the ESM entity in the MME shall locally deactivate the EPS bearer context towards the UE without any peer-to-peer ESM signalling between the MME and the UE.

NOTE  2:  The EPS bearer context state(s) can be synchronized between the UE and the MME at the next EMM-IDLE to EMM-CONNECTED transition, e.g. during a service request or tracking area updating procedure.



Figure 6.4.4.2.1: EPS bearer context deactivation procedure

6.4.4.3  EPS bearer context deactivation accepted by the UE

Upon receipt of the DEACTIVATE EPS BEARER CONTEXT REQUEST message, the UE shall delete the EPS bearer context identified by the EPS bearer identity. After deactivating the identified EPS bearer context, the UE shall respond to the MME with the DEACTIVATE EPS BEARER CONTEXT ACCEPT.

If the EPS bearer identity indicated in the DEACTIVATE EPS BEARER CONTEXT REQUEST is that of the default bearer to a PDN, the UE shall delete all EPS bearer contexts associated to the PDN. After deactivating all EPS bearer contexts, the UE shall respond to the MME with the DEACTIVATE EPS BEARER CONTEXT ACCEPT.

Upon sending the DEACTIVATE EPS BEARER CONTEXT ACCEPT message, the UE shall enter the state BEARER CONTEXT INACTIVE. If due to the EPS bearer context deactivation only the PDN connection for emergency bearer services remains established, the UE shall consider itself attached for emergency bearer services only.

If the DEACTIVATE EPS BEARER CONTEXT REQUEST includes ESM cause  #39 "reactivation requested" and the EPS bearer context is a default EPS bearer context, and the UE provided an APN for the establishment of the PDN connection, the UE shall stop timer T3396 if it is running for the APN provided by the UE. The UE should then re-initiate the UE requested PDN connectivity procedure for the same APN as the deactivated default EPS bearer context to reactivate the EPS bearer context. If the UE did not provide an APN for the establishment of the PDN connection and the request type was different from "emergency" and from "handover of emergency bearer services", the UE shall stop the timer T3396 associated with no APN if it is running, and should re-initiate the UE requested PDN connectivity procedure without including an APN. Additionally, the UE should re-initiate the request(s) for dedicated bearer resources that have been activated on request of the UE and released as a result of this EPS bearer context deactivation procedure. If the DEACTIVATE EPS BEARER CONTEXT REQUEST message was received for an emergency PDN connection, the UE shall not stop the timer T3396 associated with no APN if it is running. The UE should then re-initiate the UE requested PDN connectivity procedure for the emergency PDN connection.

NOTE  1:  User interaction is necessary in some cases when the UE cannot re-activate the EPS bearer context(s) automatically.

NOTE  2:  The UE behaviour is not specified for the case where the DEACTIVATE EPS BEARER CONTEXT REQUEST includes ESM cause  #39 "reactivation requested" and the deactivated EPS bearer context was a dedicated EPS bearer context.

If the DEACTIVATE EPS BEARER CONTEXT REQUEST message contains a PTI value other than "no procedure transaction identity assigned" and "reserved" (see 3GPP  S  24.007  [12]), the UE uses the PTI to identify the UE requested bearer resource modification procedure or UE requested PDN disconnect procedure to which the EPS bearer context deactivation is related (see clause  6.5.4).

If the DEACTIVATE EPS BEARER CONTEXT REQUEST message contains a PTI value other than "no procedure transaction identity assigned" and "reserved" (see 3GPP  S  24.007  [12]), the UE shall release the traffic flow aggregate description associated to the PTI value provided.

If the ESM cause value is #26 "insufficient resources", the network may include a value for timer T3396 in the DEACTIVATE EPS BEARER CONTEXT REQUEST message. The UE shall take different actions depending on the timer value received for timer T3396 (if the UE is configured for dual priority, exceptions are specified in clause  6.5.5; if the UE is a UE configured to use AC11        15 in selected PLMN, exceptions are specified in clause  6.3.5):

i)  if the timer value indicates neither zero nor deactivated, the UE shall stop timer T3396 associated with the corresponding APN, if it is running. The UE shall start timer T3396 with received value and not send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in clause  6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for the same APN until timer T3396 expires or the timer T3396 is stopped. If the UE did not provide an APN for the establishment of the PDN connection and the request type was different from "emergency" and from "handover of emergency bearer services", the UE shall stop timer T3396 associated with no APN, if it is running. The UE shall start timer T3396 with the received value and not send another PDN CONNECTIVITY REQUEST message without an APN and with request type different from "emergency" and from "handover of emergency bearer services", or another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in clause  6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without an APN provided by the UE, until timer T3396 expires or timer T3396 is stopped. The UE shall not stop timer T3396 upon a PLMN change or inter-system change;

ii)  if the timer value indicates that this timer is deactivated, the UE shall not send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in clause  6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for the same APN until the UE is switched off or the USIM is removed, or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message for the same APN from the network or a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause  #39 "reactivation requested" for a default EPS bearer context for the same APN from the network. If the UE did not provide an APN for the establishment of the PDN connection and the request type was different from "emergency" and from "handover of emergency bearer services", the UE shall not send another PDN CONNECTIVITY REQUEST message without an APN and with request type different from "emergency" and from "handover of emergency bearer services", or another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in clause  6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without APN provided by the UE , until the UE is switched off or the USIM is removed, or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message for a non-emergency PDN connection established without an APN provided by the UE, or a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause #39 "reactivation requested" for a default EPS bearer context of a non-emergency PDN connection established without an APN provided by the UE. The timer T3396 remains deactivated upon a PLMN change or inter-system change; and

iii)  if the timer value indicates zero, the UE:

-  shall stop timer T3396 associated with the corresponding APN, if running, and may send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for the same APN; and

-  if the UE did not provide an APN for the establishment of the PDN connection and the request type was different from "emergency" and from "handover of emergency bearer services", the UE shall stop timer T3396 associated with no APN, if running, and may send another PDN CONNECTIVITY REQUEST message without an APN, or another BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without an APN provided by the UE.

If the timer T3396 is running when the UE enters state EMM-DEREGISTERED, the UE remains switched on, and the USIM in the UE remains the same, then timer T3396 is kept running until it expires or it is stopped.

If the UE is switched off when the timer T3396 is running, the UE shall behave as follows when the UE is switched on and the USIM in the UE remains the same:

-  let t1 be the time remaining for T3396 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1        t. If t1 is equal to or less than t, then the timer need not be restarted. If the UE is not capable of determining t, then the UE shall restart the timer with the value t1;

-  if prior to switch off, timer T3396 was running for a specific APN, because a PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message containing the low priority indicator set to "MS is configured for NAS signalling low priority" was rejected with timer T3396, and if timer T3396 is restarted at switch on, then the UE configured for dual priority shall handle session management requests as indicated in clause  6.5.5; and

-  if prior to switch off timer T3396 was running because a PDN CONNECTIVITY REQUEST without APN sent together with an ATTACH REQUEST message containing the low priority indicator set to "MS is configured for NAS signalling low priority" was rejected with timer T3396, and if timer T3396 is restarted at switch on, then the UE configured for dual priority shall handle session management requests as indicated in clause  6.5.5.

If the T3396 IE is not included, the UE shall proceed with deactivation procedure and then send DEACTIVATE EPS BEARER CONTEXT ACCEPT message.

Upon receipt of the DEACTIVATE EPS BEARER CONTEXT ACCEPT message, the MME shall enter the state BEARER CONTEXT INACTIVE and stop the timer T3495.

6.4.4.4  Abnormal cases in the UE

The following abnormal case can be identified:

a)  UE is requested to deactivate a default EPS bearer context of the last PDN connection:

  If EMM-REGISTERED without PDN connection is not supported by the UE or the MME, and the UE determines that the EPS bearer indicated in the DEACTIVATE EPS BEARER CONTEXT REQUEST message is the default EPS bearer of the last PDN connection that the UE has, then the UE shall respond by performing a detach procedure. Additionally, the UE should perform an attach procedure.

  If EMM-REGISTERED without PDN connection is supported by the UE and the MME, the UE shall proceed with the deactivation procedure as specified in clause  6.4.4.3.

NOTE:  User interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s), if any, automatically.

6.4.4.5  Abnormal cases on the network side

The following abnormal cases can be identified:

a)  Expiry of timer T3495:

  On the first expiry of the timer T3495, the MME shall resend the DEACTIVATE EPS BEARER CONTEXT REQUEST and shall reset and restart timer T3495. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3495, the MME shall abort the procedure and deactivate the EPS bearer context locally without any peer-to-peer ESM signalling between the MME and the UE.

b)  Collision of UE requested PDN disconnect procedure and EPS bearer context deactivation:

  When the MME receives a PDN DISCONNECT REQUEST message during the EPS bearer context deactivation procedure, and the EPS bearer indicated in the DEACTIVATE EPS BEARER CONTEXT REQUEST message is a dedicated EPS bearer belonging to the PDN connection the UE wants to disconnect, the MME shall proceed with both procedures. If the EPS bearer indicated in the DEACTIVATE EPS BEARER CONTEXT REQUEST message is the default EPS bearer, the MME shall proceed with the EPS bearer context deactivation procedure.

6.4.4.6  Local EPS bearer context deactivation without NAS signalling

The UE and the MME deactivate EPS bearer contexts locally without peer-to-peer ESM signalling in the following cases:

1)  during the service request procedure, if the E-UTRAN establishes the user plane radio bearers for one or more EPS bearer contexts but not for all the EPS bearer contexts, e.g. due to radio access control (see clause  5.6.1.4 for details);

1a)  during the resume of NAS signalling connection procedure as specified in clause  5.3.1.3, if one or more but not all the suspended user plane radio bearers are resumed;

2)  during the tracking area updating procedure but the network established the user plane radio bearers due to downlink pending data, if the E-UTRAN establishes the user plane radio bearers for one or more EPS bearer contexts but not for all the EPS bearer contexts indicated active by both UE and network;

NOTE  1:  The synchronisation of the EPS bearers, for which the user plane radio bearers need to be established, indicated in EPS bearer context status information element in TRACKING AREA UPDATE ACCEPT message is not applicable in item 2.

3)  during handover, if the target E-UTRAN does not establish all the user plane radio bearers for the UE;

4)  if the E-UTRAN releases one or more user plane radio bearers but not all the user plane radio bearers of the UE due to E-UTRAN specific reasons; or

5)  if triggered by an NBIFOM procedure (see 3GPP  S  24.161  [36]), for an NBIFOM multi-access PDN connection.

For cases 1) to 4), based on the indication from the lower layers, the UE and the MME shall locally deactivate the EPS bearer contexts for which no user plane radio bearers are set up.

NOTE  2:  The above cases 1) to 4) do not apply for the UE when an RRC connection release occurs. The lower layers in the UE provide the user plane radio bearer context status to the ESM sublayer when a change in the user plane radio bearers is detected by the lower layers including establishment and release of user plane radio bearers for the UE in connected mode.

NOTE  3:  The above cases 1) to 4) do not apply for the MME when the S1 release procedure occurs as specified in 3GPP  S  23.401  [10]).

If due to any of the cases described above the UE locally deactivates a default EPS bearer context, the UE shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context.

If the UE locally deactivates the EPS bearer context(s) of the last remaining PDN connection, and EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the UE shall perform a local detach and enter state EMM-DEREGISTERED. If this occurs during a service request procedure for CS fallback, the UE shall reselect to GERAN or UTRAN and continue with the CS service, otherwise the UE shall initiate an attach procedure.

If the UE locally deactivates the EPS bearer context(s) of the last remaining PDN connection, and EMM-REGISTERED without PDN connection is supported by the UE and the MME, the UE shall enter state EMM-REGISTERED.

If the UE locally deactivates the EPS bearer context(s) of the last remaining PDN connection for non-emergency bearer services and only the PDN connection for emergency bearer services remains established, the UE shall consider itself attached for emergency bearer services only.

The MME shall deactivate the GBR EPS bearer contexts locally without peer-to-peer ESM signalling, when the MME performs locally the release of the S1AP signalling connection due to the S1AP signalling connection is lost. All non-GBR EPS bearers established are preserved in the MME and in the PDN GW.

If the EUTRAN requests the MME to release the S1AP signalling connection, the MME shall deactivate or preserve the GBR EPS bearer contexts according to 3GPP  S  23.401  [10], clause  5.3.5. All non-GBR EPS bearer contexts established are preserved in the MME and in the PDN GW.

NOTE  4:  The UE and the MME will synchronize the EPS bearer contexts subsequently during the next service request procedure, tracking area updating procedure or routing area updating procedure.

If due to any of the cases described above the MME locally deactivates a default EPS bearer context, the MME shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the UE.

If the MME locally deactivates the EPS bearer context(s) of the last remaining PDN connection, and EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the MME shall perform a local detach and enter state EMM-DEREGISTERED.

If the MME locally deactivates the EPS bearer context(s) of the last remaining PDN connection, and EMM-REGISTERED without PDN connection is supported by the UE and the MME, the MME shall enter state EMM-REGISTERED.

For EPS bearer context deactivation procedure initiated by the network, if no NAS signalling connection exists, the MME locally deactivates the EPS bearer context(s) without peer-to-peer ESM signalling In the case of reactivation requested, the MME can perform this local deactivation only when the EMM-entity in the network was unable to re-establish the NAS signalling connection. The EPS bearer context deactivation procedure is not initiated by the network when the MME disconnects the UE from the last remaining PDN to which it is connected and EMM-REGISTERED without PDN connection is not supported by the UE or the MME. In this case, the MME initiates a network initiated detach procedure.

If the MME locally deactivates the EPS bearer context(s) of the last remaining PDN connection for non-emergency bearer services and only the PDN connection for emergency bearer services remains established for the UE, the MME shall consider the UE to be attached for emergency bearer services only.

6.5  UE requested ESM procedures

6.5.0  General

The UE   's maximum number of active EPS bearer contexts in a PLMN is determined by whichever is the lowest of the maximum number of EPS bearer identities allowed by the protocol (as specified in 3GPP  S  24.007  [12] clause  11.2.3.1.5), the PLMN   's maximum number of EPS bearer contexts in S1 mode and the UE   's implementation-specific maximum number of EPS bearer contexts.

NOTE  1:  Clauses  6.5.1.4 and 6.5.3.4 specify how the UE determines the PLMN   's maximum number of EPS bearer contexts in S1 mode.

In earlier versions of the protocol, the maximum number of simultaneously active EPS bearer contexts was limited by lower layer protocols to 8.

In the present version of the protocol, the UE and the network may support a maximum number of 15 EPS bearer contexts.

A UE supporting signalling for a maximum number of 15 EPS bearer contexts shall support the extended range or EPS bearer identities from 0 to 15 (as specified in 3GPP  S  24.007  [12] clause  11.2.3.1.5). The UE indicates support of signalling for a maximum number of 15 EPS bearer contexts by setting the 15 bearers bit in the UE Network Capability IE.

A network supporting signalling for a maximum number of 15 EPS bearer contexts shall support the extended range or EPS bearer identities from 0 to 15 (as specified in 3GPP  S  24.007  [12] clause  11.2.3.1.5). The network indicates support of signalling for a maximum number of 15 EPS bearer contexts by setting the 15 bearers bit in the EPS network feature support IE.

NOTE  2:  A UE and a network not supporting signalling for a maximum number of 15 EPS bearer contexts will treat the EPS bearer identity values 1 to 4 as    'reserved   ' values.

For a UE in NB-S1 mode, the UE   's implementation-specific maximum number of active user plane radio bearers is 2 (as defined in 3GPP  S  36.300  [20]) when the UE sets the Multiple DRB support bit to "Multiple DRB supported" during attach or tracking area updating procedures, and 1 otherwise.

Upon an inter-system change from N1 mode to NB-S1 mode in EMM-IDLE mode for the UE operating in single-registration mode, if:

a)  the number of active default EPS bearer contexts in the UE is larger than the UE   's implementation-specific maximum number of active user plane radio bearers; and

b)  the UE is using user plane CIoT EPS optimization;

the UE shall locally deactivate at least one default EPS bearer context such that the total number of active default EPS bearer contexts that remained does not exceed the UE   's implementation-specific maximum number of active user plane radio bearers. In this case, choosing which EPS bearer context to deactivate is implementation specific. The UE shall then include the EPS bearer context status IE in the TRACKING AREA UPDATE REQUEST message.

Upon the inter-system change from A/Gb mode or Iu mode to S1 mode, for any PDN connection that has been transferred, if the PDN connection is not associated with a PDU session ID and the UE supporting N1 mode decides to enable the transfer of the PDN connection from S1 mode to N1 mode, the UE may first initiate the UE requested PDN disconnection procedure and then the UE requested PDN connectivity procedure for such PDN connection(s). As an implementation option, the UE may deactivate all EPS bearer contexts for such PDN connection(s) locally, include the EPS bearer context status IE in the TRACKING AREA UPDATE REQUEST message of the tracking area updating procedure upon inter-system change from A/Gb mode or Iu mode to S1 mode, and then initiate UE requested PDN connectivity procedure for such PDN connection(s).

NOTE  3:  Upon the inter-system change from A/Gb mode or Iu mode to S1 mode, if a PDN connection does not support interworking with 5GS and the UE determines that the PLMN or the APN cannot support interworking with 5GS, it is recommended that a UE does not release and re-establish the PDN connection in order to enable interworking with 5GS for the PDN connection. Whether and how the UE determines the PLMN or the APN can support interworking with 5GS is implementation specific.

6.5.1  UE requested PDN connectivity procedure

6.5.1.1  General

The purpose of the UE requested PDN connectivity procedure is for a UE to request the setup of a default EPS bearer to a PDN. The UE requests connectivity to a PDN by sending a PDN CONNECTIVITY REQUEST message to the network. If accepted by the network, this procedure initiates the establishment of a default EPS bearer context. If EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the procedure is used either to establish the first default bearer by including the PDN CONNECTIVITY REQUEST message into the initial attach message, or to establish subsequent default bearers to additional PDNs in order to allow the UE simultaneous access to multiple PDNs by sending the message stand-alone. If EMM-REGISTERED without PDN connection is supported by the UE and the MME, the procedure is used to establish the first or subsequent default bearers to a PDN or additional PDNs by sending the PDN CONNECTIVITY REQUEST message stand-alone.

If the UE requests PDN connectivity for emergency bearer services, the MME shall not check for regional restrictions or subscription restrictions when processing the PDN CONNECTIVITY REQUEST message.

If there is already a PDN connection for emergency bearer services established, the UE shall not request an additional PDN connection for emergency bearer services.

A UE attached for emergency bearer services shall not request a PDN connection to any other PDN.

A UE attached for access to RLOS shall not request any additional PDN connection for RLOS nor any PDN connection to any other PDN.

The UE may also initiate the UE requested PDN connectivity procedure to add 3GPP access to the PDN connection which is already established over WLAN as specified in the clause  6.2.2 of 3GPP  S  23.161  [34].

The UE may also initiate the UE requested PDN connectivity procedure to transfer an existing PDU session in the 5GS to EPS as specified in 3GPP  S  24.501  [54].

If the UE supports the device triggering short message as specified in 3GPP  S  23.040  [57] and supports non-IP PDN type, then upon receiving from ESMS entity as specified in 3GPP  S  24.007  [12] an indication requesting establishment of a PDN connection for non-IP PDN type using the default APN as specified in 3GPP  S  24.011  [13A], the UE shall initiate the UE requested PDN connectivity procedure in order to request connectivity to a PDN using the default APN and non-IP PDN type.

6.5.1.2  UE requested PDN connectivity procedure initiation

In order to request connectivity to a PDN, the UE shall send a PDN CONNECTIVITY REQUEST message to the MME, start timer T3482 and enter the state PROCEDURE TRANSACTION PENDING (see example in figure  6.5.1.2.1).

When the PDN CONNECTIVITY REQUEST message is sent together with an ATTACH REQUEST message, the UE shall not start timer T3482 and shall not include the APN.

NOTE  1:  If the UE needs to provide protocol configuration options which require ciphering or provide an APN, or both, during the attach procedure, the ESM information transfer flag is included in the PDN CONNECTIVITY REQUEST. The MME then at a later stage in the PDN connectivity procedure initiates the ESM information request procedure in which the UE can provide the MME with protocol configuration options or APN or both.

In order to request a PDN connection for emergency bearer services or for access to RLOS, the UE shall not include an APN in the PDN CONNECTIVITY REQUEST message or, when applicable, in the ESM INFORMATION RESPONSE message.

In order to request connectivity to a PDN using the default APN, the UE includes the access point name IE in the PDN CONNECTIVITY REQUEST message or, when applicable, in the ESM INFORMATION RESPONSE message, according to the following conditions:

-  if use of a PDN using the default APN requires PAP/CHAP, then the UE should include the Access point name IE; and

-  in all other conditions, the UE need not include the Access point name IE.

In order to request connectivity to an additional PDN using a specific APN, the UE shall include the requested APN in the PDN CONNECTIVITY REQUEST message or, when applicable, in the ESM INFORMATION RESPONSE message.

NOTE  2:  The requested APN in the PDN CONNECTIVITY REQUEST or ESM INFORMATION RESPONSE message is for UAS services when the request to establish a PDN connection for UAS services is requested by the upper layers.

NOTE  3:  By configuration provided by the operator, the UE supporting UAS services knows that an APN is for UAS services when the request to establish a PDN connection for UAS services is requested by the upper layers and how this UE configuration is achieved is implementation specific.

In the PDN type IE the UE shall either indicate the IP version capability of the IP stack associated with the UE or non IP or Ethernet as specified in clause  6.2.2.

If the PDN type value of the PDN type IE is set to IPv4 or IPv6 or IPv4v6 and the UE indicates "Control plane CIoT EPS optimization supported" in the UE network capability IE of the ATTACH REQUEST message, the UE may include the Header compression configuration IE in the PDN CONNECTIVITY REQUEST message.

When the connectivity to a PDN is to be transferred from a non-3GPP access network to the 3GPP access network, the UE shall set the PDN type value of the PDN type IE to:

-  IPv4, if the previously allocated home address information consists of an IPv4 address only;

-  IPv6, if the previously allocated home address information consists of an IPv6 prefix only; or

-  IPv4v6, if the previously allocated home address information consists of both an IPv4 address and an IPv6 prefix.

The UE shall set the request type to "initial request" when the UE is establishing a new PDN connectivity to a PDN in an attach procedure or in a stand-alone PDN connectivity procedure or when the UE requests establishment of a PDN connection as a user-plane resource of an MA PDU session to be established. The UE shall set the request type to "emergency" when the UE is requesting a new PDN connectivity for emergency bearer services. The UE shall set the request type to "handover" when the connectivity to a PDN is to be transferred from a non-3GPP access network to the 3GPP access network, when the UE initiates the procedure to add 3GPP access to the PDN connection which is already established over WLAN, when the UE supporting N1 mode requests transfer of an existing non-emergency PDU session in 5GS or when the UE requests establishment of a PDN connection as a user-plane resource of an already established MA PDU session. The UE shall set the request type to "handover of emergency bearer services" when a PDN connection for emergency bearer services is to be transferred from a WLAN to the 3GPP access network or when the UE supporting N1 mode requests transfer of an existing emergency PDU session in 5GS. The UE shall set the request type to "RLOS" when the UE is requesting a new PDN connection for RLOS.

If the UE supports DSMIPv6, the UE may include a request for obtaining the IPv6 address and optionally the IPv4 address of the home agent in the Protocol configuration options IE in the PDN CONNECTIVITY REQUEST message. The UE may also include a request for obtaining the IPv6 Home Network Prefix. The UE shall request the IPv6 Home Network Prefix only if the UE has requested the home agent IPv6 address. The requested home agent address(es) and the Home Network Prefix are related to the APN the UE requested connectivity for.

The UE may set the ESM information transfer flag in the PDN CONNECTIVITY REQUEST message to indicate that it has ESM information, i.e. protocol configuration options, APN, or both, that needs to be sent after the NAS signalling security has been activated between the UE and the MME.

If the UE supports A/Gb mode or Iu mode or both, the UE shall indicate the support of the network requested bearer control procedures (see 3GPP  S  24.008  [13]) in A/Gb mode or Iu mode in the protocol configuration options IE.

If the UE supports N1 mode and the request type is:

a)  "initial request" or "emergency", the UE shall generate a PDU session ID, associate the PDU session ID with the PDN connection that is being established, and include the PDU session ID in the protocol configuration options IE or the extended protocol configuration options IE;

b)  "handover" or "handover of emergency bearer services", and the UE requests:

1)  transfer of an existing PDU session in 5GS or establishment of a PDN connection as a user-plane resource of an already established MA PDU session, the UE shall associate the PDU session ID of the PDU session with the PDN connection that is being established for the existing PDU session and include the PDU session ID in the protocol configuration options IE or the extended protocol configuration options IE; or

2)  transfer of an existing PDN connection in a non-3GPP access connected to the EPC and a PDU session ID is associated with the existing PDN connection, the UE shall include the PDU session ID in the protocol configuration options IE or the extended protocol configuration options IE and associate the PDU session ID with the PDN connection that is being established. If the existing PDN connection is a non-emergency PDN connection and an S-NSSAI and a related PLMN ID are associated with the existing PDN connection, the UE shall in addition associate the S-NSSAI and the related PLMN ID with the PDN connection that is being established.

NOTE  4:  The UE can also have an S-NSSAI and the related PLMN ID associated with the PDN connection, if the S-NSSAI and the related PLMN ID was associated with the existing PDN connection in a non-3GPP access connected to the EPC as specified in 3GPP  S  24.302  [48]. The UE stores this S-NSSAI and the related PLMN ID for later use during inter-system change from S1 mode to N1 mode.

If the N1 mode capability is disabled, the UE may apply a) and b.2) above for service continuity support at inter-system change from S1 mode to N1 mode once its N1 mode capability is enabled again.

If the UE supporting N1 mode supports receiving QoS rules with the length of two octets or QoS flow descriptions with the length of two octets via the extended protocol configuration options IE, the UE shall include the QoS rules with the length of two octets support indicator or the QoS flow descriptions with the length of two octets support indicator, respectively, in the protocol configuration options IE or the extended protocol configuration options IE.

If the UE supports providing PDU session ID in the protocol configuration options IE or the extended protocol configuration option IE when its N1 mode capability is disabled, the UE shall include the QoS rules with the length of two octets support indicator or the QoS flow descriptions with the length of two octets support indicator, respectively, in the protocol configuration options IE or the extended protocol configuration options IE.

Protocol configuration options provided in the ESM INFORMATION RESPONSE message replace any protocol configuration options provided in the PDN CONNECTIVITY REQUEST message.

When the UE initiates the procedure to add 3GPP access to the PDN connection that is already established over WLAN, the UE shall provide the same APN as that of the PDN connection established over WLAN in the PDN connectivity procedure as specified in the clause  6.2.2 of 3GPP  S  23.161  [34].

If the UE supports APN rate control, the UE shall include an APN rate control support indicator and an additional APN rate control for exception data support indicator in the protocol configuration options IE or extended protocol configuration options IE.

If the UE supports DNS over (D)TLS (see 3GPP  S  33.501  [24]), the UE shall include the Protocol configuration options IE or the Extended protocol configuration options IE in the PDN CONNECTIVITY REQUEST or ESM INFORMATION RESPONSE message and include the DNS server security information indicator and optionally, if the UE wishes to indicate which security protocol type(s) are supported by the UE, it may include the DNS server security protocol support.

NOTE  5:  Support of DNS over (D)TLS is based on the informative requirements as specified in 3GPP  S  33.501  [24].

When the UE supporting UAS services initiates a UE requested PDN connectivity procedure for UAS services during an attach procedure, the UE:

a)  shall create the service-level-AA container with the length of two octets. In the service-level-AA container with the length of two octets, the UE:

1)  shall include the service-level device ID parameter set to the UE   's CAA-level UAV ID;

2)  shall include the service-level-AA server address parameter set to the USS address, if it is provided by the upper layers;

3)  shall include the service-level-AA payload parameter set to the UUAA payload and the service-level-AA payload type parameter set to "UUAA payload", if the UUAA payload is provided by the upper layer; and

4)  shall include the service-level-AA payload parameter set to the C2 authorization payload and the service-level-AA payload type parameter set to "C2 authorization payload", if the C2 authorization procedure is requested; and

NOTE  6:  The C2 authorization payload in the service-level-AA payload parameter can include the pairing information for C2 communication and the flight authorization information.

b)  shall include the created service-level-AA container with the length of two octets in the extended protocol configuration options IE of the PDN CONNECTIVITY REQUEST or ESM INFORMATION RESPONSE message.

When the UE supporting UAS services initiates a UE requested PDN connectivity procedure for C2 communication after the completion of the attach procedure, the UE:

a)  shall create the service-level-AA container with the length of two octets. In the service-level-AA container with the length of two octets, the UE:

1)  shall include the service-level device ID parameter set to the UE   's CAA-level UAV ID; and

2)  shall include the service-level-AA payload parameter set to the C2 authorization payload and the service-level-AA payload type parameter set to "C2 authorization payload"; and

NOTE  7:  The C2 authorization payload in the service-level-AA payload parameter can include the pairing information for C2 communication and the flight authorization information.

b)  shall include the created service-level-AA container with the length of two octets in the extended protocol configuration options IE of the PDN CONNECTIVITY REQUEST message.

If the UE supports provisioning of ECS configuration information to the EEC in the UE, then the UE may include the ECS configuration information provisioning support indicator in the Protocol configuration options IE or the Extended protocol configuration options IE in the PDN CONNECTIVITY REQUEST message.



Figure 6.5.1.2.1: UE requested PDN connectivity procedure

6.5.1.3  UE requested PDN connectivity procedure accepted by the network

Upon receipt of the PDN CONNECTIVITY REQUEST message, the MME checks whether the ESM information transfer flag is included. If the flag is included the MME waits for completion of the ESM information request procedure before proceeding with the PDN connectivity procedure. The MME then checks if connectivity with the requested PDN can be established. If no requested APN is included in the PDN CONNECTIVITY REQUEST message or the ESM INFORMATION RESPONSE message and the request type is different from "emergency" and from "handover of emergency bearer services" and from "RLOS", the MME shall use the default APN as the requested APN. If the request type is "emergency" or "handover of emergency bearer services", the MME shall use the APN configured for emergency bearer services or select the statically configured PDN GW for unauthenticated UEs, if applicable. If the request type is "RLOS", the MME shall use the APN configured for RLOS.

If the network receives a PDN CONNECTIVITY REQUEST message with the same combination of APN and PDN type as an already existing PDN connection, and multiple PDN connections for a given APN are allowed, the network retains the existing EPS bearer contexts for the PDN connection and proceeds with the requested PDN connectivity procedure.

If the lower layers provide a GW Transport Layer Address value identifying a L-GW together with the PDN CONNECTIVITY REQUEST message and a PDN connection is established as a LIPA PDN connection due to the PDN CONNECTIVITY REQUEST message, then the MME shall store the GW Transport Layer Address value as the P-GW address in the EPS bearer context of the LIPA PDN connection.

If the lower layers provide a SIPTO L-GW Transport Layer Address value identifying a L-GW together with the PDN CONNECTIVITY REQUEST message and a PDN connection is established as a SIPTO at the local network PDN connection due to the PDN CONNECTIVITY REQUEST message, then the MME shall store the SIPTO L-GW Transport Layer Address value as the P-GW address in the EPS bearer context of the SIPTO at the local network PDN connection.

If the lower layers provide a LHN-ID value together with the PDN CONNECTIVITY REQUEST message and a PDN connection is established as a SIPTO at the local network PDN connection due to the PDN CONNECTIVITY REQUEST message, then the MME shall store the LHN-ID value in the EPS bearer context of the SIPTO at the local network PDN connection.

NOTE  1:  The receipt of a LHN-ID value during the establishment of the PDN connection, during tracking area updating procedure or during inter-MME handover can be used as an indication by the MME that the SIPTO at the local network PDN connection is established to a stand-alone GW (see 3GPP  S  23.401  [10]).

If connectivity with the requested PDN is accepted by the network, the MME shall initiate the default EPS bearer context activation procedure (see clause  6.4.1).

If connectivity with the requested PDN is accepted and the network considers this PDN connection a LIPA PDN connection, then subject to operator policy the MME shall include in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message the Connectivity type IE indicating "the PDN connection is considered a LIPA PDN connection".

If connectivity with the requested PDN is accepted, but with a restriction of IP version (i.e. both an IPv4 address and an IPv6 prefix is requested, but only one particular IP version, or only single IP version bearers are supported/allowed by the network), ESM cause #50 "PDN type IPv4 only allowed", #51 "PDN type IPv6 only allowed", or #52 "single address bearers only allowed", respectively, shall be included in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message.

If connectivity with the requested PDN is accepted and the UE provided the Header compression configuration IE in the PDN CONNECTIVITY REQUEST message, the MME may include the Header compression configuration IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message. Furthermore, if the MME decides that the associated PDN connection is only for control plane CIoT EPS optimization (see clause  5.3.15), the MME shall include the Control plane only indication in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message.

Upon receipt of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, the UE shall stop timer T3482 and enter the state PROCEDURE TRANSACTION INACTIVE. The UE should ensure that the procedure transaction identity (PTI) assigned to this procedure is not released immediately. The way to achieve this is implementation dependent. While the PTI value is not released, the UE regards any received ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message with the same PTI value as a network retransmission (see clause  7.3.1).

Upon receipt of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message with the Connectivity type IE indicating "the PDN connection is considered a LIPA PDN connection", the UE provides an indication to the upper layers that the connectivity is provided by a LIPA PDN connection.

Upon receipt of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, if the 3GPP PS data off UE status is "activated", the UE behaves as described in clause  6.3.10.

Upon receipt of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, if the SCEF or P-GW indicates acceptance of use of Reliable Data Service to transfer data for the PDN connection, the UE behaves as described in clause  6.3.11.

Upon receipt of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, if an S-NSSAI and the PLMN ID that this S-NSSAI relates to are provided in the protocol configuration options IE or extended protocol configuration options IE, the UE shall delete the stored S-NSSAI and the PLMN ID that this S-NSSAI relates to, if any, and shall store the S-NSSAI and the PLMN ID this S-NSSAI relates to provided in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message and the associated PLMN ID along with the corresponding PDU session ID that the UE provided in the PDN CONNECTIVITY REQUEST message. The usage of the PDU session ID and the corresponding S-NSSAI with the associated PLMN ID is specified in 3GPP  S  24.501  [54]. Additionally, the UE shall remove the S-NSSAI, if present, from the rejected NSSAI as specified in 3GPP  S  24.501  [54] clause  4.6.2.2.

Upon receipt of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message with a session-AMBR and QoS rule(s), which correspond to the default EPS bearer of the PDN connectivity being activated, in the protocol configuration options IE or the extended protocol configuration options IE, the UE stores the session-AMBR and QoS rule(s) for use during inter-system change from S1 mode to N1 mode.

If the UE requests the PDN type "IPv4v6", receives the selected PDN type set to "IPv4" and the ESM cause value #50 "PDN type IPv4 only allowed", the UE shall not automatically send another PDN CONNECTIVITY REQUEST message to the same APN (or no APN, if no APN was indicated by the UE) to obtain a PDN type different from the one allowed by the network until:

-  the UE is registered to a new PLMN;

-  the UE is switched off; or

-  the USIM is removed.

If the UE requests the PDN type "IPv4v6", receives the selected PDN type set to "IPv6" and the ESM cause value #51 "PDN type IPv6 only allowed", the UE shall not automatically send another PDN CONNECTIVITY REQUEST message to the same APN (or no APN, if no APN was indicated by the UE) to obtain a PDN type different from the one allowed by the network until:

-  the UE is registered to a new PLMN;

-  the UE is switched off; or

-  the USIM is removed.

NOTE  2:  For the ESM cause values #50 "PDN type IPv4 only allowed" and #51 "PDN type IPv6 only allowed", re-attempt in A/Gb, Iu, or N1 mode for the same APN (or no APN, if no APN was indicated by the UE) is only allowed using the PDN type(s) indicated by the network.

6.5.1.4  UE requested PDN connectivity procedure not accepted by the network

6.5.1.4.1  General

If connectivity with the requested PDN cannot be accepted by the network, the MME shall send a PDN CONNECTIVITY REJECT message to the UE. The message shall contain the PTI and an ESM cause value indicating the reason for rejecting the UE requested PDN connectivity.

The ESM cause IE typically indicates one of the following ESM cause values:

#8:  operator determined barring;

#26:  insufficient resources;

#27:  missing or unknown APN;

#28:  unknown PDN type;

#29:  user authentication or authorization failed;

#30:  request rejected by Serving GW or PDN GW;

#31:  request rejected, unspecified;

#32:  service option not supported;

#33:  requested service option not subscribed;

#34:  service option temporarily out of order;

#35:  PTI already in use;

#38:  network failure;

#50:  PDN type IPv4 only allowed;

#51:  PDN type IPv6 only allowed;

#53:  ESM information not received;

#54:  PDN connection does not exist;

#55:  multiple PDN connections for a given APN not allowed;

#57:  PDN type IPv4v6 only allowed;

#58:  PDN type non IP only allowed;

#61:  PDN type Ethernet only allowed;

#65:  maximum number of EPS bearers reached;

#66:  requested APN not supported in current RAT and PLMN combination;

#95        111:  protocol errors;

#112:  APN restriction value incompatible with active EPS bearer context;

#113:  Multiple accesses to a PDN connection not allowed.

The network may include a Back-off timer value IE in the PDN CONNECTIVITY REJECT message. If the ESM cause value is #26 "insufficient resources" and the PDN CONNECTIVITY REQUEST message was received via a NAS signalling connection established with RRC establishment cause "High priority access AC 11        15" or the request type in the PDN CONNECTIVITY REQUEST message was set to "emergency" or "handover of emergency bearer services", the network shall not include a Back-off timer value IE.

If the Back-off timer value IE is included and the ESM cause value is different from #26 "insufficient resources", #50 "PDN type IPv4 only allowed", #51 "PDN type IPv6 only allowed", #57 "PDN type IPv4v6 only allowed", #58 "PDN type non IP only allowed", #61 "PDN type Ethernet only allowed", and #65 "maximum number of EPS bearers reached", the network may include the Re-attempt indicator IE to indicate:

-  whether the UE is allowed to attempt a PDP context activation procedure in the PLMN for the same APN in A/Gb or Iu mode or a PDU session establishment procedure in the PLMN for the same APN in N1 mode; and

-  whether another attempt in A/Gb and Iu mode, in S1 mode or in N1 mode is allowed in an equivalent PLMN.

If the ESM cause value is #50 "PDN type IPv4 only allowed", #51 "PDN type IPv6 only allowed", #57 "PDN type IPv4v6 only allowed", #58 "PDN type non IP only allowed" or #61 "PDN type Ethernet only allowed", the network may include the Re-attempt indicator IE without Back-off timer value IE to indicate whether the UE is allowed to attempt a PDN connectivity procedure in an equivalent PLMN for the same APN in S1 mode using the same PDN type.

If the ESM cause value is #66 "requested APN not supported in current RAT and PLMN combination", the network may include the Re-attempt indicator IE without Back-off timer value IE to indicate whether the UE is allowed to attempt a PDN connectivity procedure in an equivalent PLMN for the same APN in S1 mode.

Upon receipt of the PDN CONNECTIVITY REJECT message, the UE shall stop timer T3482 and enter the state PROCEDURE TRANSACTION INACTIVE.

If the PDN CONNECTIVITY REJECT message is due to an ESM failure notified by EMM layer (i.e., EMM cause #19 "ESM failure" included in an ATTACH REJECT message), the UE may include a different APN in the PDN CONNECTIVITY REQUEST message.

NOTE  1:  When receiving EMM cause #19 "ESM failure", coordination is required between the EMM and ESM sublayers in the UE to notify the ESM failure.

If the PDN CONNECTIVITY REQUEST message was sent with request type set to "emergency" or "handover of emergency bearer services" in a stand-alone PDN connectivity procedure and the UE receives a PDN CONNECTIVITY REJECT message, then the UE may:

a)  inform the upper layers of the failure to establish the emergency bearer; or

NOTE  2:  This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP  S  24.229  [13D] can result in the emergency call being attempted to another IP-CAN.

b)  detach locally, if not detached already, attempt EPS attach for emergency bearer services.

If the PDN CONNECTIVITY REQUEST message was sent with PDN type set to "Ethernet" and the UE receives a PDN CONNECTIVITY REJECT message with ESM cause #58 "PDN type non IP only allowed", then the UE may attempt a PDN connectivity procedure with the non-IP PDN type.

If the PDN CONNECTIVITY REJECT message contains the UAS services not allowed indication parameter in the extended protocol configuration options IE and the UE has not provided its CAA-level UAV ID to the network, the UE shall not send another PDN CONNECTIVITY REQUEST message for UAS services without providing its CAA-level UAV ID to the network.

NOTE  3:  If the PDN CONNECTIVITY REJECT message contains the UAS services not allowed indication parameter in the extended protocol configuration options IE, the ESM cause value #29 "user authentication or authorization failed" is included in the PDN CONNECTIVITY REJECT message.

6.5.1.4.2  Handling of network rejection due to ESM cause #26

If the ESM cause value is #26 "insufficient resources" and the Back-off timer value IE is included, the UE shall ignore the Re-attempt indicator IE provided by the network, if any, and behave as follows:

1)  if the PDN CONNECTIVITY REQUEST message was sent standalone, the UE shall take different actions depending on the timer value received for timer T3396 in the Back-off timer value IE (if the UE is configured for dual priority, exceptions are specified in clause  6.5.5; if the UE is a UE configured to use AC11        15 in selected PLMN, exceptions are specified in clause  6.3.5):

i)  if the timer value indicates neither zero nor deactivated and an APN was included in the PDN CONNECTIVITY REQUEST message, the UE shall stop timer T3396 associated with the corresponding APN, if it is running. If the timer value indicates neither zero nor deactivated, no APN was included in the PDN CONNECTIVITY REQUEST message and the request type was different from "emergency" and from "handover of emergency bearer services", the UE shall stop timer T3396 associated with no APN if it is running. The UE shall then start timer T3396 with the value provided in the Back-off timer value IE and:

-  shall not send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in clause  6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for the same APN that was sent by the UE, until timer T3396 expires or timer T3396 is stopped; and

-  shall not send another PDN CONNECTIVITY REQUEST message without an APN and with request type different from "emergency" and from "handover of emergency bearer services", or another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in clause  6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST for a non-emergency PDN connection established without an APN provided by the UE, if no APN was included in the PDN CONNECTIVITY REQUEST message and the request type was different from "emergency" and from "handover of emergency bearer services", until timer T3396 expires or timer T3396 is stopped.

The UE shall not stop timer T3396 upon a PLMN change or inter-system change;

ii)  if the timer value indicates that this timer is deactivated, the UE:

-  shall not send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in clause  6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for the same APN until the UE is switched off or the USIM is removed, or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message for the same APN from the network or a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause  #39 "reactivation requested" for a default EPS bearer context for the same APN from the network; and

-  shall not send another PDN CONNECTIVITY REQUEST message without an APN and with request type different from "emergency" and from "handover of emergency bearer services", or another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in clause  6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without an APN provided by the UE, if no APN was included in the PDN CONNECTIVITY REQUEST message and the request type was different from "emergency" and from "handover of emergency bearer services", until the UE is switched off or the USIM is removed, or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message for a non-emergency PDN connection established without an APN provided by the UE, or a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause #39 "reactivation requested" for a default EPS bearer context of a non-emergency PDN connection established without an APN provided by the UE.

The timer T3396 remains deactivated upon a PLMN change or inter-system change; and

iii)  if the timer value indicates zero, the UE:

-  shall stop timer T3396 associated with the corresponding APN, if running, and may send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for the same APN; and

-  if no APN was included in the PDN CONNECTIVITY REQUEST message and the request type was different from "emergency" and from "handover of emergency bearer services", the UE shall stop timer T3396 associated with no APN, if running, and may send another PDN CONNECTIVITY REQUEST message without an APN, or another BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without an APN provided by the UE; and

2)  if the PDN CONNECTIVITY REQUEST message was sent together with an ATTACH REQUEST, the UE shall take different actions depending on the timer value received for timer T3396 in the Back-off timer value IE and on the integrity protection of the ATTACH REJECT message (if the UE is configured for dual priority, exceptions are specified in clause  6.5.5; if the UE is a UE configured to use AC11        15 in selected PLMN, exceptions are specified in clause  6.3.5):

i)  if the ATTACH REJECT message is not integrity protected and an APN was sent by the UE during the attach procedure, the UE shall stop timer T3396 associated with the corresponding APN if it is running. If the ATTACH REJECT message is not integrity protected, the request type was different from "emergency" and from "handover of emergency bearer services", and an APN was not sent by the UE, the UE shall stop timer T3396 associated with no APN if it is running. The UE shall then start timer T3396 with a random value from a default range specified in table  11.2.3 defined in 3GPP  S  24.008  [13], and:

a)  shall not initiate a new attach procedure with the same APN or send another PDN CONNECTIVITY REQUEST with the same APN that was sent by the UE, until timer T3396 expires or timer T3396 is stopped; and

b)  shall not initiate a new attach procedure without an APN and with request type different from "emergency" and from "handover of emergency bearer services" or send another PDN CONNECTIVITY REQUEST without an APN and with request type different from "emergency" and from "handover of emergency bearer services", if the UE did not provide any APN during the attach procedure and the request type was different from "emergency" and from "handover of emergency bearer services", until timer T3396 expires.

  The UE shall not stop timer T3396 upon a PLMN change or inter-system change;

ii)  if the ATTACH REJECT message is integrity protected, the UE shall proceed as follows:

a)  if the timer value indicates neither zero nor deactivated and an APN was sent by the UE during the attach procedure, the UE shall stop timer T3396 associated with the corresponding APN if it is running. If the timer value indicates neither zero nor deactivated, the request type was different from "emergency" and from "handover of emergency bearer services", and an APN was not sent by the UE during the attach procedure, the UE shall stop timer T3396 associated with no APN if it is running. The UE shall then start timer T3396 with the value provided in the Back-off timer value IE and:

-  shall not initiate a new attach procedure with the same APN or send another PDN CONNECTIVITY REQUEST with the same APN that was sent by the UE, until timer T3396 expires or timer T3396 is stopped; and

-  shall not initiate a new attach procedure without an APN and with request type different from "emergency" and from "handover of emergency bearer services" or send another PDN CONNECTIVITY REQUEST without an APN and with request type different from "emergency" and from "handover of emergency bearer services", if the UE did not provide any APN during the attach procedure and the request type was different from "emergency" and from "handover of emergency bearer services", until timer T3396 expires.

  The UE shall not stop timer T3396 upon a PLMN change or inter-system change;

b)  if the timer value indicates that this timer is deactivated, the UE:

-  shall not initiate a new attach procedure with the same APN or send another PDN CONNECTIVITY REQUEST with the same APN that was sent by the UE, until the UE is switched off or the USIM is removed, or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message for the same APN from the network; and

-  shall not initiate a new attach procedure without an APN and with request type different from "emergency" and from "handover of emergency bearer services" or send another PDN CONNECTIVITY REQUEST without an APN and with request type different from "emergency" and from "handover of emergency bearer services", if the UE did not provide any APN during the attach procedure and the request type was different from "emergency" and from "handover of emergency bearer services", until the UE is switched off or the USIM is removed, or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message for a non-emergency PDN connection established without an APN provided by the UE.

  The timer T3396 remains deactivated upon a PLMN change or inter-system change; and

c)  if the timer value indicates that this timer is zero, the UE shall proceed as specified in clause 5.5.1.2.6 item d.

If the Back-off timer value IE is not included and the PDN CONNECTIVITY REQUEST was sent standalone, then the UE may send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for the same APN.

When the timer T3396 is running or the timer is deactivated, the UE is allowed to initiate an attach procedure or PDN connectivity procedure if the procedure is for emergency bearer services.

If the timer T3396 is running when the UE enters state EMM-DEREGISTERED, the UE remains switched on, and the USIM in the UE remains the same, then timer T3396 is kept running until it expires or it is stopped.

If the UE is switched off when the timer T3396 is running, and if the USIM in the UE remains the same when the UE is switched on, the UE shall behave as follows:

-  let t1 be the time remaining for T3396 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1        t. If t1 is equal to or less than t, then the timer need not be restarted. If the UE is not capable of determining t, then the UE shall restart the timer with the value t1;

-  if prior to switch off, timer T3396 was running for a specific APN, because a PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message containing the low priority indicator set to "MS is configured for NAS signalling low priority" was rejected with a timer value for timer T3396, and if timer T3396 is restarted at switch on, then the UE configured for dual priority shall handle session management requests as indicated in clause  6.5.5; and

-  if prior to switch off timer T3396 was running because a PDN CONNECTIVITY REQUEST without APN sent together with an ATTACH REQUEST message containing the low priority indicator set to "MS is configured for NAS signalling low priority" was rejected with a timer value for timer T3396, and if timer T3396 is restarted at switch on, then the UE configured for dual priority shall handle session management requests as indicated in clause  6.5.5.

6.5.1.4.3  Handling of network rejection due to ESM cause other than ESM cause #26

If the ESM cause value is different from #26 "insufficient resources", #28 "unknown PDN type", #50 "PDN type IPv4 only allowed", #51 "PDN type IPv6 only allowed", #54 "PDN connection does not exist", #57 "PDN type IPv4v6 only allowed", #58 "PDN type non IP only allowed",  #61 "PDN type Ethernet only allowed", #65 "maximum number of EPS bearers reached", and #66 "requested APN not supported in current RAT and PLMN combination", and the Back-off timer value IE is included, the UE shall behave as follows:

1)  if the PDN CONNECTIVITY REQUEST message was sent standalone, the UE shall take different actions depending on the timer value received in the Back-off timer value IE (if the UE is a UE configured to use AC11         15 in selected PLMN, exceptions are specified in clause  6.3.6):

i)  if the timer value indicates neither zero nor deactivated, the UE shall start the back-off timer with the value provided in the Back-off timer value IE for the PDN connectivity procedure and PLMN and APN combination and

-  shall not send another PDN CONNECTIVITY REQUEST message in the PLMN for the same APN that was sent by the UE, until the back-off timer expires, the UE is switched off or the USIM is removed; and

-  shall not send another PDN CONNECTIVITY REQUEST message in the PLMN without an APN and with request type different from "emergency" and from "handover of emergency bearer services" if no APN was included in the PDN CONNECTIVITY REQUEST message, until the back-off timer expires, the UE is switched off or the USIM is removed;

ii)  if the timer value indicates that this timer is deactivated, the UE:

-  shall not send another PDN CONNECTIVITY REQUEST message in the PLMN for the same APN until the UE is switched off or the USIM is removed; and

-  shall not send another PDN CONNECTIVITY REQUEST message in the PLMN without an APN and with request type different from "emergency" and from "handover of emergency bearer services" if no APN was included in the PDN CONNECTIVITY REQUEST message, until the UE is switched off or the USIM is removed; and

iii)  if the timer value indicates zero, the UE:

-  may send another PDN CONNECTIVITY REQUEST message in the PLMN for the same APN; and

-  may send another PDN CONNECTIVITY REQUEST message in the PLMN without an APN; and

2)  if the PDN CONNECTIVITY REQUEST message was sent together with an ATTACH REQUEST, the UE shall take different actions depending on the timer value received in the Back-off timer value IE and on the integrity protection of the ATTACH REJECT message (if the UE is a UE configured to use AC11         15 in selected PLMN, exceptions are specified in clause  6.3.6):

i)  if the ATTACH REJECT message is not integrity protected, the UE shall start the back-off timer with a random value from a default range specified in table  11.2.3(see 3GPP  S  24.008  [13]), and:

a)  shall not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message in the PLMN with the same APN that was sent by the UE, until the back-off timer expires, the UE is switched off or the USIM is removed; and

b)  shall not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message in the PLMN without an APN and with request type different from "emergency" and from "handover of emergency bearer services", if the UE did not provide any APN during the attach procedure and the request type was different from "emergency", until the back-off timer expires, the UE is switched off or the USIM is removed; and

ii)  if the ATTACH REJECT message is integrity protected, the UE shall proceed as follows:

a)  if the timer value indicates neither zero nor deactivated, the UE shall start the back-off timer with the value provided in the Back-off timer value IE for the PDN connectivity procedure and PLMN and APN combination and:

-  shall not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message in the PLMN with the same APN that was sent by the UE, until the back-off timer expires, the UE is switched off or the USIM is removed; and

-  shall not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message in the PLMN without an APN and with request type different from "emergency" and from "handover of emergency bearer services", if the UE did not provide any APN during the attach procedure and the request type was different from "emergency" and from "handover of emergency bearer services", until the back-off timer expires, the UE is switched off or the USIM is removed;

b)  if the timer value indicates that this timer is deactivated, the UE:

-  shall not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message in the PLMN with the same APN that was sent by the UE, until the UE is switched off or the USIM is removed; and

-  shall not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message in the PLMN without an APN and with request type different from "emergency" and from "handover of emergency bearer services", if the UE did not provide any APN during the attach procedure and the request type was different from "emergency" and from "handover of emergency bearer services", until the UE is switched off or the USIM is removed; and

c)  if the timer value indicates that this timer is zero, the UE shall proceed as specified in clause  5.5.1.2.6 item  d.

If the Back-off timer value IE is not included and the PDN CONNECTIVITY REQUEST was sent standalone, then the UE shall ignore the Re-attempt indicator IE provided by the network in PDN CONNECTIVITY REJECT, if any.

1)  Additionally, if the ESM cause value is #8 "operator determined barring", #27 "missing or unknown APN", #32 "service option not supported", or #33 "requested service option not subscribed", the UE shall proceed as follows:

-  if the UE is registered in the HPLMN or in a PLMN that is within the EHPLMN list (if the EHPLMN list is present), the UE shall behave as described above in the present clause, using the configured SM_RetryWaitTime value as specified in 3GPP  S  24.368  [15A] or in USIM file NASCONFIG as specified in 3GPP  S  31.102  [17], if available, as back-off timer value; and

NOTE  0:  The way to choose one of the configured SM_RetryWaitTime values for back-off timer value is up to UE implementation if the UE is configured with:
-  an SM_RetryWaitTime value in ME as specified in 3GPP  S  24.368  [15A]; and
-  an SM_RetryWaitTime value in USIM file NASCONFIG as specified in 3GPP  S  31.102  [17].

-  otherwise, if the UE is not registered in its HPLMN or in a PLMN that is within the EHPLMN list (if the EHPLMN list is present), or if the SM_RetryWaitTime value is not configured, the UE shall behave as described above in the present clause, using the default value of 12 minutes for the back-off timer.

2)  For ESM cause values different from #8 "operator determined barring", #27 "missing or unknown APN", #32 "service option not supported", or #33 "requested service option not subscribed", the UE behaviour regarding the start of a back-off timer is unspecified.

The UE shall not stop any back-off timer upon a PLMN change or inter-system change. If the network indicates that a back-off timer for the PDN connectivity procedure and PLMN and APN combination is deactivated, then it remains deactivated upon a PLMN change or inter-system change.

NOTE  1:  This means the back-off timer can still be running or be deactivated for the given ESM procedure and PLMN and APN combination when the UE returns to the PLMN or when it performs inter-system change back from A/Gb or Iu mode or N1 mode to S1 mode. Thus the UE can still be prevented from sending another PDN CONNECTIVITY REQUEST message in the PLMN for the same APN.

If the Back-off timer value IE is not included and the PDN CONNECTIVITY REQUEST was sent together with an ATTACH REQUEST, the UE shall ignore the Re-attempt indicator IE provided by the network in PDN CONNECTIVITY REJECT, if any, and proceed as specified in clause  5.5.1.2.6, item  d.

If the back-off timer is started upon receipt of a PDN CONNECTIVITY REJECT (i.e. the timer value was provided by the network, a configured value is available or the default value is used as explained above) or the back-off timer is deactivated, the UE behaves as follows:

1)  after a PLMN change the UE may send a PDN CONNECTIVITY REQUEST message for the same APN in the new PLMN, if the back-off timer is not running and is not deactivated for the PDN connectivity procedure and the combination of new PLMN and APN;

  Furthermore as an implementation option, for the ESM cause values #8 "operator determined barring", #27 "missing or unknown APN", #32 "service option not supported" or #33 "requested service option not subscribed", if the network does not include a Re-attempt indicator IE, the UE may decide not to automatically send another PDN CONNECTIVITY REQUEST message for the same APN that was sent by the UE using the same PDN type, or the UE may decide not to automatically send another PDN CONNECTIVITY REQUEST message included in an ATTACH REQUEST message without an APN using the same PDN type if the UE did not provide any APN in the PDN connectivity procedure, if the UE is registered to a new PLMN which is in the list of equivalent PLMNs.

2)  if the network does not include the Re-attempt indicator IE to indicate whether re-attempt in A/Gb or Iu mode or N1 mode is allowed, or the UE ignores the Re-attempt indicator IE, e.g. because the Back-off timer value IE is not included, then:

-  if the UE is registered in its HPLMN or in a PLMN that is within the EHPLMN list (if the EHPLMN list is present), the UE shall apply the configured SM_RetryAtRATChange value as specified in 3GPP  S  24.368  [15A] or in USIM file NASCONFIG as specified in 3GPP  S  31.102  [17], if available, to determine whether the UE may attempt a PDP context activation procedure for the same PLMN and APN combination in A/Gb or Iu mode or a PDU session establishment procedure for the same PLMN and APN combination in N1 mode; and

NOTE  2:  The way to choose one of the configured SM_RetryAtRATChange values for back-off timer value is up to UE implementation if the UE is configured with:

-  an SM_RetryAtRATChange value in ME as specified in 3GPP  S  24.368  [15A]; and

-  an SM_RetryAtRATChange value in USIM file NASCONFIG as specified in 3GPP  S  31.102  [17].

-  if the UE is not registered in its HPLMN or in a PLMN that is within the EHPLMN list (if the EHPLMN list is present), or if the NAS configuration MO as specified in 3GPP  S  24.368  [15A] is not available and the value for inter-system change is not configured in the USIM file NASCONFIG, then the UE behaviour regarding a PDP context activation procedure for the same PLMN and APN combination in A/Gb or Iu mode and a PDU session establishment procedure for the same PLMN and APN combination in N1 mode are unspecified; and

3)  if the network includes the Re-attempt indicator IE indicating that re-attempt in an equivalent PLMN is not allowed, then depending on the timer value received in the Back-off timer value IE, for each combination of a PLMN from the equivalent PLMN list and the APN the UE shall start a back-off timer for the PDN connectivity procedure with the value provided by the network, or deactivate the respective back-off timer as follows:

-  if the Re-attempt indicator IE additionally indicates that re-attempt in A/Gb or Iu mode or N1 mode is allowed, the UE shall start or deactivate the back-off timer for S1 mode only; and

-  otherwise the UE shall start or deactivate the back-off timer for A/Gb, Iu, S1 and N1 mode.

If the back-off timer for a PLMN and APN combination was started or deactivated in A/Gb or Iu mode upon receipt of an ACTIVATE PDP CONTEXT REJECT message (see 3GPP  S  24.008  [13]) and the network indicated that re-attempt in S1 mode is allowed, then this back-off timer does not prevent the UE from sending a PDN CONNECTIVITY REQUEST message in this PLMN for the same APN after inter-system change to S1 mode. If the network indicated that re-attempt in S1 mode is not allowed, the UE shall not send any PDN CONNECTIVITY REQUEST message in this PLMN for the same APN after inter-system change to S1 mode until the timer expires, the UE is switched off or the USIM is removed.

If a back-off timer for a PLMN and APN combination, in combination with any S-NSSAI or without S-NSSAI (see 3GPP  S  24.501  [54]) was started or deactivated in N1 mode upon receipt of a PDU SESSION ESTABLISHMENT REJECT message (see 3GPP  S  24.501  [54]) and the network indicated that re-attempt in S1 mode is allowed, then this back-off timer does not prevent the UE from sending a PDN CONNECTIVITY REQUEST message in this PLMN for the same APN after inter-system change to S1 mode. If the network indicated that re-attempt in S1 mode is not allowed, the UE shall not send any PDN CONNECTIVITY REQUEST message in this PLMN for the same APN after inter-system change to S1 mode until the timer expires, the UE is switched off or the USIM is removed. If more than one back-off timers for the same PLMN and APN combination was started in N1 mode with an indication from the network that re-attempt in S1 mode is not allowed and no back-off timer for the same PLMN and APN combination was deactivated in N1 mode, the UE shall not send any PDN CONNECTIVITY REQUEST message in this PLMN for the same APN after inter-system change to S1 mode until all timers have expired. If at least one back-off timer for the same PLMN and APN combination was deactivated in N1 mode, the UE shall not send any PDN CONNECTIVITY REQUEST message in this PLMN for the same APN until the UE is switched off or the USIM is removed.

NOTE  3:  The back-off timer is used to describe a logical model of the required UE behaviour. This model does not imply any specific implementation, e.g. as a timer or timestamp.

NOTE  4:  Reference to back-off timer in this section can either refer to use of timer T3396 or to use of a different packet system specific timer within the UE. Whether the UE uses T3396 as a back-off timer or it uses different packet system specific timers as back-off timers is left up to UE implementation. This back-off timer is stopped when the UE is switched off or the USIM is removed.

When the back-off timer is running or the timer is deactivated, the UE is allowed to initiate an attach procedure or PDN connectivity procedure if the procedure is for emergency bearer services.

If the ESM cause value is #28 "unknown PDN type" and the PDN CONNECTIVITY REQUEST message contained a PDN type IE indicating a PDN connection type, the UE shall ignore the Back-off timer value IE and Re-attempt indicator IE provided by the network, if any. The UE may send another PDN CONNECTIVITY REQUEST message with the PDN type IE indicating another PDN connection type.

If the ESM cause value is #50 "PDN type IPv4 only allowed", #51 "PDN type IPv6 only allowed", #57 "PDN type IPv4v6 only allowed", #58 "PDN type non IP only allowed" or #61 "PDN type Ethernet only allowed", the UE shall ignore the Back-off timer value IE provided by the network, if any. The UE shall not automatically send another PDN CONNECTIVITY REQUEST message for the same APN that was sent by the UE to obtain a PDN type different from the one allowed by the network until any of the following conditions is fulfilled:

-  the UE is registered to a new PLMN, and either the network did not include a Re-attempt indicator IE in the PDN CONNECTIVITY REJECT message or the Re-attempt indicator IE included in the message indicated that re-attempt in an equivalent PLMN is allowed;

-  the UE is registered to a new PLMN which was not in the list of equivalent PLMNs at the time when the PDN CONNECTIVITY REJECT message was received;

-  the UE is switched off; or

-  the USIM is removed.

For the ESM cause values #50 "PDN type IPv4 only allowed", #51 "PDN type IPv6 only allowed", #57 "PDN type IPv4v6 only allowed", #58 "PDN type non IP only allowed" and #61 "PDN type Ethernet only allowed", the UE shall ignore the value of the RATC bit in the Re-attempt indicator IE provided by the network, if any.

NOTE  5:  For the ESM cause values #50 "PDN type IPv4 only allowed", #51 "PDN type IPv6 only allowed", #57 "PDN type IPv4v6 only allowed", #58 "PDN type non IP only allowed" and #61 "PDN type Ethernet only allowed", re-attempt in A/Gb, Iu, or N1 mode for the same APN (or no APN, if no APN was indicated by the UE) is only allowed using the PDN type(s) indicated by the network.

Furthermore as an implementation option, for the SM cause values #50 "PDN type IPv4 only allowed", #51 "PDN type IPv6 only allowed", #57 "PDN type IPv4v6 only allowed", #58 "PDN type non IP only allowed" and #61 "PDN type Ethernet only allowed", if the network does not include a Re-attempt indicator IE the UE may decide not to automatically send another PDN CONNECTIVITY REQUEST message for the same APN that was sent by the UE using the same PDN type, if the UE is registered to a new PLMN which is in the list of equivalent PLMNs.

NOTE  6:  Request to send another PDN CONNECTIVITY REQUEST message with a specific PDN type has to come from upper layers.

If the ESM cause value is #65 "maximum number of EPS bearers reached", the UE shall determine the PLMN   's maximum number of EPS bearer contexts in S1 mode (see clause  6.5.0) as the number of active EPS bearer contexts it has. The UE shall ignore the Back-off timer value IE and Re-attempt indicator IE provided by the network, if any.

NOTE  7:  In some situations, when attempting to establish multiple EPS bearer contexts, the number of active EPS bearer contexts that the UE has when ESM cause #65 is received is not equal to the maximum number of EPS bearer contexts reached in the network.

NOTE  8:  When the network supports emergency bearer services, it is not expected that ESM cause #65 is returned by the network when the UE requests a PDN connection for emergency bearer services.

The PLMN   's maximum number of EPS bearer contexts in S1 mode applies to the PLMN in which the ESM cause #65 "maximum number of EPS bearers reached" is received. When the UE is switched off, when the USIM is removed, or when there is a change in the value indicated by the network in the 15 bearers bit of the EPS network feature support IE, the UE shall clear all previous determinations representing PLMNs maximum number of EPS bearer contexts in S1 mode. Upon successful registration with a new PLMN, the UE may clear previous determinations representing any PLMN   's maximum number(s) of EPS bearer contexts in S1 mode.

If the ESM cause value is #66 "requested APN not supported in current RAT and PLMN combination", the UE shall take different actions depending on the Back-off timer value IE and the Re-attempt indicator IE optionally included:

1)  If the PDN CONNECTIVITY REQUEST message was sent standalone, the Back-off timer value IE is not included, and either the Re-attempt indicator IE is not included or the Re-attempt indicator IE is included indicating that re-attempt in an equivalent PLMN is allowed, the UE shall not send another PDN CONNECTIVITY REQUEST message for the same APN in the current PLMN in S1 mode until the UE is switched off or the USIM is removed;

2)  if the PDN CONNECTIVITY REQUEST message was sent standalone, the Back-off timer value IE is not included, and the Re-attempt indicator IE is included and indicates that re-attempt in an equivalent PLMN is not allowed, the UE shall not send a PDN CONNECTIVITY REQUEST message for the same APN in any PLMN in the list of equivalent PLMNs in S1 mode until the UE is switched off or the USIM is removed;

3)  if the PDN CONNECTIVITY REQUEST message was sent standalone and the Back-off timer value IE is included, the UE shall take different actions depending on the timer value received in the Back-off timer value IE (if the UE is a UE configured to use AC11          15 in selected PLMN, exceptions are specified in clause  6.3.6):

i)  if the timer value indicates neither zero nor deactivated, the UE shall start the back-off timer with the value provided in the Back-off timer value IE for the PLMN and APN combination and shall not send another PDN CONNECTIVITY REQUEST for the same APN in the current PLMN in S1 mode until the back-off timer expires, the UE is switched off or the USIM is removed;

ii)  if the timer value indicates that this timer is deactivated, the UE shall not send another PDN CONNECTIVITY REQUEST message for the same APN in the current PLMN in S1 mode until the UE is switched off or the USIM is removed; and

iii)  if the timer value indicates that this timer is zero, the UE may send a PDN CONNECTIVITY REQUEST message for the same APN in the current PLMN; and

4)  if the PDN CONNECTIVITY REQUEST message was sent together with an ATTACH REQUEST, the UE shall take different actions depending on the integrity protection of the ATTACH REJECT message (if the UE is a UE configured to use AC11          15 in selected PLMN, exceptions are specified in clause  6.3.6):

i)  if the ATTACH REJECT message is not integrity protected, regardless whether the Back-off timer IE is included, the UE shall start the back-off timer with a random value from a default range specified in table  11.2.3(see 3GPP  S  24.008  [13]), and shall not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message in the current PLMN in S1 mode with the same APN that was sent by the UE, until the back-off timer expires, the UE is switched off or the USIM is removed; and

ii)  if the ATTACH REJECT message is integrity protected, the UE shall proceed as follows:

a)  if the Back-off timer value IE is included and the timer value indicates neither zero nor deactivated, the UE shall start the back-off timer with the value provided in the Back-off timer value IE for the PDN connectivity procedure and PLMN and APN combination and shall not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message in the current PLMN in S1 mode with the same APN that was sent by the UE, until the back-off timer expires, the UE is switched off or the USIM is removed;

b)  if the Back-off timer value IE is included and the timer value indicates that this timer is deactivated, the UE shall not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message in the current PLMN in S1 mode with the same APN that was sent by the UE, until the UE is switched off or the USIM is removed;

c)  if the Back-off timer value IE is included and the timer value indicates that this timer is zero, the UE shall proceed as specified in clause  5.5.1.2.6 item  d;

d)  if the Back-off timer value IE is not included, and either the Re-attempt indicator IE is not included or the Re-attempt indicator IE is included indicating that re-attempt in an equivalent PLMN is allowed, the UE shall not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message for the same APN in the current PLMN in S1 mode until the UE is switched off or the USIM is removed; and

e)  if the Back-off timer value IE is not included, and the Re-attempt indicator IE is included and indicates that re-attempt in an equivalent PLMN is not allowed, the UE shall not initiate a new attach procedure or send a PDN CONNECTIVITY REQUEST message for the same APN in any PLMN in the list of equivalent PLMNs in S1 mode until the UE is switched off or the USIM is removed.

NOTE  9:  Receiving ESM cause value #66 during an attach procedure without APN is not expected and the UE behaviour is implementation specific.

If the network includes the Re-attempt indicator IE indicating that re-attempt in an equivalent PLMN is not allowed, then

-  for cases  3.i, 4.i and 4.ii.a the UE shall additionally start a back-off timer with the value provided in the Back-off timer value IE for the PDN connectivity procedure for each combination of a PLMN from the equivalent PLMN list and the APN; and

-  for cases  3.ii and 4.ii.b the UE shall deactivate the respective back-off timers for the PDN connectivity procedure for each combination of a PLMN from the equivalent PLMN list and the APN.

For the ESM cause value #66 "requested APN not supported in current RAT and PLMN combination" the UE shall ignore the value of the RATC bit in the Re-attempt indicator IE provided by the network, if any.

As an implementation option, for cases  1, 3.i, 3.ii, 4.iv, 4.v.a and 4.v.b, if the Re-attempt indicator IE is not included, the UE may decide not to automatically send another PDN CONNECTIVITY REQUEST message for the same APN in a PLMN which is in the list of equivalent PLMNs.

If the ESM cause value is #54 "PDN connection does not exist", the UE shall ignore the Back-off timer value IE and Re-attempt indicator IE provided by the network, if any, and take different actions as follows:

-  if the PDN CONNECTIVITY REQUEST message was sent standalone, the UE shall set the request type to "initial request" in the subsequent PDN CONNECTIVITY REQUEST message to establish a PDN connectivity to the same APN;

-  if the PDN CONNECTIVITY REQUEST message was sent together with an ATTACH REQUEST message, the UE shall set the request type to "initial request" in the PDN CONNECTIVITY REQUEST message which is included in the subsequent ATTACH REQUEST message to establish a PDN connectivity to the same APN.

NOTE  10:  User interaction is necessary in some cases when the UE cannot re-activate the EPS bearer context(s) automatically.

If the PDN connection is for UAS services, and the PDN CONNECTIVITY REJECT message includes the extended protocol configuration options IE containing the service-level-AA container with the length of two octets , and the service-level-AA container with the length of two octets contains the service-level-AA response parameter with the SLAR field set to "Service level authentication and authorization was not successful or service level authorization is revoked", then the UE supporting UAS services shall consider the UUAA procedure as failed and not attempt to establish a PDN connection for UAS services.

6.5.1.4A  Handling the maximum number of active EPS bearer contexts

If the maximum number of active EPS bearer contexts is reached at the UE (see clause  6.5.0) and the upper layers of the UE request connectivity to a PDN the UE shall not send a PDN CONNECTIVITY REQUEST message unless an active EPS bearer is deactivated. If the UE needs to de-activate an active EPS bearer context, choosing which EPS bearer context to de-activate is implementation specific, however the UE shall not deactivate an EPS bearer context for emergency.

NOTE:  Clause  6.5.1.6 specifies that a PDN CONNECTIVITY REQUEST message with the same combination of APN and PDN type as an already existing, non-emergency PDN connection can be acceptable, in some cases. In these cases the UE does not need to de-activate an active EPS bearer context if the maximum number of active EPS bearer contexts is reached at the UE.

If the UE needs to de-activate an EPS bearer context in order to request an emergency EPS bearer context, it shall either de-activate an EPS bearer context locally or via explicit signalling. If the UE performs local de-activation, the UE shall perform tracking area updating procedure to indicate EPS bearer context status to the network.

6.5.1.4B  Void

6.5.1.4C  Handling the maximum number of active user plane radio bearers in NB-S1 mode

When the maximum number of active user plane radio bearers in NB-S1 mode is reached (see clause  6.5.0) and upper layers request for more DRBs for PDN connections other than PDN connections with those DRBs, the UE can choose to release one or more of the PDN connections to cater for the upper layer request. The choice of which PDN connection to be released is implementation specific.

If the maximum number of active user plane radio bearers in NB-S1 mode is reached and the upper layers of the UE request user-plane resources for exception data reporting, the UE shall release a PDN connection that has user-plane resources to cater for the request for exception data reporting. The choice of which PDN connection to be released is implementation specific.

If the UE needs to release a PDN connection for the reasons stated in this clause, a PDN connection that is used for exception data reporting shall not be released.

If the UE releases a PDN connection to cater for the upper layer request, the UE shall release the PDN connection via explicit ESM signalling.

6.5.1.5  Abnormal cases in the UE

The following abnormal cases can be identified:

a)  T3482 expired

  On the first expiry of the timer T3482:

-  if the PDN CONNECTIVITY REQUEST message was sent with request type set to "emergency" or "handover of emergency bearer services" in a stand-alone PDN connectivity procedure, then the UE shall:

a)  inform the upper layers of the failure to establish the emergency bearer; or

NOTE:  This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain), or other implementation specific mechanisms, e.g. procedures specified in 3GPP  S  24.229  [13D] can result in the emergency call being attempted to another IP-CAN.

b)  detach locally, if not detached already, attempt EPS attach for emergency bearer services.

-  otherwise, the UE shall resend the PDN CONNECTIVITY REQUEST and shall reset and restart timer T3482. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3482, the UE shall abort the procedure, release the PTI allocated for this invocation and enter the state PROCEDURE TRANSACTION INACTIVE.

b)  T3447 is running

  The UE shall not send a PDN CONNECTIVITY REQUEST message when the UE is in EMM-CONNECTED mode after the UE attached without PDN connection, unless:

-  establishment of a PDN connection for emergency bearer services is requested;

-  the UE is a UE configured to use AC11        15 in the selected PLMN; or

-  a network initiated signalling message has been received.

  The PDN CONNECTIVITY REQUEST message can be sent, if still necessary, when timer T3447 expires.

6.5.1.6  Abnormal cases on the network side

The following abnormal cases can be identified:

a)  UE initiated PDN connectivity request for an already existing PDN connection:

  If the network receives a PDN CONNECTIVITY REQUEST message with the same combination of APN and PDN type as an already existing PDN connection,

  If the information elements in the PDN CONNECTIVITY REQUEST message do not differ from the ones received within the previous PDN CONNECTIVITY REQUEST message, and the MME has not received the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message from UE, the network shall resend the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message and continue the previous procedure.

  If one or more information elements in the PDN CONNECTIVITY REQUEST message differ from the ones received within the previous PDN CONNECTIVITY REQUEST message, and multiple PDN connections for a given APN are not allowed, the network may deactivate the existing EPS bearer contexts for the PDN connection locally without notification to the UE and proceed with the requested PDN connectivity procedure or may reject this PDN connectivity procedure including the ESM cause #55 "multiple PDN connections for a given APN not allowed", in the PDN CONNECTIVITY REJECT message.

  If the network receives a PDN CONNECTIVITY REQUEST message with request type "emergency" and the MME has not received the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message from UE for the previous PDN connectivity request for emergency bearer services, the network shall resend the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message and continue the previous procedure. If there is already a PDN connection for emergency bearer services existing, the MME shall reject the request with ESM cause #55 "multiple PDN connections for a given APN not allowed" or deactivate the existing EPS bearer contexts for the PDN connection locally without notification to the UE and proceed with the requested PDN connectivity procedure.

b)  UE initiated PDN connectivity request with request type "handover" for a PDN connection that does not exist:

  If the network receives a PDN CONNECTIVITY REQUEST message for either a default APN or a specific APN with request type set to "handover" and the MME does not have any information about that PDN connection, then MME shall reject the PDN connectivity request procedure including the ESM cause #54 "PDN connection does not exist", in the PDN CONNECTIVITY REJECT message.

c)  ESM information not received:

  If the ESM information transfer flag in the PDN CONNECTIVITY REQUEST message has been set and the ESM information is not received before the final expiry of timer T3489 as described in clause  6.6.1.2.6, the MME shall reject the PDN connectivity request procedure including the ESM cause #53 "ESM information not received", in the PDN CONNECTIVITY REJECT message.

d)  Additional UE initiated PDN connectivity request received from a UE that is attached for emergency bearer services:

  The MME shall reject the request with ESM cause #31 "request rejected, unspecified".

e)  A PDN CONNECTIVITY REQUEST message with request type "handover of emergency bearer services" received from a UE and the MME does not have any information about a P-GW currently providing emergency bearer services for the UE or the MME is not configured with an address of a P-GW in the MME emergency configuration data:

  MME shall reject the PDN connectivity request procedure including the ESM cause #54 "PDN connection does not exist", in the PDN CONNECTIVITY REJECT message.

f)  Additional UE initiated PDN connectivity request received from a UE that is attached for access to RLOS:

  The MME shall reject the request with ESM cause #31 "request rejected, unspecified".

6.5.1.7  Handling PDN connectivity request for UE configured for dual priority

If a PDN connection exists that was established due to a request including a low priority indicator set to "MS is configured for NAS signalling low priority" and the upper layers of the UE request to establish a PDN connection with the same APN and a low priority indicator set to "MS is not configured for NAS signalling low priority", when initiating the PDN connectivity request procedure, the UE shall:

-  send a PDN CONNECTIVITY REQUEST message with the same combination of APN and PDN type as the existing PDN connection. If the UE receives a PDN CONNECTIVITY REJECT message with ESM cause #55 "multiple PDN connections for a given APN not allowed", the upper layers are informed of this; or

-  send a PDN CONNECTIVITY REQUEST message with the same APN after the successful deactivation of the existing PDN connection.

NOTE:  The above list of options also apply for the case when the existing PDN connection was established due to a request including a low priority indicator set to "MS is not configured for NAS signalling low priority" and the new request to establish a PDN connection with the same APN contains a low priority indicator set to "MS is configured for NAS signalling low priority".

As an alternative the upper layers of the UE can request to establish a PDN connection with a different APN.

6.5.2  UE requested PDN disconnect procedure

6.5.2.1  General

The purpose of the UE requested PDN disconnection procedure is for a UE to request disconnection from one PDN. If EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the UE can initiate this procedure to disconnect from any PDN as long as it is connected to at least one other PDN. If EMM-REGISTERED without PDN connection is supported by the UE and the MME, the UE can initiate this procedure to disconnect from any PDN. With this procedure, all EPS bearer contexts established towards this PDN, including the default EPS bearer context, are released.

The UE is allowed to initiate the PDN disconnection procedure even if the timer T3396 is running.

6.5.2.2  UE requested PDN disconnection procedure initiation

In order to request PDN disconnection from a PDN, the UE shall send a PDN DISCONNECT REQUEST message to the MME, start the timer T3492 and enter the state PROCEDURE TRANSACTION PENDING (see example in figure  6.5.2.2.1). The PDN DISCONNECT REQUEST message shall include the EPS bearer identity of the default bearer associated with the PDN to disconnect from as the linked EPS bearer identity in the PDN DISCONNECT REQUEST message.



Figure 6.5.2.2.1: UE requested PDN disconnection procedure

6.5.2.3  UE requested PDN disconnection procedure accepted by the network

Upon receipt of the PDN DISCONNECT REQUEST message, if it is accepted by the network, the MME shall initiate the bearer context deactivation procedure by sending the DEACTIVATE EPS BEARER CONTEXT REQUEST message including the linked EPS bearer identity of the default bearer associated with the PDN to disconnect from and the PTI. The behaviour of the MME is described in clause  6.4.4.

Upon receipt of the DEACTIVATE EPS BEARER CONTEXT REQUEST message with a PTI which matches the value used for the PDN DISCONNECT REQUEST message, the UE shall stop the timer T3492 and enter the state PROCEDURE TRANSACTION INACTIVE. The behaviour of the UE is described in clause  6.4.4. The UE should ensure that the procedure transaction identity (PTI) assigned to this procedure is not released immediately. The way to achieve this is implementation dependent. While the PTI value is not released, the UE regards any received DEACTIVATE EPS BEARER CONTEXT REQUEST message with the same PTI value as a network retransmission (see clause  7.3.1).

On reception of DEACTIVATE EPS BEARER CONTEXT ACCEPT message from the UE, the MME releases all the resources reserved for the PDN in the network.

6.5.2.4  UE requested PDN disconnection procedure not accepted by the network

Upon receipt of the PDN DISCONNECT REQUEST message, if it is not accepted by the network, the MME shall send a PDN DISCONNECT REJECT message to the UE. The PDN DISCONNECT REJECT message shall contain the PTI and an ESM cause IE that typically indicates one of the following ESM cause values:

#35:  PTI already in use;

#43:  invalid EPS bearer identity;

#49:  last PDN disconnection not allowed;

#95        111: protocol errors.

If EMM-REGISTERED without PDN connection is supported by the UE and the MME, then ESM cause #49 "last PDN disconnection not allowed" is not applicable.

Upon receipt of the PDN DISCONNECT REJECT message, the UE shall stop the timer T3492, enter the state PROCEDURE TRANSACTION INACTIVE and abort the PDN disconnection procedure. Additionally, in all cases with the exception of the UE having received ESM cause #49 "last PDN disconnection not allowed" if EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the UE shall deactivate all EPS bearer contexts for this PDN connection locally without peer-to-peer signalling between the UE and the MME. If the UE receives ESM cause #49 "last PDN disconnection not allowed" and the UE has any other PDN connections established, the UE may locally deactivate, without peer-to-peer signalling between the UE and the MME, all EPS bearer contexts associated with those other PDN connections.

6.5.2.5  Abnormal cases in the UE

The following abnormal cases can be identified:

a)  Expiry of timer T3492:

  On the first expiry of the timer T3492, the UE shall resend the PDN DISCONNECT REQUEST and shall reset and restart timer T3492. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3492, the UE shall abort the procedure, deactivate all EPS bearer contexts for this PDN connection locally without peer-to-peer signalling between the UE and the MME, release the PTI allocated for this invocation and enter the state PROCEDURE TRANSACTION INACTIVE. In order to synchronize EPS bearer contexts status with the MME, on indication of "back to E-UTRAN coverage" from the lower layers, the UE shall send a TRACKING AREA UPDATE REQUEST message that includes the EPS bearer context status IE to the MME.

b)  Collision of UE requested PDN disconnect procedure and dedicated EPS bearer context activation procedure:

  When the UE receives an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message during the PDN disconnect procedure, and the EPS bearer to be activated belongs to the PDN connection the UE wants to disconnect, the UE shall ignore the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message and proceed with the PDN disconnect procedure.

c)  Collision of UE requested PDN disconnect procedure and EPS bearer context modification:

  When the UE receives a MODIFY EPS BEARER CONTEXT REQUEST message during the PDN disconnect procedure, and the EPS bearer to be modified belongs to the PDN connection the UE wants to disconnect, the UE shall ignore the MODIFY EPS BEARER CONTEXT REQUEST message and proceed with the PDN disconnect procedure.

d)  Collision of UE requested PDN disconnect procedure and EPS bearer context deactivation procedure:

  When the UE receives a DEACTIVATE EPS BEARER CONTEXT REQUEST message during the PDN disconnect procedure, and the EPS bearer indicated in the DEACTIVATE EPS BEARER CONTEXT REQUEST message is a dedicated EPS bearer belonging to the PDN connection the UE wants to disconnect, the UE shall proceed with both procedures.

6.5.2.6  Abnormal cases on the network side

The following abnormal cases can be identified:

a)  No PDN connection with the linked EPS bearer identity activated:

  If the linked EPS bearer identity included in the PDN DISCONNECT REQUEST message does not belong to the default EPS bearer context of an established PDN connection, the MME shall reply with a PDN DISCONNECT REJECT message with ESM cause #43 "invalid EPS bearer identity".

6.5.3  UE requested bearer resource allocation procedure

6.5.3.1  General

The purpose of the UE requested bearer resource allocation procedure is for a UE to request an allocation of bearer resources for a traffic flow aggregate. The UE requests a specific QoS demand (QCI) and optionally sends a GBR requirement for a new traffic flow aggregate. If accepted by the network, this procedure invokes a dedicated EPS bearer context activation procedure (see clause  6.4.2) or an EPS bearer context modification procedure (see clause  6.4.3).

If there is a PDN connection for emergency bearer services established, the UE shall not request additional bearer resources for this PDN connection.

6.5.3.2  UE requested bearer resource allocation procedure initiation

In order to request the allocation of bearer resources for one traffic flow aggregate, the UE shall send a BEARER RESOURCE ALLOCATION REQUEST message to the MME, start timer T3480 and enter the state PROCEDURE TRANSACTION PENDING (see example in figure  6.5.3.2.1).

The UE shall include the EPS bearer identity of the default EPS bearer associated with the requested bearer resource in the Linked EPS bearer identity IE. The UE shall set the TFT operation code in the Traffic flow aggregate IE to "Create new TFT". The packet filters in the Traffic flow aggregate IE shall include at least one packet filter applicable for the uplink direction. In the Required traffic flow QoS IE, the UE shall indicate a QCI and, if the UE also includes a GBR, the additional GBR required for the traffic flow aggregate.



Figure 6.5.3.2.1: UE requested bearer resource allocation procedure

For the NBIFOM procedures as defined in 3GPP  S  24.161  [36], the UE may send a BEARER RESOURCE ALLOCATION REQUEST message to the MME. If the traffic flow aggregate IE is not needed in those procedures, the UE shall set:

-  the length indicator of the Traffic flow aggregate IE to the value 1;

-  the TFT operation code to "000";

-  the E bit to zero; and

-  the number of packet filters to zero;

and in the Required traffic flow QoS IE:

-  the length indicator to the value 1; and

-  the QCI to zero.

6.5.3.3  UE requested bearer resource allocation procedure accepted by the network

Upon receipt of the BEARER RESOURCE ALLOCATION REQUEST message, the MME checks whether the resources requested by the UE can be established by verifying the EPS bearer identity given in the Linked EPS bearer identity IE to be any of the active default EPS bearer context(s).

If the bearer resource allocation requested is accepted by the network, the MME shall initiate either a dedicated EPS bearer context activation procedure or an EPS bearer context modification procedure. Upon receipt of an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message with a PTI which matches the value used for the BEARER RESOURCE ALLOCATION REQUEST message, the UE shall stop timer T3480 and enter the state PROCEDURE TRANSACTION INACTIVE. The UE should ensure that the procedure transaction identity (PTI) assigned to this procedure is not released immediately. The way to achieve this is implementation dependent. While the PTI value is not released, the UE regards any received ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message with the same PTI value as a network retransmission (see clause  7.3.1).

If the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message is received, the UE shall verify that the EPS bearer identity given in the EPS bearer identity IE is not already used by any EPS bearer context. The UE shall then proceed as described in clause 6.4.2.3 or clause 6.4.2.4.

If the MODIFY EPS BEARER CONTEXT REQUEST message is received, the UE verifies that the EPS bearer identity given in the EPS bearer identity IE is any of the active EPS bearer contexts. The UE shall then proceed as described in clause 6.4.3.3 or clause 6.4.3.4.

6.5.3.4  UE requested bearer resource allocation procedure not accepted by the network

6.5.3.4.1  General

If the bearer resource allocation requested cannot be accepted by the network, the MME shall send a BEARER RESOURCE ALLOCATION REJECT message to the UE. The message shall contain the PTI and an ESM cause value indicating the reason for rejecting the UE requested bearer resource allocation.

The ESM cause value typically indicates one of the following:

#26:  insufficient resources;

#30:  request rejected by Serving GW or PDN GW;

#31:  request rejected, unspecified;

#32:  service option not supported;

#33:  requested service option not subscribed;

#34:  service option temporarily out of order;

#35:  PTI already in use;

#37:  EPS QoS not accepted;

#41:  semantic error in the TFT operation;

#42:  syntactical error in the TFT operation;

#43:  invalid EPS bearer identity;

#44:  semantic error(s) in packet filter(s);

#45:  syntactical error(s) in packet filter(s);

#56:  collision with network initiated request;

#59:  unsupported QCI value;

#60:  bearer handling not supported;

#65:  maximum number of EPS bearers reached; or

#95        111:  protocol errors.

If the bearer resource allocation requested is for an established LIPA PDN connection or SIPTO at the local network PDN connection, then the network shall reply with a BEARER RESOURCE ALLOCATION REJECT message with ESM cause #60 "bearer handling not supported".

If the requested new TFT is not available, then the BEARER RESOURCE ALLOCATION REJECT message shall be sent.

The TFT in the request message is checked by the network for different types of TFT IE errors as follows:

a)  Semantic errors in TFT operations:

1)  When the TFT operation is an operation other than "Create a new TFT".

  The network shall reject the allocation request with ESM cause #41 "semantic error in the TFT operation".

b)  Syntactical errors in TFT operations:

1)  When the TFT operation = "Create a new TFT" and the packet filter list in the TFT IE is empty.

2)  When there are other types of syntactical errors in the coding of the TFT IE, such as a mismatch between the number of packet filters subfield, and the number of packet filters in the packet filter list.

  The network shall reject the allocation request with ESM cause #42 "syntactical error in the TFT operation".

c)  Semantic errors in packet filters:

1)  When a packet filter consists of conflicting packet filter components which would render the packet filter ineffective, i.e. no IP packet will ever fit this packet filter. How the network determines a semantic error in a packet filter is outside the scope of the present document.

2)  When the resulting TFT does not contain any packet filter which applicable for the uplink direction.

  The network shall reject the allocation request with ESM cause #44 "semantic errors in packet filter(s)".

d)  Syntactical errors in packet filters:

1)  When the TFT operation = "Create a new TFT" and two or more packet filters in the resultant TFT would have identical packet filter identifiers.

2)  When the TFT operation = "Create a new TFT" and two or more packet filters among all TFTs associated with the PDN connection would have identical packet filter precedence values.

3)  When there are other types of syntactical errors in the coding of packet filters, such as the use of a reserved value for a packet filter component identifier.

  In case 2, if the old packet filters do not belong to the default EPS bearer context, the network shall not diagnose an error, shall further process the new request and, if it was processed successfully, shall delete the old packet filters which have identical filter precedence values. Furthermore, the network shall perform an EPS bearer context deactivation request procedure to deactivate the dedicated EPS bearer context(s) for which it has deleted the packet filters.

  In case 2, if one or more old packet filters belong to the default EPS bearer context, the network shall release the relevant PDN connection using the EPS bearer context deactivation procedure. If it is the last remaining PDN connection and EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the network shall detach the UE using detach type "re-attach required".

  Otherwise the network shall reject the allocation request with ESM cause #45 "syntactical errors in packet filter(s)".

The network may include a Back-off timer value IE in the BEARER RESOURCE ALLOCATION REJECT message.

If the Back-off timer value IE is included and the ESM cause value is different from #26 "insufficient resources" and #65 "maximum number of EPS bearers reached", the network may include the Re-attempt indicator IE to indicate:

-  whether the UE is allowed to attempt a secondary PDP context activation procedure in the PLMN for the same APN in A/Gb or Iu mode or a PDU session modification procedure in the PLMN for the same APN in N1 mode; and

-  whether another attempt in A/Gb and Iu mode, in S1 mode or in N1 mode is allowed in an equivalent PLMN.

Upon receipt of a BEARER RESOURCE ALLOCATION REJECT message, the UE shall stop the timer T3480, release the traffic flow aggregate description associated to the PTI value, and enter the state PROCEDURE TRANSACTION INACTIVE.

6.5.3.4.2  Handling of network rejection due to ESM cause #26

If the ESM cause value is #26 "insufficient resources" and the Back-off timer value IE is included, the UE shall ignore the Re-attempt indicator IE provided by the network, if any, and take different actions depending on the timer value received for timer T3396 in the Back-off timer value IE (if the UE is configured for dual priority, exceptions are specified in clause  6.5.5; if the UE is a UE configured to use AC11        15 in selected PLMN, exceptions are specified in clause  6.3.5):

i)  if the timer value indicates neither zero nor deactivated, the UE shall stop timer T3396 associated with the corresponding APN, if it is running. The UE shall then start T3396 with the value provided in the Back-off timer value IE and not send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in clause  6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for the same APN until timer T3396 expires or timer T3396 is stopped. If the UE did not provide an APN for the establishment of the PDN connection and the request type was different from "emergency" and from "handover of emergency bearer services", the UE shall stop the timer T3396 associated with no APN if it is running. The UE shall start timer T3396 with the received value and not send another PDN CONNECTIVITY REQUEST message without an APN and with request type different from "emergency" and from "handover of emergency bearer services", or another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in clause  6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without an APN provided by the UE, until timer T3396 expires or timer T3396 is stopped. The UE shall not stop timer T3396 upon a PLMN change or inter-system change;

ii)  if the timer value indicates that this timer is deactivated, the UE shall not send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in clause  6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for the same APN until the UE is switched off or the USIM is removed or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message for the same APN from the network or a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause  #39 "reactivation requested" for a default EPS bearer context for the same APN from the network. If the UE did not provide an APN for the establishment of the PDN connection and the request type was different from "emergency" and from "handover of emergency bearer services", the UE shall not send another PDN CONNECTIVITY REQUEST message without an APN and with request type different from "emergency" and from "handover of emergency bearer services", or another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in clause  6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without APN provided by the UE, until the UE is switched off or the USIM is removed, or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message for a non-emergency PDN connection established without an APN provided by the UE, or a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause #39 "reactivation requested" for a default EPS bearer context of a non-emergency PDN connection established without an APN provided by the UE. The timer T3396 remains deactivated upon a PLMN change or inter-system change; or

iii)  if the timer value indicates zero, the UE:

-  shall stop timer T3396 associated with the corresponding APN, if running, and may send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for the same APN; and

-  if the UE did not provide an APN for the establishment of the PDN connection and the request type was different from "emergency" and from "handover of emergency bearer services", the UE shall stop timer T3396 associated with no APN, if running, and may send another PDN CONNECTIVITY REQUEST message without an APN, or another BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without an APN provided by the UE.

If the Back-off timer value IE is not included, the UE may send a PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST messages for the same APN.

The further actions to be performed by the UE are implementation dependent as part of upper layers responsibility.

If the timer T3396 is running when the UE enters state EMM-DEREGISTERED, the UE remains switched on, and the USIM in the UE remains the same, then timer T3396 is kept running until it expires or it is stopped.

If the UE is switched off when the timer T3396 is running, and if the USIM in the UE remains the same when the UE is switched on, the UE behaves as follows:

-  let t1 be the time remaining for T3396 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1        t. If t1 is equal to or less than t, then the timer need not be restarted. If the UE is not capable of determining t, then the UE shall restart the timer with the value t1;

-  if prior to switch off, timer T3396 was running for a specific APN, because a PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message containing the low priority indicator set to "MS is configured for NAS signalling low priority" was rejected with a timer value for timer T3396, and if timer T3396 is restarted at switch on, then the UE configured for dual priority shall handle session management requests as indicated in clause  6.5.5; and

-  if prior to switch off timer T3396 was running because a PDN CONNECTIVITY REQUEST without APN sent together with an ATTACH REQUEST message containing the low priority indicator set to "MS is configured for NAS signalling low priority" was rejected with a timer value for timer T3396, and if timer T3396 is restarted at switch on, then the UE configured for dual priority shall handle session management requests as indicated in clause  6.5.5.

6.5.3.4.3  Handling of network rejection due to ESM cause other than ESM cause #26

If the ESM cause value is different from #26 "insufficient resources" and #65 "maximum number of EPS bearers reached", and the Back-off timer value IE is included, the UE shall behave as follows depending on the timer value received in the Back-off timer value IE (if the UE is a UE configured to use AC11        15 in selected PLMN, exceptions are specified in clause  6.3.6):

-  if the timer value indicates neither zero nor deactivated, the UE shall start the back-off timer with the value provided in the Back-off timer value IE for the bearer resource allocation procedure and PLMN and APN combination and not send another BEARER RESOURCE ALLOCATION REQUEST message in the PLMN for the same APN until the back-off timer expires, the UE is switched off or the USIM is removed;

-  if the timer value indicates that this timer is deactivated, the UE shall not send another BEARER RESOURCE ALLOCATION REQUEST message in the PLMN for the same APN until the UE is switched off or the USIM is removed; and

-  if the timer value indicates zero, the UE may send another BEARER RESOURCE ALLOCATION REQUEST message in the PLMN for the same APN.

If the Back-off timer value IE is not included, then the UE shall ignore the Re-attempt Indicator IE provided by the network, if any.

1)  Additionally, if the ESM cause value is #32 "service option not supported", or #33 "requested service option not subscribed", the UE shall proceed as follows:

-  if the UE is registered in the HPLMN or in a PLMN that is within the EHPLMN list (if the EHPLMN list is present), the UE shall behave as described above in the present clause, using the configured SM_RetryWaitTime value as specified in 3GPP  S  24.368  [15A] or in USIM file NASCONFIG as specified in 3GPP  S  31.102  [17], if available, as back-off timer value; and

NOTE  0:  The way to choose one of the configured SM_RetryWaitTime values for back-off timer value is up to UE implementation if the UE is configured with:
-  an SM_RetryWaitTime value in ME as specified in 3GPP  S  24.368  [15A]; and
-  an SM_RetryWaitTime value in USIM file NASCONFIG as specified in 3GPP  S  31.102  [17].

-  otherwise, if the UE is not registered in its HPLMN or a PLMN that is within the EHPLMN list (if the EHPLMN list is present) or the SM_RetryWaitTime value is not configured, the UE shall behave as described above in the present clause, using the default value of 12 minutes for the back-off timer.

2)  For ESM cause values different from #32 "service option not supported", or #33 "requested service option not subscribed", the UE behaviour regarding the start of a back-off timer is unspecified.

The UE shall not stop any back-off timer upon a PLMN change or inter-system change. If the network indicates that a back-off timer for the bearer resource allocation procedure and PLMN and APN combination is deactivated, then it remains deactivated upon a PLMN change or inter-system change.

NOTE  1:  This means the back-off timer can still be running or be deactivated for the given ESM procedure and PLMN and APN combination when the UE returns to the PLMN or when it performs inter-system change back from A/Gb or Iu mode or N1 mode to S1 mode. Thus the UE can still be prevented from sending another BEARER RESOURCE ALLOCATION REQUEST message in the PLMN for the same APN.

If the back-off timer is started upon receipt of BEARER RESOURCE ALLOCATION REJECT (i.e. the timer value was provided by the network, a configured value is available or the default value is used as explained above) or the back-off timer is deactivated, the UE behaves as follows:

1)  after a PLMN change the UE may send a BEARER RESOURCE ALLOCATION REQUEST message for the same APN in the new PLMN, if the back-off timer is not running and is not deactivated for the bearer resource allocation procedure and the combination of new PLMN and APN;

  Furthermore as an implementation option, for the ESM cause values #32 "service option not supported" or #33 "requested service option not subscribed", if the network does not include a Re-attempt indicator IE, the UE may decide not to automatically send another BEARER RESOURCE ALLOCATION REQUEST message for the same APN that was sent by the UE, if the UE is registered to a new PLMN which is in the list of equivalent PLMNs.

2)  if the network does not include the Re-attempt indicator IE to indicate whether re-attempt in A/Gb or Iu mode or N1 mode is allowed, or the UE ignores the Re-attempt indicator IE, e.g. because the Back-off timer value IE is not included, then:

-  if the UE is registered in its HPLMN or in a PLMN that is within the EHPLMN list (if the EHPLMN list is present), the UE shall apply the configured SM_RetryAtRATChange value as specified in 3GPP  S  24.368  [15A] or in USIM file NASCONFIG as specified in 3GPP  S  31.102  [17], if available, to determine whether the UE may attempt a secondary PDP context activation procedure for the same PLMN and APN combination in A/Gb or Iu mode or a PDU session modification procedure for the same PLMN and APN combination in N1 mode; and

NOTE  2:  The way to choose one of the configured SM_RetryAtRATChange values for back-off timer value is up to UE implementation if the UE is configured with:

-  an SM_RetryAtRATChange value in ME as specified in 3GPP  S  24.368  [15A]; and

-  an SM_RetryAtRATChange value in USIM file NASCONFIG as specified in 3GPP  S  31.102  [17].

-  if the UE is not registered in its HPLMN or in a PLMN that is within the EHPLMN list (if the EHPLMN list is present), or if the NAS configuration MO as specified in 3GPP  S  24.368  [15A] is not available and the value for inter-system change is not configured in the USIM file NASCONFIG, then the UE behaviour regarding a secondary PDP context activation procedure for the same PLMN and APN combination in A/Gb or Iu mode and a PDU session modification procedure for the same PLMN and APN combination in N1 mode are unspecified; and

3)  if the network includes the Re-attempt indicator IE indicating that re-attempt in an equivalent PLMN is not allowed, then depending on the timer value received in the Back-off timer value IE, for each combination of a PLMN from the equivalent PLMN list and the APN the UE shall start a back-off timer for the bearer resource allocation procedure with the value provided by the network, or deactivate the respective back-off timer as follows:

-  if the Re-attempt indicator IE additionally indicates that re-attempt in A/Gb or Iu mode or N1 mode is allowed, the UE shall start or deactivate the back-off timer for S1 mode only; and

-  otherwise the UE shall start or deactivate the back-off timer for A/Gb, Iu, S1 and N1 mode.

If the back-off timer for a PLMN and APN combination was started or deactivated in A/Gb or Iu mode upon receipt of an ACTIVATE SECONDARY PDP CONTEXT REJECT message (see 3GPP  S  24.008  [13]) and the network indicated that re-attempt in S1 mode is allowed, then this back-off timer does not prevent the UE from sending a BEARER RESOURCE ALLOCATION REQUEST message in this PLMN for the same APN after inter-system change to S1 mode. If the network indicated that re-attempt in S1 mode is not allowed, the UE shall not send any BEARER RESOURCE ALLOCATION REQUEST message in this PLMN for the same APN after inter-system change to S1 mode until the timer expires, the UE is switched off or the USIM is removed.

If a back-off timer for a PLMN and APN combination, in combination with any S-NSSAI or without S-NSSAI (see 3GPP  S  24.501  [54]) was started or deactivated in N1 mode upon receipt of a PDU SESSION MODIFICATION REJECT message (see 3GPP  S  24.501  [54]) and the network indicated that re-attempt in S1 mode is allowed, then this back-off timer does not prevent the UE from sending a BEARER RESOURCE ALLOCATION REQUEST message in this PLMN for the same APN after inter-system change to S1 mode. If the network indicated that re-attempt in S1 mode is not allowed, the UE shall not send any BEARER RESOURCE ALLOCATION REQUEST message in this PLMN for the same APN after inter-system change to S1 mode until the timer expires, the UE is switched off or the USIM is removed. If more than one back-off timer for the same PLMN and APN combination was started in N1 mode with an indication from the network that re-attempt in S1 mode is not allowed and no back-off timer for the same PLMN and APN combination was deactivated in N1 mode, the UE shall not send any BEARER RESOURCE ALLOCATION REQUEST message in this PLMN for the same APN after inter-system change to S1 mode until all timers have expired. If at least one back-off timer for the same PLMN and APN combination was deactivated in N1 mode, the UE shall not send any BEARER RESOURCE ALLOCATION REQUEST message in this PLMN for the same APN until the UE is switched off or the USIM is removed.

NOTE  3:  The back-off timer is used to describe a logical model of the required UE behaviour. This model does not imply any specific implementation, e.g. as a timer or timestamp.

NOTE  4:  Reference to back-off timer in this section can either refer to use of timer T3396 or to use of a different packet system specific timer within the UE. Whether the UE uses T3396 as a back-off timer or it uses different packet system specific timers as back-off timers is left up to UE implementation. This back-off timer is stopped when the UE is switched off or the USIM is removed.

If the ESM cause value is #65 "maximum number of EPS bearers reached", the UE shall determine the PLMN   's maximum number of EPS bearer contexts in S1 mode (see clause  6.5.0) as the number of active EPS bearer contexts it has. The UE shall ignore the Back-off timer value IE and Re-attempt indicator IE provided by the network, if any.

NOTE  5:  In some situations, when attempting to establish multiple EPS bearer contexts, the number of active EPS bearer contexts in the UE when cause #65 is received is not equal to the maximum number of EPS bearer contexts reached in the network.

The PLMN   's maximum number of EPS bearer contexts in S1 mode applies to the PLMN in which the ESM cause #65 "maximum number of EPS bearers reached" is received. When the UE is switched off or when the USIM is removed, the UE shall clear all previous determinations representing any PLMN   's maximum number of EPS bearer contexts in S1 mode. Upon successful registration with a new PLMN, the UE may clear previous determinations representing any PLMN   's maximum number of EPS bearer contexts in S1 mode.

The further actions to be performed by the UE are implementation dependent as part of upper layers responsibility.

6.5.3.4A  Handling the maximum number of active EPS bearer contexts

If the UE requests allocation of additional bearer resources, and the network has reached its maximum number of active EPS bearer contexts, then the network can:

-  reject the request if the network decides that it is necessary to allocate a dedicated EPS bearer context; or

-  accept the request by sending a MODIFY EPS BEARER CONTEXT REQUEST message.

NOTE:  An example of where the network will reject the request for allocation of additional bearer resources is when the request includes a GBR requirement while all existing bearers are non-GBR bearers, and the maximum number of active EPS bearer contexts has been reached at the network.

If the maximum number of active EPS bearer contexts is reached at the UE (see clause  6.5.0) and the UE de-activates an active EPS bearer context prior to sending the request for additional bearer resources, then choosing which EPS bearer context to de-activate is a implementation specific, however the UE shall not deactivate a default EPS bearer context for emergency.

6.5.3.5  Abnormal cases in the UE

The following abnormal cases can be identified:

a)  Expiry of timer T3480:

  On the first expiry of the timer T3480, the UE shall resend the BEARER RESOURCE ALLOCATION REQUEST and shall reset and restart timer T3480. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3480, the UE shall abort the procedure, release the PTI allocated for this activation and enter the state PROCEDURE TRANSACTION INACTIVE.

b)  Unknown EPS bearer context

  Upon receipt of the BEARER RESOURCE ALLOCATION REJECT message including ESM cause #43 "invalid EPS bearer identity", the UE shall deactivate the existing default EPS bearer context locally without peer-to-peer signalling between the UE and the MME and shall stop the timer T3480.

c)  Collision of a UE requested bearer resource allocation procedure and an EPS bearer context deactivation procedure.

  When the UE receives a DEACTIVATE EPS BEARER CONTEXT REQUEST message for the default EPS bearer context related to the UE requested bearer resource allocation procedure, the UE shall abort the UE requested bearer resource allocation procedure and shall stop the timer T3480 and proceed with the EPS bearer context deactivation procedure.

6.5.3.6  Abnormal cases on the network side

The following abnormal case can be identified:

a)  No PDN connection with the linked EPS bearer identity activated:

  If the linked EPS bearer identity included in the BEARER RESOURCE ALLOCATION REQUEST message does not belong to the default EPS bearer context of an established PDN connection, the MME shall reply with a BEARER RESOURCE ALLOCATION REJECT message with ESM cause #43 "invalid EPS bearer identity".

b)  BEARER RESOURCE ALLOCATION REQUEST message received for a PDN connection established for emergency bearer services:

  The MME shall reply with a BEARER RESOURCE ALLOCATION REJECT message with ESM cause #31 "request rejected, unspecified".

6.5.4  UE requested bearer resource modification procedure

6.5.4.1  General

The purpose of the UE requested bearer resource modification procedure is for a UE to:

a)  request a modification;

b)  release of bearer resources for a traffic flow aggregate;

c)  modify a traffic flow aggregate by replacing packet filters or adding packet filters;

d)  re-negotiate header compression configuration associated to an EPS bearer context;

e)  indicate a change of 3GPP PS data off UE status for a PDN connection; or

f)  transmit information for the C2 authorization for the UAS services.

When requesting a modification of bearer resources for a traffic flow aggregate or a modification of a traffic flow aggregate, the UE can modify the existing GBR. If accepted by the network, this procedure invokes a dedicated EPS bearer context activation procedure (see clause  6.4.2), an EPS bearer context modification procedure (see clause  6.4.3), or an EPS bearer context deactivation procedure (see clause  6.4.4).

If there is a PDN connection for emergency bearer services established, the UE shall not request a modification of bearer resources for this PDN connection.

When the UE requested bearer resource modification procedure is used to indicate a change of 3GPP PS data off UE status for a PDN connection (see clause  6.3.10), the UE shall initiate the UE requested bearer resource modification procedure even if the timer T3396 or the back-off timer is running or is deactivated.

6.5.4.2  UE requested bearer resource modification procedure initiation

In order to request the modification of bearer resources for one traffic flow aggregate, the UE shall send a BEARER RESOURCE MODIFICATION REQUEST message to the MME, start timer T3481 and enter the state PROCEDURE TRANSACTION PENDING (see example in figure  6.5.4.2.1).

The UE shall include the EPS bearer identity of the EPS bearer associated with the traffic flow aggregate in the EPS bearer identity for packet filter IE.

To request a change of the GBR without changing the packet filter(s), the UE shall set the TFT operation code in the Traffic flow aggregate IE to "no TFT operation" and include the packet filter identifier(s) to which the change of the GBR applies in the Packet filter identifier parameter in the parameters list. The UE shall indicate the new GBR requested for the EPS bearer context in the Required traffic flow QoS IE.

To request a modification of a traffic flow aggregate, the UE shall set the TFT operation code in the Traffic flow aggregate IE to "Replace packet filters in existing TFT" or "Add packet filters to existing TFT". If the TFT operation code is set to "Add packet filters to existing TFT", the UE shall include in the parameter list one existing packet filter identifier to which the newly added packet filter(s) is linked. If the EPS bearer is a GBR bearer and the UE also wishes to request a change of GBR, the UE shall indicate the new GBR requested for the EPS bearer context in the Required traffic flow QoS IE.

To request a release of bearer resources, the UE shall set the TFT operation code in the Traffic flow aggregate IE to "Delete packet filters from existing TFT". If the EPS bearer is a GBR bearer and the UE does not request the release of all bearer resources, the UE shall indicate the new GBR requested for the EPS bearer context in the Required traffic flow QoS IE.

To request re-negotiation of header compression configuration associated to an EPS bearer context, the UE shall include the Header compression configuration IE in the BEARER RESOURCE MODIFICATION REQUEST message if the network indicated "Control plane CIoT EPS optimization supported" and "Header compression for control plane CIoT EPS optimization supported" in the EPS network feature support IE.

After an inter-system change from N1 mode to S1 mode, if:

a)  the UE is operating in single-registration mode and has received the interworking without N26 interface indicator set to "interworking without N26 interface not supported" from the network;

b)  the PDN type value of the PDN type IE is set to "IPv4", "IPv6" or "IPv4v6";

c)  the UE indicates "Control plane CIoT EPS optimization supported" and "Header compression for control plane CIoT EPS optimization supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message; and

d)  the network indicates "Control plane CIoT EPS optimization supported" and "Header compression for control plane CIoT EPS optimization supported" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message;

the UE shall send a BEARER RESOURCE MODIFICATION REQUEST message to the MME and include the Header compression configuration IE to negotiate the header compression configuration.

To indicate a change of 3GPP PS data off UE status associated to a PDN connection, the UE shall include the protocol configuration options IE in the BEARER RESOURCE MODIFICATION REQUEST message and set the 3GPP PS data off UE status only if:

-  the network included the 3GPP PS data off support indication in the protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message when the PDN connection was established; or

-  the PDU session was established when in N1 mode.

To indicate a change of 3GPP PS data off UE status, the UE shall include the EPS bearer identity of the default EPS bearer context of the PDN connection, for which the UE wishes a change of the 3GPP PS data off UE status, in the EPS bearer identity for packet filter IE.

The UE behaves as described in clause  6.3.10.

If the UE requests the modification of a traffic flow aggregate, which is assigned to a dedicated EPS bearer context, it shall ensure that at least one packet filter applicable for the uplink direction remains among the packet filters created on request from the UE in that TFT, or no own packet filters.

NOTE:  If the UE requests the release of all bearer resources of a GBR bearer and includes a Required traffic flow QoS IE in the BEARER RESOURCE MODIFICATION REQUEST message, the network ignores the Required traffic flow QoS IE.

If the UE includes the Required traffic flow QoS IE, the UE shall set the QCI to the current QCI value of the EPS bearer context.

If the UE requests the release of bearer resources, the ESM cause value typically indicates one of the following:

#36:  regular deactivation.

To perform authorization for the C2 communication when a PDN connection is already established for the USS communication, the UE shall include the extended protocol configuration options IE in the BEARER RESOURCE MODIFICATION REQUEST message containing the service-level-AA container with the length of two octets. In the service-level-AA container with the length of two octets, the UE shall include:

a)  the service-level device ID, with the value set to CAA-level UAV ID;

b)  if provided by the upper layers, the service-level-AA payload type parameter with the value set to "C2 authorization payload"; and

c)  the service-level-AA payload parameter, with the value set to C2 authorization payload.

NOTE:  C2 authorization payload can contain pairing information for C2 communication and flight authorization information.





Figure 6.5.4.2.1: UE requested bearer resource modification procedure

For the NBIFOM procedures as defined in 3GPP  S  24.161  [36], the UE may send a BEARER RESOURCE MODIFICATION REQUEST message to the MME.

It is possible that the traffic flow aggregate IE is not needed in the following procedures:

-  re-negotiation of header compression configuration associated to an EPS bearer context;

-  indicating a change of 3GPP PS data off UE status associated to a PDN connection; or

-  NBIFOM procedures.

If the traffic flow aggregate IE is not needed, the UE shall set:

-  the length indicator of the Traffic flow aggregate IE to the value 1;

-  the TFT operation code to "000";

-  the E bit to zero; and

-  the number of packet filters to zero.

6.5.4.3  UE requested bearer resource modification procedure accepted by the network

Upon receipt of the BEARER RESOURCE MODIFICATION REQUEST message, the MME checks whether the resources requested by the UE can be established, modified or released by verifying the EPS bearer identity given in the EPS bearer identity for packet filter IE.

If the bearer resource modification requested is accepted by the network, the MME shall initiate either a dedicated EPS bearer context activation procedure, an EPS bearer context modification procedure or an EPS bearer context deactivation procedure.

If the request to re-negotiate header compression configuration associated to an EPS bearer context is accepted by the network, the MME shall initiate an EPS bearer context modification procedure.

If the bearer resource modification requests a release of bearer resources that results in the TFT of the EPS bearer context containing only packet filters applicable to the uplink direction, the network may initiate the EPS bearer context deactivation procedure.

Upon receipt of an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST, MODIFY EPS BEARER CONTEXT REQUEST or DEACTIVATE EPS BEARER CONTEXT REQUEST message with a PTI which matches the value used for the BEARER RESOURCE MODIFICATION REQUEST message, the UE shall stop timer T3481 and enter the state PROCEDURE TRANSACTION INACTIVE. The UE should ensure that the procedure transaction identity (PTI) assigned to this procedure is not released immediately. The way to achieve this is implementation dependent. While the PTI value is not released, the UE regards any received ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST or DEACTIVATE EPS BEARER CONTEXT REQUEST message with the same PTI value as a network retransmission (see clause  7.3.1).

i)  If the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message is received, the UE shall verify that the EPS bearer identity given in the EPS bearer identity IE is not already used by any EPS bearer context. The UE shall then proceed as described in clause  6.4.2.3 or clause  6.4.2.4.

ii)  If the MODIFY EPS BEARER CONTEXT REQUEST message is received, the UE verifies that the EPS bearer identity given in the EPS bearer identity IE is any of the active EPS bearer contexts. The UE shall then proceed as described in clause  6.4.3.3 or clause  6.4.3.4.

iii)  If the DEACTIVATE EPS BEARER CONTEXT REQUEST message is received, the UE verifies that the EPS bearer identity given in the EPS bearer identity IE is one of the active EPS bearer contexts. The UE shall then proceed as described in clause  6.4.4.3.

In case i, after successful completion of the dedicated EPS bearer context activation procedure, the network may initiate an EPS bearer context modification procedure to delete the packet filters which have packet filter identifiers indicated by the UE in the Traffic flow aggregate IE in the BEARER RESOURCE MODIFICATION REQUEST message and for which the network created new packet filters during the dedicated EPS bearer context activation procedure. In this case the MME shall set the procedure transaction identity value in the MODIFY EPS BEARER CONTEXT REQUEST message to "no procedure transaction identity assigned".

6.5.4.4  UE requested bearer resource modification procedure not accepted by the network

6.5.4.4.1  General

If the bearer resource modification requested cannot be accepted by the network, the MME shall send a BEARER RESOURCE MODIFICATION REJECT message to the UE. The message shall contain the PTI and an ESM cause value indicating the reason for rejecting the UE requested bearer resource modification.

The ESM cause value typically indicates one of the following:

#26:  insufficient resources;

#30:  request rejected by Serving GW or PDN GW;

#31:  request rejected, unspecified;

#32:  service option not supported;

#33:  requested service option not subscribed;

#34:  service option temporarily out of order;

#35:  PTI already in use;

#37:  EPS QoS not accepted;

#41:  semantic error in the TFT operation;

#42:  syntactical error in the TFT operation;

#43:  invalid EPS bearer identity;

#44:  semantic error(s) in packet filter(s);

#45:  syntactical error(s) in packet filter(s);

#56:  collision with network initiated request;

#59:  unsupported QCI value;

#60:  bearer handling not supported; or

#95        111:  protocol errors.

If the bearer resource modification requested is for an established LIPA PDN connection or SIPTO at the local network PDN connection, then the network shall reply with a BEARER RESOURCE MODIFICATION REJECT message with ESM cause #60 "bearer handling not supported".

If the requested new TFT is not available, then the BEARER RESOURCE MODIFICATION REJECT message shall be sent.

The TFT in the request message is checked by the network for different types of TFT IE errors as follows:

a)  Semantic errors in TFT operations:

1)  When the TFT operation is an operation other than "Replace packet filters in existing TFT", "Add packet filters to existing TFT", "Delete packet filters from existing TFT" or "No TFT operation".

2)  When the TFT operation is "Replace packet filters in existing TFT", "Add packet filters to existing TFT" or "Delete packet filters from existing TFT", the EPS bearer context being modified is the default EPS bearer content and there is no TFT for the default EPS bearer context.

3)  TFT operation = "Delete packet filters from existing TFT" when it would render the TFT empty.

  In case 1 the network shall reject the modification request with ESM cause #41 "semantic error in the TFT operation".

  In case 2, if the TFT operation is "Delete packet filters from existing TFT", the network shall further process the new request and, if no error according to items b, c, and d was detected, shall perform an EPS bearer context modification procedure including the value of EPS bearer identity for packet filter IE in the EPS bearer identity IE and a TFT IE with TFT operation = "Delete existing TFT" in the MODIFY EPS BEARER CONTEXT REQUEST message.

  In case 2, if the TFT operation is "Replace packet filters in existing TFT" or "Add packet filters to existing TFT", the network shall process the new request as a request with TFT operation = "Create a new TFT".

  In case 3, if the packet filters belong to a dedicated EPS bearer context, the network shall process the new deletion request and, if no error according to items b, c, and d was detected, delete the existing TFT. After successful deletion of the TFT, the network shall perform an EPS bearer context deactivation request procedure to deactivate the dedicated EPS bearer context between the UE and the network.

  In case 3, if the packet filters belong to the default EPS bearer context, the network shall process the new deletion request and if no error according to items b, c, and d was detected then perform an EPS bearer context modification procedure to remove the existing TFT of the default EPS bearer context, this corresponds to using match-all packet filter for the default EPS bearer context.

b)  Syntactical errors in TFT operations:

1)  When the TFT operation = "Replace packet filters in existing TFT", "Add packet filters to existing TFT" or "Delete packet filters from existing TFT", and the packet filter list in the TFT IE is empty.

2)  TFT operation = "No TFT operation" with a non-empty packet filter list in the TFT IE.

3)  TFT operation = "Replace packet filters in existing TFT" when the packet filter to be replaced does not exist in the original TFT.

4)  TFT operation = "Delete packet filters from existing TFT" when the packet filter to be deleted does not exist in the original TFT.

5)  Void

6)  When there are other types of syntactical errors in the coding of the TFT IE, such as a mismatch between the number of packet filters subfield, and the number of packet filters in the packet filter list.

7)  TFT operation = "No TFT operation" with an empty parameters list.

  In case 3 the network shall not diagnose an error, shall further process the replace request and, if no error according to items c and d was detected, shall perform an EPS bearer context modification procedure using TFT operation = "Add packet filters to existing TFT" to include the packet filters received to the existing TFT.

  In case 4 the network shall not diagnose an error, shall further process the deletion request and, if no error according to items c and d was detected, shall perform an EPS bearer context modification procedure including the value of EPS bearer identity for packet filter IE in the EPS bearer identity IE and a TFT IE with TFT operation = "Delete packet filters from existing TFT" and the received packet filter identifier(s) in the MODIFY EPS BEARER CONTEXT REQUEST message.

  Otherwise the network shall reject the modification request with ESM cause #42 "syntactical error in the TFT operation".

c)  Semantic errors in packet filters:

1)  When a packet filter consists of conflicting packet filter components which would render the packet filter ineffective, i.e. no IP packet will ever fit this packet filter. How the network determines a semantic error in a packet filter is outside the scope of the present document.

2)  When the resulting TFT, which is assigned to a dedicated EPS bearer context, does not contain any packet filter applicable for the uplink direction.

  The network shall reject the modification request with ESM cause #44 "semantic errors in packet filter(s)".

d)  Syntactical errors in packet filters:

1)  When the TFT operation = "Replace packet filters in existing TFT" or "Add packet filters to existing TFT", and two or more packet filters in the resultant TFT would have identical packet filter identifiers.

2)  When the TFT operation = "Replace packet filters in existing TFT" or "Add packet filters to existing TFT", and two or more packet filters in all TFTs associated with the PDN connection would have identical packet filter precedence values.

3)  When there are other types of syntactical errors in the coding of packet filters, such as the use of a reserved value for a packet filter component identifier.

  In case 2, if the old packet filters do not belong to the default EPS bearer context, the network shall not diagnose an error, shall further process the new request and, if it was processed successfully, shall delete the old packet filters which have identical filter precedence values. Furthermore, the network shall perform an EPS bearer context deactivation procedure to deactivate the dedicated EPS bearer context(s) for which it has deleted the packet filters.

  In case 2, if one or more old packet filters belong to the default EPS bearer context, the network shall release the relevant PDN connection using the EPS bearer context deactivation procedure. If the relevant PDN connection is the last one and EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the network shall detach the UE using detach type "re-attach required".

  Otherwise the network shall reject the modification request with ESM cause #45 "syntactical errors in packet filter(s)".

The network may include a Back-off timer value IE in the BEARER RESOURCE MODIFICATION REJECT message.

The network shall not include the ESM cause value #26 "insufficient resources" in the BEARER RESOURCE MODIFICATION REJECT message due to APN based congestion control being active.

If the Back-off timer value IE is included and the ESM cause value is not #26 "insufficient resources", the network may include the Re-attempt indicator IE to indicate:

-  whether the UE is allowed to attempt a PDP context modification procedure in the PLMN for the same APN in A/Gb or Iu mode or a PDU session modification procedure in the PLMN for the same APN in N1 mode; and

-  whether another attempt in A/Gb and Iu mode, in S1 mode or in N1 mode is allowed in an equivalent PLMN.

Upon receipt of a BEARER RESOURCE MODIFICATION REJECT message, the UE shall stop the timer T3481, release the traffic flow aggregate description associated to the PTI value, and enter the state PROCEDURE TRANSACTION INACTIVE. If the ESM cause included in the BEARER RESOURCE MODIFICATION REJECT message is #43 "invalid EPS bearer identity", the UE locally deactivates the EPS bearer context(s) without peer-to-peer ESM signalling.

6.5.4.4.2  Handling of network rejection due to ESM cause #26

If the ESM cause value is #26 "insufficient resources" and the Back-off timer value IE is included, the UE shall ignore the Re-attempt indicator IE provided by the network, if any, and take different actions depending on the timer value received for timer T3396 in the Back-off timer value IE (if the UE is configured for dual priority, exceptions are specified in clause  6.5.5; if the UE is a UE configured to use AC11        15 in selected PLMN, exceptions are specified in clause  6.3.5):

i)  if the timer value indicates neither zero nor deactivated, the UE shall stop timer T3396 associated with the corresponding APN, if it is running. The UE shall then start T3396 with the value provided in the Back-off timer value IE and not send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in clause  6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for the same APN until timer T3396 expires or timer T3396 is stopped. If the UE did not provide an APN for the establishment of the PDN connection and the request type was different from "emergency" and from "handover of emergency bearer services", the UE shall stop the timer T3396 associated with no APN if it is running. The UE shall start timer T3396 with the received value and not send another PDN CONNECTIVITY REQUEST message without an APN and with request type different from "emergency" and from "handover of emergency bearer services", or another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in clause  6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without an APN provided by the UE, until timer T3396 expires or timer T3396 is stopped. The UE shall not stop timer T3396 upon a PLMN change or inter-system change;

ii)  if the timer value indicates that this timer is deactivated, the UE shall not send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in clause  6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for the same APN until the UE is switched off or the USIM is removed or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message for the same APN from the network or a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause  #39 "reactivation requested" for a default EPS bearer context for the same APN from the network. If the UE did not provide an APN for the establishment of the PDN connection and the request type was different from "emergency" and from "handover of emergency bearer services", the UE shall not send another PDN CONNECTIVITY REQUEST message without an APN and with request type different from "emergency" and from "handover of emergency bearer services", or another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in clause  6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without APN provided by the UE, until the UE is switched off or the USIM is removed, or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message for a non-emergency PDN connection established without an APN provided by the UE, or a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause #39 "reactivation requested" for a default EPS bearer context of a non-emergency PDN connection established without an APN provided by the UE. The timer T3396 remains deactivated upon a PLMN change or inter-system change; or

iii)  if the timer value indicates zero, the UE:

-  shall stop timer T3396 associated with the corresponding APN, if running, and may send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for the same APN; and

-  if the UE did not provide an APN for the establishment of the PDN connection and the request type was different from "emergency" and from "handover of emergency bearer services", the UE shall stop timer T3396 associated with no APN, if running, and may send another PDN CONNECTIVITY REQUEST message without an APN, or another BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without an APN provided by the UE.

If the Back-off timer value IE is not included, the UE may send a PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST messages for the same APN.

The further actions to be performed by the UE are implementation dependent as part of upper layers responsibility.

If the timer T3396 is running when the UE enters state EMM-DEREGISTERED, the UE remains switched on, and the USIM in the UE remains the same, then timer T3396 is kept running until it expires or it is stopped.

If the UE is switched off when the timer T3396 is running, and if the USIM in the UE remains the same when the UE is switched on, the UE behaves as follows:

-  let t1 be the time remaining for T3396 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than  , then the timer shall be restarted with the value t1        t. If t1 is equal to or less than t, then the timer need not be restarted. If the UE is not capable of determining t, then the UE shall restart the timer with the value t1;

-  if prior to switch off, timer T3396 was running for a specific APN, because a PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message containing the low priority indicator set to "MS is configured for NAS signalling low priority" was rejected with a timer value for timer T3396, and if timer T3396 is restarted at switch on, then the UE configured for dual priority shall handle session management requests as indicated in clause  6.5.5; and

-  if prior to switch off timer T3396 was running because a PDN CONNECTIVITY REQUEST without APN sent together with an ATTACH REQUEST message containing the low priority indicator set to "MS is configured for NAS signalling low priority" was rejected with a timer value for timer T3396, and if timer T3396 is restarted at switch on, then the UE configured for dual priority shall handle session management requests as indicated in clause  6.5.5.

6.5.4.4.3  Handling of network rejection due to ESM cause other than ESM cause #26

If the ESM cause value is not #26 "insufficient resources", and the Back-off timer value IE is included, the UE shall behave as follows depending on the timer value received in the Back-off timer value IE (if the UE is a UE configured to use AC11        15 in selected PLMN, exceptions are specified in clause  6.3.6):

-  if the timer value indicates neither zero nor deactivated, the UE shall start the back-off timer with the value provided in the Back-off timer value IE for the bearer resource modification procedure and PLMN and APN combination and not send another BEARER RESOURCE MODIFICATION REQUEST message with exception of those identified in clause  6.5.4.1, in the PLMN for the same APN until the back-off timer expires, the UE is switched off or the USIM is removed;

-  if the timer value indicates that this timer is deactivated, the UE shall not send another BEARER RESOURCE MODIFICATION REQUEST message with exception of those identified in clause  6.5.4.1, in the PLMN for the same APN until the UE is switched off or the USIM is removed; and

-  if the timer value indicates zero, the UE may send another BEARER RESOURCE MODIFICATION REQUEST message in the PLMN for the same APN.

If the Back-off timer value IE is not included, then the UE shall ignore the Re-attempt indicator IE provided by the network, if any.

1)  Additionally, if the ESM cause value is #32 "service option not supported", or #33 "requested service option not subscribed", the UE shall proceed as follows:

-  if the UE is registered in the HPLMN or in a PLMN that is within the EHPLMN list (if the EHPLMN list is present), the UE shall behave as described above in the present clause, using the configured SM_RetryWaitTime value as specified in 3GPP  S  24.368  [15A] or in USIM file NASCONFIG as specified in 3GPP  S  31.102  [17], if available, as back-off timer value; and

NOTE  0:  The way to choose one of the configured SM_RetryWaitTime values for back-off timer value is up to UE implementation if the UE is configured with:
-  an SM_RetryWaitTime value in ME as specified in 3GPP  S  24.368  [15A]; and
-  an SM_RetryWaitTime value in USIM file NASCONFIG as specified in 3GPP  S  31.102  [17].

-  otherwise, if the UE is not registered in its HPLMN or a PLMN that is within the EHPLMN list (if the EHPLMN list is present) or the SM_RetryWaitTime value is not configured, the UE shall behave as described above in the present clause, using the default value of 12 minutes for the back-off timer.

2)  For ESM cause values different from #32 "service option not supported", or #33 "requested service option not subscribed", the UE behaviour regarding the start of a back-off timer is unspecified.

The UE shall not stop any back-off timer upon a PLMN change or inter-system change. If the network indicates that a back-off timer for the bearer resource modification procedure and PLMN and APN combination is deactivated, then it remains deactivated upon a PLMN change or inter-system change.

NOTE  1:  This means the back-off timer can still be running or be deactivated for the given ESM procedure and PLMN and APN combination when the UE returns to the PLMN or when it performs inter-system change back from A/Gb or Iu mode or N1 mode to S1 mode. Thus the UE can still be prevented from sending another BEARER RESOURCE MODIFICATION REQUEST message with exception of those identified in clause  6.5.4.1, in the PLMN for the same APN.

If the back-off timer is started upon receipt of BEARER RESOURCE MODIFICATION REJECT (i.e. the timer value was provided by the network, a configured value is available or the default value is used as explained above) or the back-off timer is deactivated, the UE behaves as follows:

1)  after a PLMN change the UE may send a BEARER RESOURCE MODIFICATION REQUEST message for the same APN in the new PLMN, if the back-off timer is not running and is not deactivated for the bearer resource modification procedure and the combination of new PLMN and APN;

  Furthermore as an implementation option, for the ESM cause values #32 "service option not supported" or #33 "requested service option not subscribed", if the network does not include a Re-attempt indicator IE, the UE may decide not to automatically send another BEARER RESOURCE MODIFICATION REQUEST message for the same APN that was sent by the UE, if the UE is registered to a new PLMN which is in the list of equivalent PLMNs.

2)  if the network does not include the Re-attempt indicator IE to indicate whether re-attempt in A/Gb or Iu mode or N1 mode is allowed, or the UE ignores the Re-attempt indicator IE, e.g. because the Back-off timer value IE is not included, then:

-  if the UE is registered in its HPLMN or in a PLMN that is within the EHPLMN list (if the EHPLMN list is present), the UE shall apply the configured SM_RetryAtRATChange value as specified in 3GPP  S  24.368  [15A] or in USIM file NASCONFIG as specified in 3GPP  S  31.102  [17], if available, to determine whether the UE may attempt a PDP context modification procedure for the same PLMN and APN combination in A/Gb or Iu mode or a PDU session modification procedure for the same PLMN and APN combination in N1 mode; and

NOTE  2:  The way to choose one of the configured SM_RetryAtRATChange values for back-off timer value is up to UE implementation if the UE is configured with:

-  an SM_RetryAtRATChange value in ME as specified in 3GPP  S  24.368  [15A]; and

-  an SM_RetryAtRATChange value in USIM file NASCONFIG as specified in 3GPP  S  31.102  [17].

-  if the UE is not registered in its HPLMN or in a PLMN that is within the EHPLMN list (if the EHPLMN list is present), or if the NAS configuration MO as specified in 3GPP TS 24.368 [15A] is not available and the value for inter-system change is not configured in the USIM file NASCONFIG, then the UE behaviour regarding a PDP context modification procedure for the same PLMN and APN combination in A/Gb or Iu mode and a PDU session modification procedure for the same PLMN and APN combination in N1 mode are unspecified; and

3)  if the network includes the Re-attempt indicator IE indicating that re-attempt in an equivalent PLMN is not allowed, then depending on the timer value received in the Back-off timer value IE, for each combination of a PLMN from the equivalent PLMN list and the APN the UE shall start a back-off timer for the bearer resource modification procedure with the value provided by the network, or deactivate the respective back-off timer as follows:

-  if the Re-attempt indicator IE additionally indicates that re-attempt in A/Gb or Iu mode or N1 mode is allowed, the UE shall start or deactivate the back-off timer for S1 mode only; and

-  otherwise the UE shall start or deactivate the back-off timer for A/Gb, Iu, S1 and N1 mode.

If the back-off timer for a PLMN and APN combination was started or deactivated upon receipt of an MODIFY PDP CONTEXT REJECT message (see 3GPP  S  24.008  [13]) and the network indicated that re-attempt in S1 mode is allowed, then this back-off timer does not prevent the UE from sending a BEARER RESOURCE MODIFICATION REQUEST message in this PLMN for the same APN after inter-system change to S1 mode. If the network indicated that re-attempt in S1 mode is not allowed, the UE shall not send any BEARER RESOURCE MODIFICATION REQUEST message in this PLMN for the same APN after inter-system change to S1 mode until the timer expires, the UE is switched off or the USIM is removed.

If a back-off timers for a PLMN and APN combination, in combination with any S-NSSAI or without S-NSSAI (see 3GPP  S  24.501  [54]) was started or deactivated in N1 mode upon receipt of a PDU SESSION MODIFICATION REJECT message (see 3GPP  S  24.501  [54]) and the network indicated that re-attempt in S1 mode is allowed, then this back-off timer does not prevent the UE from sending a BEARER RESOURCE MODIFICATION REQUEST message in this PLMN for the same APN after inter-system change to S1 mode. If the network indicated that re-attempt in S1 mode is not allowed, the UE shall not send any BEARER RESOURCE MODIFICATION REQUEST message in this PLMN for the same APN after inter-system change to S1 mode until the timer expires, the UE is switched off or the USIM is removed. If more than one back-off timer for the same PLMN and APN combination was started in N1 mode with an indication from the network that re-attempt in S1 mode is not allowed and no back-off timer for the same PLMN and APN combination was deactivated in N1 mode, the UE shall not send any BEARER RESOURCE MODIFICATION REQUEST message in this PLMN for the same APN after inter-system change to S1 mode until all timers have expired. If at least one back-off timer for the same PLMN and APN combination was deactivated in N1 mode, the UE shall not send any BEARER RESOURCE MODIFICATION REQUEST message in this PLMN for the same APN until the UE is switched off or the USIM is removed.

NOTE  3:  The back-off timer is used to describe a logical model of the required UE behaviour. This model does not imply any specific implementation, e.g. as a timer or timestamp.

NOTE  4:  Reference to back-off timer in this section can either refer to use of timer T3396 or to use of a different packet system specific timer within the UE. Whether the UE uses T3396 as a back-off timer or it uses different packet system specific timers as back-off timers is left up to UE implementation. This back-off timer is stopped when the UE is switched off or the USIM is removed.

The further actions to be performed by the UE are implementation dependent as part of upper layers responsibility.

6.5.4.5  Abnormal cases in the UE

The following abnormal cases can be identified:

a)  Expiry of timer T3481:

  On the first expiry of the timer T3481, the UE shall resend the BEARER RESOURCE MODIFICATION REQUEST and shall reset and restart timer T3481. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3481, the UE shall abort the procedure, release the PTI allocated for this activation and enter the state PROCEDURE TRANSACTION INACTIVE. In addition, if the UE had initiated resource release for all the traffic flows for the bearer, it shall deactivate the EPS bearer context locally without peer-to-peer signalling between the UE and the MME. In order to synchronize the EPS bearer context status with the MME, on indication of "back to E-UTRAN coverage" from the lower layers, the UE shall send a TRACKING AREA UPDATE REQUEST message that includes the EPS bearer context status IE to the MME.

b)  Unknown EPS bearer context:

  Upon receipt of the BEARER RESOURCE MODIFICATION REJECT message including ESM cause #43 "invalid EPS bearer identity", the UE shall deactivate the existing EPS bearer context locally without peer-to-peer signalling between the UE and the MME and shall stop the timer T3481.

c)  Collision of a UE requested bearer resource modification procedure and an EPS bearer context deactivation procedure:

  When the UE receives a DEACTIVATE EPS BEARER CONTEXT REQUEST message during the bearer resource modification procedure, and the EPS bearer identity indicated in the DEACTIVATE EPS BEARER CONTEXT REQUEST message is an EPS bearer context the UE indicated in the UE requested bearer resource modification procedure, then the UE shall abort the UE requested bearer resource modification procedure and shall stop the timer T3481 and proceed with the EPS bearer context deactivation procedure.

d)  Rejection of a UE requested bearer resource modification procedure when the UE has initiated the procedure to release all traffic flows for the bearer:

  Upon receipt of a BEARER RESOURCE MODIFICATION REJECT message with ESM cause value #31 "request rejected, unspecified", if the UE had initiated resource release for all the traffic flows for the bearer, it shall deactivate the EPS bearer context locally without peer-to-peer signalling between the UE and the MME and shall stop the timer T3481. In order to synchronize the EPS bearer context status with the MME, the UE may send a TRACKING AREA UPDATE REQUEST message that includes the EPS bearer context status IE to the MME.

e)  Collision of UE requested bearer resource modification procedure and EPS bearer context modification procedure:

  The handling of the same abnormal case as described in clause  6.4.3.5 applies.

6.5.4.6  Abnormal cases on the network side

The following abnormal cases can be identified:

a)  Unknown EPS bearer context:

  If the EPS bearer identity provided in the EPS bearer identity for packet filter IE in the BEARER RESOURCE MODIFICATION REQUEST message indicates an EPS bearer identity value and this does not belong to any already activated EPS bearer context, the MME shall reply with a BEARER RESOURCE MODIFICATION REJECT message with ESM cause #43 "invalid EPS bearer identity".

b)  BEARER RESOURCE MODIFICATION REQUEST message received for a PDN connection established for emergency bearer services:

  The MME shall reply with a BEARER RESOURCE MODIFICATION REJECT message with ESM cause #30 "request rejected by Serving GW or PDN GW".

c)  Collision of UE requested bearer resource modification procedure and EPS bearer context modification procedure:

  The handling of the same abnormal case as described in clause  6.4.3.6 applies.

6.5.5  Handling session management request for UE configured for dual priority

If timer T3396 is running for a specific APN due to one of the following reasons:

-  a PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message containing the low priority indicator set to "MS is configured for NAS signalling low priority" was rejected with a timer value for timer T3396 and ESM cause value #26 "insufficient resources";

-  a DEACTIVATE EPS BEARER CONTEXT REQUEST message was received with a timer value for timer T3396 and ESM cause value #26 "insufficient resources" for a PDN connection established with low priority indicator set to "MS is configured for NAS signalling low priority", or

-  because the UE received a DEACTIVATE EPS BEARER CONTEXT REQUEST message containing a timer value for timer T3396 and ESM cause value #26 "insufficient resources" for a PDN connection established with low priority indicator set to "MS is configured for NAS signalling low priority",

upon request of the upper layers the UE can:

-  send a PDN CONNECTIVITY REQUEST message to the same APN, with low priority indicator set to "MS is not configured for NAS signalling low priority"; or,

-  send a BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message, with low priority indicator set to "MS is not configured for NAS signalling low priority", for a PDN connection established with low priority indicator set to "MS is not configured for NAS signalling low priority" exists.

If timer T3396 is running, because any of the following messages containing the low priority indicator set to "MS is configured for NAS signalling low priority" was rejected with a timer value for timer T3396 and ESM cause value #26 "insufficient resources":

-  a PDN CONNECTIVITY REQUEST without APN and with request type different from "emergency" and from "handover of emergency bearer services", sent together with an ATTACH REQUEST message;

-  a stand-alone PDN CONNECTIVITY REQUEST message without APN and with request type different from "emergency" and from "handover of emergency bearer services"; or

-  a BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message sent for a non-emergency PDN connection established without APN provided by the UE,

or because the UE received a DEACTIVATE EPS BEARER CONTEXT REQUEST message containing a timer value for timer T3396 and ESM cause value #26 "insufficient resources" for a non-emergency PDN connection established without APN provided by the UE and established with low priority indicator set to "MS is configured for NAS signalling low priority", then upon request of the upper layers the UE can initiate a new attach procedure or stand-alone PDN CONNECTIVITY REQUEST procedure without APN and with request type different from "emergency" and from "handover of emergency bearer services", with low priority indicator set to "MS is not configured for NAS signalling low priority".

For requests with low priority indicator set to "MS is configured for NAS signalling low priority", the UE shall follow the procedures specified in clause  6.5.1.4.

6.6  Miscellaneous procedures

6.6.1  Exchange of protocol configuration options

6.6.1.1  General

The UE and the PDN GW can exchange protocol configuration options via the dedicated ESM information request procedure or via other ESM procedures.

If supported by the network and UE end-to-end for a PDN connection, protocol configuration options shall be exchanged via the extended protocol configuration options IE. Otherwise the protocol configuration options IE is used.

NOTE  1:  In this version of the protocol inter-system mobility to and from NB-S1 mode is supported. During inter-system-mobility from NB-S1 mode to WB-S1 mode the end-to-end support of the extended protocol configuration options IE can be lost, e.g. if the new MME does not support the extended protocol configuration options IE.

For the UE, the extended protocol configuration options is supported by the network and the UE end-to-end for a PDN connection if

-  the UE is in NB-S1 mode;

-  the APN requested for the PDN connection is for UAS services;

-  the PDN Type requested for the PDN connection is non-IP or Ethernet; or

-  the network has indicated support of the extended protocol configuration options IE in the last ATTACH ACCEPT or TRACKING AREA UPDATING ACCEPT message and the network has included the extended protocol configuration options IE in at least one EPS session management message received by the UE for this PDN connection.

For the MME, the extended protocol configuration options is supported by the network and the UE end-to-end for a PDN connection if

-  the UE is in NB-S1 mode;

-  the APN requested for the PDN connection is for UAS services;

-  the PDN Type requested for the PDN connection is non-IP or Ethernet; or

-  the UE has indicated support of the extended protocol configuration options IE in the last ATTACH REQUEST or TRACKING AREA UPDATING REQUEST message, and the MME has received the extended protocol configuration options IE in at least one message sent by the PDN GW towards the UE for this PDN connection (for details see 3GPP  S  29.274  [16D]).

NOTE  2:  For the PDN GW, the extended protocol configuration options is supported by the network and the UE end-to-end for a PDN connection if the last support indication received from the MME or S-GW indicates that extended protocol configuration options is supported for this PDN connection (for details see 3GPP  S  29.274  [16D]).

6.6.1.2  ESM information request procedure

6.6.1.2.1  General

The ESM information request procedure is used by the network to retrieve ESM information, i.e. protocol configuration options, APN, or both from the UE during the attach procedure if the UE indicated in the PDN CONNECTIVITY REQUEST message that it has ESM information that needs to be sent security protected. The purpose of this procedure is to provide privacy for the ESM information if ciphering is enabled in the network.

6.6.1.2.2  ESM information request initiated by the network

The network initiates the ESM information request procedure by sending an ESM INFORMATION REQUEST message to the UE, starting timer T3489 and entering the state PROCEDURE TRANSACTION PENDING (see example in figure  6.6.1.2.2.1). This message shall be sent only after the security context has been setup, and if the ESM information transfer flag has been set in the PDN CONNECTIVITY REQUEST message. The MME shall set the EPS bearer identity of the ESM INFORMATION REQUEST message to the value "no EPS bearer identity assigned" and include the PTI from the associated PDN CONNECTIVITY REQUEST message.



Figure 6.6.1.2.2.1: ESM information request procedure

6.6.1.2.3  ESM information request completion by the UE

Upon receipt of the ESM INFORMATION REQUEST message, the UE shall send an ESM INFORMATION RESPONSE message to the network. The UE shall include all the protocol configuration options that need to be transferred security protected, and APN if required, to the network in the ESM INFORMATION RESPONSE message. The UE shall set the EPS bearer identity of the ESM INFORMATION RESPONSE message to the value "no EPS bearer identity assigned" and include the PTI from the ESM INFORMATION REQUEST message.

6.6.1.2.4  ESM information request completion by the network

Upon receipt of the ESM INFORMATION RESPONSE message, the network shall stop timer T3489 and enter the state PROCEDURE TRANSACTION INACTIVE. A protocol configuration options IE or extended protocol configuration options IE included in the ESM INFORMATION RESPONSE message replaces any protocol configuration options IE or extended protocol configuration options IE that the network previously may have received during the attach procedure execution.

6.6.1.2.5  Abnormal cases in the UE

Apart from the case described in clause  6.3.3, no abnormal cases have been identified.

6.6.1.2.6  Abnormal cases on the network side

The following abnormal cases can be identified:

a)  Expiry of timer T3489:

  On the first expiry of the timer T3489, the MME shall resend the ESM INFORMATION REQUEST message and shall reset and restart timer T3489. This retransmission is repeated two times, i.e. on the third expiry of timer T3489, the MME shall abort the procedure, release any resources for this procedure and reject the associated PDN connectivity procedure including the ESM cause #53 "ESM information not received", in the PDN CONNECTIVITY REJECT message.

6.6.1.3  Exchange of protocol configuration options in other messages

The UE may include a protocol configuration options IE or extended protocol configuration options IE on EPS bearer context activation, EPS bearer context deactivation, EPS bearer context modification, PDN connectivity request, PDN disconnect request, bearer resource allocation request and bearer resource modification request if the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the PDN GW or the SCEF. In particular, the UE may use this procedure on EPS bearer context activation to perform the MSISDN notification procedure as specified in 3GPP  S  24.008  [13], clause  6.4.

The PDN GW or the SCEF may include a protocol configuration options IE or extended protocol configuration options IE on EPS bearer context activation, EPS bearer context deactivation, EPS bearer context modification, PDN connectivity reject, PDN disconnect reject, bearer resource allocation reject and bearer resource modification reject if the PDN GW or the SCEF wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE. In particular, the PDN GW may use this procedure on EPS bearer context activation to perform the MSISDN notification procedure as specified in 3GPP  S  24.008  [13], clause  6.4.

6.6.2  Notification procedure

6.6.2.1  General

The network can use the notification procedure to inform the UE about events which are relevant for the upper layer which is using an EPS bearer context or has requested a procedure transaction.

If the UE has indicated that it supports the notification procedure, the network may initiate the procedure at any time while a PDN connection exists or a procedure transaction is ongoing.

6.6.2.2  Notification procedure initiation by the network

The network initiates the notification procedure by sending a NOTIFICATION message to the UE (see example in figure  6.6.2.2.1).



Figure 6.6.2.2.1: Notification procedure

6.6.2.3  Notification procedure in the UE

When the UE receives a NOTIFICATION message, the ESM protocol entity in the UE shall provide the notification indicator to the upper layer.

The notification indicator can have the following value:

#1:  SRVCC handover cancelled, IMS session re-establishment required.

6.6.2.4  Abnormal cases on the network side

The following abnormal case can be identified:

a)  Lower layer indication of non-delivered NAS PDU due to handover

  If the NOTIFICATION message could not be delivered due to an intra MME handover, then upon successful completion of the intra MME handover the MME shall retransmit the NOTIFICATION message. If a failure of the handover procedure is reported by the lower layer and the S1 signalling connection exists, the MME shall retransmit the NOTIFICATION message.

6.6.3  Remote UE Report procedure

6.6.3.1  General

The purpose of the Remote UE Report procedure is for a UE acting as ProSe UE-to-network relay to notify the network that a remote UE is connected to the ProSe UE-to-network relay or disconnected from the ProSe UE-to-network relay as specified in 3GPP  S  23.303  [31].

6.6.3.2  Remote UE Report initiated by the UE

The UE initiates the Remote UE Report procedure by sending a REMOTE UE REPORT message to the network, starting timer T3493 and entering the state PROCEDURE TRANSACTION PENDING (see example in figure  6.6.3.2.1). The UE shall include information of newly connected or disconnected remote UEs to the network in the REMOTE UE REPORT message. If any encrypted IMSI remote UE identity is included in the REMOTE UE REPORT message, the UE shall include the corresponding ProSe Key Management Function address. The UE shall include the default EPS bearer identity of the PDN connection associated with the remote UE connected to the ProSe UE-to-network relay or disconnected from the ProSe UE-to-network relay.

NOTE:  Encrypted IMSI remote UE identities corresponding to different ProSe Key Management Function addresses need to be reported using separate REMOTE UE REPORT messages.





Figure 6.6.3.2.1: Remote UE Report procedure

6.6.3.3  Remote UE Report completion by the network

Upon receipt of the REMOTE UE REPORT message, the MME shall send a REMOTE UE REPORT RESPONSE message to the UE. The MME shall include the PTI from the REMOTE UE REPORT message.

6.6.3.4  Remote UE Report completion by the UE

Upon receipt of the REMOTE UE REPORT RESPONSE message, the UE shall stop timer T3493 and enter the state PROCEDURE TRANSACTION INACTIVE.

6.6.3.5  Abnormal cases in the UE

The following abnormal cases can be identified:

a)  Expiry of timer T3493:

  On the first expiry of the timer T3493, the UE shall resend the REMOTE UE REPORT message and shall reset and restart timer T3493. This retransmission is repeated two times, i.e. on the third expiry of timer T3493, the UE shall abort the procedure and release any resources for this procedure.

NOTE:  After the abortion of the Remote UE Report procedure, the Remote UE Report procedure for the remote UE(s) can be restarted and how to restart the procedure is left to UE implementation.

6.6.3.6  Abnormal cases on the network side

No abnormal cases have been identified.

6.6.4  Transport of user data via the control plane procedure

6.6.4.1  General

The purpose of the transport of user data via the control plane procedure is to transfer user data via the control plane in an encapsulated form between the UE and the MME.

The procedure may be initiated by the UE or the network when the UE is in EMM-CONNECTED mode.

The procedure may also be initiated by the UE in EMM-IDLE mode by including the ESM DATA TRANSPORT message in a CONTROL PLANE SERVICE REQUEST message.

6.6.4.2  UE initiated transport of user data via the control plane

Upon receipt of a request to transfer user data via the control plane, if the UE is in EMM-CONNECTED mode, the UE initiates the procedure by sending the ESM DATA TRANSPORT message including the user data to be sent in the User data container IE (see example in figure  6.6.4.2.1). The length of the value part of the User data container IE should not exceed the link MTU size for the respective type of user data (IPv4, IPv6 or Non-IP). If the user data in the value part of the User data container IE is an Ethernet frame, then the length of the Ethernet frame payload should not exceed the Ethernet frame payload MTU size.

NOTE:  The recommended maximum size for link MTU is 1358 octets to prevent fragmentation in the backbone network (see 3GPP  S  23.060  [74]). Depending on the network configuration, setting link MTU size to a value larger than 1358 octets could lead to inefficient core network implementation due to fragmentation.

If the UE is in EMM-IDLE mode, the UE initiates the procedure by sending the ESM DATA TRANSPORT message included in a CONTROL PLANE SERVICE REQUEST message.

Based on information provided by the upper layers, the UE may include a Release assistance indication IE in the ESM DATA TRANSPORT message to inform the network that

1)  subsequent to the current uplink data transmission no further uplink or downlink data transmission (e.g. an acknowledgement or response) is expected; i.e. the upper layers indicated that data exchanges have completed with the current UL data transfer; or

2)  subsequent to the current uplink data transmission only a single downlink data transmission and no further uplink data transmission is expected; i.e. the upper layers indicated that data exchanges will have completed with the next downlink data transmission.

When receiving the ESM DATA TRANSPORT message, the MME shall identify the PDN connection to the SCEF or to the PDN GW, based on the EPS bearer identity included in message, and forward the contents of the User data container IE accordingly. If the ESM DATA TRANSPORT message includes a Release assistance indication IE, then ESM layer indicates to the EMM layer to initiate release of the NAS signalling connection,

1)  if the release assistance indication indicates that no further uplink and no further downlink data transmission subsequent to the uplink data transmission is expected; or

2)  upon subsequent delivery of the next received downlink data transmission to the UE if the release assistance indication indicates that only a single downlink data transmission and no further uplink data transmission subsequent to the uplink data transmission is expected.





Figure 6.6.4.2.1: UE initiated transport of user data via the control plane procedure

6.6.4.3  Network initiated transport of user data via the control plane

The network initiates the procedure by sending the ESM DATA TRANSPORT message (see example in figure  6.6.4.3.1). Upon receiving the ESM DATA TRANSPORT message, the UE shall:

-  forward the contents of the User data container IE to the upper layers.



Figure 6.6.4.3.1: Network initiated transport of user data via the control plane procedure

6.6.4.4  Abnormal cases in the UE

The following abnormal case can be identified:

a)  T3396 is running

  The UE shall not send an ESM DATA TRANSPORT message unless

-  the UE is a UE configured to use AC11        15 in selected PLMN; or

-  the ESM DATA TRANSPORT message is used for an exception data reporting and the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP  S  24.368  [15A] or the USIM file EFNASCONFIG in 3GPP  S  31.102  [17]).

  The ESM DATA TRANSPORT message can be sent, if still necessary, when timer T3396 expires or is stopped.

b)  Transmission failure of the ESM DATA TRANSPORT message indication from lower layers

  If lower layers indicate a TAI change and the current TAI is not in the TAI list, the transport of user data via the control plane procedure shall be aborted and re-initiated after successfully performing a tracking area updating procedure if the control plane CIoT EPS optimisation is still used and the user data exists. The "signalling active" flag shall be set in the TRACKING AREA UPDATE REQUEST message.

  If lower layers indicate a TAI change, but the current TAI is still part of the TAI list, or the TAI has not changed, the transport of user data via the control plane procedure shall be re-initiated immediately if the user data still exists by including the ESM DATA TRANSPORT message in a CONTROL PLANE SERVICE REQUEST message.

NOTE:  How the ESM sublayer handles the retransmission of user data via the control plane is up to the UE implementation.

c)  NAS MAC calculation indication from lower layers

  If lower layers indicate to calculate an NAS MAC, the UE shall calculate an NAS MAC as specified in 3GPP  S  33.401  [19] and then provide the calculated NAS MAC and 5 least significant bits of the uplink NAS COUNT used to calculate the NAS MAC to lower layers (see 3GPP  S  36.331  [22]). The UE shall increase the uplink NAS COUNT by one after the calculation of the NAS MAC.

6.6.4.5  Abnormal cases on the network side

Apart from the case described in clause  6.3.4, no other abnormal cases have been identified.

6.7  Reception of an ESM STATUS message by an ESM entity

The purpose of the sending of the ESM STATUS message is to report at any time certain error conditions detected upon receipt of ESM protocol data. The ESM STATUS message can be sent by both the MME and the UE (see example in figure  6.7.1).

If the ESM entity of the UE receives an ESM STATUS message the UE shall take different actions depending on the received ESM cause value:

#43  (Invalid EPS bearer identity);

  The UE shall abort any ongoing ESM procedure related to the received EPS bearer identity, stop any related timer, and deactivate the corresponding EPS bearer context locally (without peer to peer signalling between the UE and the MME).

#81  (Invalid PTI value);

  The UE shall abort any ongoing ESM procedure related to the received PTI value and stop any related timer.

#97  (Message type non-existent or not implemented);

  The UE shall abort any ongoing ESM procedure related to the PTI or EPS bearer identity and stop any related timer.

On receipt of an ESM STATUS message with any other ESM cause value no state transition and no specific action shall be taken as seen from the radio interface, i.e. local actions are possible.

If the ESM entity of the MME receives an ESM STATUS message the MME shall take different actions depending on the received ESM cause value:

#43  (Invalid EPS bearer identity);

  The MME shall abort any ongoing ESM procedure related to the received EPS bearer identity, stop any related timer, and deactivate the corresponding EPS bearer context locally (without peer to peer signalling between the MME and the UE).

#81  (Invalid PTI value);

  The MME shall abort any ongoing ESM procedure related to the received PTI value and stop any related timer.

#97  (Message type non-existent or not implemented);

  The MME shall abort any ongoing ESM procedure related to the PTI or EPS bearer identity and stop any related timer.

The local actions to be taken by the MME on receipt of an ESM STATUS message with any other ESM cause value are implementation dependent.



Figure 6.7.1: ESM status procedure

7  Handling of unknown, unforeseen, and erroneous protocol data

7.1  General

The procedures specified in the present document apply to those messages which pass the checks described in this clause.

This clause also specifies procedures for the handling of unknown, unforeseen, and erroneous protocol data by the receiving entity. These procedures are called "error handling procedures", but in addition to providing recovery mechanisms for error situations they define a compatibility mechanism for future extensions of the protocols.

Clauses  7.1 to 7.8 shall be applied in order of precedence.

Most error handling procedures are mandatory for the UE.

Detailed error handling procedures in the network are implementation dependent and may vary from PLMN to PLMN. However, when extensions of this protocol are developed, networks will be assumed to have the error handling that is indicated in this clause as mandatory ("shall") and that is indicated as strongly recommended ("should").

Also, the error handling of the network is only considered as mandatory or strongly recommended when certain thresholds for errors are not reached during a dedicated connection.

For definition of semantical and syntactical errors see 3GPP  S  24.007  [12], clause  11.4.2.

7.2  Message too short

When a message is received that is too short to contain a complete message type information element, that message shall be ignored, cf. 3GPP  S  24.007  [12].

7.3  Unknown or unforeseen procedure transaction identity or EPS bearer identity

7.3.1  Procedure transaction identity

The following network procedures shall apply for handling an unknown, erroneous, or unforeseen PTI received in an ESM message:

a)  If the network receives a PDN CONNECTIVITY REQUEST message with an unassigned or reserved PTI value, the network shall respond with a PDN CONNECTIVITY REJECT message including ESM cause #81 "invalid PTI value".

b)  If the network receives a PDN DISCONNECT REQUEST message with an unassigned or reserved PTI value, the network shall respond with a PDN DISCONNECT REJECT message including ESM cause #81 "invalid PTI value".

c)  If the network receives a BEARER RESOURCE ALLOCATION REQUEST message with an unassigned or reserved PTI value, the network shall respond with a BEARER RESOURCE ALLOCATION REJECT message including ESM cause #81 "invalid PTI value".

d)  If the network receives a BEARER RESOURCE MODIFICATION REQUEST message with an unassigned or reserved PTI value, the network shall respond with a BEARER RESOURCE MODIFICATION REJECT message including ESM cause #81 "invalid PTI value".

e)  If the network receives an ESM INFORMATION RESPONSE message which includes an unassigned or reserved PTI value, the network shall ignore the message. If the PTI is an assigned value that does not match the PTI in use for any ongoing transaction related procedure, the network shall respond with an ESM STATUS message including ESM cause #81 "invalid PTI value".

f)  If the network receives an ESM message other than those listed in items a through e above with a reserved PTI value, the network shall ignore the message.

The following UE procedures shall apply for handling an unknown, erroneous, or unforeseen PTI received in an ESM message:

a)  If the UE receives a PDN CONNECTIVITY REJECT message in which the PTI value is an unassigned or reserved value, or an assigned value that does not match any PTI in use, the UE shall ignore the message.

b)  If the UE receives a PDN DISCONNECT REJECT message in which the PTI value is an unassigned or reserved value, or an assigned value that does not match any PTI in use, the UE shall ignore the message.

c)  If the UE receives a BEARER RESOURCE ALLOCATION REJECT message in which the PTI value is an unassigned or reserved value, or an assigned value that does not match any PTI in use, the UE shall ignore the message.

d)  If the UE receives a BEARER RESOURCE MODIFICATION REJECT message in which the PTI value is an unassigned or reserved value, or an assigned value that does not match any PTI in use, the UE shall ignore the message.

e)  If the UE receives an ESM INFORMATION REQUEST message in which the PTI value is an unassigned or reserved value, the UE shall ignore the message. If the PTI is an assigned value that does not match a PTI in use for a pending UE requested PDN connectivity procedure for which the ESM information transfer flag was set in the PDN CONNECTIVITY REQUEST message, the UE shall respond with an ESM STATUS message including ESM cause #47 "PTI mismatch".

f)  If the UE receives a NOTIFICATION message in which the PTI value is an unassigned value, the UE shall proceed as specified in clause  7.3.2. If the PTI is a reserved value, the UE shall respond with an ESM STATUS message including ESM cause #81 "invalid PTI value". If the PTI is an assigned value that does not match any PTI in use, the UE shall respond with an ESM STATUS message including ESM cause #47 "PTI mismatch".

g)  If the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message in which the PTI value is an assigned value that does not match any PTI in use, if the UE detects that this request is a network retransmission of an already accepted request (see clause  6.5.1.3) the UE shall respond with an ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message. Otherwise, the UE shall respond with an ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT message including ESM cause #47 "PTI mismatch".

h)  If the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message which contains a reserved or unassigned PTI value, the UE shall respond with an ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT message including ESM cause #81 "invalid PTI value".

i)  If the UE receives an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message in which the PTI value is an assigned value that does not match any PTI in use, if the UE detects that this request is a network retransmission of an already accepted request (see clauses  6.5.3.3 and  6.5.4.3) the UE shall respond with an ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message. Otherwise, the UE shall respond with an ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message including ESM cause #47 "PTI mismatch".

j)  If the UE receives an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message which contains a reserved PTI value, the UE shall respond with an ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message including ESM cause #81 "invalid PTI value".

k)  If the UE receives a MODIFY EPS BEARER CONTEXT REQUEST message in which the PTI value is an assigned value that does not match any PTI in use, if the UE detects that this request is a network retransmission of an already accepted request (see clauses  6.5.3.3 and 6.5.4.3) the UE shall respond with a MODIFY EPS BEARER CONTEXT ACCEPT message. Otherwise, the UE shall respond with a MODIFY EPS BEARER CONTEXT REJECT message including ESM cause #47 "PTI mismatch".

l)  If the UE receives a MODIFY EPS BEARER CONTEXT REQUEST message which contains a reserved PTI value, the UE shall respond with a MODIFY EPS BEARER CONTEXT REJECT message including ESM cause #81 "invalid PTI value".

m)  If the UE receives a DEACTIVATE EPS BEARER CONTEXT REQUEST message in which the PTI value is a reserved value or an assigned value that does not match any PTI in use, the UE shall ignore the message.

n)  If the UE receives an ESM message other than those listed in items a through m with a reserved PTI value or an assigned value that does not match any PTI in use, the UE shall ignore the message.

7.3.2  EPS bearer identity

The following network procedures shall apply for handling an unknown, erroneous, or unforeseen EPS bearer identity received in the header of an ESM message (specified as the header of a standard L3 message, see 3GPP  S  24.007  [12]):

a)  If the network receives a PDN CONNECTIVITY REQUEST message which includes an assigned or reserved EPS bearer identity value, the network shall respond with a PDN CONNECTIVITY REJECT message including ESM cause #43 "invalid EPS bearer identity".

b)  If the network receives a PDN DISCONNECT REQUEST message which includes an assigned or reserved EPS bearer identity value, the network shall respond with a PDN DISCONNECT REJECT message including ESM cause #43 "invalid EPS bearer identity".

c)  If the network receives a BEARER RESOURCE ALLOCATION REQUEST message which includes an assigned or reserved EPS bearer identity value, the network shall respond with a BEARER RESOURCE ALLOCATION REJECT message including ESM cause #43 "invalid EPS bearer identity".

d)  If the network receives a BEARER RESOURCE MODIFICATION REQUEST message which includes an assigned or reserved EPS bearer identity value, the network shall respond with a BEARER RESOURCE MODIFICATION REJECT message including ESM cause #43 "invalid EPS bearer identity".

e)  If the network receives an ESM INFORMATION RESPONSE message which includes an assigned or reserved EPS bearer identity value, the network shall ignore the message.

f)  If the network receives an ESM DATA TRANSPORT message which includes a reserved EPS bearer identity value or an assigned value that does not match an existing EPS bearer context, the network shall respond with an ESM STATUS message including ESM cause #43 "invalid EPS bearer identity".

g)  If the network receives an ESM message other than those listed in items a through e above in which the message includes a reserved EPS bearer identity value or an assigned value that does not match an existing EPS bearer context, the network shall ignore the message.

The following UE procedures shall apply for handling an unknown, erroneous, or unforeseen EPS bearer identity received in the header of an ESM message:

a)  If the UE receives a PDN CONNECTIVITY REJECT message which includes an assigned or reserved EPS bearer identity value, the UE shall ignore the message.

b)  If the UE receives a PDN DISCONNECT REJECT message which includes an assigned or reserved EPS bearer identity value, the UE shall ignore the message.

c)  If the UE receives a BEARER RESOURCE ALLOCATION REJECT message which includes an assigned or reserved EPS bearer identity value, the UE shall ignore the message.

d)  If the UE receives a BEARER RESOURCE MODIFICATION REJECT message which includes an assigned or reserved EPS bearer identity value, the UE shall ignore the message.

e)  If the UE receives an ESM INFORMATION REQUEST message which includes an assigned or reserved EPS bearer identity value, the UE shall respond with an ESM STATUS message including ESM cause #43 "invalid EPS bearer identity".

f)  If the UE receives a NOTIFICATION message which includes a reserved EPS bearer identity value, an assigned EPS bearer identity value that does not match an existing EPS bearer context, or the combination of an unassigned PTI value and an unassigned EPS bearer identity value, the UE shall respond with an ESM STATUS message including ESM cause #43 "invalid EPS bearer identity".

g)  If the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message which includes an unassigned or reserved EPS bearer identity value, the UE shall respond with an ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT message including ESM cause #43 "invalid EPS bearer identity".

h)  If the UE receives an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message which includes an unassigned or reserved EPS bearer identity value, the UE shall respond with an ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message including ESM cause #43 "invalid EPS bearer identity".

i)  If the UE receives a MODIFY EPS BEARER CONTEXT REQUEST message which includes an unassigned or reserved EPS bearer identity value or an assigned EPS bearer identity value that does not match an existing EPS bearer context, the UE shall respond with a MODIFY EPS BEARER CONTEXT REJECT message including ESM cause #43 "invalid EPS bearer identity".

j)  If the UE receives a DEACTIVATE EPS BEARER CONTEXT REQUEST message which includes an unassigned or reserved EPS bearer identity value or an assigned EPS bearer identity value that does not match an existing EPS bearer context, the UE shall respond with a DEACTIVATE EPS BEARER CONTEXT ACCEPT message with the EPS bearer identity set to the received EPS bearer identity.

k)  If the UE receives an ESM DATA TRANSPORT message which includes a reserved EPS bearer identity value or an assigned value that does not match an existing EPS bearer context, the UE shall respond with an ESM STATUS message including ESM cause #43 "invalid EPS bearer identity".

l)  If the UE receives an ESM message other than those listed in items a through j in which the message includes an unassigned or reserved EPS bearer identity value or a value that does not match an EPS bearer context of an established PDN connection, the UE shall ignore the message.

7.4  Unknown or unforeseen message type

If UE receives an EMM message or ESM message with message type not defined for the protocol discriminator (PD) or not implemented by the receiver, it shall return a status message (EMM STATUS or ESM STATUS depending on the PD) with cause #97 "message type non-existent or not implemented".

If the network receives an EMM or ESM message with message type not defined for the PD or not implemented by the receiver in a protocol state where reception of an unsolicited message with the given PD from the UE is not foreseen in the protocol, the network actions are implementation dependent. Otherwise, if the network receives a message with message type not defined for the PD or not implemented by the receiver, it shall ignore the message except that it should return a status message (EMM STATUS or ESM STATUS depending on the PD) with cause #97 "message type non-existent or not implemented".

NOTE:  A message type not defined for the PD in the given direction is regarded by the receiver as a message type not defined for the PD, see 3GPP  S  24.007  [12].

If the UE receives a message not compatible with the protocol state, the UE shall return a status message (EMM STATUS or ESM STATUS depending on the PD) with cause #98 "message type not compatible with protocol state".

If the network receives a message not compatible with the protocol state, the network actions are implementation dependent.

7.5  Non-semantical mandatory information element errors

7.5.1  Common procedures

When on receipt of a message,

-  an "imperative message part" error; or

-  a "missing mandatory IE" error

is diagnosed or when a message containing:

-  a syntactically incorrect mandatory IE;

-  an IE unknown in the message, but encoded as "comprehension required" (see 3GPP  S  24.007  [12]); or

-  an out of sequence IE encoded as "comprehension required" (see 3GPP  S  24.007  [12]) is received,

the UE shall proceed as follows:

  If the message is not one of the messages listed in clause  7.5.3, item a, b, c, or d, the UE shall return a status message (EMM STATUS or ESM STATUS depending on the PD) with cause #96 "invalid mandatory information"; and

the network shall proceed as follows:

  If the message is not one of the messages listed in clause  7.5.3, item e, f, g or h, the network shall either:

-  try to treat the message (the exact further actions are implementation dependent); or

-  ignore the message except that it should return a status message (EMM STATUS or ESM STATUS depending on the PD) with cause #96 "invalid mandatory information".

7.5.2  EPS mobility management

No exceptional cases are described for mobility management messages.

No semantical or syntactical diagnosis other than presence and length shall be performed on the ESM message container information element in the ATTACH REQUEST, ATTACH ACCEPT, ATTACH COMPLETE and CONTROL PLANE SERVICE REQUEST messages.

7.5.3  EPS session management

The following UE procedures shall apply for handling an error encountered with a mandatory information element in an ESM message:

a)  If the message is an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, an ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT message with ESM cause #96 "invalid mandatory information", shall be returned.

b)  If the message is an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST, an ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message with ESM cause #96 "invalid mandatory information", shall be returned.

c)  If the message is a MODIFY EPS BEARER CONTEXT REQUEST, a MODIFY EPS BEARER CONTEXT REJECT message with ESM cause #96 "invalid mandatory information", shall be returned.

d)  If the message is a DEACTIVATE EPS BEARER CONTEXT REQUEST, a DEACTIVATE EPS BEARER CONTEXT ACCEPT message shall be returned. All resources associated with that EPS bearer shall be released.

The following network procedures shall apply for handling an error encountered with a mandatory information element in an ESM message:

e)  If the message is a PDN CONNECTIVITY REQUEST, a PDN CONNECTIVITY REJECT message with ESM cause #96 "invalid mandatory information", shall be returned.

f)  If the message is a PDN DISCONNECT REQUEST, a PDN DISCONNECT REJECT message with ESM cause #96 "invalid mandatory information", shall be returned.

g)  If the message is a BEARER RESOURCE ALLOCATION REQUEST, a BEARER RESOURCE ALLOCATION REJECT message with ESM cause #96 "invalid mandatory information", shall be returned.

h)  If the message is a BEARER RESOURCE MODIFICATION REQUEST, a BEARER RESOURCE MODIFICATION REJECT message with ESM cause #96 "invalid mandatory information", shall be returned.

7.6  Unknown and unforeseen IEs in the non-imperative message part

7.6.1  IEIs unknown in the message

The UE shall ignore all IEs unknown in a message which are not encoded as "comprehension required" (see 3GPP  S  24.007  [12]).

The network shall take the same approach.

7.6.2  Out of sequence IEs

The UE shall ignore all out of sequence IEs in a message which are not encoded as "comprehension required" (see 3GPP  S  24.007  [12]).

The network should take the same approach.

7.6.3  Repeated IEs

If an information element with format T, TV, TLV, or TLV-E is repeated in a message in which repetition of the information element is not specified in clause  8 of the present document, the UE shall handle only the contents of the information element appearing first and shall ignore all subsequent repetitions of the information element. When repetition of information elements is specified, the UE shall handle only the contents of specified repeated information elements. If the limit on repetition of information elements is exceeded, the UE shall handle the contents of information elements appearing first up to the limit of repetitions and shall ignore all subsequent repetitions of the information element.

The network should follow the same procedures.

7.7  Non-imperative message part errors

This category includes:

-  syntactically incorrect optional IEs; and

-  conditional IE errors.

7.7.1  Syntactically incorrect optional IEs

The UE shall treat all optional IEs that are syntactically incorrect in a message as not present in the message.

The network shall take the same approach.

7.7.2  Conditional IE errors

When upon receipt of a EMM or ESM message the UE diagnoses a "missing conditional IE" error or an "unexpected conditional IE" error, or when it receives a EMM or ESM message containing at least one syntactically incorrect conditional IE, the UE shall ignore the message and shall return a status message (EMM STATUS or ESM STATUS depending on the PD) with cause #100 "conditional IE error".

When the network receives a message and diagnoses a "missing conditional IE" error or an "unexpected conditional IE" error or when it receives a message containing at least one syntactically incorrect conditional IE, the network shall either:

-  try to treat the message (the exact further actions are implementation dependent); or

-  ignore the message except that it should return a status message (EMM STATUS or ESM STATUS depending on the PD) with cause #100 "conditional IE error".

7.8  Messages with semantically incorrect contents

When a message with semantically incorrect contents is received, the UE shall perform the foreseen reactions of the procedural part of the present document (i.e. of clauses  4, 5 and 6). If however no such reactions are specified, the UE shall ignore the message except that it shall return a status message (EMM STATUS or ESM STATUS depending on the PD) with cause #95 "semantically incorrect message".

The network should follow the same procedure except that a status message is not normally transmitted.

8  Message functional definitions and contents

8.1  Overview

This clause defines the structure of the messages of the Layer  3 (L3) protocols defined in the present document. These are standard L3 messages as defined in 3GPP  S  24.007  [12].

Each definition given in the present clause includes:

a)  a brief description of the message direction and use, including whether the message has:

1.  Local significance, i.e. relevant only on the originating or terminating access;

2.  Access significance, i.e. relevant in the originating and terminating access, but not in the network;

3.  Dual significance, i.e. relevant in either the originating or terminating access and in the network; or

4.  Global significance, i.e. relevant in the originating and terminating access and in the network.

b)  a table listing the Information Elements (IE) known in the message and the order of their appearance in the message. All IEs that may be repeated are explicitly indicated (The V, LV and LV-E formatted IEs, which compose the imperative part of the message, occur before the T, TV, TLV and TLV-E formatted IEs which compose the non-imperative part of the message, see 3GPP  S  24.007  [12]). In a (maximal) sequence of consecutive IEs with half octet length, the first IE with half octet length occupies bits 1 to 4 of octet N, the second IE bits 5 to 8 of octet N, the third IE bits 1 to 4 of octet N+1 etc. Such a sequence always has an even number of elements.

  For each information element the table indicates:

1.  The Information Element Identifier (IEI), in hexadecimal notation, if the IE has format T, TV, TLV or TLVE. If the IEI has half octet length, it is specified by a notation representing the IEI as a hexadecimal digit followed by a "-" (example: B-).

NOTE:  The same IEI can be used for different information element types in different messages of the same protocol.

2.  The name of the information element (which may give an idea of the semantics of the element). The name of the information element followed by "IE" or "information element" is used in this technical report as reference to the information element within a message.

3.  The name of the type of the information element (which indicates the coding of the value part of the IE), and generally, the referenced clause of clause  9 of the present document describing the value part of the information element.

4.  The presence requirement indication (M, C, or O) for the IE as defined in 3GPP  S  24.007  [12].

5.  The format of the information element (T, V, TV, LV, TLV, LV-E or TLV-E) as defined in 3GPP  S  24.007  [12].

6.  The length of the information element (or permissible range of lengths), in octets, in the message, where "?" means that the maximum length of the IE is only constrained by link layer protocol. This indication is non-normative.

c)  clauses specifying, where appropriate, conditions for IEs with presence requirement C or O in the relevant message which together with other conditions specified in the present document define when the information elements shall be included or not, what non-presence of such IEs means, and        for IEs with presence requirement C        the static conditions for presence or non-presence of the IEs or for both cases (see 3GPP  S  24.007  [12]).

8.2  EPS mobility management messages

8.2.1  Attach accept

8.2.1.1  Message definition

This message is sent by the network to the UE to indicate that the corresponding attach request has been accepted. See table  8.2.1.1.

Message type:  ATTACH ACCEPT

Significance:  dual

Direction:  network to UE

8.2.1.2  GUTI

This IE may be included to assign a GUTI to the UE during attach or combined EPS/IMSI attach.

8.2.1.3  Location area identification

This IE may be included to assign a new location area identification to a UE during a combined attach.

8.2.1.4  MS identity

This IE may be included to assign or unassign a new TMSI to a UE during a combined attach.

8.2.1.5  EMM cause

This IE shall be included when IMSI attach for non-EPS services is not successful during a combined EPS/IMSI attach procedure.

8.2.1.6  T3402 value

This IE may be included to indicate a value for timer T3402.

8.2.1.7  T3423 value

This IE may be included to indicate a value for timer T3423.

If this IE is not included, the UE shall use the default value.

8.2.1.8  Equivalent PLMNs

This IE may be included in order to assign a new equivalent PLMNs list to a UE.

8.2.1.9  Emergency number list

This IE may be sent by the network. If this IE is sent, the contents of this IE indicates a list of emergency numbers valid within the same country as in the PLMN from which this IE is received.

8.2.1.9A  Extended emergency number list

This IE may be sent by the network. If this IE is sent, the contents of this IE indicates a list of emergency numbers (with URN information) valid within the same country as in the PLMN from which this IE is received or valid only in the PLMN from which this IE is received.

8.2.1.10  EPS network feature support

The network may include this IE to inform the UE of the support of certain features. If this IE is not included then the UE shall interpret this as a receipt of an information element with all bits of the value part coded as zero, except for the S1-u data transfer (S1-U data) (octet 4, bit 2).

NOTE: In this exceptional case, the UE deems that the network supports S1-u data transfer.

8.2.1.11  Additional update result

The network may include this IE to provide the UE with additional information about the result of:

-  a combined attach procedure if the procedure was successful for EPS services and non-EPS services, or for EPS services and "SMS only"; or

-  an attach procedure requested for CIoT EPS optimizations if the procedure was successful for EPS services and "SMS only".

8.2.1.12  T3412 extended value

The network may include this IE to provide the UE with longer periodic tracking area update timer.

8.2.1.13  T3324 value

The network shall include the T3324 value IE if:

-  the UE included the T3324 value IE in the ATTACH REQUEST message; and

-  the network supports PSM and accepts the use of PSM.

8.2.1.14  Extended DRX parameters

The network shall include the Extended DRX parameters IE if:

-  the UE included the Extended DRX parameters IE in the ATTACH REQUEST message; and

-  the network supports eDRX and accepts the use of eDRX.

8.2.1.15  DCN-ID

This IE is included in the message when the network wishes to provide a DCN-ID to the UE.

8.2.1.16  SMS services status

This IE may be included when a normal attach procedure for EPS services and "SMS only" was successful for EPS services only.

8.2.1.17  Non-3GPP NW provided policies

This IE is included if the network needs to indicate whether emergency numbers provided via non-3GPP access can be used to initiate UE detected emergency calls (see 3GPP  S  24.302  [48]). If this IE is not included then the UE shall interpret this as a receipt of an information element with all bits of the value part coded as zero.

8.2.1.18  T3448 value

The network may include this IE if the congestion control for transport of user data via the control plane is active and the UE supports timer T3448.

8.2.1.19  Network policy

This IE is included if the network needs to indicate network policy information to the UE, If this IE is not included then the UE shall interpret this as a receipt of an information element with all bits of the value part coded as zero.

8.2.1.20  T3447 value

The network may include T3447 value IE if:

-  the UE has indicated support for service gap control in the ATTACH REQUEST message; and

-  the EMM context contains a service gap time value.

8.2.1.21  Ciphering key data

This IE is included if the network needs to send ciphering key data to the UE for ciphered broadcast assistance data.

8.2.1.22  UE radio capability ID

This IE may be included in WB-S1 mode if both the UE and the network supports RACS and the network needs to assign a network-assigned UE radio capability ID to the UE.

8.2.1.23  UE radio capability ID deletion indication

This IE may be included in WB-S1 mode if both the UE and the network supports RACS and the network needs to trigger the UE to delete all network-assigned UE radio capability IDs stored at the UE for the serving PLMN.

8.2.1.24  Negotiated WUS assistance information

The network shall include the Negotiated WUS assistance information IE if:

-  the UE supports WUS assistance;

-  the MME supports and accepts the use of WUS assistance; and

-  the UE is not attaching for emergency bearer services.

8.2.1.25  Negotiated DRX parameter in NB-S1 mode

The network shall include the Negotiated DRX parameter in NB-S1 mode IE if the UE has included the DRX parameter in NB-S1 mode IE in the ATTACH REQUEST message.

8.2.1.26  Negotiated IMSI offset

The network shall include the Negotiated IMSI offset IE if the network supports paging timing collision control and the MUSIM UE has included the Requested IMSI offset IE in the ATTACH REQUEST message.

8.2.1.27  Forbidden TAI(s) for the list of "forbidden tracking areas for roaming"

This IE is included to indicate the forbidden TAI(s) to be stored in the list of "forbidden tracking areas for roaming". This IE is included only if the message is sent via satellite E-UTRAN access. 

8.2.1.28  Forbidden TAI(s) for the list of "forbidden tracking areas for  regional provision of service"

This IE is included to indicate the forbidden TAI(s) to be stored in the list of "forbidden tracking areas for regional provision of service". This IE is included only if the message is sent via satellite E-UTRAN access.

8.2.2  Attach complete

This message is sent by the UE to the network in response to an ATTACH ACCEPT message. See table  8.2.2.1.

Message type:  ATTACH COMPLETE

Significance:  dual

Direction:  UE to network

8.2.3.2  ESM message container

This IE is included to carry a single ESM message.

8.2.3.3  T3346 value

The MME may include this IE when the NAS level mobility management congestion control is active.

8.2.3.4  T3402 value

This IE may be included to indicate a value for timer T3402.

8.2.3.5  Extended EMM cause

This IE may be included by the network to indicate additional information associated with the EMM cause.

8.2.3.6  Forbidden TAI(s) for the list of "forbidden tracking areas for roaming"

This IE is included to indicate the forbidden TAI(s) to be stored in the list of "forbidden tracking areas for roaming". This IE is included only if the message is sent via satellite E-UTRAN access. 

8.2.3.7  Forbidden TAI(s) for the list of "forbidden tracking areas for  regional provision of service"

This IE is included to indicate the forbidden TAI(s) to be stored in the list of "forbidden tracking areas for regional provision of service". This IE is included only if the message is sent via satellite E-UTRAN access.

8.2.4  Attach request

8.2.4.1  Message definition

This message is sent by the UE to the network in order to perform an attach procedure. See table  8.2.4.1.

Message type:  ATTACH REQUEST

Significance:  dual

Direction:  UE to network

8.2.4.2  Old P-TMSI signature

The UE shall include this IE if the UE holds a valid P-TMSI signature, P-TMSI and RAI, and the TIN either indicates "P-TMSI" or is deleted. If the UE is configured for "AttachWithIMSI" as specified in 3GPP  S  24.368  [15A] or 3GPP  S  31.102  [17] and is attaching in a new PLMN that is neither the registered PLMN nor in the list of equivalent PLMNs, the UE shall not include this IE.

8.2.4.3  Additional GUTI

The UE shall include this IE if the TIN indicates "P-TMSI" and the UE holds a valid GUTI, P-TMSI and RAI. If the UE is configured for "AttachWithIMSI" as specified in 3GPP  S  24.368  [15A] or 3GPP  S  31.102  [17] and is attaching in a new PLMN that is neither the registered PLMN nor in the list of equivalent PLMNs, the UE shall not include this IE.

8.2.4.4  Last visited registered TAI

This IE shall be included if the UE holds a valid last visited registered TAI.

8.2.4.5  DRX parameter

This IE is included if UE supports A/Gb mode or Iu mode or if the UE wants to indicate its UE specific DRX parameters to the network.

8.2.4.6  MS network capability

A UE supporting A/Gb mode or Iu mode shall include this IE to indicate its capabilities to the network.

8.2.4.7  Old location area identification

The UE shall include this IE during a combined attach procedure if it has a valid location area identification.

8.2.4.8  TMSI status

The UE shall include this IE during combined attach procedure if it has no valid TMSI available.

8.2.4.9  Mobile station classmark 2

This IE shall be included if the UE supports SRVCC to GERAN or UTRAN or supports vSRVCC to UTRAN (see 3GPP  S  23.216  [8]), or if the UE is performing a combined attach procedure.

8.2.4.10  Mobile station classmark 3

This IE shall be included if the UE supports SRVCC to GERAN.

8.2.4.11  Supported Codecs

This IE shall be included if the UE supports SRVCC to GERAN or UTRAN or supports vSRVCC to UTRAN to indicate its supported speech codecs for CS speech calls.

8.2.4.12  Additional update type

The UE shall include this IE if the UE requests "SMS only" or CIoT EPS optimizations.

8.2.4.13  Voice domain preference and UE   's usage setting

This IE shall be included in WB-S1 mode if and only if the UE supports:

-  CS fallback and SMS over SGs; or

-  if the UE is configured to support IMS voice, but does not support 1xCS fallback.

8.2.4.14  Device properties

This IE shall be included if the UE is configured for NAS signalling low priority.

8.2.4.15  Old GUTI type

The UE shall include this IE if the type of identity in the EPS mobile identity IE is set to "GUTI".

8.2.4.16  MS network feature support

This IE shall be included if the UE supports extended periodic timer T3412.

8.2.4.17  TMSI based NRI container

The UE shall include this IE during a combined attach procedure if it has a valid TMSI.

8.2.4.18  T3324 value

The UE may include this IE to request the use of PSM.

8.2.4.19  T3412 extended value

The UE may include this IE to request a particular T3412 value if the T3324 value IE is included.

8.2.4.20  Extended DRX parameters

The UE may include this IE to request the use of eDRX.

8.2.4.21  UE additional security capability

The UE shall include this IE if the UE supports dual connectivity with NR or if the UE supports N1 mode.

8.2.4.22  UE status

This IE shall be included if the UE wants to provide the network with information concerning aspects of the current UE registration status which is used for interworking with 5GS.

8.2.4.23  Additional information requested

The UE shall include this IE if the UE supports ciphered broadcast assistance data and the UE needs to obtain new ciphering keys for ciphered broadcast assistance data.

8.2.4.24  N1 UE network capability

The UE shall include this IE if the UE supports N1 mode and needs to indicate the supported CIoT network behaviour for 5GCN.

8.2.4.25  UE radio capability ID availability IE

The UE shall include this IE in WB-S1 mode if the UE supports RACS and the UE has an applicable UE radio capability ID for the current UE radio configuration in the selected PLMN.

8.2.4.26  Requested WUS assistance information

The UE may include this IE if it supports WUS assistance and it is not attaching for emergency bearer services.

8.2.4.27  DRX parameter in NB-S1 mode

This IE is included if the UE intends to use the UE specific DRX parameter in NB-S1 mode.

8.2.4.28  Requested IMSI offset

The MUSIM UE may include this IE if the UE needs to indicate an IMSI offset value to the network as specified in 3GPP  S  23.401  [10] that is used for deriving the paging occasion as specified in 3GPP  S  36.304  [21].

8.2.5  Authentication failure

8.2.5.1  Message definition

This message is sent by the UE to the network to indicate that authentication of the network has failed. See table  8.2.5.1.

Message type:  AUTHENTICATION FAILURE

Significance:  dual

Direction:  UE to network

8.2.5.2  Authentication failure parameter

This IE shall be sent if and only if the EMM cause was #21 "synch failure". It shall include the response to the authentication challenge from the USIM, which is made up of the AUTS parameter (see 3GPP  S  33.102  [18]).

8.2.6  Authentication reject

This message is sent by the network to the UE to indicate that the authentication procedure has failed and that the UE shall abort all activities. See table  8.2.6.1.

Message type:  AUTHENTICATION REJECT

Significance:  dual

Direction:  network to UE

8.2.8  Authentication response

This message is sent by the UE to the network to deliver a calculated authentication response to the network. See table  8.2.8.1.

Message type:  AUTHENTICATION RESPONSE

Significance:  dual

Direction:  UE to network

8.2.9.2  CLI

The network shall send this IE if it was received via SGs. It contains the identification of the calling line for the mobile terminating call in the CS domain, which triggered the paging via SGs.

8.2.9.3  SS Code

The network shall send this IE if it was received via SGs. It contains information on the supplementary service transaction in the CS domain, which triggered the paging via SGs.

8.2.9.4  LCS indicator

The network shall send this IE if it was received via SGs. It indicates that the paging was triggered by a terminating LCS request in the CS domain.

8.2.9.5  LCS client identity

The network shall send this IE if received via SGs. It contains information related to the requestor of the terminating LCS request in the CS domain.

8.2.10  Detach accept

8.2.10.1  Detach accept (UE originating detach)

This message is sent by the network to indicate that the detach procedure has been completed. See table  8.2.10.1.1.

Message type:  DETACH ACCEPT

Significance:  dual

Direction:  network to UE


8.2.13.2  Full name for network

This IE may be sent by the network. If this IE is sent, the contents of this IE indicate the "full length name of the network" that the network wishes the UE to associate with the MCC and MNC contained in the last visited tracking area identification.

8.2.13.3  Short name for network

This IE may be sent by the network. If this IE is sent, the contents of this IE indicate the "abbreviated name of the network" that the network wishes the UE to associate with the MCC and MNC contained in the last visited tracking area identification.

8.2.13.4  Local time zone

This IE may be sent by the network. The UE should assume that this time zone applies to the tracking area of the current cell, and also applies to the tracking area list if available in the UE.

NOTE:  The time information can be inaccurate, especially when the TAI list includes tracking areas belonging to different time zones.

If the local time zone has been adjusted for daylight saving time, the network shall indicate this by including the Network daylight saving time IE.

8.2.13.5  Universal time and local time zone

This IE may be sent by the network. The UE should assume that this time zone applies to the tracking area the UE is currently in, and also applies to the tracking area list if available in the UE. The UE shall not assume that the time information is accurate.

NOTE:  The time information can be inaccurate, especially when the TAI list includes tracking areas belonging to different time zones.

If the local time zone has been adjusted for daylight saving time, the network shall indicate this by including the Network daylight saving time IE.

8.2.13.6  Network daylight saving time

This IE may be sent by the network. If this IE is sent, the contents of this IE indicates the value that has been used to adjust the local time zone.

8.2.14  EMM status

This message is sent by the UE or by the network at any time to report certain error conditions listed in clause  7. See table  8.2.14.1.

Message type:  EMM STATUS

Significance:  local

Direction:  both

8.2.15  Extended service request

8.2.15.1  Message definition

This message is sent by the UE to the network

-  to initiate a CS fallback or 1xCS fallback call or respond to a mobile terminated CS fallback or 1xCS fallback request from the network; or

-  to request the establishment of a NAS signalling connection and of the radio and S1 bearers for packet services, if the UE needs to provide additional information that cannot be provided via a SERVICE REQUEST message.

See table  8.2.15.1.

Message type:  EXTENDED SERVICE REQUEST

Significance:  dual

Direction:  UE to network

8.2.15.2  CSFB response

The UE shall include this IE only if the Service type information element indicates "mobile terminating CS fallback or 1xCS fallback".

NOTE:  The UE does not include this IE for mobile terminating 1xCS fallback.

8.2.15.3  EPS bearer context status

This IE shall be included if the UE wants to indicate the EPS bearer contexts that are active within the UE.

8.2.15.4  Device properties

The UE shall include this IE if the UE is configured for NAS signalling low priority.

8.2.15.5  UE request type

The UE shall include this IE if the MUSIM UE requests the release of the NAS signalling connection or rejects the paging request from the network.

8.2.15.6  Paging restriction

The UE shall include this IE if the Request type is set to "NAS signalling connection release" or to "Rejection of paging" in the UE request type IE and the UE requests the network to restrict paging.



8.2.16  GUTI reallocation command

8.2.16.1  Message definition

This message is sent by the network to the UE to reallocate a GUTI and optionally to provide a new TAI list or a new DCN-ID or both. See table  8.2.16.1.

Message type:  GUTI REALLOCATION COMMAND

Significance:  dual

Direction:  network to UE

8.2.16.2  TAI list

This IE may be included to assign a TAI list to the UE.

8.2.16.3  DCN-ID

This IE may be included to assign a new DCN-ID to the UE.

8.2.16.4  UE radio capability ID

This IE may be included in WB-S1 mode if both the UE and the network support RACS and the network needs to assign a network-assigned UE radio capability ID to the UE. If this IE is included, the UE radio capability ID deletion indication IE shall not be included.

8.2.16.5  UE radio capability ID deletion indication

This IE may be included in WB-S1 mode if both the UE and the network support RACS and the network needs to trigger the UE to delete all network-assigned UE radio capability IDs stored at the UE for the serving PLMN. If this IE is included, the UE radio capability ID IE shall not be included.

8.2.17  GUTI reallocation complete

This message is sent by the UE to the network to indicate that reallocation of a GUTI has taken place. See table  8.2.17.1.

Message type:  GUTI REALLOCATION COMPLETE

Significance:  dual

Direction:  UE to network

8.2.20.2  IMEISV request

The MME may include this information element to request the UE to send its IMEISV with the corresponding SECURITY MODE COMPLETE message.

8.2.20.3  Replayed nonceUE

The MME may include this information element to indicate to the UE to use the replayed nonceUE.

8.2.20.4  NonceMME

The MME may include this information element to indicate to the UE to use the nonceMME.

8.2.20.5  HashMME

The MME shall include this information element when the MME is initiating a SECURITY MODE COMMAND during an attach or tracking area updating procedure and the ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message was received without integrity protection or did not successfully pass the integrity check at the MME.

8.2.20.6  Replayed UE additional security capability

The MME shall include this IE if the MME supports handling of UE additional security capabilities, the MME is initiating a SECURITY MODE COMMAND during an attach or tracking area updating procedure and the ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message included a UE additional security capability IE.

8.2.20.7  UE radio capability ID request

The MME may include this information element in WB-S1 mode to request the UE to send its UE radio capability ID with the corresponding SECURITY MODE COMPLETE message.

8.2.21  Security mode complete

8.2.21.1  Message definition

This message is sent by the UE to the network in response to a SECURITY MODE COMMAND message. See table  8.2.21.1.

Message type:  SECURITY MODE COMPLETE

Significance:  dual

Direction:  UE to network

8.2.21.2  IMEISV

The UE shall include this information element, if the IMEISV was requested within the corresponding SECURITY MODE COMMAND message.

8.2.21.3  Replayed NAS message container

The UE shall include this information element, if during an ongoing attach or tracking area updating procedure, the MME included HASHMME in the SECURITY MODE COMMAND message and HASHMME has a different value from the hash value locally calculated at the UE as described in 3GPP  S  33.401  [19].

8.2.21.4  UE radio capability ID

The UE shall include this information element in WB-S1 mode if the UE radio capability ID was requested within the corresponding SECURITY MODE COMMAND message.

8.2.22  Security mode reject

This message is sent by the UE to the network to indicate that the corresponding security mode command has been rejected. See table  8.2.22.1.

Message type:  SECURITY MODE REJECT

Significance:  dual

Direction:  UE to network


8.2.23  Security protected NAS message

This message is sent by the UE or the network to transfer a NAS message together with the sequence number and the message authentication code protecting the message. See table  8.2.23.1.

Message type:  SECURITY PROTECTED NAS MESSAGE

Significance:  dual

Direction:  both

8.2.24.2  T3442 value

The MME shall include this IE when the EMM cause value is #39 "CS service temporarily not available".

8.2.24.3  T3346 value

The MME may include this IE when the general NAS level mobility management congestion control is active.

8.2.24.4  T3448 value

The network may include this IE if the congestion control for transport of user data via the control plane is active and the UE supports timer T3448.

8.2.24.5  Forbidden TAI(s) for the list of "forbidden tracking areas for roaming"

This IE is included to indicate the forbidden TAI(s) to be stored in the list of "forbidden tracking areas for roaming". This IE is included only if the message is sent via satellite E-UTRAN access. 

8.2.24.6  Forbidden TAI(s) for the list of "forbidden tracking areas for  regional provision of service"

This IE is included to indicate the forbidden TAI(s) to be stored in the list of "forbidden tracking areas for regional provision of service". This IE is included only if the message is sent via satellite E-UTRAN access.

8.2.25  Service request

This message is sent by the UE to the network to request the establishment of a NAS signalling connection and of the radio and S1 bearers. Its structure does not follow the structure of a standard layer  3 message. See table  8.2.25.1.

Message type:  SERVICE REQUEST

Significance:  dual

Direction:  UE to network

8.2.26  Tracking area update accept

8.2.26.1  Message definition

This message is sent by the network to the UE to provide the UE with EPS mobility management related data in response to a tracking area update request message. See table  8.2.26.1.

Message type:  TRACKING AREA UPDATE ACCEPT

Significance:  dual

Direction:  network to UE

8.2.26.2  T3412 value

The MME shall include this IE during normal and combined tracking area updating procedure, and may include this IE during periodic tracking area updating procedure.

The MME shall include this IE if it includes the T3412 extended value IE.

8.2.26.3  GUTI

This IE may be included to assign a GUTI to a UE.

8.2.26.4  TAI list

This IE may be included to assign a TAI list to a UE.

8.2.26.5  EPS bearer context status

This IE shall be included if the network wants to indicate the EPS bearer contexts that are active for the UE in the network.

8.2.26.6  Location area identification

This IE may be included to assign a new location area identification to a UE during a combined TA/LA update.

8.2.26.7  MS identity

This IE may be included to assign or unassign a new TMSI to a UE during a combined TA/LA update.

8.2.26.8  EMM cause

This IE shall be included if the combined tracking area updating procedure was successful for EPS services only.

8.2.26.9  T3402 value

This IE may be included to indicate a value for timer T3402.

8.2.26.10  T3423 value

This IE may be included to indicate a value for timer T3423.

If this IE is not included, the UE shall use the default value.

8.2.26.11  Equivalent PLMNs

This IE may be included in order to assign a new equivalent PLMNs list to a UE.

8.2.26.12  Emergency number list

This IE may be sent by the network. If this IE is sent, the contents of this IE indicates a list of emergency numbers valid within the same country as in the PLMN from which this IE is received.

8.2.26.12A  Extended emergency number list

This IE may be sent by the network. If this IE is sent, the contents of this IE indicates a list of emergency numbers (with URN information) valid within the same country as in the PLMN from which this IE is received or valid only in the PLMN from which this IE is received.

8.2.26.13  EPS network feature support

The network may include this IE to inform the UE of the support of certain features. If this IE is not included then the UE shall interpret this as a receipt of an information element with all bits of the value part coded as zero, except for the S1-u data transfer (S1-U data) (octet 4, bit 2).

NOTE: In this exceptional case, the UE deems that the network supports S1-u data transfer.

8.2.26.14  Additional update result

The network may include this IE to provide the UE with additional information about the result of:

-  a combined tracking area updating procedure if the procedure was successful for EPS services and non-EPS services, or for EPS services and "SMS only"; or

-  a normal tracking area updating procedure requested for CIoT EPS optimizations if the procedure was successful for EPS services and "SMS only".

8.2.26.15  T3412 extended value

The network may include this IE to provide the UE with a longer periodic tracking area update timer.

8.2.26.16  T3324 value

The network shall include the T3324 value IE if:

-  the UE included the T3324 value IE in the TRACKING AREA UPDATE REQUEST message; and

-  the network supports PSM and accepts the use of PSM.

8.2.26.17  Extended DRX parameters

The network shall include the Extended DRX parameters IE if:

-  the UE included the Extended DRX parameters IE in the TRACKING AREA UPDATE REQUEST message; and

-  the network supports eDRX and accepts the use of eDRX.

8.2.26.18  DCN-ID

This IE is included in the message when the network wishes to provide a DCN-ID to the UE.

8.2.26.19  SMS services status

This IE may be included when a normal tracking area updating procedure for EPS services and "SMS only" was successful for EPS services only.

8.2.26.20  Non-3GPP NW provided policies

This IE is included if the network needs to indicate whether emergency numbers provided via non-3GPP access can be used to initiate UE detected emergency calls (see 3GPP  S  24.302  [48]). If this IE is not included then the UE shall interpret this as a receipt of an information element with all bits of the value part coded as zero.

8.2.26.21  T3448 value

The network may include this IE if the congestion control for transport of user data via the control plane is active and the UE supports timer T3448.

8.2.26.22  Network policy

This IE is included if the network needs to indicate network policy information to the UE. If this IE is not included, then the UE shall interpret this as a receipt of an information element with all bits of the value part coded as zero.

8.2.26.23  T3447 value

The network may include T3447 value IE if:

-  the UE has indicated support for service gap control in the TRACKING AREA UPDATE REQUEST messages; and

-  the EMM context contains a service gap time value.

8.2.26.24  Ciphering key data

This IE is included if the network needs to send ciphering key data to the UE for ciphered broadcast assistance data.

8.2.26.25  UE radio capability ID

This IE may be included in WB-S1 mode if both the UE and the network supports RACS and the network needs to assign a network-assigned UE radio capability ID to the UE.

8.2.26.26  UE radio capability ID deletion indication

This IE may be included in WB-S1 mode if both the UE and the network supports RACS and the network needs to trigger the UE to delete all network-assigned UE radio capability IDs stored at the UE for the serving PLMN.

8.2.26.27  Negotiated WUS assistance information

The network shall include the Negotiated WUS assistance information IE if:

-  the UE supports WUS assistance;

-  the MME supports and accepts the use of WUS assistance; and

-  the UE is not attaching for emergency bearer services.

8.2.26.28  Negotiated DRX parameter in NB-S1 mode

The network shall include the Negotiated DRX parameter in NB-S1 mode IE if the UE has included the DRX parameter in NB-S1 mode IE in the TRACKING AREA UPDATE REQUEST message.

8.2.26.29  Negotiated IMSI offset

The network shall include the Negotiated IMSI offset IE if the network supports paging timing collision control and the MUSIM UE has included the Requested IMSI offset IE in the TRACKING AREA UPDATE REQUEST message.

8.2.26.30  EPS additional request result

The network may include this IE to inform the UE about the result of additional request.

8.2.26.31  Forbidden TAI(s) for the list of "forbidden tracking areas for roaming"

This IE is included to indicate the forbidden TAI(s) to be stored in the list of "forbidden tracking areas for roaming". This IE is included only if the message is sent via satellite E-UTRAN access. 

8.2.26.32  Forbidden TAI(s) for the list of "forbidden tracking areas for  regional provision of service"

This IE is included to indicate the forbidden TAI(s) to be stored in the list of "forbidden tracking areas for regional provision of service". This IE is included only if the message is sent via satellite E-UTRAN access.

8.2.27  Tracking area update complete

This message shall be sent by the UE to the network in response to a tracking area update accept message if a GUTI has been changed or a new TMSI has been assigned. See table  8.2.27.1.

Message type:  TRACKING AREA UPDATE COMPLETE

Significance:  dual

Direction:  UE to network

8.2.28.2  T3346 value

The MME may include this IE when the general NAS level mobility management congestion control is active.

8.2.28.3  Extended EMM cause

This IE may be included by the network to indicate additional information associated with the EMM cause.

8.2.28.4  Forbidden TAI(s) for the list of "forbidden tracking areas for roaming"

This IE is included to indicate the forbidden TAI(s) to be stored in the list of "forbidden tracking areas for roaming". This IE is included only if the message is sent via satellite E-UTRAN access. 

8.2.28.5  Forbidden TAI(s) for the list of "forbidden tracking areas for  regional provision of service"

This IE is included to indicate the forbidden TAI(s) to be stored in the list of "forbidden tracking areas for regional provision of service". This IE is included only if the message is sent via satellite E-UTRAN access.

8.2.29  Tracking area update request

8.2.29.1  Message definition

The purposes of sending the tracking area update request by the UE to the network are described in clause  5.5.3.1. See table  8.2.29.1.

Message type:  TRACKING AREA UPDATE REQUEST

Significance:  dual

Direction:  UE to network

8.2.29.2  Non-current native NAS key set identifier

The UE shall include this IE if the UE has a valid non-current native EPS security context when the UE performs an A/Gb mode or Iu mode or N1 mode to S1 mode inter-system change in EMM-CONNECTED mode and the UE uses a mapped EPS security context to protect the TRACKING AREA UPDATE REQUEST message.

8.2.29.3  GPRS ciphering key sequence number

The UE shall include this IE if the UE performs an A/Gb mode or Iu mode to S1 mode inter-system change in EMM-IDLE mode and the TIN indicates "P-TMSI".

8.2.29.4  Old P-TMSI signature

The UE shall include this IE if the TIN indicates "P-TMSI" and the UE holds a valid P-TMSI signature, P-TMSI and RAI.

8.2.29.5  Additional GUTI

The UE shall include this IE:

a)  if the TIN indicates "P-TMSI" and the UE holds a valid GUTI, P-TMSI and RAI; or

b)  if the UE performs an N1 mode to S1 mode inter-system change and the UE holds a valid GUTI.

8.2.29.6  NonceUE

This IE is included if the UE performs an A/Gb mode or Iu mode to S1 mode inter-system change in idle mode and the TIN is set to "P-TMSI".

8.2.29.7  UE network capability

The UE shall include this IE, unless the UE performs a periodic tracking area updating procedure.

8.2.29.8  Last visited registered TAI

This IE shall be included if the UE holds a valid last visited registered TAI.

8.2.29.9  DRX parameter

This IE is included by the UE to indicate a change of UE specific DRX parameters to the network.

8.2.29.10  UE radio capability information update needed

The UE shall include this IE if the UE radio capability information in the network needs to be updated.

8.2.29.11  EPS bearer context status

This IE shall be included if the UE wants to indicate the EPS bearer contexts that are active within the UE.

8.2.29.12  MS network capability

A UE supporting A/Gb mode or Iu mode shall include this IE, unless the UE performs a periodic tracking area updating procedure.

8.2.29.13  Old location area identification

The UE shall include this IE during a combined tracking area updating procedure if it has a valid location area identification.

8.2.29.14  TMSI status

The UE shall include this IE during a combined tracking area updating procedure if it has no valid TMSI available.

8.2.29.15  Mobile station classmark 2

This IE shall be included if the UE supports SRVCC to GERAN or UTRAN or supports vSRVCC to UTRAN (see 3GPP  S  23.216  [8]), or if the UE is performing a combined tracking area updating procedure.

8.2.29.16  Mobile station classmark 3

This IE shall be included if the UE supports SRVCC to GERAN.

8.2.29.17  Supported Codecs

This IE shall be included if the UE supports SRVCC to GERAN or UTRAN or supports vSRVCC to UTRAN to indicate its supported speech codecs for CS speech calls.

8.2.29.18  Additional update type

The UE shall include this IE if the UE requests "SMS only" or CIoT EPS optimizations, unless the UE performs a periodic tracking area updating procedure.

8.2.29.19  Voice domain preference and UE   's usage setting

This IE shall be included in WB-S1 mode if and only if the UE supports:

-  CS fallback and SMS over SGs; or

-  if the UE is configured to support IMS voice, but does not support 1xCS fallback.

8.2.29.20  Old GUTI type

The UE shall include this IE.

8.2.29.21  Device properties

This IE shall be included if the UE is configured for NAS signalling low priority.

8.2.29.22  MS network feature support

This IE shall be included if the UE supports extended periodic timer T3412.

8.2.29.23  TMSI based NRI container

The UE shall include this IE if it has a valid TMSI.

8.2.29.24  T3324 value

The UE may include this IE to request the use of PSM.

8.2.29.25  T3412 extended value

The UE may include this IE to request a particular T3412 value if the T3324 value IE is included.

8.2.29.26  Extended DRX parameters

The UE may include this IE to request the use of eDRX.

8.2.29.27  UE additional security capability

The UE shall include this IE if the UE supports dual connectivity with NR or if the UE supports N1 mode.

8.2.29.28  UE status

This IE shall be included if the UE wants to provide the network with information concerning aspects of the current UE registration status which is used for interworking with 5GS.

8.2.29.29  Additional information requested

The UE shall include this IE if the UE supports ciphered broadcast assistance data and the UE needs to obtain new ciphering keys for ciphered broadcast assistance data.

8.2.29.30  N1 UE network capability

The UE shall include this IE if the UE supports N1 mode and needs to indicate the supported CIoT network behaviour for 5GCN, unless the UE performs a periodic tracking area updating procedure.

8.2.29.31  UE radio capability ID availability IE

The UE may include this IE in WB-S1 mode if the UE supports RACS and the UE has an applicable UE radio capability ID for the current UE radio configuration in the selected PLMN.

8.2.29.32  DRX parameter in NB-S1 mode

This IE is included if the UE intends to use or change the UE specific DRX parameter in NB-S1 mode, except when the UE performs a periodic tracking area updating procedure.

8.2.29.33  Requested WUS assistance information

The UE may include this IE if it supports WUS assistance and it is not attaching for emergency bearer services.

8.2.29.34  Requested IMSI offset

The MUSIM UE may include this IE if the UE needs to indicate an IMSI offset value to the network as specified in 3GPP  S  23.401  [10] that is used for deriving the paging occasion as specified in 3GPP  S  36.304  [21].

8.2.29.35  UE request type

The UE shall include this IE if the MUSIM UE requests the release of the NAS signalling connection.

8.2.29.36  Paging restriction

The UE shall include this IE if the Request type is set to "NAS signalling connection release" in the UE request type IE and the UE requests the network to restrict paging.



8.2.30  Uplink NAS Transport

This message is sent by the UE to the network in order to carry an SMS message in encapsulated format. See table  8.2.30.1.

Message type:  UPLINK NAS TRANSPORT

Significance:  dual

Direction:  UE to network

8.2.33.2  ESM message container

The UE shall include this IE, if it wants to send an ESM message to the network.

8.2.33.3  NAS message container

The UE shall include this IE, if it is in EMM-IDLE mode and has pending SMS messages to be sent.

8.2.33.4  EPS bearer context status

The UE shall include this IE, if it wants to indicate the EPS bearer contexts that are active within the UE.

8.2.33.5  Device properties

The UE shall include this IE if the UE is configured for NAS signalling low priority.

8.2.33.6  UE request type

The UE shall include this IE if the MUSIM UE requests the release of the NAS signalling connection or rejects the paging request from the network.

8.2.33.7  Paging restriction

The UE shall include this IE if the Request type is set to "NAS signalling connection release" or to "Rejection of paging" in the UE request type IE and the UE requests the network to restrict paging.



8.2.34  Service Accept

8.2.34.1  Message definition

This message is sent by the network in response to the SERVICE REQUEST message, the EXTENDED SERVICE REQUEST message or the CONTROL PLANE SERVICE REQUEST message. See table  8.2.34.1.

Message type:  SERVICE ACCEPT

Significance:  dual

Direction:  network to UE

8.2.34.2  EPS bearer context status

This IE shall be included if the network wants to indicate the EPS bearer contexts that are active for the UE in the network.

8.2.34.3  T3448 value

The network may include this IE if the congestion control for transport of user data via the control plane is active and the UE supports timer T3448.

8.2.34.4  EPS additional request result

The network may include this IE to inform the UE about the result of additional request.

8.3  EPS session management messages

8.3.1  Activate dedicated EPS bearer context accept

8.3.1.1  Message definition

This message is sent by the UE to the network to acknowledge activation of a dedicated EPS bearer context associated with the same PDN address(es) and APN as an already active EPS bearer context. See table  8.3.1.1.

Message type:  ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT

Significance:  dual

Direction:  UE to network

8.3.1.2  Protocol configuration options

This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see clause  6.6.1.1).

8.3.1.3  NBIFOM container

This information element is used to transfer information associated with network-based IP flow mobility, see 3GPP  S  24.161  [36].

8.3.1.4  Extended protocol configuration options

This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see clause  6.6.1.1).

8.3.2  Activate dedicated EPS bearer context reject

8.3.2.1  Message definition

This message is sent by UE to the network to reject activation of a dedicated EPS bearer context. See table  8.3.2.1.

Message type:  ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT

Significance:  dual

Direction:  UE to network

8.3.2.2  Protocol configuration options

This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see clause  6.6.1.1).

8.3.2.3  NBIFOM container

This information element is used to transfer information associated with network-based IP flow mobility, see 3GPP  S  24.161  [36].

8.3.2.4  Extended protocol configuration options

This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see clause  6.6.1.1).

  8.3.3  Activate dedicated EPS bearer context request

8.3.3.1  Message definition

This message is sent by the network to the UE to request activation of a dedicated EPS bearer context associated with the same PDN address(es) and APN as an already active default EPS bearer context. See table  8.3.3.1.

Message type:  ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST

Significance:  dual

Direction:  network to UE

8.3.3.2  Transaction identifier

If the UE supports A/Gb mode or Iu mode or both, a network supporting mobility from S1 mode to A/Gb mode or Iu mode or both shall include this IE

8.3.3.3  Negotiated QoS

If the UE supports A/Gb mode or Iu mode or both, a network supporting mobility from S1 mode to A/Gb mode or Iu mode or both shall include the corresponding R99 QoS parameter values of a PDP context.

8.3.3.4  Negotiated LLC SAPI

If the UE supports A/Gb mode, a network supporting mobility from S1 mode to A/Gb mode shall include this IE.

8.3.3.5  Radio priority

If the UE supports A/Gb mode, a network supporting mobility from S1 mode to A/Gb mode shall include this IE.

8.3.3.6  Packet flow identifier

If the UE supports A/Gb mode and BSS packet flow procedures, a network supporting mobility from S1 mode to A/Gb mode shall include this IE.

8.3.3.7  Protocol configuration options

This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see clause  6.6.1.1).

8.3.3.8  WLAN offload indication

This IE shall be included in the message when the network wishes to indicate if the UE is allowed to offload the traffic of the associated PDN connection to WLAN(s), as specified in clause  9.9.4.18.

8.3.3.9  NBIFOM container

This information element is used to transfer information associated with network-based IP flow mobility, see 3GPP  S  24.161  [36].

8.3.3.10  Extended protocol configuration options

This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see clause  6.6.1.1).

8.3.3.11  Extended EPS QoS

This IE shall be included in the message only if the network wishes to transmit the maximum and guaranteed bit rate values to the UE and at least one of the values to be transmitted exceeds the maximum value specified in the EPS quality of service information element in clause  9.9.4.3.

8.3.4  Activate default EPS bearer context accept

8.3.4.1  Message definition

This message is sent by the UE to the network to acknowledge activation of a default EPS bearer context. See table  8.3.4.1.

Message type:  ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT

Significance:  dual

Direction:  UE to network

8.3.4.2  Protocol configuration options

This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see clause  6.6.1.1).

8.3.4.3  Extended protocol configuration options

This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see clause  6.6.1.1).

8.3.5  Activate default EPS bearer context reject

8.3.5.1  Message definition

This message is sent by UE to the network to reject activation of a default EPS bearer context. See table  8.3.5.1.

Message type:  ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT

Significance:  dual

Direction:  UE to network

8.3.5.2  Protocol configuration options

This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see clause  6.6.1.1).

8.3.5.3  Extended protocol configuration options

This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see clause  6.6.1.1).

8.3.6  Activate default EPS bearer context request

8.3.6.1  Message definition

This message is sent by the network to the UE to request activation of a default EPS bearer context. See table  8.3.6.1.

Message type:  ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST

Significance:  dual

Direction:  network to UE

8.3.6.2  Transaction identifier

If the UE supports A/Gb mode or Iu mode or both, a network supporting mobility from S1 mode to A/Gb mode or Iu mode or both shall include this IE.

8.3.6.3  Negotiated QoS

If the UE supports A/Gb mode or Iu mode or both, a network supporting mobility from S1 mode to A/Gb mode or Iu mode or both shall include the corresponding R99 QoS parameter values of a PDP context.

8.3.6.4  Negotiated LLC SAPI

If the UE supports A/Gb mode, a network supporting mobility from S1 mode to A/Gb mode shall include this IE.

8.3.6.5  Radio priority

If the UE supports A/Gb mode, a network supporting mobility from S1 mode to A/Gb mode shall include this IE.

8.3.6.6  Packet flow identifier

If the UE supports A/Gb mode and BSS packet flow procedures, a network supporting mobility from S1 mode to A/Gb mode shall include this IE.

8.3.6.7  APN-AMBR

This IE is included in the message when the network wishes to transmit the APN-AMBR to the UE for possible uplink policy enforcement.

8.3.6.8  ESM cause

The network shall include this IE, if the network allocated a PDN address of a PDN type which is different from the PDN type requested by the UE.

8.3.6.9  Protocol configuration options

This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see clause  6.6.1.1).

This IE shall be included if the network supports Local IP address in the traffic flow aggregate description and TFT filter, the PDN Type is different from Non-IP and Ethernet, and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see clause  6.6.1.1).

8.3.6.10  Connectivity type

The network shall include the Connectivity type IE if:

-  the network is configured to indicate when a PDN connection is a LIPA PDN connection; and

-  the present PDN connection is a LIPA PDN connection.

8.3.6.11  WLAN offload indication

This IE shall be included in the message when the network wishes to indicate if the UE is allowed to offload the traffic of the associated PDN connection to WLAN(s), as specified in clause  9.9.4.18.

8.3.6.12  NBIFOM container

This information element is used to transfer information associated with network-based IP flow mobility, see 3GPP  S  24.161  [36].

8.3.6.13  Header compression configuration

The network may include the Header compression configuration IE if:

-  the network accepts an IP PDN type; and

-  control plane CIoT EPS optimization is selected.

8.3.6.14  Control plane only indication

The network shall include the Control plane only indication IE if the associated PDN connection is only for control plane CIoT EPS optimization.

8.3.6.15  Extended protocol configuration options

This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see clause  6.6.1.1).

This IE shall be included if the network supports Local IP address in the traffic flow aggregate description and TFT filter, the PDN Type is different from Non-IP and Ethernet, and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see clause  6.6.1.1).

8.3.6.16  Serving PLMN rate control

This IE shall be included when the network wishes to indicate the maximum number of uplink ESM DATA TRANSPORT messages including User data container IEs the UE is allowed to send per 6 minute interval.

8.3.6.17  Extended APN aggregate maximum bit rate

This IE shall be included in the message only if the network wishes to transmit the APN-AMBR values to the UE for possible uplink policy enforcement and at least one of the values to be transmitted exceeds the maximum value specified in the APN aggregate maximum bit rate information element in clause  9.9.4.2.

8.3.7  Bearer resource allocation reject

8.3.7.1  Message definition

This message is sent by the network to the UE to reject the allocation of a dedicated bearer resource. See table  8.3.7.1.

Message type:  BEARER RESOURCE ALLOCATION REJECT

Significance:  dual

Direction:  network to UE

8.3.7.2  Protocol configuration options

This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see clause  6.6.1.1).

8.3.7.3  Back-off timer value

The network may include this IE if the ESM cause is not #65 "maximum number of EPS bearers reached", to request a minimum time interval before procedure retry is allowed.

8.3.7.4  Re-attempt indicator

The network may include this IE only if it includes the Back-off timer value IE and the ESM cause value is not #26 "insufficient resources".

8.3.7.5  NBIFOM container

This information element is used to transfer information associated with network-based IP flow mobility, see 3GPP  S  24.161  [36].

8.3.7.6  Extended protocol configuration options

This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see clause  6.6.1.1).

8.3.8  Bearer resource allocation request

8.3.8.1  Message definition

This message is sent by the UE to the network to request the allocation of a dedicated bearer resource. See table  8.3.8.1.

Message type:  BEARER RESOURCE ALLOCATION REQUEST

Significance:  dual

Direction:  UE to network

8.3.8.2  Protocol configuration options

This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see clause  6.6.1.1).

8.3.8.3  Device properties

The UE shall include this IE if the UE is configured for NAS signalling low priority.

8.3.8.4  NBIFOM container

This information element is used to transfer information associated with network-based IP flow mobility, see 3GPP  S  24.161  [36].

8.3.8.5  Extended protocol configuration options

This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see clause  6.6.1.1).

8.3.8.6  Extended EPS QoS

This IE shall be included in the message only if the UE wishes to transmit the maximum and guaranteed bit rate values to the network and at least one of the values to be transmitted exceeds the maximum value specified in the EPS quality of service information element in clause  9.9.4.3.

8.3.9  Bearer resource modification reject

8.3.9.1  Message definition

This message is sent by the network to the UE to reject the modification of a dedicated bearer resource. See table  8.3.9.1.

Message type:  BEARER RESOURCE MODIFICATION REJECT

Significance:  dual

Direction:  network to UE

8.3.9.2  Protocol configuration options

This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see clause  6.6.1.1).

8.3.9.3  Back-off timer value

The network may include this IE to request a minimum time interval before procedure retry is allowed.

8.3.9.4  Re-attempt indicator

The network may include this IE only if it includes the Back-off timer value IE and the ESM cause value is not #26 "insufficient resources".

8.3.9.5  NBIFOM container

This information element is used to transfer information associated with network-based IP flow mobility, see 3GPP  S  24.161  [36].

8.3.9.6  Extended protocol configuration options

This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see clause  6.6.1.1).

8.3.10  Bearer resource modification request

8.3.10.1  Message definition

This message is sent by the UE to the network to request the modification of a dedicated bearer resource, or to request re-negotiation of header compression configuration associated to an EPS bearer context if the network has previously indicated support of Control plane CIoT EPS optimization and Header compression for control plane CIoT EPS optimization. See table  8.3.10.1.

Message type:  BEARER RESOURCE MODIFICATION REQUEST

Significance:  dual

Direction:  UE to network



8.3.10.2  Required traffic flow QoS

This IE is included in the message when the UE requests a change of QoS for the indicated traffic flows and does not request to release all bearer resources for the EPS bearer context.

8.3.10.3  ESM cause

This IE is included in the message when the UE requests the release of a dedicated bearer resource.

8.3.10.4  Protocol configuration options

This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see clause  6.6.1.1).

8.3.10.5  Device properties

The UE shall include this IE if the UE is configured for NAS signalling low priority.

8.3.10.6  NBIFOM container

This information element is used to transfer information associated with network-based IP flow mobility, see 3GPP  S  24.161  [36].

8.3.10.7  Header compression configuration

This IE is included in the message if:

a)  the UE wishes to re-negotiate header compression configuration associated to an EPS bearer context and both the UE and the network supports Control plane CIoT EPS optimization and header compression; or

b)  to negotiate header compression configuration associated to an EPS bearer context after an inter-system change from N1 mode to S1 mode when both the UE and the network support control plane CIoT EPS optimization and header compression, and the UE is operating in single-registration mode and has received the interworking without N26 interface indicator set to "interworking without N26 interface not supported" from the network.

8.3.10.8  Extended protocol configuration options

This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see clause  6.6.1.1).

8.3.10.9  Extended EPS QoS

This IE shall be included in the message only if the UE wishes to transmit the maximum and guaranteed bit rate values to the network and at least one of the values to be transmitted exceeds the maximum value specified in the EPS quality of service information element in clause  9.9.4.3.

8.3.11  Deactivate EPS bearer context accept

8.3.11.1  Message definition

This message is sent by the UE to acknowledge deactivation of the EPS bearer context requested in the corresponding Deactivate EPS bearer context request message. See table  8.3.11.1.

Message type:  DEACTIVATE EPS BEARER CONTEXT ACCEPT

Significance:  dual

Direction:  UE to network

8.3.11.2  Protocol configuration options

This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see clause  6.6.1.1).

8.3.11.3  Void

8.3.11.4  Extended protocol configuration options

This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see clause  6.6.1.1).

8.3.12  Deactivate EPS bearer context request

8.3.12.1  Message definition

This message is sent by the network to request deactivation of an active EPS bearer context. See table  8.3.12.1.

Message type:  DEACTIVATE EPS BEARER CONTEXT REQUEST

Significance:  dual

Direction:  network to UE

8.3.12.2  Protocol configuration options

This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see clause  6.6.1.1).

8.3.12.3  T3396 value

The network may include this IE if the ESM cause is #26 "insufficient resources".

8.3.12.4  WLAN offload indication

This IE shall be included in the message when the network wishes to indicate if the UE is allowed to offload the traffic of the associated PDN connection to WLAN(s), as specified in clause  9.9.4.18. If the MME wishes to deactivate all EPS bearer contexts of a PDN connection, MME shall not include this IE.

8.3.12.5  NBIFOM container

This information element is used to transfer information associated with network-based IP flow mobility, see 3GPP  S  24.161  [36].

8.3.12.6  Extended protocol configuration options

This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see clause  6.6.1.1).

8.3.12A  ESM dummy message

This message is sent by the UE or the network included in an ESM message container information element during an attach procedure, if the UE does not request for PDN connection. See table  8.3.12A.1.

Message type:  ESM DUMMY MESSAGE

Significance:  dual

Direction:  both

8.3.13  ESM information request

This message is sent by the network to the UE to request the UE to provide ESM information, i.e. protocol configuration options or APN or both. See table  8.3.13.1.

Message type:  ESM INFORMATION REQUEST

Significance:  dual

Direction:  network to UE

8.3.14  ESM information response

8.3.14.1  Message definition

This message is sent by the UE to the network in response to an ESM INFORMATION REQUEST message and provides the requested ESM information. See table  8.3.14.1.

Message type:  ESM INFORMATION RESPONSE

Significance:  dual

Direction:  UE to network

8.3.14.2  Access point name

This IE is included in the message when the UE wishes to request network connectivity as defined by a certain access point name during the attach procedure.

8.3.14.3  Protocol configuration options

This IE shall be included in the message when, during the attach procedure, the UE wishes to transmit security protected (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network, and:

a)  the UE is in WB-S1 mode;

b)  the requested PDN Type is different from non-IP and Ethernet; and

c)  the requested APN is not for UAS services.

This IE shall be included if:

a)  the UE supports local IP address in traffic flow aggregate description and TFT filter;

b)  the UE is in WB-S1 mode;

c)  the requested PDN Type is different from non-IP and Ethernet; and

d)  the requested APN is not for UAS services.

This IE shall not be included if the Extended protocol configuration options IE is included in the message.

8.3.14.4  Extended protocol configuration options

This IE shall be included in the message when, during the attach procedure, the UE wishes to transmit security protected (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network, and:

a)  the UE is in NB-S1 mode;

b)  the requested PDN Type is non-IP or Ethernet; or

c)  the requested APN is for UAS services.

This IE shall be included if:

a)  the UE supports local IP address in traffic flow aggregate description and TFT filter, the UE is in NB-S1 mode and the requested PDN Type is different from non-IP and Ethernet; or

b)  the UE supports local IP address in traffic flow aggregate description and TFT filter, the requested PDN Type is different from non-IP and Ethernet, and the requested APN is for UAS services.

This IE shall not be included if the Protocol configuration options IE is included in the message.

8.3.15  ESM status

This message is sent by the network or the UE to pass information on the status of the indicated EPS bearer context and report certain error conditions (e.g. as listed in clause  7). See table  8.3.15.1.

Message type:  ESM STATUS

Significance:  dual

Direction:  both

8.3.16.2  Protocol configuration options

This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see clause  6.6.1.1).

8.3.16.3  NBIFOM container

This information element is used to transfer information associated with network-based IP flow mobility, see 3GPP  S  24.161  [36].

8.3.16.4  Extended protocol configuration options

This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see clause  6.6.1.1).

8.3.17  Modify EPS bearer context reject

8.3.17.1  Message definition

This message is sent by the UE or the network to reject a modification of an active EPS bearer context. See table  8.3.17.1.

Message type:  MODIFY EPS BEARER CONTEXT REJECT

Significance:  dual

Direction:  UE to network


8.3.17.2  Protocol configuration options

This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see clause  6.6.1.1).

8.3.17.3  NBIFOM container

This information element is used to transfer information associated with network-based IP flow mobility, see 3GPP  S  24.161  [36].

8.3.17.4  Extended protocol configuration options

This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see clause  6.6.1.1).

8.3.18  Modify EPS bearer context request

8.3.18.1  Message definition

This message is sent by the network to the UE to request modification of an active EPS bearer context, or to request re-negotiation of header compression configuration associated to an EPS bearer context if the UE has previously indicated support of Control plane CIoT EPS optimization and Header compression for control plane CIoT EPS optimization. See table  8.3.18.1.

Message type:  MODIFY EPS BEARER CONTEXT REQUEST

Significance:  dual

Direction:  network to UE

8.3.18.2  New EPS QoS

When the EPS QoS of the EPS bearer context is modified, the network shall include the modified EPS QoS assigned to the EPS bearer context.

8.3.18.3  TFT

This IE provides the UE with packet filters.

8.3.18.4  New QoS

If the UE supports A/Gb mode or Iu mode or both and when the corresponding R99 QoS of the EPS bearer context is modified, a network supporting mobility from S1 mode to A/Gb mode or Iu mode or both shall include the corresponding R99 QoS parameter values of a PDP context.

8.3.18.5  Negotiated LLC SAPI

If the UE supports A/Gb mode and when the negotiated LLC SAPI is modified, a network supporting mobility from S1 mode to A/Gb mode shall include this IE.

8.3.18.6  Radio priority

If the UE supports A/Gb mode and when the radio priority is modified, a network supporting mobility from S1 mode to A/Gb mode shall include this IE.

8.3.18.7  Packet flow identifier

If the UE supports A/Gb mode and BSS packet flow procedures, a network supporting mobility from S1 mode to A/Gb mode shall include this IE.

8.3.18.8  APN-AMBR

This IE is included when the APN-AMBR has been changed by the network.

8.3.18.9  Protocol configuration options

This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see clause  6.6.1.1).

8.3.18.10  WLAN offload indication

This IE shall be included in the message when the network wishes to indicate if the UE is allowed to offload the traffic of the associated PDN connection to WLAN(s), as specified in clause  9.9.4.18.

8.3.18.11  NBIFOM container

This information element is used to transfer information associated with network-based IP flow mobility, see 3GPP  S  24.161  [36].

8.3.18.12  Header compression configuration

This IE is included in the message if the network wishes to re-negotiate header compression configuration associated to an EPS bearer context and both the UE and the network support Control plane CIoT EPS optimization and header compression.

8.3.18.13  Extended protocol configuration options

This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see clause  6.6.1.1).

8.3.18.14  Extended APN-AMBR

This IE shall be included in the message only if at least one of the APN-AMBR values has been changed by the network and at least one of the values to be transmitted exceeds the maximum value specified in the APN aggregate maximum bit rate information element in clause  9.9.4.2.

8.3.18.15  Extended EPS QoS

This IE shall be included in the message only if the network wishes to transmit the maximum and guaranteed bit rate values to the UE and at least one of the values to be transmitted exceeds the maximum value specified in the EPS quality of service information element in clause  9.9.4.3.

8.3.18A  Notification

This message is sent by the network to inform the UE about events which are relevant for the upper layer using an EPS bearer context or having requested a procedure transaction. See table  8.3.18A.1.

Message type:  NOTIFICATION

Significance:  local

Direction:  network to UE

8.3.19.2  Protocol configuration options

This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see clause  6.6.1.1).

8.3.19.3  Back-off timer value

The network may include this IE if the ESM cause is not #28 "unknown PDN type", #50 "PDN type IPv4 only allowed", #51 "PDN type IPv6 only allowed", #54 "PDN connection does not exist", #57 "PDN type IPv4v6 only allowed", #58 "PDN type non IP only allowed", #61 "PDN type Ethernet only allowed", or #65 "maximum number of EPS bearers reached", to request a minimum time interval before procedure retry is allowed.

8.3.19.4  Re-attempt indicator

The network may include this IE only if the ESM cause value is #28 "unknown PDN type", #50 "PDN type IPv4 only allowed", #51 "PDN type IPv6 only allowed", #57 "PDN type IPv4v6 only allowed", #58 "PDN type non IP only allowed", #61 "PDN type Ethernet only allowed", or #66 "requested APN not supported in current RAT and PLMN combination", or if the network includes the Back-off timer value IE and the ESM cause value is not #26 "insufficient resources".

8.3.19.5  Extended protocol configuration options

This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see clause  6.6.1.1).

8.3.20  PDN connectivity request

8.3.20.1  Message definition

This message is sent by the UE to the network to initiate establishment of a PDN connection. See table  8.3.20.1.

Message type:  PDN CONNECTIVITY REQUEST

Significance:  dual

Direction:  UE to network

8.3.20.2  ESM information transfer flag

The UE shall include this IE in the PDN CONNECTIVITY REQUEST message sent during the attach procedure if the UE has protocol configuration options that need to be transferred security protected or wishes to provide an access point name for the PDN connection to be established during the attach procedure.

8.3.20.3  Access point name

This IE is included in the message when the UE wishes to request network connectivity as defined by a certain access point name. This IE shall not be included when the PDN CONNECTIVITY REQUEST message is included in an ATTACH REQUEST message or if the request type indicates "emergency" or "handover of emergency bearer services" or "RLOS".

8.3.20.4  Protocol configuration options

This IE shall be included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network, and:

a)  the UE is in WB-S1 mode;

b)  the requested PDN Type is different from non-IP and Ethernet; and

c)  the requested APN is not for UAS services.

This IE shall be included if:

a)  the UE supports local IP address in traffic flow aggregate description and TFT filter;

b)  the UE is in WB-S1 mode;

c)  the requested PDN Type is different from non-IP and Ethernet; and

d)  the requested APN is not for UAS services.

This IE shall not be included if the Extended protocol configuration options IE is included in the message.

8.3.20.5  Device properties

The UE shall include this IE if the UE is configured for NAS signalling low priority.

8.3.20.6  NBIFOM container

This information element is used to transfer information associated with network-based IP flow mobility, see 3GPP  S  24.161  [36].

8.3.20.7  Header compression configuration

The UE shall include the Header compression configuration IE if:

-  the PDN type value of the PDN type IE is set to IPv4 or IPv6 or IPv4v6;

-  the UE indicates "Control Plane CIoT EPS optimization supported" in the UE network capability IE of the ATTACH REQUEST message; and

-  the UE supports header compression.

8.3.20.8  Extended protocol configuration options

This IE shall be included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network, and:

a)  the UE is in NB-S1 mode;

b)  the requested PDN Type is non-IP or Ethernet; or

c)  the requested APN is for UAS services.

This IE shall be included if:

a)  the UE supports local IP address in traffic flow aggregate description and TFT filter, the UE is in NB-S1 mode and the requested PDN Type is different from non-IP and Ethernet; or

b)  the UE supports local IP address in traffic flow aggregate description and TFT filter, the requested PDN Type is different from non-IP and Ethernet, and the requested APN is for UAS services.

This IE shall not be included if the Protocol configuration options IE is included in the message.

8.3.21  PDN disconnect reject

8.3.21.1  Message definition

This message is sent by the network to the UE to reject release of a PDN connection. See table  8.3.21.1.

Message type:  PDN DISCONNECT REJECT

Significance:  dual

Direction:  network to UE

8.3.21.2  Protocol configuration options

This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see clause  6.6.1.1).

8.3.21.3  Extended protocol configuration options

This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see clause  6.6.1.1).

8.3.22  PDN disconnect request

8.3.22.1  Message definition

This message is sent by the UE to the network to initiate release of a PDN connection. See table  8.3.22.1.

Message type:  PDN DISCONNECT REQUEST

Significance:  dual

Direction:  UE to network

8.3.22.2  Protocol configuration options

This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see clause  6.6.1.1).

8.3.22.3  Extended protocol configuration options

This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see clause  6.6.1.1).

8.3.23  Remote UE report

8.3.23.1  Message definition

This message is sent by the UE to the network to report connection or disconnection of remote UE(s). See table  8.3.23.1.

Message type:  REMOTE UE REPORT

Significance:  dual

Direction:  UE to network

8.3.23.2  Remote UE Context Connected

This IE is included in the message by the UE acting as ProSe UE-to-network relay to provide the network with newly connected remote UE information as specified in 3GPP  S  23.303  [31].

8.3.23.3  Remote UE Context Disconnected

This IE is included in the message by the UE acting as ProSe UE-to-Network Relay to provide the network with disconnected remote UE information as specified in 3GPP  S  23.303  [31].

8.3.23.4  ProSe Key Management Function Address

This IE is included in the message by the UE acting as ProSe UE-to-network relay to provide the network with the address of the ProSe Key Management Function associated with the remote UEs connected to or disconnected from the ProSe UE-to-network relay.

8.3.24  Remote UE report response

8.3.24.1  Message definition

This message is sent by the network to the UE to acknowledge receipt of a Remote UE report message. See table  8.3.24.1.

Message type:  REMOTE UE REPORT RESPONSE

Significance:  dual

Direction:  network to UE

8.3.25  ESM DATA TRANSPORT

8.3.25.1  Message definition

This message is sent by the UE or the network in order to carry user data in an encapsulated format. See table  8.3.25.1.

Message type:  ESM DATA TRANSPORT

Significance:  dual

Direction:  both

8.3.25.2  Release assistance indication

The UE may include this IE to inform the network whether

-  no further uplink and no further downlink data transmission is expected; or

-  only a single downlink data transmission (e.g. acknowledgement or response to uplink data) and no further uplink data transmission subsequent to the uplink data transmission is expected.



9  General message format and information elements coding

9.1  Overview

Within the protocols defined in the present document, every message, except the SERVICE REQUEST message, is a standard L3 message as defined in 3GPP  S  24.007  [12]. This means that the message consists of the following parts:

1)  if the message is a plain NAS message:

a)  protocol discriminator;

b)  EPS bearer identity or security header type;

c)  procedure transaction identity;

d)  message type;

e)  other information elements, as required.

2)  if the message is a security protected NAS message:

a)  protocol discriminator;

b)  security header type;

c)  message authentication code;

d)  sequence number;

e)  plain NAS message, as defined in item  1.

The organization of a plain NAS message is illustrated in the example shown in figure  9.1.1.

The EPS bearer identity and the procedure transaction identity are only used in messages with protocol discriminator EPS session management. Octet 1a with the procedure transaction identity shall only be included in these messages.

Unless specified otherwise in the message descriptions of clause  8, a particular information element shall not be present more than once in a given message.

When a field extends over more than one octet, the order of bit values progressively decreases as the octet number increases. The most significant bit of the field is represented by the highest numbered bit of the lowest numbered octet of the field. The least significant bit of the field is represented by the lowest numbered bit of the highest numbered octet of the field.

9.2  Protocol discriminator

The Protocol Discriminator (PD) and its use are defined in 3GPP  S  24.007  [12]. The protocol discriminator in the header (see 3GPP  S  24.007  [12]) of a security protected NAS message is encoded as "EPS mobility management messages".

9.3  Security header type and EPS bearer identity

9.3.1  Security header type

Bits 5 to 8 of the first octet of every EPS Mobility Management (EMM) message contain the Security header type IE. This IE includes control information related to the security protection of a NAS message. The total size of the Security header type IE is 4 bits.

The Security header type IE can take the values shown in table  9.3.1.

NOTE  1:  This codepoint may be used only for a SECURITY MODE COMMAND message.

NOTE  2:  This codepoint may be used only for a SECURITY MODE COMPLETE message.

NOTE  3:  When bits 7 and 8 are set to    '11   ', bits 5 and 6 can be used for future extensions of the SERVICE REQUEST message.

NOTE  4:  This codepoint may be used only for a CONTROL PLANE SERVICE REQUEST message.



An EMM message received with the security header type encoded as 0000 shall be treated as not security protected, plain NAS message. A protocol entity sending a not security protected EMM message shall send the message as plain NAS message and encode the security header type as 0000.

9.3.2  EPS bearer identity

Bits 5 to 8 of the first octet of every EPS Session Management (ESM) message contain the EPS bearer identity. The EPS bearer identity and its use to identify a message flow are defined in 3GPP  S  24.007  [12].

If the UE or the MME or both do not support signalling for a maximum number of 15 EPS bearer contexts, the MME shall select the EPS bearer identity from the value range 5 to 15, or select the value 0 when it needs to indicate that no EPS bearer identity is assigned.

NOTE:  When assigning EPS bearer identities from the range 1 to 4, the MME can take into account that these EPS bearer contexts will be subject to local deactivation if the UE performs inter-system change to A/Gb mode or Iu mode or if it performs a change to an MME not supporting signalling for a maximum number of 15 EPS bearer contexts.

9.4  Procedure transaction identity

Bits 1 to 8 of the second octet (octet 1a) of every EPS Session Management (ESM) message contain the procedure transaction identity. The procedure transaction identity and its use are defined in 3GPP  S  24.007  [12].

9.5  Message authentication code

  The Message authentication code (MAC) information element contains the integrity protection information for the message. The MAC IE shall be included in the security protected NAS message if a valid EPS security context exists and security functions are started. The usage of MAC is specified in clause  4.4.3.3.

9.6  Sequence number

This IE includes the NAS message sequence number (SN) which consists of the eight least significant bits of the NAS COUNT for a security protected NAS message. The usage of SN is specified in clause  4.4.3.

9.7  NAS message

This IE includes a complete plain NAS message as specified in clause  8.2 and 8.3. The SECURITY PROTECTED NAS MESSAGE and the SERVICE REQUEST message are not plain NAS messages and shall not be included in this IE.

9.8  Message type

The message type IE and its use are defined in 3GPP  S  24.007  [12]. Tables  9.8.1 and 9.8.2 define the value part of the message type IE used in the EPS mobility management protocol and EPS session management protocol.


9.9  Other information elements

9.9.1  General

The different formats (V, LV, T, TV, TLV, LV-E, TLV-E) and the five categories of information elements (type 1, 2, 3, 4 and 6) are defined in 3GPP  S  24.007  [12].

The first octet of an information element in the non-imperative part contains the IEI of the information element. If this octet does not correspond to an IEI known in the message, the receiver shall determine whether this IE is of type 1 or 2 (i.e. it is an information element of one octet length) or an IE of type 4 (i.e. that the next octet is the length indicator indicating the length of the remaining of the information element) (see 3GPP  S  24.007  [12]).

This allows the receiver to jump over unknown information elements and to analyse any following information elements.

The definitions of information elements which are common for the EMM and ESM protocols or which are used by access stratum protocols are described in clause  9.9.2.

The information elements of the EMM or ESM protocols can be defined by reference to an appropriate specification, e.g., "see clause  10.5.6.3 in 3GPP  S  24.008  [13]".

9.9.2  Common information elements

9.9.2.0  Additional information

The purpose of the Additional information information element is to provide additional information to upper layers in relation to the generic NAS message transport mechanism.

The Additional information information element is coded as shown in figure  9.9.2.0.1 and table  9.9.2.0.1.

The Additional information is a type 4 information element with a minimum length of 3 octets.

The coding of the additional information value is dependent on the generic message container type.

9.9.2.0A  Device properties

See clause  10.5.7.8 in 3GPP  S  24.008  [13].

9.9.2.1  EPS bearer context status

The purpose of the EPS bearer context status information element is to indicate the state of each EPS bearer context that can be identified by an EPS bearer identity.

The EPS bearer context status information element is coded as shown in figure  9.9.2.1.1 and table  9.9.2.1.1.

The EPS bearer context status information element is a type 4 information element with 4 octets length.

9.9.2.2  Location area identification

See clause  10.5.1.3 in 3GPP  S  24.008  [13].

9.9.2.3  Mobile identity

See clause  10.5.1.4 in 3GPP  S  24.008  [13].

9.9.2.4  Mobile station classmark 2

See clause  10.5.1.6 in 3GPP  S  24.008  [13].

9.9.2.5  Mobile station classmark 3

See clause  10.5.1.7 in 3GPP  S  24.008  [13].

9.9.2.6  NAS security parameters from E-UTRA

The purpose of the NAS security parameters from E-UTRA information element is to provide the UE with information that enables the UE to create a mapped UMTS security context.

The NAS security parameters from E-UTRA information element is coded as shown in figure  9.9.2.6.1 and table  9.9.2.6.1.

The NAS security parameters from E-UTRA is a type 3 information element with a length of 2 octets.

The value part of the NAS security parameters from E-UTRA information element is included in specific information elements within some RRC messages sent to the UE; see 3GPP  S  36.331  [22]. For these cases the coding of the information element identifier and length information is defined in 3GPP  S  36.331  [22].

DL NAS COUNT value (short) (octet 2, bit 1 to 4)



This field contains the 4 least significant bits of the binary representation of the downlink NAS COUNT value applicable when this information element is sent.



Bit 5 to 8 of octet 2 are spare and shall be coded as zero.



9.9.2.7  NAS security parameters to E-UTRA

The purpose of the NAS security parameters to E-UTRA information element is to provide the UE with parameters that enable the UE to create a mapped EPS security context and take this context into use after inter-system handover to S1 mode.

The NAS security parameters to E-UTRA information element is coded as shown in figure  9.9.2.7.1 and table  9.9.2.7.1.

The NAS security parameters to E-UTRA is a type 3 information element with a length of 7 octets.

The value part of the NAS security parameters to E-UTRA information element is included in specific information elements within some RRC messages sent to the UE; see 3GPP  S  36.331  [22]. For these cases the coding of the information element identifier and length information is defined in 3GPP  S  36.331  [22].

NonceMME value (octet 2 to 5)



This field is coded as the nonce value in the Nonce information element (see clause 9.9.3.25).



Type of integrity protection algorithm (octet 6, bit 1 to 3) and 
type of ciphering algorithm (octet 6, bit 5 to 7)



These fields are coded as the type of integrity protection algorithm and type of ciphering algorithm in the NAS security algorithms information element (see clause 9.9.3.23).



Bit 4 and 8 of octet 6 are spare and shall be coded as zero.



NAS key set identifier (octet 7, bit 1 to 3) and 
type of security context flag (TSC) (octet 7, bit 4)



These fields are coded as the NAS key set identifier and type of security context flag in the NAS key set identifier information element (see clause 9.9.3.21).



Bit 5 to 8 of octet 7 are spare and shall be coded as zero.





9.9.2.8  PLMN list

See clause  10.5.1.13 in 3GPP  S  24.008  [13].

9.9.2.9  Spare half octet

This element is used in the description of EMM and ESM messages when an odd number of half octet type 1 information elements are used. This element is filled with spare bits set to zero and is placed in bits 5 to 8 of the octet unless otherwise specified.

9.9.2.10  Supported codec list

See clause  10.5.4.32 in 3GPP  S  24.008  [13].

9.9.3  EPS Mobility Management (EMM) information elements

9.9.3.0A  Additional update result

The purpose of the Additional update result information element is to provide additional information about the result of a combined attach procedure or a combined tracking area updating procedure.

The Additional update result information element is coded as shown in figure  9.9.3.0A.1 and table  9.9.3.0A.1.

The Additional update result is a type 1 information element.

Bits 4 and 3 of octet 1 are spare and shall all be coded as zero.



NOTE:  Bits 4 and 3 of octet 1 were used in earlier versions of this release of this specification.



9.9.3.0B  Additional update type

The purpose of the Additional update type information element is to provide additional information about the type of request for an attach or a tracking area updating procedure.

The Additional update type information element is coded as shown in figure  9.9.3.0B.1 and table  9.9.3.0B.1.

The Additional update type is a type 1 information element.

9.9.3.1  Authentication failure parameter

See clause  10.5.3.2.2 in 3GPP  S  24.008  [13].

9.9.3.2  Authentication parameter AUTN

See clause  10.5.3.1.1 in 3GPP  S  24.008  [13].

9.9.3.3  Authentication parameter RAND

See clause  10.5.3.1 in 3GPP  S  24.008  [13].

9.9.3.4  Authentication response parameter

The purpose of the Authentication response parameter information element is to provide the network with the authentication response calculated in the USIM.

The Authentication response parameter information element is coded as shown in figure  9.9.3.4.1 and table  9.9.3.4.1.

The Authentication response parameter is a type 4 information element with a minimum length of 6 octets and a maximum length of 18 octets.

In an EPS authentication challenge, the response calculated in the USIM (RES) is minimum 4 octets and may be up to 16 octets in length.

In a 5G AKA authentication challenge, the response calculated in the ME (RES*) is 16 octets in length.


9.9.3.5  CSFB response

The purpose of the CSFB response information element is to indicate whether the UE accepts or rejects a paging for CS fallback.

The CSFB response information element is coded as shown in figure  9.9.3.5.1 and table  9.9.3.5.1.

The CSFB response is a type 1 information element.

9.9.3.6  Daylight saving time

See clause  10.5.3.12 in 3GPP  S  24.008  [13].

9.9.3.7  Detach type

The purpose of the Detach type information element is to indicate the type of detach.

The Detach type information element is coded as shown in figure  9.9.3.7.1 and table  9.9.3.7.1.

The Detach type is a type 1 information element.

9.9.3.8  DRX parameter

See clause  10.5.5.6 in 3GPP  S  24.008  [13].

9.9.3.9  EMM cause

The purpose of the EMM cause information element is to indicate the reason why an EMM request from the UE is rejected by the network.

The EMM cause information element is coded as shown in figure  9.9.3.9.1 and table  9.9.3.9.1.

The EMM cause is a type 3 information element with 2 octets length.


Any other value received by the mobile station shall be treated as 0110 1111, "protocol error, unspecified". Any other value received by the network shall be treated as 0110 1111, "protocol error, unspecified".



9.9.3.10  EPS attach result

The purpose of the EPS attach result information element is to specify the result of an attach procedure.

The EPS attach result information element is coded as shown in figure  9.9.3.10.1 and table  9.9.3.10.1.

The EPS attach result is a type 1 information element.

combined EPS/IMSI attach



All other values are reserved.



Bit 4 of octet 1 is spare and shall be coded as zero.





9.9.3.11  EPS attach type

The purpose of the EPS attach type information element is to indicate the type of the requested attach.

The EPS attach type information element is coded as shown in figure  9.9.3.11.1 and table  9.9.3.11.1.

The EPS attach type is a type 1 information element.

All other values are unused and shall be interpreted as "EPS attach", if received by the network.



Bit 4 of octet 1 is spare and shall be coded as zero.



NOTE:  "EPS RLOS attach" shall be interpreted as "EPS attach" by a network not supporting attach for access to RLOS.



9.9.3.12  EPS mobile identity

The purpose of the EPS mobile identity information element is to provide either the IMSI, the GUTI or the IMEI.

The EPS mobile identity information element is coded as shown in figures  9.9.3.12.1 and 9.9.3.12.2 and table  9.9.3.12.1.

The EPS mobile identity is a type 4 information element with a minimum length of 3 octets and a maximum length of 13 octets.


odd number of identity digits



Identity digits (octet 4 etc)



For the IMSI, this field is coded using BCD coding. If the number of identity digits is even then bits 5 to 8 of the last octet shall be filled with an end mark coded as "1111".



For the GUTI, then bits 5 to 8 of octet 3 are coded as "1111", octet 4 through 6 contain the MCC and MNC values as specified below, and bit 8 of octet 7 is the most significant bit and bit 1 of the last octet the least significant bit for the subsequent fields. The required fields for the GUTI are as defined in 3GPP  S  23.003  [2].



MCC, Mobile country code (octet 4, octet 5 bits 1 to 4)



The MCC field is coded as in ITU-T  Recommendation  E.212  [30], annex  A.



MNC, Mobile network code (octet 5 bits 5 to 8, octet 6)



The coding of this field is the responsibility of each administration but BCD coding shall be used. The MNC shall consist of 2 or 3 digits. If a network operator decides to use only two digits in the MNC, bits 5 to 8 of octet 5 shall be coded as "1111".



The MCC and MNC digits are coded as octets 6 to 8 of the Temporary Mobile Group Identity IE in figure  10.5.154 of 3GPP  S  24.008  [13].



For the IMEI, this field is coded using BCD coding. The format of the IMEI is described in 3GPP  S  23.003  [2].


9.9.3.12A  EPS network feature support

The purpose of the EPS network feature support information element is to indicate whether certain features are supported by the network.

The EPS network feature support information element is coded as shown in figure  9.9.3.12A.1 and table  9.9.3.12A.1.

The EPS network feature support is a type 4 information element with a minimum length of 3 octets and a maximum length of 5 octets.

If the network does not include octet 4 or octet 5 as defined below in the present version of the protocol, then the UE shall interpret this as a receipt of an information element with all bits of octet 4 and 5 coded as zero.

Interworking without N26 interface supported



Signalling for a maximum number of 15 EPS bearer contexts (15 bearers) (octet 4, bit 8)

This bit indicates the support of signalling for a maximum number of 15 EPS bearer contexts.


9.9.3.13  EPS update result

The purpose of the EPS update result information element is to specify the result of the associated updating procedure.

The EPS update result information element is coded as shown in figure  9.9.3.13.1 and table  9.9.3.13.1.

The EPS update result is a type 1 information element.

9.9.3.14  EPS update type

The purpose of the EPS update type information element is to specify the area the updating procedure is associated with.

The EPS update type information element is coded as shown in figure  9.9.3.14.1 and table  9.9.3.14.1.

The EPS update type is a type 1 information element.

9.9.3.15  ESM message container

The purpose of the ESM message container information element is to enable piggybacked transfer of a single ESM message within an EMM message. The ESM message included in this IE shall be coded as specified in clause  8.3, i.e. without NAS security header.

The ESM message container information element is coded as shown in figure  9.9.3.15.1 and table  9.9.3.15.1.

The ESM message container is a type 6 information element.

9.9.3.19  KSI and sequence number

  The purpose of the KSI and sequence number information element is to provide the network with the key set identifier (KSI) value of the current EPS security context and the 5 least significant bits of the NAS COUNT value applicable for the message including this information element.

The KSI and sequence number information element is coded as shown in figure  9.9.3.19.1 and table  9.9.3.19.1.

The KSI and sequence number is a type 3 information element with a length of 2 octets.

9.9.3.21  NAS key set identifier

The NAS key set identifier is allocated by the network.

The NAS key set identifier information element is coded as shown in figure  9.9.3.21.1 and table  9.9.3.21.1.

The NAS key set identifier is a type 1 information element.

9.9.3.22  NAS message container

This information element is used to encapsulate the SMS messages transferred between the UE and the network. The NAS message container information element is coded as shown in figure  9.9.3.22.1 and table  9.9.3.22.1.

The NAS message container is a type 4 information element with a minimum length of 4 octets and a maximum length of 253 octets.

9.9.3.23  NAS security algorithms

The purpose of the NAS security algorithms information element is to indicate the algorithms to be used for ciphering and integrity protection.

The NAS security algorithms information element is coded as shown in figure  9.9.3.23.1 and table  9.9.3.23.1.

The NAS security algorithms is a type 3 information element with a length of 2 octets.

9.9.3.24  Network name

See clause  10.5.3.5a in 3GPP  S  24.008  [13].

9.9.3.24A  Network resource identifier container

See clause  10.5.5.31 in 3GPP  S  24.008  [13].

9.9.3.25  Nonce

The purpose of the Nonce information element is to transfer a 32-bit nonce value to support deriving a new mapped EPS security context.

The Nonce information element is coded as shown in figure  9.9.3.25.1 and table  9.9.3.25.1.

The Nonce is a type 3 information element with a length of 5 octets.


9.9.3.25A  Paging identity

The purpose of the Paging identity information element is to indicate the identity used for paging for non-EPS services.

The Paging identity information element is coded as shown in figure  9.9.3.25A.1 and table  9.9.3.25A.1.

The Paging identity is a type 3 information element with 2 octets length.



9.9.3.26  P-TMSI signature

See clause  10.5.5.8 in 3GPP  S  24.008  [13].

9.9.3.26A  Extended EMM cause

The purpose of the extended EMM cause information element is to indicate additional information associated with the EMM cause.

The Extended EMM cause information element is coded as shown in figure  9.9.3.26A.1 and table  9.9.3.26A.1.

The Extended EMM cause is a type 1 information element.


9.9.3.28  Short MAC

  The purpose of the Short MAC information element is to protect the integrity of a SERVICE REQUEST message.

  The integrity protection shall include octet 1 and 2 of the SERVICE REQUEST message. For the used algorithm and other input parameters to the algorithm see clause  9.5. Only the 2 least significant octets of the resulting message authentication code are included in the information element.

The Short MAC information element is coded as shown in figure  9.9.3.28.1 and table  9.9.3.28.1.

The Short MAC is a type 3 information element with a length of 3 octets.

9.9.3.32  Tracking area identity

The purpose of the Tracking area identity information element is to provide an unambiguous identification of tracking areas within the area covered by the 3GPP system.

The Tracking area identity information element is coded as shown in figure  9.9.3.32.1 and table  9.9.3.32.1.

The Tracking area identity is a type 3 information element with a length of 6 octets.

If the TAI is deleted the MCC and MNC shall take the value from the deleted TAI.

In abnormal cases, the MCC stored in the UE can contain elements not in the set {0, 1 ... 9}. In such cases the UE should transmit the stored values using full hexadecimal encoding. When receiving such an MCC, the network shall treat the TAI as deleted.

MNC, Mobile network code (octet 3 bits 5 to 8, octet 4)

The coding of this field is the responsibility of each administration, but BCD coding shall be used. The MNC shall consist of 2 or 3 digits. For PCS 1900 for NA, Federal regulation mandates that a 3-digit MNC shall be used. However a network operator may decide to use only two digits in the MNC in the TAI over the radio interface. In this case, bits 5 to 8 of octet 3 shall be coded as "1111". Mobile equipment shall accept a TAI coded in such a way.



In abnormal cases, the MNC stored in the UE can have:

-  digit 1 or 2 not in the set {0, 1 ... 9}, or

-  digit 3 not in the set {0, 1 ... 9, F} hex.

In such cases the UE shall transmit the stored values using full hexadecimal encoding. When receiving such an MNC, the network shall treat the TAI as deleted.



The same handling shall apply for the network, if a 3-digit MNC is sent by the UE to a network using only a 2-digit MNC.



TAC, Tracking area code (octet 5 and 6)

In the TAC field bit 8 of octet 5 is the most significant bit and bit 1 of octet 6 the least significant bit.

The coding of the tracking area code is the responsibility of each administration except that two values are used to mark the TAC, and hence the TAI, as deleted. Coding using full hexadecimal representation may be used. The tracking area code consists of 2 octets.

If a TAI has to be deleted then all bits of the tracking area code shall be set to one with the exception of the least significant bit which shall be set to zero. If a USIM is inserted in a mobile equipment with the tracking area code containing all zeros, then the mobile equipment shall recognise this TAC as part of a deleted TAI.


9.9.3.33  Tracking area identity list

The purpose of the Tracking area identity list information element is to transfer a list of tracking areas from the network to the UE.

The coding of the information element allows combining different types of lists. The lists of type "00" and "01" allow a more compact encoding, when the different TAIs are sharing the PLMN identity.

The Tracking area identity list information element is coded as shown in figure  9.9.3.33.1, figure  9.9.3.33.2, figure  9.9.3.33.3, figure  9.9.3.33.4 and table  9.9.3.33.1.

The Tracking area identity list is a type 4 information element, with a minimum length of 8 octets and a maximum length of 98 octets. The list can contain a maximum of 16 different tracking area identities.

The value part of the Tracking area identity list information element consists of one or several partial tracking area identity lists. The length of each partial tracking area identity list can be determined from the    'type of list   ' field and the    'number of elements   ' field in the first octet of the partial tracking area identity list.

The UE shall store the complete list received. If more than 16 TAIs are included in this information element, the UE shall store the first 16 TAIs and ignore the remaining octets of the information element.

Partial tracking area identity list:

TAC, Tracking area code



In the TAC field bit 8 of the first octet is the most significant bit and bit 1 of second octet the least significant bit.

The coding of the tracking area code is the responsibility of each administration. Coding using full hexadecimal representation may be used. The tracking area code consists of 2 octets.



NOTE:  If the "list of TAIs belonging to different PLMNs" is used, the PLMNs included in the list need to be present in the list of "equivalent PLMNs".



9.9.3.34  UE network capability

The purpose of the UE network capability information element is to provide the network with information concerning aspects of the UE related to EPS or interworking with GPRS and 5GS. The contents might affect the manner in which the network handles the operation of the UE. The UE network capability information indicates general UE characteristics and it shall therefore, except for fields explicitly indicated, be independent of the frequency band of the channel it is sent on.

The UE network capability information element is coded as shown in figure  9.9.3.34.1 and table  9.9.3.34.1.

The UE network capability is a type 4 information element with a minimum length of 4 octets and a maximum length of 15 octets.

NOTE:  The requirements for the support of UMTS security algorithms in the UE are specified in 3GPP  S  33.102  [18], and the requirements for the support of EPS security algorithms in 3GPP  S  33.401  [19].

9.9.3.35  UE radio capability information update needed

The purpose of the UE radio capability information update needed information element is to indicate whether the MME shall delete the stored UE radio capability information, if any.

The UE radio capability information update needed information element is coded as shown in figure  9.9.3.35.1and table  9.9.3.35.1.

The UE radio capability information update needed is a type 1 information element.

9.9.3.36  UE security capability

The UE security capability information element is used by the network to indicate which security algorithms are supported by the UE in S1 mode, Iu mode and Gb mode. Security algorithms supported in S1 mode are supported both for NAS and for AS security. If the UE supports S101 mode, then these security algorithms are also supported for NAS security in S101 mode.

The UE security capability information element is coded as shown in figure  9.9.3.36.1 and table  9.9.3.36.1.

The UE security capability is a type 4 information element with a minimum length of 4 octets and a maximum length of 7 octets.

Octets 5, 6, and 7 are optional. If octet 5 is included, then also octet 6 shall be included and octet 7 may be included.

If a UE did not indicate support of any security algorithm for Gb mode, octet 7 shall not be included. If the UE did not indicate support of any security algorithm for Iu mode and Gb mode, octets 5, 6, and 7 shall not be included.

If the UE did not indicate support of any security algorithm for Iu mode but indicated support of a security algorithm for Gb mode, octets 5, 6, and 7 shall be included. In this case octets 5 and 6 are filled with the value of zeroes.


NOTE  1:  For a UE supporting dual connectivity with NR, if the UE supports one of the encryption algorithms for E-UTRAN (bits 8 to 5 of octet 3), it shall support the same algorithm for NR-PDCP as specified in 3GPP  S  33.401  [19].



NOTE  2:  For a UE supporting dual connectivity with NR, if the UE supports one of the integrity algorithms for E-UTRAN different from EIA0 (bits 7 to 5 of octet 4), it shall support the same algorithm for NR-PDCP as specified in 3GPP  S  33.401  [19].

9.9.3.37A  Extended emergency number list

The purpose of this information element is to encode one or more local emergency number(s) together with a sub-services field containing zero or more sub-services of the associated emergency service URN and a validity indication. An emergency service URN is a service URN with top level service type of "sos" as specified in IETF  RFC  5031  [55].

EXAMPLE  1:  If the associated emergency service URN is "urn:service:sos.gas", there is only one sub-service provided in the sub-services field which is "gas".

EXAMPLE  2:  If the associated emergency service URN is "urn:service:sos", there is no sub-services provided in the sub-services field and the length of the sub-services field is "0".

NOTE:  The associated emergency service URN can be a country-specific emergency service URN as defined in 3GPP  S  24.229  [13D].

The Extended emergency number list information element is coded as shown in figure  9.9.3.37A.1 and table  9.9.3.37A.1.

The Extended emergency number list IE is a type 6 information element with a minimum length of 7 octets and a maximum length of 65538 octets.


NOTE  1:  The length shall contain the number of octets used to encode the number digits.

NOTE  2:  The number digit(s) in octet 6 precedes the digit(s) in octet 7 etc. The number digit, which would be entered first, is located in octet 6, bits 1 to 4. The contents of the number digits are coded as shown in table  10.5.118/3GPP  S  24.008  [13].

NOTE  3:  If the emergency number contains an odd number of digits, bits 5 to 8 of the last octet of the respective emergency number shall be filled with an end mark coded as "1111".

NOTE  4:  The length shall contain the number of octets used to encode the sub-services field.

NOTE  5:  The characters of the sub-services of the associated emergency service URN shall be coded in accordance to GSM 7 bit default alphabet (see 3GPP  S  23.038  [3]) and the first character starts in octet j+1, l+1 or n+1.

9.9.3.43  Generic message container

This information element is used to encapsulate the application message transferred between the UE and the network. The generic message container information element is coded as shown in figure  9.9.3.43.1 and table  9.9.3.43.1.

The generic message container is a type 6 information element.


9.9.3.46  Extended DRX parameters

See clause  10.5.5.32 in 3GPP  S  24.008  [13].

9.9.3.47  Control plane service type

The purpose of the Control plane service type information element is to specify the purpose of the CONTROL PLANE SERVICE REQUEST message.

The Control plane service type information element is coded as shown in figure  9.9.3.47.1 and table  9.9.3.47.1.

The Control plane service type is a type 1 information element.


9.9.3.48  DCN-ID

See clause  10.5.5.35 in 3GPP  S  24.008  [13].

9.9.3.49  Non-3GPP NW provided policies

See clause  10.5.5.37 in 3GPP  S  24.008  [13].

9.9.3.50  HashMME

The purpose of the HashMME information element is to transfer a 64-bit hash value to the UE so the UE can check the MME calculated value against the value locally calculated by the UE to determine whether the ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message sent by the UE has been modified.

The HashMME information element is coded as shown in figure  9.9.3.50.1 and table  9.9.3.50.1.

The HashMME is a type 4 information element with a length of 10 octets.

9.9.3.51  Replayed NAS message container

The purpose of the Replayed NAS message container IE is to, during an ongoing attach or tracking area updating procedure, re-send the ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message with which the UE had initiated the procedure, if the MME has included a HASHMME in the SECURITY MODE COMMAND message and the HASHMME is different from the hash value locally calculated at the UE as described in 3GPP  S  33.401  [19]. If an ATTACH REQUEST message is included in this IE, the ATTACH REQUEST message shall be coded as specified in clause  8.2.4, i.e. without NAS security header. If a TRACKING AREA UPDATE REQUEST message is included in this IE, the TRACKING AREA UPDATE REQUEST message shall be coded as specified in clause  8.2.29, i.e. without NAS security header

The Replayed NAS message container information element is coded as shown in figure  9.9.3.51.1 and table  9.9.3.51.1.

The Replayed NAS message container is a type 6 information element.

PDN address information (octet 4 to 15)



If PDN type value indicates IPv4, the PDN address information in octet 4 to octet 7 contains an IPv4 address. Bit 8 of octet 4 represents the most significant bit of the IPv4 address and bit 1 of octet 7 the least significant bit.



If PDN type value indicates IPv6, the PDN address information in octet 4 to octet 11 contains an IPv6 interface identifier. Bit 8 of octet 4 represents the most significant bit of the IPv6 interface identifier and bit 1 of octet 11 the least significant bit.



If PDN type value indicates IPv4v6, the PDN address information in octet 4 to octet 15 contains an IPv6 interface identifier and an IPv4 address. Bit 8 of octet 4 represents the most significant bit of the IPv6 interface identifier and bit 1 of octet 11 the least significant bit. Bit 8 of octet 12 represents the most significant bit of the IPv4 address and bit 1 of octet 15 the least significant bit.



If PDN type value indicates IPv4 or IPv4v6 and DHCPv4 is to be used to allocate the IPv4 address, the IPv4 address shall be coded as 0.0.0.0.



If PDN type value indicates non IP, the PDN address information in octet 4 to octet 7 are spare and shall be coded as zero.



If PDN type value indicates Ethernet, the PDN address information in octet 4 to octet 7 are spare and shall be coded as zero.




9.9.4.10  PDN type

The purpose of the PDN type information element is to indicate:

-  the IP version capability of the IP stack associated with the UE;

-  non IP; or

-  Ethernet.

The PDN type information element is coded as shown in figure  9.9.4.10.1 and table  9.9.4.10.1.

The PDN type is a type 1 information element.



9.9.4.13A  Re-attempt indicator

The purpose of the Re-attempt indicator information element is to indicate a condition under which the UE is allowed, in the current PLMN for the same APN, to re-attempt a session management procedure (see 3GPP  S  24.008  [13]) corresponding to the EPS session management procedure which was rejected by the network.

The Re-attempt indicator information element is coded as shown in figure  9.9.4.13A/3GPP  S  24.301 and table  9.9.4.13A/3GPP  S  24.301.

The Re-attempt indicator is a type 4 information element with a length of 3 octets.

9.9.4.15  Traffic flow aggregate description

The purpose of the Traffic flow aggregate description information element is to specify the aggregate of one of more packet filters and their related parameters and operations. The traffic flow aggregate description may contain the aggregate of packet filters for the downlink direction, the uplink direction or packet filters that apply for both directions. The packet filters determine the traffic mapping to EPS bearer contexts. The downlink packet filters shall be applied by the network, and the uplink packet filters shall be applied by the UE. A packet filter that applies for both directions shall be applied by the network as a downlink packet filter and by the UE as an uplink packet filter.

When the traffic flow aggregate description is used in the UE requested bearer resource allocation procedure or the UE requested bearer resource modification procedure, it is associated to a particular procedure identified by a procedure transaction identity (PTI). Therefore, the UE shall release the traffic flow aggregate description when the UE requested bearer resource allocation procedure or the UE requested bearer resource modification procedure is completed. The UE shall not include the packet filters of a particular traffic flow aggregate description in any other traffic flow aggregate description when multiple UE requested bearer resource allocation procedures and/or UE requested bearer resource modification procedures are ongoing in parallel.

The Traffic flow aggregate description information element is encoded using the same format as the Traffic flow template (TFT) information element (see clause  10.5.6.12 in 3GPP  S  24.008  [13]). When sending this IE in the BEARER RESOURCE ALLOCATION REQUEST message or the BEARER RESOURCE MODIFICATION REQUEST message, the UE shall set the packet filter identifier values to 0 if the packet filters are newly created; otherwise, the UE shall set the packet filter identifier values from those of already assigned packet filter identifiers of the existing EPS bearer, so that they are unique across all packet filters for the EPS bearer context indicated by the EPS bearer identity IE.


Annex A (informative):
Cause values for EPS mobility management

A.1  Causes related to UE identification

Cause #2        IMSI unknown in HSS

  This EMM cause is sent to the UE if the UE is not known (registered) in the HSS or if the UE has packet only subscription. This EMM cause does not affect operation of the EPS service, although it may be used by an EMM procedure.

Cause #3        Illegal UE

  This EMM cause is sent to the UE when the network refuses service to the UE either because an identity of the UE is not acceptable to the network or because the UE does not pass the authentication check, i.e. the RES received from the UE is different from that generated by the network.

Cause #6        Illegal ME

  This EMM cause is sent to the UE if the ME used is not acceptable to the network, e.g. on the prohibited list.

Cause #9        UE identity cannot be derived by the network.

  This EMM cause is sent to the UE when the network cannot derive the UE   's identity from the GUTI/S-TMSI/P-TMSI and RAI e.g. no matching identity/context in the network or failure to validate the UE   's identity due to integrity check failure of the received message.

Cause #10        Implicitly detached

  This EMM cause is sent to the UE either if the network has implicitly detached the UE, e.g. after the implicit detach timer has expired, or if the EMM context data related to the subscription does not exist in the MME e.g. because of a MME restart, or because of a periodic tracking area update request routed to a new MME.

A.2  Cause related to subscription options

Cause #5        IMEI not accepted

  This cause is sent to the UE if the network does not accept an attach procedure for emergency bearer services using an IMEI.

Cause #7        EPS services not allowed

  This EMM cause is sent to the UE when it is not allowed to operate EPS services.

Cause #8        EPS services and non-EPS services not allowed

  This EMM cause is sent to the UE when it is not allowed to operate either EPS or non-EPS services.

Cause #11        PLMN not allowed

  This EMM cause is sent to the UE if it requests service, or if the network initiates a detach request, in a PLMN where the UE, by subscription or due to operator determined barring, is not allowed to operate.

Cause #12        Tracking area not allowed

  This EMM cause is sent to the UE if it requests service, or if the network initiates a detach request, in a tracking area where the HPLMN determines that the UE, by subscription, is not allowed to operate.

NOTE  1:  If EMM cause #12 is sent to a roaming subscriber the subscriber is denied service even if other PLMNs are available on which registration was possible.

Cause #13        Roaming not allowed in this tracking area

  This EMM cause is sent to an UE which requests service, or if the network initiates a detach request, in a tracking area of a PLMN which by subscription offers roaming to that UE but not in that tracking area.

Cause #14        EPS services not allowed in this PLMN

  This EMM cause is sent to the UE which requests service, or if the network initiates a detach request, in a PLMN which does not offer roaming for EPS services to that UE.

NOTE  2:  Since only one list of forbidden PLMNs for packet services is maintained in the UE, then the "forbidden PLMNs for GPRS service" is the maintained list and the forbidden PLMNs for EPS service is equivalent to it.

Cause #15        No suitable cells in tracking area

  This EMM cause is sent to the UE if it requests service, or if the network initiates a detach request, in a tracking area where the UE, by subscription, is not allowed to operate, but when it should find another allowed tracking area or location area in the same PLMN or an equivalent PLMN.

NOTE  3:  Cause #15 and cause #12 differ in the fact that cause #12 does not trigger the UE to search for another allowed tracking area on the same PLMN.

Cause #25        Not authorized for this CSG

  This EMM cause is sent to the UE if it requests access, or if the network initiates a detach request, in a CSG cell with CSG ID where the UE either has no subscription to operate or the UE   's subscription has expired and it should find another cell in the same PLMN or an equivalent PLMN.

Cause #35        Requested service option not authorized in this PLMN

  This EMM cause is sent to the UE if it requests in a PLMN a service option for which it is not authorized, e.g. if it attempts to attach for relay node operation in a PLMN with a USIM which does not belong to a relay node-specific subscription.

Cause #40        No EPS bearer context activated

  This EMM cause is sent to the UE, if during a tracking area updating procedure or a service request, the MME detects that there is no active EPS bearer context in the  network.

Cause #31        Redirection to 5GCN required

  This EMM cause is sent to the UE if it requests service in a PLMN where the UE by operator policy, is not allowed in EPC and redirection to 5GCN is required.

A.3  Causes related to PLMN specific network failures and congestion/authentication failures

Cause #16        MSC temporarily not reachable

  This EMM cause is sent to the UE if it requests a combined EPS attach or tracking area updating in a PLMN where the MSC is temporarily not reachable via the EPS part of the network.

Cause #17        Network failure

  This EMM cause is sent to the UE if the MME cannot service an UE generated request because of PLMN failures.

Cause #18        CS domain not available

  This EMM cause is sent to the UE if the MME cannot service an UE generated request because CS domain is not available and SMS in MME is not supported.

Cause #19        ESM failure

  This EMM cause is sent to the UE when there is a failure in the ESM message contained in the EMM message.

Cause #20        MAC failure

  This EMM cause is sent to the network if the USIM detects that the MAC in the AUTHENTICATION REQUEST message is not fresh (see 3GPP  S  33.401  [19]).

Cause #21        Synch failure

  This EMM cause is sent to the network if the USIM detects that the SQN in the AUTHENTICATION REQUEST message is out of range (see 3GPP  S  33.401  [19]).

Cause #22        Congestion

  This EMM cause is sent to the UE because of congestion in the network (e.g. no channel, facility busy/congested etc.).

Cause #23        UE security capabilities mismatch

  This EMM cause is sent to the network if the UE detects that the UE security capability does not match the one sent back by the network.

Cause #24        Security mode rejected, unspecified

  This EMM cause is sent to the network if the security mode command is rejected by the UE if the UE detects that the nonceUE does not match the one sent back by the network or for unspecified reasons.

Cause #26        Non-EPS authentication unacceptable

    This EMM cause is sent to the network in S1 mode if the "separation bit" in the AMF field of AUTN is set to 0 in the AUTHENTICATION REQUEST message (see 3GPP  S  33.401  [19]).

Cause #39        CS service temporarily not available

  This EMM cause is sent to the UE when the CS fallback or 1xCS fallback request cannot be served temporarily due to O&M reasons or a mobile terminating CS fallback call is aborted by the network during call establishment (see 3GPP  S  29.118  [16A]).

Cause #42        Severe network failure

  This EMM cause is sent to the UE when the network has determined that the requested procedure cannot be completed successfully due to network failure. The failure is not expected to be temporary and repeated request is not likely to succeed in near future.

Cause #78       PLMN not allowed to operate at the present UE location

  This EMM cause is sent to the UE to indicate that the PLMN is not allowed to operate at the present UE location.

NOTE:  This cause is only used by the network towards UE in NB-S1 mode or WB-S1 mode accessing the network through a satellite E-UTRA cell.

Annex B (informative):
Cause values for EPS session management

B.1  Causes related to nature of request

Cause #8        Operator Determined Barring

  This ESM cause is used by the network to indicate that the requested service was rejected by the MME due to Operator Determined Barring.

Cause #26        Insufficient resources

  This ESM cause is used by the UE or by the network to indicate that the requested service cannot be provided due to insufficient resources. If EPS counting is required for a network slice, this ESM cause is used by the network to indicate that the requested service cannot be provided due to maximum number of UEs registered to a specific network slice reached or maximum number of PDU sessions on a specific network slice reached.

Cause #27        Missing or unknown APN

  This ESM cause is used by the network to indicate that the requested service was rejected by the external packet data network because the access point name was not included although required or if the access point name could not be resolved.

Cause #28        Unknown PDN type

  This ESM cause is used by the network to indicate that the requested service was rejected by the external packet data network because the PDN type could not be recognised.

Cause #29        User authentication or authorization failed

  This ESM cause is used by the network to indicate that the requested service was rejected by the external packet data network due to a failed user authentication or revoked by the external packet data network.

Cause #30        Request rejected by Serving GW or PDN GW

  This ESM cause is used by the network to indicate that the requested service or operation or the request for a resource was rejected by the Serving GW or PDN GW.

Cause #31        Request rejected, unspecified

  This ESM cause is used by the network or by the UE to indicate that the requested service or operation or the request for a resource was rejected due to unspecified reasons.

Cause #32        Service option not supported

  This ESM cause is used by the network when the UE requests a service which is not supported by the PLMN.

Cause #33        Requested service option not subscribed

  This ESM cause is sent when the UE requests a service option for which it has no subscription.

Cause #34        Service option temporarily out of order

  This ESM cause is sent when the network cannot service the request because of temporary outage of one or more functions required for supporting the service.

Cause #35        PTI already in use

  This ESM cause is used by the network to indicate that the PTI included by the UE is already in use by another active UE requested procedure for this UE.

Cause #36        Regular deactivation

  This ESM cause is used to indicate a regular UE or network initiated release of EPS bearer resources.

Cause #37        EPS QoS not accepted

  This ESM cause is used by the network if the new EPS QoS cannot be accepted that was indicated in the UE request.

Cause #38        Network failure

  This ESM cause is used by the network to indicate that the requested service was rejected due to an error situation in the network.

Cause #39        Reactivation requested

  This ESM cause is used by the network to request a PDN connection reactivation.

Cause #41        Semantic error in the TFT operation.

  This ESM cause is used by the network or the UE to indicate that the requested service was rejected due to a semantic error in the TFT operation included in the request.

Cause #42        Syntactical error in the TFT operation.

  This ESM cause is used by the network or the UE to indicate that the requested service was rejected due to a syntactical error in the TFT operation included in the request.

Cause #43        Invalid EPS bearer identity

  This ESM cause is used by the network or the UE to indicate that the EPS bearer identity value provided to it is not a valid value for the received message or the EPS bearer context identified by the linked EPS bearer identity IE in the request is not active.

Cause #44        Semantic errors in packet filter(s)

  This ESM cause is used by the network or the UE to indicate that the requested service was rejected due to one or more semantic errors in packet filter(s) of the TFT included in the request.

Cause #45        Syntactical error in packet filter(s)

  This ESM cause is used by the network or the UE to indicate that the requested service was rejected due to one or more syntactical errors in packet filter(s) of the TFT included in the request.

Cause #47        PTI mismatch

  This ESM cause is used by the UE to indicate that the PTI value which is included in the ESM message that the UE receives does not match a PTI in use.

Cause #49        Last PDN disconnection not allowed

  This ESM cause is used by the network, in case of EMM-REGISTERED without PDN connection is not supported by the UE or the MME, to indicate that the UE requested PDN disconnection procedure on the last remaining PDN connection is not allowed.

Cause #50        PDN type IPv4 only allowed

  This ESM cause is used by the network to indicate that only PDN type IPv4 is allowed for the requested PDN connectivity.

Cause #51        PDN type IPv6 only allowed

  This ESM cause is used by the network to indicate that only PDN type IPv6 is allowed for the requested PDN connectivity.

Cause #52        single address bearers only allowed

  This ESM cause is used by the network to indicate that the requested PDN connectivity is accepted with the restriction that only single IP version bearers are allowed.

Cause #53        ESM information not received

  This ESM cause is used by the network to indicate that the PDN connectivity procedure was rejected due to the ESM information was not received.

Cause #54        PDN connection does not exist

  This ESM cause is used by the network at handover of a PDN connection from a non-3GPP access network connected to EPC, or at interworking of a PDU session from non-3GPP access network connected to 5GCN or from NG-RAN connected to 5GCN to a PDN connection, to indicate that the MME does not have any information about the requested PDN connection.

Cause #55        Multiple PDN connections for a given APN not allowed

  This ESM cause is used by the network to indicate that the PDN connectivity procedure was rejected due to multiple PDN connections for a given APN are not allowed.

Cause #56        Collision with network initiated request

  This ESM cause is used by the network to indicate that the network has already initiated the activation, modification or deactivation of bearer resources which was requested by the UE.

Cause #57        PDN type IPv4v6 only allowed

  This ESM cause is used by the network to indicate that only PDN types IPv4, IPv6 or IPv4v6 are allowed for the requested PDN connectivity.

Cause #58        PDN type non IP only allowed

  This ESM cause is used by the network to indicate that only PDN type non IP is allowed for the requested PDN connectivity.

Cause #59        Unsupported QCI value

  This ESM cause is used by the network if the QCI indicated in the UE request cannot be supported.

Cause #60        Bearer handling not supported

  This ESM cause is used by the network to indicate that the procedure requested by the UE was rejected because the bearer handling is not supported.

Cause #61        PDN type Ethernet only allowed

  This ESM cause is used by the network to indicate that only PDN type Ethernet is allowed for the requested PDN connectivity.

Cause #65        Maximum number of EPS bearers reached

  This ESM cause is used by the network to indicate that the procedure requested by the UE was rejected as the network has reached the maximum number of simultaneously active EPS bearer contexts for the UE.

Cause #66        Requested APN not supported in current RAT and PLMN combination

  This ESM cause is used by the network to indicate that the procedure requested by the UE was rejected as the requested APN is not supported in the current RAT and PLMN.

Cause #81        Invalid PTI value

  This ESM cause is used by the network or UE to indicate that the PTI provided to it is unassigned or reserved.

Cause #112        APN restriction value incompatible with active EPS bearer context.

  This ESM cause is used by the network to indicate that the EPS bearer context(s) have an APN restriction value that is not allowed in combination with a currently active EPS bearer context. Restriction values are defined in 3GPP  S  23.060  [4].

Cause #113        Multiple accesses to a PDN connection not allowed

  This ESM cause is used by the network to indicate that multiple accesses to a PDN connection for NBIFOM is not allowed.

B.2  Protocol errors (e.g., unknown message) class

Cause #95        Semantically incorrect message

  This ESM cause is used to report receipt of a message with semantically incorrect contents.

Cause #96        Invalid mandatory information

  This ESM cause indicates that the equipment sending this ESM cause has received a message with a non-semantical mandatory IE error.

Cause #97        Message type non-existent or not implemented

  This ESM cause indicates that the equipment sending this ESM cause has received a message with a message type it does not recognize either because this is a message not defined, or defined but not implemented by the equipment sending this ESM cause.

Cause #98        Message type not compatible with protocol state

  This ESM cause indicates that the equipment sending this ESM cause has received a message not compatible with the protocol state.

Cause #99        Information element non-existent or not implemented

  This ESM cause indicates that the equipment sending this ESM cause has received a message which includes information elements not recognized because the information element identifier is not defined or it is defined but not implemented by the equipment sending the ESM cause. However, the information element is not required to be present in the message in order for the equipment sending the ESM cause to process the message.

Cause #100        Conditional IE error

  This ESM cause indicates that the equipment sending this cause has received a message with conditional IE errors.

Cause #101        Message not compatible with protocol state

  This ESM cause indicates that a message has been received which is incompatible with the protocol state.

Cause #111        Protocol error, unspecified

  This ESM cause is used to report a protocol error event only when no other ESM cause in the protocol error class applies.


Annex C (normative):
Storage of EMM information

The following EMM parameters shall be stored on the USIM if the corresponding file is present:

-  GUTI;

-  last visited registered TAI;

-  EPS update status;

-  Allowed CSG list;

-  Operator CSG list; and

-  EPS security context parameters from a full native EPS security context (see 3GPP  S  33.401  [19]).

The presence and format of corresponding files on the USIM is specified in 3GPP  S  31.102  [17].

If the corresponding file is not present on the USIM, these EMM parameters except allowed CSG list are stored in a non-volatile memory in the ME together with the IMSI from the USIM. The allowed CSG list is stored in a non-volatile memory in the ME if the UE supports CSG selection. These EMM parameters can only be used if the IMSI from the USIM matches the IMSI stored in the non-volatile memory; else the UE shall delete the EMM parameters.

The following EMM parameters shall be stored in a non-volatile memory in the ME together with the IMSI from the USIM:

-  TIN;

-  DCN-ID list; and

-  network-assigned UE radio capability IDs.

The TIN parameter can only be used if the IMSI from the USIM matches the IMSI stored in the non-volatile memory of the ME; else the UE shall delete the TIN parameter.

The DCN-ID list consists of DCN-IDs stored together with a PLMN identity. The list can have zero or more entries and the maximum length shall be at least 32 entries. When the maximum length is reached any new entry shall replace the oldest entry in the list. There shall be no duplicated PLMN identities in the list and any existing DCN-ID shall be deleted when a new DCN-ID is added for the same PLMN.

The DCN-ID list can only be used if the IMSI from the USIM matches the IMSI stored in the non-volatile memory of the ME; else the UE shall delete the DCN-ID list. The UE shall delete the stored DCN-ID list if the default standardized DCN-ID in the UE is changed.

Each network-assigned UE radio capability ID is stored together with a PLMN identity of the PLMN that provided it as well as a mapping to the corresponding UE radio configuration, and is valid in that PLMN. A network-assigned UE radio capability ID can only be used if the IMSI from the USIM matches the IMSI stored in the non-volatile memory of the ME, else the UE shall delete the network-assigned UE radio capability ID. The UE shall be able to store at least the last 16 received network-assigned UE radio capability IDs. There shall be only one network-assigned UE radio capability ID stored for a given combination of PLMN identity and UE radio configuration and any existing UE radio capability ID shall be deleted when a new UE radio capability ID is added for the same combination of PLMN identity and UE radio configuration. If the UE receives a network-assigned UE radio capability ID with a Version ID value different from the value included in the network-assigned UE radio capability ID(s) stored at the UE for the serving PLMN, the UE may delete these stored network-assigned UE radio capability ID(s).

If the UE is attached for emergency bearer services, the UE shall not store the EMM parameters described in this annex on the USIM or in non-volatile memory. Instead the UE shall temporarily store these parameters locally in the ME and the UE shall delete these parameters when the UE is detached.

If the UE is configured for eCall only mode as specified in 3GPP  S  31.102  [17], the UE shall not store the EMM parameters described in this annex on the USIM or in non-volatile memory. Instead the UE shall temporarily store these parameters locally in the ME and the UE shall delete these parameters when the UE enters EMM-DEREGISTERED.eCALL-INACTIVE state, the UE is switched-off or the USIM is removed.

If the UE is attached for access to RLOS, the UE shall not store the EMM parameters described in this annex on the USIM or in non-volatile memory. Instead, the UE shall temporarily store these parameters locally in the ME and the UE shall delete these parameters after detach.

Annex D (normative):
Establishment cause (S1 mode only)

D.1  Mapping of NAS procedure to RRC establishment cause (S1 mode only)

When EMM requests the establishment of a NAS-signalling connection, or when EMM requests the lower layers to resume a NAS signalling connection, the RRC establishment cause used by the UE shall be selected according to the NAS procedure as specified in table  D.1.1. The EMM shall also indicate to the lower layer for the purpose of access control, the call type associated with the RRC establishment cause as specified in table  D.1.1. If the UE is configured for EAB (see the "ExtendedAccessBarring" leaf of NAS configuration MO in 3GPP  S  24.368  [15A] or 3GPP  S  31.102  [17]), the EMM shall indicate to the lower layer for the purpose of access control that EAB applies for this request except for the following cases:

-  the UE is a UE configured to use AC11        15 in selected PLMN;

-  the UE is answering to paging;

-  the RRC Establishment cause is set to "Emergency call";

-  the UE is configured to allow overriding EAB (see the "Override_ExtendedAccessBarring" leaf of the NAS configuration MO as specified in 3GPP  S  24.368  [15A] or 3GPP  S  31.102  [17]) and receives an indication from the upper layers to override EAB; or

-  the UE is configured to allow overriding EAB (see the "Override_ExtendedAccessBarring" leaf of the NAS configuration MO as specified in 3GPP  S  24.368  [15A] or 3GPP  S  31.102  [17]) and already has a PDN connection that was established with EAB override.

Table D.1.1: Mapping of NAS procedure to establishment cause and call type

NAS procedure

RRC establishment cause (according 3GPP TS 36.331 [22])

Call type

Attach

If an ATTACH REQUEST has EPS attach type not set to "EPS emergency attach", the RRC establishment cause shall be set to MO signalling except when the UE initiates attach procedure to establish emergency bearer services.
(See Note  1, Note  6)

"originating signalling"



If an ATTACH REQUEST contains the Device properties IE with low priority indicator set to "MS is configured for NAS signalling low priority", the RRC establishment cause shall be set to Delay tolerant.
(See Note  1, Note  6)

"originating signalling"





If an ATTACH REQUEST has EPS attach type set to "EPS emergency attach", or if the ATTACH REQUEST has EPS attach type not set to "EPS emergency attach" but the UE initiates the attach procedure either on receiving request from upper layer to establish emergency bearer services or with a PDN CONNECTIVITY REQUEST that has request type set to "handover of emergency bearer services", the RRC establishment cause shall be set to Emergency call.
(See Note  1, Note  4)

"emergency calls"





If the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP  S  24.368  [15A] or the USIM file EFNASCONFIG in 3GPP  S  31.102  [17]) and the attach procedure has been initiated upon receiving a request from upper layers to transmit user data related to an exceptional event, the RRC establishment cause shall be set to MO exception data.
(See Note  1) 

"originating signalling"



Tracking Area Update

If the UE does not have a PDN connection established for emergency bearer services and is not initiating a PDN CONNECTIVITY REQUEST that has request type set to "emergency" or "handover of emergency bearer services", and MO MMTEL voice call is not started, MO MMTEL video call is not started, MO SMSoIP is not started, MO SMS over NAS or MO SMS over S102 is not requested, the RRC establishment cause shall be set to MO signalling.
(See Note  1, Note  5, Note  6)

"originating signalling"



If the UE does not have a PDN connection established for emergency bearer services and is not initiating a PDN CONNECTIVITY REQUEST that has request type set to "emergency" or "handover of emergency bearer services", and an MO MMTEL voice call is started, the RRC establishment cause shall be set to MO signalling.
(See Note  1, Note  3, Note  5, Note  6)

"originating MMTEL voice"





If the UE does not have a PDN connection established for emergency bearer services and is not initiating a PDN CONNECTIVITY REQUEST that has request type set to "emergency" or "handover of emergency bearer services", and an MO MMTEL video call is started, the RRC establishment cause shall be set to MO signalling.
(See Note  1, Note  3, Note  5, Note  6)

"originating MMTEL video"





If the UE does not have a PDN connection established for emergency bearer services and is not initiating a PDN CONNECTIVITY REQUEST that has request type set to "emergency" or "handover of emergency bearer services", and an MO SMSoIP is started, the RRC establishment cause shall be set to MO signalling.
(See Note  1, Note  5, Note  6)

"originating SMSoIP"





If the UE does not have a PDN connection established for emergency bearer services and is not initiating a PDN CONNECTIVITY REQUEST that has request type set to "emergency" or "handover of emergency bearer services", and an MO SMS over NAS or MO SMS over S102 is requested, the RRC establishment cause shall be set to MO signalling.
(See Note  1, Note  5, Note  6)

"originating SMS"





If the UE does not have a PDN connection established for emergency bearer services and is not initiating a PDN CONNECTIVITY REQUEST that has request type set to "emergency" or "handover of emergency bearer services", the tracking area updating procedure is not triggered due to paging, a TRACKING AREA UPDATE REQUEST contains the Device properties IE with low priority indicator set to "MS is configured for NAS signalling low priority", and MO MMTEL voice call is not started, MO MMTEL video call is not started, MO SMSoIP is not started, MO SMS over NAS or MO SMS over S102 is not requested, the RRC establishment cause shall be set to Delay tolerant.
(See Note  1, Note  6)

"originating signalling"



If the UE does not have a PDN connection established for emergency bearer services and is not initiating a PDN CONNECTIVITY REQUEST that has request type set to "emergency" or "handover of emergency bearer services", an MO MMTEL voice call is started, and a TRACKING AREA UPDATE REQUEST contains the Device properties IE with low priority indicator set to "MS is configured for NAS signalling low priority", the RRC establishment cause shall be set to MO signalling.
(See Note  1, Note  3, Note  5, Note  6)

"originating MMTEL voice"





If the UE does not have a PDN connection established for emergency bearer services and is not initiating a PDN CONNECTIVITY REQUEST that has request type set to "emergency" or "handover of emergency bearer services", an MO MMTEL video call is started, and a TRACKING AREA UPDATE REQUEST contains the Device properties IE with low priority indicator set to "MS is configured for NAS signalling low priority", the RRC establishment cause shall be set to MO signalling.
(See Note  1, Note  3, Note  5, Note  6)

"originating MMTEL video"





If the UE does not have a PDN connection established for emergency bearer services and is not initiating a PDN CONNECTIVITY REQUEST that has request type set to "emergency" or "handover of emergency bearer services", an MO SMSoIP is started, and a TRACKING AREA UPDATE REQUEST contains the Device properties IE with low priority indicator set to "MS is configured for NAS signalling low priority", the RRC establishment cause shall be set to MO signalling.
(See Note  1, Note  5, Note  6)

"originating SMSoIP"





If the UE does not have a PDN connection established for emergency bearer services and is not initiating a PDN CONNECTIVITY REQUEST that has request type set to "emergency" or "handover of emergency bearer services", an MO SMS over NAS or MO SMS over S102 is requested, and a TRACKING AREA UPDATE REQUEST contains the Device properties IE with low priority indicator set to "MS is configured for NAS signalling low priority", the RRC establishment cause shall be set to MO signalling.
(See Note  1, Note  5, Note  6)

"originating SMS"





If the UE does not have a PDN connection established for emergency bearer services and is not initiating a PDN CONNECTIVITY REQUEST that has request type set to "emergency" or "handover of emergency bearer services", and a TRACKING AREA UPDATE REQUEST is a response to paging where the CN domain indicator is set to "PS" or "CS", the RRC establishment cause shall be set to MT access.
(See Note 1, Note  6)

"terminating calls"



If the UE does not have a PDN connection established for emergency bearer services and is not initiating a PDN CONNECTIVITY REQUEST that has request type set to "emergency" or "handover of emergency bearer services", and a TRACKING AREA UPDATE REQUEST is triggered upon receiving a "call-pull-initiated" indication from the upper layers (see 3GPP  S  24.174  [13F]), the RRC establishment cause shall be set to MT access.
(See Note 1)

"terminating calls"



If the UE has CS fallback emergency call or 1xCS fallback emergency call pending, the RRC establishment cause shall be set to Emergency call.
(See Note  1)

"emergency calls"



If the UE has a PDN connection established for emergency bearer services or is initiating a PDN CONNECTIVITY REQUEST that has request type set to "emergency" or "handover of emergency bearer services", the RRC establishment cause shall be set to Emergency call.
(See Note  1)

"emergency calls"



If the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP  S  24.368  [15A] or the USIM file EFNASCONFIG in 3GPP  S  31.102  [17]) and there is a pending request from upper layers to transmit user data related to an exceptional event, the RRC establishment cause shall be set to MO exception data. 

"originating signalling"





If the UE is requesting resources for V2X communication over PC5, the RRC establishment cause shall be set to MO signalling.
 (See Note  1)

"originating signalling"





If the UE is requesting resources for V2X communication over PC5 and a TRACKING AREA UPDATE REQUEST contains the Device properties IE with low priority indicator set to "MS is configured for NAS signalling low priority", the RRC establishment cause shall be set to Delay tolerant.
 (See Note  1)

"originating signalling"





If the UE is requesting resources for ProSe direct discovery or ProSe direct communication as specified in 3GPP  S  36.331  [22], the RRC establishment cause shall be set to MO signalling.
(See Note  1)

"originating signalling"





If the UE is requesting resources for ProSe direct discovery or ProSe direct communication as specified in 3GPP  S  36.331  [22] and a TRACKING AREA UPDATE REQUEST contains the Device properties IE with low priority indicator set to "MS is configured for NAS signalling low priority", the RRC establishment cause shall be set to Delay tolerant.
(See Note  1)

"originating signalling"



Detach

MO signalling
(See Note  1)

"originating signalling"



If a SERVICE REQUEST is to request user plane radio resources and MO MMTEL voice call is not started, MO MMTEL video call is not started and MO SMSoIP is not started, the RRC establishment cause shall be set to MO data.
(See Note  1, Note  6)

"originating calls"



If a SERVICE REQUEST is to request user plane radio resources and an MO MMTEL voice call is started, the RRC establishment cause shall be set to MO data.
(See Note  1, Note  3, Note  6)

"originating MMTEL voice"



If a SERVICE REQUEST is to request user plane radio resources and an MO MMTEL video call is started, the RRC establishment cause shall be set to MO data.
(See Note  1, Note  3, Note  6)

"originating MMTEL video



If a SERVICE REQUEST is to request user plane radio resources and an MO SMSoIP is started, the RRC establishment cause shall be set to MO data.
(See Note  1, Note  6)  

"originating SMSoIP"



If a SERVICE REQUEST is to request user plane radio resources for emergency bearer services, the RRC establishment cause shall be set to Emergency call.
(See Note  1)

"emergency calls"



If a SERVICE REQUEST is to request resources for UL signalling and not for MO SMS over NAS or MO SMS over S102, the RRC establishment cause shall be set to MO data.
(See Note  1, Note  6)

"originating calls"



If a SERVICE REQUEST is to request resources for UL signalling for MO SMS over NAS or MO SMS over S102, the RRC establishment cause shall be set to MO data.
(See Note  1, Note  6)

"originating SMS"



If a SERVICE REQUEST is to request user plane radio resources or to request resources for UL signalling and the UE is configured for dual priority and the NAS signalling low priority indicator is overridden, the RRC establishment cause shall be set to MO data.
(See Note  1, Note  6)

"originating calls"



If a SERVICE REQUEST is triggered by a PDN CONNECTIVITY REQUEST that has request type set to "emergency" or "handover of emergency bearer services", the RRC establishment cause shall be set to Emergency call.
(See Note  1)

"emergency calls"



If a SERVICE REQUEST is to request user plane radio resources or to request resources for UL signalling, the UE is configured for NAS signalling low priority, and MO MMTEL voice call is not started, MO MMTEL video call is not started and MO SMSoIP is not started, MO SMS over NAS or MO SMS over S102 is not requested, the RRC establishment cause shall be set to Delay tolerant.
(See Note  1, Note  6)

"originating calls"



If a SERVICE REQUEST is to request user plane radio resources, an MO MMTEL voice call is started, and the UE is configured for NAS signalling low priority, the RRC establishment cause shall be set to MO data.
(See Note  1, Note  3, Note  6)

"originating MMTEL voice"



If a SERVICE REQUEST is to request user plane radio resources, an MO MMTEL video call is started, and the UE is configured for NAS signalling low priority, the RRC establishment cause shall be set to MO data.
(See Note  1, Note  3, Note  6)

"originating MMTEL video"



If a SERVICE REQUEST is to request user plane radio resources, an MO SMSoIP is started, and the UE is configured for NAS signalling low priority, the RRC establishment cause shall be set to MO data.
(See Note  1, Note  6)

"originating SMSoIP"



If a SERVICE REQUEST is to request resources for UL signalling for MO SMS over NAS or MO SMS over S102 and the UE is configured for NAS signalling low priority, the RRC establishment cause shall be set to MO data.
(See Note  1, Note  6)

"originating SMS"



If a SERVICE REQUEST is a response to paging where the CN domain indicator is set to "PS", the RRC establishment cause shall be set to MT access.
(See Note  1, Note  6)

"terminating calls"





If a SERVICE REQUEST is triggered upon receiving a "call-pull-initiated" indication from the upper layers (see 3GPP  S  24.174  [13F]), the RRC establishment cause shall be set to MT access.
(See Note 1)

"terminating calls"



If a SERVICE REQUEST is triggered to request resources for ProSe direct discovery or ProSe direct communication as specified in 3GPP  S  36.331  [22], the RRC establishment cause shall be set to MO data.
(See Note  1, Note  6)

"originating calls"



If a SERVICE REQUEST is triggered to request resources for ProSe direct discovery or ProSe direct communication as specified in 3GPP  S  36.331  [22] and the UE is configured for NAS signalling low priority, the RRC establishment cause shall be set to Delay tolerant.
(See Note  1, Note  6)

"originating calls"



If a SERVICE REQUEST is triggered to request resources for V2X communication over PC5, the RRC establishment cause shall be set to MO data.
(See Note  1)

"originating calls"



If a SERVICE REQUEST is triggered to request resources for V2X communication over PC5 and the UE is configured for NAS signalling low priority, the RRC establishment cause shall be set to Delay tolerant.
(See Note  1)

"originating calls"



If an EXTENDED SERVICE REQUEST has service type set to "packet services via S1" and is to request user plane radio resources for emergency bearer services, the RRC establishment cause shall be set to Emergency call.
(See Note  1)

"emergency calls"



If an EXTENDED SERVICE REQUEST has service type set to "packet services via S1" and is triggered by a PDN CONNECTIVITY REQUEST that has request type set to "emergency" or "handover of emergency bearer services", the RRC establishment cause shall be set to Emergency call.
(See Note  1)

"emergency calls"



If an EXTENDED SERVICE REQUEST has service type set to "packet services via S1" and is a response to paging where the CN domain indicator is set to "PS", the RRC establishment cause shall be set to MT access.
(See Note  1, Note  6)

"terminating calls"



If an EXTENDED SERVICE REQUEST has service type set to "mobile originating CS fallback or 1xCS fallback" and is to request mobile originating 1xCS fallback, or if an EXTENDED SERVICE REQUEST is a response to paging for 1xCS fallback received over cdma2000   xae 1xRTT and has service type set to "mobile terminating CS fallback or 1xCS fallback", the RRC establishment cause shall be set to MO data.
(See Note  1, Note  6).

"originating calls"



If an EXTENDED SERVICE REQUEST has service type set to "mobile originating CS fallback or 1xCS fallback" and is to request mobile originating CS fallback, the RRC establishment cause shall be set to MO data.
(See Note  1, Note  6).

"mobile originating CS fallback"



If an EXTENDED SERVICE REQUEST is a response to paging for CS fallback, service type set to "mobile terminating CS fallback or 1xCS fallback", the RRC establishment cause shall be set to MT access.
(See Note1, Note  2, Note  6).

"terminating calls"



If an EXTENDED SERVICE REQUEST has service type set to "mobile originating CS fallback emergency call or 1xCS fallback emergency call", the RRC establishment cause shall be set to Emergency call. 
(See Note  1).

"emergency calls"



If an EXTENDED SERVICE REQUEST contains the Device properties IE with low priority indicator set to "MS is not configured for NAS signalling low priority", and MO MMTEL voice call is not started, MO MMTEL video call is not started and MO SMSoIP is not started, MO SMS over NAS or MO SMS over S102 is not requested, the RRC establishment cause shall be set to MO data.
(See Note  1, Note  6)

"originating calls"



If an EXTENDED SERVICE REQUEST contains the Device properties IE with low priority indicator set to "MS is not configured for NAS signalling low priority" and an MO MMTEL voice call is started, the RRC establishment cause shall be set to MO data.
(See Note  1, Note  3, Note  6)

"originating MMTEL voice"





If an EXTENDED SERVICE REQUEST contains the Device properties IE with low priority indicator set to "MS is not configured for NAS signalling low priority" and an MO MMTEL video call is started, the RRC establishment cause shall be set to MO data.
(See Note  1, Note  3, Note  6)

"originating MMTEL video"





If an EXTENDED SERVICE REQUEST contains the Device properties IE with low priority indicator set to "MS is not configured for NAS signalling low priority" and an MO SMSoIP is started, the RRC establishment cause shall be set to MO data.
(See Note  1, Note  6)

"originating SMSoIP"





If an EXTENDED SERVICE REQUEST contains the Device properties IE with low priority indicator set to "MS is not configured for NAS signalling low priority" and an MO SMS over NAS or MO SMS over S102 is requested, the RRC establishment cause shall be set to MO data.
(See Note  1, Note  6)

"originating SMS"





If an EXTENDED SERVICE REQUEST contains the Device properties IE with low priority indicator set to "MS is configured for NAS signalling low priority", and MO MMTEL voice call is not started, MO MMTEL video call is not started and MO SMSoIP is not started, MO SMS over NAS or MO SMS over S102 is not requested, the RRC establishment cause shall be set to Delay tolerant.
(See Note  1, Note  6).

"originating calls"



If an EXTENDED SERVICE REQUEST contains the Device properties IE with low priority indicator set to "MS is configured for NAS signalling low priority" and an MO MMTEL voice call is started, the RRC establishment cause shall be set to MO data.
(See Note  1, Note  3, Note  6)

"originating MMTEL voice"





If an EXTENDED SERVICE REQUEST contains the Device properties IE with low priority indicator set to "MS is configured for NAS signalling low priority" and an MO MMTEL video call is started, the RRC establishment cause shall be set to MO data.
(See Note  1, Note  3, Note  6)

"originating MMTEL video"





If an EXTENDED SERVICE REQUEST contains the Device properties IE with low priority indicator set to "MS is configured for NAS signalling low priority" and an MO SMSoIP is started, the RRC establishment cause shall be set to MO data.
(See Note  1, Note  6)

"originating SMSoIP"





If an EXTENDED SERVICE REQUEST contains the Device properties IE with low priority indicator set to "MS is configured for NAS signalling low priority" and an MO SMS over NAS or MO SMS over S102 is requested, the RRC establishment cause shall be set to MO data.
(See Note  1, Note  6)

"originating SMS"





If an EXTENDED SERVICE REQUEST contains the Device properties IE with low priority indicator set to "MS is not configured for NAS signalling low priority" and is triggered to request resources for ProSe direct discovery or ProSe direct communication, the RRC establishment cause shall be set to MO data.
(See Note  1)

"originating calls"





If an EXTENDED SERVICE REQUEST contains the Device properties IE with low priority indicator set to "MS is configured for NAS signalling low priority" and is triggered to request resources for ProSe direct discovery or ProSe direct communication, the RRC establishment cause shall be set to Delay tolerant.
(See Note  1)

"originating calls"





If an EXTENDED SERVICE REQUEST contains the Device properties IE with low priority indicator set to "MS is not configured for NAS signalling low priority" and is triggered to request resources for V2X communication over PC5, the RRC establishment cause shall be set to MO data.
(See Note  1)

"originating calls"





If an EXTENDED SERVICE REQUEST contains the Device properties IE with low priority indicator set to "MS is configured for NAS signalling low priority" and is triggered to request resources for V2X communication over PC5, the RRC establishment cause shall be set to Delay tolerant.
(See Note  1)

"originating calls"





If a CONTROL PLANE SERVICE REQUEST is a response to paging where the Control plane service type is set to "mobile terminating request", the RRC establishment cause shall be set to MT access. (see Note  1, Note  6)

"terminating calls"



If a CONTROL PLANE SERVICE REQUEST is to transfer user data or to request resources for UL signalling, the RRC establishment cause shall be set to MO data.
(see Note  1, Note  6)

"originating calls"





If a CONTROL PLANE SERVICE REQUEST is to transfer user data or to request resources for UL signalling and contains the Device properties IE with low priority indicator set to "MS is configured for NAS signalling low priority", the RRC establishment cause shall be set to Delay tolerant.
(see Note  1, Note  6)

"originating calls"





In WB-S1 Mode, if a CONTROL PLANE SERVICE REQUEST is to transfer MO SMS, the RRC establishment cause shall be set to MO data.
(see Note  1, Note  6)

"originating SMS"





In NB-S1 Mode, if a CONTROL PLANE SERVICE REQUEST is to transfer MO SMS, the RRC establishment cause shall be set to MO data.

"originating calls"





In NB-S1 Mode, if a CONTROL PLANE SERVICE REQUEST is to transfer MO SMS and contains the Device properties IE with low priority indicator set to "MS is configured for NAS signalling low priority", the RRC establishment cause shall be set to Delay tolerant.

"originating calls"





If the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP  S  24.368  [15A] or the USIM file EFNASCONFIG in 3GPP  S  31.102  [17]) and a CONTROL PLANE SERVICE REQUEST is to perform initial data transfer related to an exceptional event, the RRC establishment cause shall be set to MO exception data.

"originating calls"



Note 1:  For these NAS procedures in WB-S1 mode initiated by UEs of access class 12, 13 or 14 in their home country, the RRC establishment cause will be set to "High priority access AC 11        15". For this purpose, the home country is defined as the country to which the MCC part of the IMSI is associated, see 3GPP  S  23.122  [6] for the definition of country.

  For these NAS procedures in WB-S1 mode initiated by UE of access class 11 or 15 in their HPLMN (if the EHPLMN list is not present or is empty) or EHPLMN (if the EHPLMN list is present), the RRC establishment cause will be set to "High priority access AC 11        15".

Note 2:  This row is not applicable for mobile terminating 1xCS fallback with 1xCS paging request received over E-UTRAN.

Note 3:  For these NAS procedures, the lower layers can change the RRC establishment cause from "MO data" or from "MO Signalling" to "MO Voice Call", if the serving cell requests the UE to use the RRC establishment cause "MO voice call" (see 3GPP  S  36.331  [22]).

Note 4:  It is an implementation option to initiate attach request carrying a PDN CONNECTIVITY REQUEST with request type "handover of emergency bearer services" to support access transfer of an ongoing emergency session from non-3GPP access to 3GPP access when the UE is not already in EMM-REGISTERED state.

Note 5:  For these NAS procedures, the lower layers can change the RRC establishment cause from "MO Signalling" to "MO Voice Call" during EPS fallback for IMS voice (see 3GPP  S  36.331  [22]).

Note  6:  For these NAS procedures in WB-S1 mode initiated by UEs following a release with redirection  with an mpsPriorityIndication indicating that the UE has an active MPS session, the lower layers can set the RRC establishment cause to "High priority access AC 11        15", including for UEs with an access class other than 11, 12, 13, 14 or 15.



NOTE:  The RRC establishment cause can be used by the network to prioritise the connection establishment request from the UE at high load situations in the network.




Annex E (informative):
Guidelines for enhancements to MS network capability IE and UE network capability IE

The UE uses the information elements MS network capability and UE network capability to inform the core network about its network related capabilities. Both information elements can be signalled in any of the modes: A/Gb mode, Iu mode and S1 mode.

The purpose of the present annex is to give some guidelines how to select the information element(s) to be enhanced if new capabilities need to be added.

1)  If a capability is related to a feature that can be used in a network supporting A/Gb mode only or Iu mode only or both, the capability will be signalled in the MS network capability IE.

2)  If a capability is related to a feature that can be used in network supporting S1 mode only, the capability will be signalled in the UE network capability IE.

3)  If a capability is related to a feature that can be used only in a network supporting both S1 mode and at least one of the two modes A/Gb mode and Iu mode, the capability is added only to one of the two information elements:

a)  If the information is used by the MME only, the capability will be signalled in the UE network capability IE.

b)  If the information is used by the SGSN only or both by the SGSN and by the MME, the capability will be signalled in the MS network capability IE.

NOTE:  The reason for rules 1 and 2 is that a UE not supporting A/Gb mode and Iu mode will not provide the MS network capability IE to the network and a UE not supporting S1 mode will not provide the UE network capability IE. In some cases, due to rules 1 and 2 the capability indicator will be included in both information elements.

EXAMPLE  1:  The support indicator for UCS2 is included in both information elements.

EXAMPLE  2:  The "SRVCC to GERAN/UTRAN capability" is included in the MS network capability IE, as it is used both by the MME for SRVCC from E-UTRAN to GERAN/UTRAN and by the SGSN for SRVCC from UTRAN HSPA to GERAN/UTRAN.


Annex F (normative):
Application specific Congestion control for Data Communication (ACDC)

The UE may support the procedures in this annex.

If the UE supports ACDC, the EMM layer shall determine the ACDC category applicable to the request based on the application identifier received from the upper layers and the configuration information in the "ACDCConf" leaf of ACDC MO as specified in 3GPP  S  24.105  [35] or in the USIM EFACDC as specified in 3GPP  S  31.102  [17].

NOTE  1:  As an implementation option, the upper layers can determine the ACDC category and send it to the EMM layer. Then the EMM layer need not read the ACDC MO or USIM to determine the ACDC category.

The EMM sublayer shall indicate to the lower layers, for the purpose of access control:

-  the ACDC category that applies to this request if only one ACDC category is applicable;

-  the highest ranked ACDC category among the ACDC categories that applies to this request if multiple ACDC categories are applicable; or

-  this request is for an uncategorized application if an application identifier received from the upper layers is not mapped to any ACDC category,

except for the following cases:

-  the UE is a UE configured to use AC11        15 in selected PLMN;

-  the UE is answering to paging;

-  the RRC Establishment cause is set to "Emergency call"; or

-  if conditions MO MMTEL voice call is started or MO MMTEL video call is started or MO SMSoIP is started, is satisfied.

NOTE  2:  The request from the EMM sublayer refers to either a request to establish an initial NAS signalling connection or a request to re-establish a NAS signalling connection.

If the UE supports ACDC and access is barred because of ACDC, the EMM layer shall keep track of the ACDC category for which access is barred and it shall not send a request for the same ACDC category or a lower ACDC category until access is granted.

If the UE supports ACDC and access is barred because of ACDC, the EMM layer shall not send a request for any uncategorized application until access is granted.
